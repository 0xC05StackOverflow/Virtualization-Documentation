# Hypervisor Top-Level Functional Specification

Windows Server 2016 Technical Preview 4, Windows 10

December, 2015: Released Version 5.0a

## Abstract

This document is the top-level functional specification (TLFS) of the
fifth-generation Microsoft hypervisor. It specifies the hypervisor’s
externally-visible behavior. The document assumes familiarity with the
goals of the project and the high-level hypervisor architecture.

This draft corresponds to Windows Server 2016 Technical Preview 4.

This specification is provided under the Microsoft Open Specification
Promise. For further details on the Microsoft Open Specification
Promise, please refer to:
[http://www.microsoft.com/interop/osp/default.mspx](http://www.microsoft.com/interop/osp/default.mspx). Microsoft may have
patents, patent applications, trademarks, copyrights, or other
intellectual property rights covering subject matter in these materials.
Except as expressly provided in the Microsoft Open Specification
Promise, the furnishing of these materials does not give you any license
to these patents, trademarks, copyrights, or other intellectual
property.

## Copyright Information  

This document is provided “as-is". Information and views expressed in
this document, including URL and other Internet Web site references, may
change without notice.

Some examples depicted herein are provided for illustration only and are
fictitious.  No real association or connection is intended or should be
inferred.

This document does not provide you with any legal rights to any
intellectual property in any Microsoft product. You may copy and use
this document for your internal, reference purposes.

© 2015 Microsoft. All rights reserved.

Microsoft, Windows, Windows NT, Windows Server, and Windows Vista are
either registered trademarks or trademarks of Microsoft Corporation in
the United States and/or other countries.

All other trademarks are property of their respective owners.

## Introduction

This document is the top-level functional specification (TLFS) of the
fifth-generation Microsoft hypervisor. It specifies the
externally-visible behavior to guest partitions. The document assumes
familiarity with the goals of the project and the high-level hypervisor
architecture.

This document is intended to be sufficiently complete and precise to
allow a developer to implement a guest partition interface with the
Microsoft hypervisor.

### Specification Style

This specification is informal; that is, the interfaces are not
specified in a formal language. Nevertheless, it is a goal to be
precise. It is also a goal to specify which behaviors are architectural
and which are implementation-specific. Callers should not rely on
behaviors that fall into the latter category because they may change in
future implementations.

Segments of code and algorithms are presented with a grey background.

### Interface Requirements and Goals
The hypervisor interfaces are designed with the following requirements
and goals in mind:  

**Performance:**  
The amount of time spent in the hypervisor in response
to a hypercall should be bounded to 50µs. This restriction requires that
operations acting on large lists or ranges must be piece-wise
interruptible.

**Hardware Independence –**  
To the extent possible, the interfaces
should be independent of hardware architecture. Although the
first-generation hypervisor will run only on x64 processors, it is
highly likely that future versions will be ported to other
architectures. It may not be possible to implement certain aspects of an
architecture in a transparent manner. The x64 implementation exposes
architecture-specifics with the handling of the CPUID instruction (the
specifics are detailed in this specification).

**Scalability –**  
The interfaces should provide significant “future
proofing" and therefore should not impose short-sighted restrictions on
memory size, address space size, processor count, and so on.

**Flexibility –**  
The interfaces should allow a conforming hypervisor
implementation to correctly virtualize all aspects of the underlying
system architecture. In some cases, the architecture may allow
implementations the freedom not to virtualize all aspects correctly, but
it should not constrain an implementation in a way that it cannot
virtualize all aspects correctly.

### Reserved Values  
This specification documents some fields as "reserved." These fields may
be given specific meaning in future versions of the hypervisor
architecture. For maximum forward compatibility, clients of the
hypervisor interface should follow the guidance provided within this
document. In general, two forms of guidance are provided.

**Preserve value** (documented as "RsvdP" in diagrams and `ReservedP` in
code segments) **–** For maximum forward compatibility, clients should
preserve the value within this field. This is typically done by reading
the current value, modifying the values of the non-reserved fields, and
writing the value back.

**Zero value** (documented as "RsvdZ" in diagrams and `ReservedZ` in code
segments) **–** For maximum forward compatibility, clients should zero
the value within this field.

Reserved fields within read-only structures are simply documented as
*Rsvd* in diagrams and simply as Reserved in code segments. For maximum
forward compatibility, the values within these fields should be ignored.
Clients should not assume these values will always be zero.

> Note regarding previous versions  
Previous versions of this document included documentation of
non-essential interfaces between the root partition and the hypervisor.
In the interest of clarity, the documentation of these interfaces has
been removed. Only useful overview information and guest interfaces are
included.  
If root interface documentation is required, please contact Microsoft
directly.

** Report Issues **  
If you notice errors in this document, or would like to give feedback,
please file an issue in our GitHub repository.

## Basic Data Types, Concepts and Notation

### Simple Scalar Types

Hypervisor data types are built up from simple scalar types UINT8,
UINT16, UINT32, UINT64 and UINT128. Each of these represents a simple
unsigned integer scalar with the specified bit count. Several
corresponding signed integer scalars are also defined: INT8, INT16,
INT32, and INT64.

The hypervisor uses neither floating point instructions nor floating
point types.

<span id="_Toc110172654" class="anchor"><span id="_Toc127596639" class="anchor"><span id="_Toc127786260" class="anchor"><span id="_Toc127786576" class="anchor"><span id="_Toc127786892" class="anchor"><span id="_Toc127877488" class="anchor"><span id="_Toc128289559" class="anchor"><span id="_Toc128289952" class="anchor"><span id="_Toc130189634" class="anchor"><span id="_Toc130200850" class="anchor"><span id="_Toc130201166" class="anchor"><span id="_Toc130201487" class="anchor"><span id="_Toc131936574" class="anchor"><span id="_Toc133901012" class="anchor"><span id="_Toc137460917" class="anchor"><span id="_Toc139096432" class="anchor"><span id="_Toc139188353" class="anchor"><span id="_Toc139191216" class="anchor"><span id="_Toc140490266" class="anchor"><span id="_Toc140571169" class="anchor"><span id="_Toc141257439" class="anchor"><span id="_Toc141257766" class="anchor"><span id="_Toc141267293" class="anchor"><span id="_Toc141522311" class="anchor"><span id="_Toc141529402" class="anchor"><span id="_Toc141529719" class="anchor"><span id="_Toc141851326" class="anchor"><span id="_Toc141852260" class="anchor"><span id="_Toc141887802" class="anchor"><span id="_Toc141889642" class="anchor"><span id="_Toc141893311" class="anchor"><span id="_Toc142113160" class="anchor"><span id="_Toc142114188" class="anchor"><span id="_Toc142729348" class="anchor"><span id="_Toc142730632" class="anchor"><span id="_Toc142731005" class="anchor"><span id="_Toc142998370" class="anchor"><span id="_Toc143063461" class="anchor"><span id="_Toc143509571" class="anchor"><span id="_Toc143510018" class="anchor"><span id="_Toc144026108" class="anchor"><span id="_Toc144026439" class="anchor"><span id="_Toc144276082" class="anchor"><span id="_Toc144276426" class="anchor"><span id="_Toc144280014" class="anchor"><span id="_Toc144280360" class="anchor"><span id="_Toc144540575" class="anchor"><span id="_Toc144554457" class="anchor"><span id="_Toc144722079" class="anchor"><span id="_Toc145503541" class="anchor"><span id="_Toc145511983" class="anchor"><span id="_Toc145513006" class="anchor"><span id="_Toc145513390" class="anchor"><span id="_Toc222907147" class="anchor"><span id="_Toc342652717" class="anchor"><span id="_Toc439863928" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Hypercall Status Code
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

Every hypercall returns a 16-bit status code of type HV\_STATUS.

typedef UINT16 HV\_STATUS;

<span id="_Toc110172655" class="anchor"><span id="_Toc127596640" class="anchor"><span id="_Toc127786261" class="anchor"><span id="_Toc127786577" class="anchor"><span id="_Toc127786893" class="anchor"><span id="_Toc127877489" class="anchor"><span id="_Toc128289560" class="anchor"><span id="_Toc128289953" class="anchor"><span id="_Toc130189635" class="anchor"><span id="_Toc130200851" class="anchor"><span id="_Toc130201167" class="anchor"><span id="_Toc130201488" class="anchor"><span id="_Toc131936575" class="anchor"><span id="_Toc133901013" class="anchor"><span id="_Toc137460918" class="anchor"><span id="_Toc139096433" class="anchor"><span id="_Toc139188354" class="anchor"><span id="_Toc139191217" class="anchor"><span id="_Toc140490267" class="anchor"><span id="_Toc140571170" class="anchor"><span id="_Toc141257440" class="anchor"><span id="_Toc141257767" class="anchor"><span id="_Toc141267294" class="anchor"><span id="_Toc141522312" class="anchor"><span id="_Toc141529403" class="anchor"><span id="_Toc141529720" class="anchor"><span id="_Toc141851327" class="anchor"><span id="_Toc141852261" class="anchor"><span id="_Toc141887803" class="anchor"><span id="_Toc141889643" class="anchor"><span id="_Toc141893312" class="anchor"><span id="_Toc142113161" class="anchor"><span id="_Toc142114189" class="anchor"><span id="_Toc142729349" class="anchor"><span id="_Toc142730633" class="anchor"><span id="_Toc142731006" class="anchor"><span id="_Toc142998371" class="anchor"><span id="_Toc143063462" class="anchor"><span id="_Toc143509572" class="anchor"><span id="_Toc143510019" class="anchor"><span id="_Toc144026109" class="anchor"><span id="_Toc144026440" class="anchor"><span id="_Toc144276083" class="anchor"><span id="_Toc144276427" class="anchor"><span id="_Toc144280015" class="anchor"><span id="_Toc144280361" class="anchor"><span id="_Toc144540576" class="anchor"><span id="_Toc144554458" class="anchor"><span id="_Toc144722080" class="anchor"><span id="_Toc145503542" class="anchor"><span id="_Toc145511984" class="anchor"><span id="_Toc145513007" class="anchor"><span id="_Toc145513391" class="anchor"><span id="_Toc222907148" class="anchor"><span id="_Toc342652718" class="anchor"><span id="_Toc439863929" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Memory Types
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

The hypervisor architecture defines three independent address spaces:

-   *System physical addresses* (SPAs) define the physical address space
    of the underlying hardware as seen by the CPUs. There is only one
    system physical address space for the entire machine.

-   *Guest physical addresses* (GPAs) define the guest’s view of
    physical memory. GPAs can be mapped to underlying SPAs. There is one
    guest physical address space per partition.

-   *Guest virtual addresses* (GVAs) are used within the guest when it
    enables address translation and provides a valid guest page table.

All three of these address spaces are up to 2^64^ bytes in size. The
following types are thus defined:

typedef UINT64 HV\_SPA;

typedef UINT64 HV\_GPA;

typedef UINT64 HV\_GVA;

Many hypervisor interfaces act on pages of memory rather than single
bytes. The minimum page size is architecture-dependent. For x64, it is
defined as 4K.

\#define X64\_PAGE\_SIZE 0x1000

\#define HV\_X64\_MAX\_PAGE\_NUMBER (MAXUINT64/X64\_PAGE\_SIZE)

\#define HV\_PAGE\_SIZE X64\_PAGE\_SIZE

\#define HV\_LARGE\_PAGE\_SIZE X64\_LARGE\_PAGE\_SIZE

\#define HV\_PAGE\_MASK (HV\_PAGE\_SIZE - 1)

typedef UINT64 HV\_SPA\_PAGE\_NUMBER;

typedef UINT64 HV\_GPA\_PAGE\_NUMBER;

typedef UINT64 HV\_GVA\_PAGE\_NUMBER;

typedef UINT32 HV\_SPA\_PAGE\_OFFSET

typedef HV\_GPA\_PAGE\_NUMBER \*PHV\_GPA\_PAGE\_NUMBER;

To convert an HV\_SPA to an HV\_SPA\_PAGE\_NUMBER, simply divide by
HV\_PAGE\_SIZE.<span id="_Toc104355824" class="anchor"><span
id="_Toc105831143" class="anchor"><span id="_Toc106181333"
class="anchor"><span id="_Toc106422379" class="anchor"><span
id="_Toc106525747" class="anchor"><span id="_Toc104355825"
class="anchor"><span id="_Toc105831144" class="anchor"><span
id="_Toc106181334" class="anchor"><span id="_Toc106422380"
class="anchor"><span id="_Toc106525748" class="anchor"><span
id="_Toc104355827" class="anchor"><span id="_Toc105831146"
class="anchor"><span id="_Toc106181336" class="anchor"><span
id="_Toc106422382" class="anchor"><span id="_Toc106525750"
class="anchor"><span id="_Toc104355829" class="anchor"><span
id="_Toc105831148" class="anchor"><span id="_Toc106181338"
class="anchor"><span id="_Toc106422384" class="anchor"><span
id="_Toc106525752"
class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>

<span id="_Toc110172656" class="anchor"><span id="_Toc127596641" class="anchor"><span id="_Toc127786262" class="anchor"><span id="_Toc127786578" class="anchor"><span id="_Toc127786894" class="anchor"><span id="_Toc127877490" class="anchor"><span id="_Toc128289561" class="anchor"><span id="_Toc128289954" class="anchor"><span id="_Toc130189636" class="anchor"><span id="_Toc130200852" class="anchor"><span id="_Toc130201168" class="anchor"><span id="_Toc130201489" class="anchor"><span id="_Toc131936576" class="anchor"><span id="_Toc133901014" class="anchor"><span id="_Toc137460919" class="anchor"><span id="_Toc139096434" class="anchor"><span id="_Toc139188355" class="anchor"><span id="_Toc139191218" class="anchor"><span id="_Toc140490268" class="anchor"><span id="_Toc140571171" class="anchor"><span id="_Toc141257441" class="anchor"><span id="_Toc141257768" class="anchor"><span id="_Toc141267295" class="anchor"><span id="_Toc141522313" class="anchor"><span id="_Toc141529404" class="anchor"><span id="_Toc141529721" class="anchor"><span id="_Toc141851328" class="anchor"><span id="_Toc141852262" class="anchor"><span id="_Toc141887806" class="anchor"><span id="_Toc141889646" class="anchor"><span id="_Toc141893315" class="anchor"><span id="_Toc142113164" class="anchor"><span id="_Toc142114192" class="anchor"><span id="_Toc142729352" class="anchor"><span id="_Toc142730636" class="anchor"><span id="_Toc142731009" class="anchor"><span id="_Toc142998374" class="anchor"><span id="_Toc143063465" class="anchor"><span id="_Toc143509575" class="anchor"><span id="_Toc143510022" class="anchor"><span id="_Toc144026112" class="anchor"><span id="_Toc144026443" class="anchor"><span id="_Toc144276086" class="anchor"><span id="_Toc144276430" class="anchor"><span id="_Toc144280018" class="anchor"><span id="_Toc144280364" class="anchor"><span id="_Toc144540579" class="anchor"><span id="_Toc144554461" class="anchor"><span id="_Toc144722083" class="anchor"><span id="_Toc145503545" class="anchor"><span id="_Toc145511987" class="anchor"><span id="_Toc145513010" class="anchor"><span id="_Toc145513394" class="anchor"><span id="_Toc222907149" class="anchor"><span id="_Toc342652719" class="anchor"><span id="_Toc439863930" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Structures, Enumerations and Bit Fields
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

Many data structures and constant values defined later in this
specification are defined in terms of C-style enumerations and
structures. The C language purposely avoids defining certain
implementation details. However, this document assumes the following:

-   All enumerations declared with the “enum" keyword define 32-bit
    signed integer values.

-   All structures are padded in such a way that fields are aligned
    naturally (that is, an 8-byte field is aligned to an offset of 8
    bytes and so on).

-   All bit fields are packed from low-order to high-order bits with
    no padding.

    1.  <span id="_Toc110172657" class="anchor"><span id="_Toc127596642" class="anchor"><span id="_Toc127786263" class="anchor"><span id="_Toc127786579" class="anchor"><span id="_Toc127786895" class="anchor"><span id="_Toc127877491" class="anchor"><span id="_Toc128289562" class="anchor"><span id="_Toc128289955" class="anchor"><span id="_Toc130189637" class="anchor"><span id="_Toc130200853" class="anchor"><span id="_Toc130201169" class="anchor"><span id="_Toc130201490" class="anchor"><span id="_Toc131936577" class="anchor"><span id="_Toc133901015" class="anchor"><span id="_Toc137460920" class="anchor"><span id="_Toc139096435" class="anchor"><span id="_Toc139188356" class="anchor"><span id="_Toc139191219" class="anchor"><span id="_Toc140490269" class="anchor"><span id="_Toc140571172" class="anchor"><span id="_Toc141257442" class="anchor"><span id="_Toc141257769" class="anchor"><span id="_Toc141267296" class="anchor"><span id="_Toc141522314" class="anchor"><span id="_Toc141529405" class="anchor"><span id="_Toc141529722" class="anchor"><span id="_Toc141851329" class="anchor"><span id="_Toc141852263" class="anchor"><span id="_Toc141887807" class="anchor"><span id="_Toc141889647" class="anchor"><span id="_Toc141893316" class="anchor"><span id="_Toc142113165" class="anchor"><span id="_Toc142114193" class="anchor"><span id="_Toc142729353" class="anchor"><span id="_Toc142730637" class="anchor"><span id="_Toc142731010" class="anchor"><span id="_Toc142998375" class="anchor"><span id="_Toc143063466" class="anchor"><span id="_Toc143509576" class="anchor"><span id="_Toc143510023" class="anchor"><span id="_Toc144026113" class="anchor"><span id="_Toc144026444" class="anchor"><span id="_Toc144276087" class="anchor"><span id="_Toc144276431" class="anchor"><span id="_Toc144280019" class="anchor"><span id="_Toc144280365" class="anchor"><span id="_Toc144540580" class="anchor"><span id="_Toc144554462" class="anchor"><span id="_Toc144722084" class="anchor"><span id="_Toc145503546" class="anchor"><span id="_Toc145511988" class="anchor"><span id="_Toc145513011" class="anchor"><span id="_Toc145513395" class="anchor"><span id="_Toc222907150" class="anchor"><span id="_Toc342652720" class="anchor"><span id="_Toc439863931" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Endianness
        --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

The hypervisor interface is designed to be endian-neutral (that is, it
should be possible to port the hypervisor to a big-endian or
little-endian system), but some of the data structures defined later in
this specification assume little-endian layout. Such data structures
will need to be amended if and when a big-endian port is attempted.

<span id="_Toc127596643" class="anchor"><span id="_Toc127786264" class="anchor"><span id="_Toc127786580" class="anchor"><span id="_Toc127786896" class="anchor"><span id="_Toc127877492" class="anchor"><span id="_Toc128289563" class="anchor"><span id="_Toc128289956" class="anchor"><span id="_Toc130189638" class="anchor"><span id="_Toc130200854" class="anchor"><span id="_Toc130201170" class="anchor"><span id="_Toc130201491" class="anchor"><span id="_Toc131936578" class="anchor"><span id="_Toc133901016" class="anchor"><span id="_Toc137460921" class="anchor"><span id="_Toc139096436" class="anchor"><span id="_Toc139188357" class="anchor"><span id="_Toc139191220" class="anchor"><span id="_Toc140490270" class="anchor"><span id="_Toc140571173" class="anchor"><span id="_Toc141257443" class="anchor"><span id="_Toc141257770" class="anchor"><span id="_Toc141267297" class="anchor"><span id="_Toc141522315" class="anchor"><span id="_Toc141529406" class="anchor"><span id="_Toc141529723" class="anchor"><span id="_Toc141851330" class="anchor"><span id="_Toc141852264" class="anchor"><span id="_Toc141887808" class="anchor"><span id="_Toc141889648" class="anchor"><span id="_Toc141893317" class="anchor"><span id="_Toc142113166" class="anchor"><span id="_Toc142114194" class="anchor"><span id="_Toc142729354" class="anchor"><span id="_Toc142730638" class="anchor"><span id="_Toc142731011" class="anchor"><span id="_Toc142998376" class="anchor"><span id="_Toc143063467" class="anchor"><span id="_Toc143509577" class="anchor"><span id="_Toc143510024" class="anchor"><span id="_Toc144026114" class="anchor"><span id="_Toc144026445" class="anchor"><span id="_Toc144276088" class="anchor"><span id="_Toc144276432" class="anchor"><span id="_Toc144280020" class="anchor"><span id="_Toc144280366" class="anchor"><span id="_Toc144540581" class="anchor"><span id="_Toc144554463" class="anchor"><span id="_Toc144722085" class="anchor"><span id="_Toc145503547" class="anchor"><span id="_Toc145511989" class="anchor"><span id="_Toc145513012" class="anchor"><span id="_Toc145513396" class="anchor"><span id="_Toc222907151" class="anchor"><span id="_Toc342652721" class="anchor"><span id="_Toc439863932" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Pointer Naming Convention
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

The document uses a naming convention for pointer types. In particular,
a “P" prepended to a defined type indicates a pointer to that type. A
“PC" prepended to a defined type indicates a pointer to a constant value
of that type.

1.  <span id="_Toc127596644" class="anchor"><span id="_Toc127786265" class="anchor"><span id="_Toc127786581" class="anchor"><span id="_Toc127786897" class="anchor"><span id="_Toc127877493" class="anchor"><span id="_Toc128289564" class="anchor"><span id="_Toc128289957" class="anchor"><span id="_Toc130189639" class="anchor"><span id="_Toc130200855" class="anchor"><span id="_Toc130201171" class="anchor"><span id="_Toc130201492" class="anchor"><span id="_Toc131936579" class="anchor"><span id="_Toc133901017" class="anchor"><span id="_Toc137460922" class="anchor"><span id="_Toc139096437" class="anchor"><span id="_Toc139188358" class="anchor"><span id="_Toc139191221" class="anchor"><span id="_Toc140490271" class="anchor"><span id="_Toc140571174" class="anchor"><span id="_Toc141257444" class="anchor"><span id="_Toc141257771" class="anchor"><span id="_Toc141267298" class="anchor"><span id="_Toc141522316" class="anchor"><span id="_Toc141529407" class="anchor"><span id="_Toc141529724" class="anchor"><span id="_Toc141851331" class="anchor"><span id="_Toc141852265" class="anchor"><span id="_Toc141887809" class="anchor"><span id="_Toc141889649" class="anchor"><span id="_Toc141893318" class="anchor"><span id="_Toc142113167" class="anchor"><span id="_Toc142114195" class="anchor"><span id="_Toc142729355" class="anchor"><span id="_Toc142730639" class="anchor"><span id="_Toc142731012" class="anchor"><span id="_Toc142998377" class="anchor"><span id="_Toc143063468" class="anchor"><span id="_Toc143509578" class="anchor"><span id="_Toc143510025" class="anchor"><span id="_Toc144026115" class="anchor"><span id="_Toc144026446" class="anchor"><span id="_Toc144276089" class="anchor"><span id="_Toc144276433" class="anchor"><span id="_Toc144280021" class="anchor"><span id="_Toc144280367" class="anchor"><span id="_Toc144540582" class="anchor"><span id="_Toc144554464" class="anchor"><span id="_Toc144722086" class="anchor"><span id="_Toc145503548" class="anchor"><span id="_Toc145511990" class="anchor"><span id="_Toc145513013" class="anchor"><span id="_Toc145513397" class="anchor"><span id="_Toc222907152" class="anchor"><span id="_Toc342652722" class="anchor"><span id="_Toc439863933" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Feature and Interface Discovery
    ========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================

    1.  <span id="_Toc127596645" class="anchor"><span id="_Toc127786266" class="anchor"><span id="_Toc127786582" class="anchor"><span id="_Toc127786898" class="anchor"><span id="_Toc127877494" class="anchor"><span id="_Toc128289565" class="anchor"><span id="_Toc128289958" class="anchor"><span id="_Toc130189640" class="anchor"><span id="_Toc130200856" class="anchor"><span id="_Toc130201172" class="anchor"><span id="_Toc130201493" class="anchor"><span id="_Toc131936580" class="anchor"><span id="_Toc133901018" class="anchor"><span id="_Toc137460923" class="anchor"><span id="_Toc139096438" class="anchor"><span id="_Toc139188359" class="anchor"><span id="_Toc139191222" class="anchor"><span id="_Toc140490272" class="anchor"><span id="_Toc140571175" class="anchor"><span id="_Toc141257445" class="anchor"><span id="_Toc141257772" class="anchor"><span id="_Toc141267299" class="anchor"><span id="_Toc141522317" class="anchor"><span id="_Toc141529408" class="anchor"><span id="_Toc141529725" class="anchor"><span id="_Toc141851332" class="anchor"><span id="_Toc141852266" class="anchor"><span id="_Toc141887810" class="anchor"><span id="_Toc141889650" class="anchor"><span id="_Toc141893319" class="anchor"><span id="_Toc142113168" class="anchor"><span id="_Toc142114196" class="anchor"><span id="_Toc142729356" class="anchor"><span id="_Toc142730640" class="anchor"><span id="_Toc142731013" class="anchor"><span id="_Toc142998378" class="anchor"><span id="_Toc143063469" class="anchor"><span id="_Toc143509579" class="anchor"><span id="_Toc143510026" class="anchor"><span id="_Toc144026116" class="anchor"><span id="_Toc144026447" class="anchor"><span id="_Toc144276090" class="anchor"><span id="_Toc144276434" class="anchor"><span id="_Toc144280022" class="anchor"><span id="_Toc144280368" class="anchor"><span id="_Toc144540583" class="anchor"><span id="_Toc144554465" class="anchor"><span id="_Toc144722087" class="anchor"><span id="_Toc145503549" class="anchor"><span id="_Toc145511991" class="anchor"><span id="_Toc145513014" class="anchor"><span id="_Toc145513398" class="anchor"><span id="_Toc222907153" class="anchor"><span id="_Toc342652723" class="anchor"><span id="_Toc439863934" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Interface Mechanisms
        -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

Guest software interacts with the hypervisor through a variety of
mechanisms. Many of these mirror the traditional mechanisms used by
software to interact with the underlying processor. As such, these
mechanisms are architecture-specific. On the x64 architecture, the
following mechanisms are used:

-   **CPUID instruction –** Used for static feature and
    version information.

-   **MSRs (model-specific registers) –** Used for status and
    control values.

-   **Memory-mapped registers –** Used for status and control values.

-   **Processor interrupts** **–** Used for asynchronous events,
    notifications and messages.

In addition to these architecture-specific interfaces, the hypervisor
provides a simple procedural interface implemented with hypercalls. For
information about the hypercall mechanism, see chapter 4.

<span id="_Toc127596646" class="anchor"><span id="_Toc127786267" class="anchor"><span id="_Toc127786583" class="anchor"><span id="_Toc127786899" class="anchor"><span id="_Toc127877495" class="anchor"><span id="_Toc128289566" class="anchor"><span id="_Toc128289959" class="anchor"><span id="_Toc130189641" class="anchor"><span id="_Toc130200857" class="anchor"><span id="_Toc130201173" class="anchor"><span id="_Toc130201494" class="anchor"><span id="_Toc131936581" class="anchor"><span id="_Toc133901019" class="anchor"><span id="_Toc137460924" class="anchor"><span id="_Toc139096439" class="anchor"><span id="_Toc139188360" class="anchor"><span id="_Toc139191223" class="anchor"><span id="_Toc140490273" class="anchor"><span id="_Toc140571176" class="anchor"><span id="_Toc141257446" class="anchor"><span id="_Toc141257773" class="anchor"><span id="_Toc141267300" class="anchor"><span id="_Toc141522318" class="anchor"><span id="_Toc141529409" class="anchor"><span id="_Toc141529726" class="anchor"><span id="_Toc141851333" class="anchor"><span id="_Toc141852267" class="anchor"><span id="_Toc141887811" class="anchor"><span id="_Toc141889651" class="anchor"><span id="_Toc141893320" class="anchor"><span id="_Toc142113169" class="anchor"><span id="_Toc142114197" class="anchor"><span id="_Toc142729357" class="anchor"><span id="_Toc142730641" class="anchor"><span id="_Toc142731014" class="anchor"><span id="_Toc142998379" class="anchor"><span id="_Toc143063470" class="anchor"><span id="_Toc143509580" class="anchor"><span id="_Toc143510027" class="anchor"><span id="_Toc144026117" class="anchor"><span id="_Toc144026448" class="anchor"><span id="_Toc144276091" class="anchor"><span id="_Toc144276435" class="anchor"><span id="_Toc144280023" class="anchor"><span id="_Toc144280369" class="anchor"><span id="_Toc144540584" class="anchor"><span id="_Toc144554466" class="anchor"><span id="_Toc144722088" class="anchor"><span id="_Toc145503550" class="anchor"><span id="_Toc145511992" class="anchor"><span id="_Toc145513015" class="anchor"><span id="_Toc145513399" class="anchor"><span id="_Toc222907154" class="anchor"><span id="_Toc342652724" class="anchor"><span id="_Toc439863935" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Hypervisor Discovery
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

Before using any hypervisor interfaces, software should first determine
whether it’s running within a virtualized environment. On x64 platforms
that conform to this specification, this is done by executing the CPUID
instruction with an input (EAX) value of 1. Upon execution, code should
check bit 31 of register ECX (the “hypervisor present bit"). If this bit
is set, a hypervisor is present. In a non-virtualized environment, the
bit will be clear.

If the “hypervisor present bit" is set, additional CPUID leafs can be
queried for more information about the conformant hypervisor and its
capabilities. Two such leaves are guaranteed to be available: 0x40000000
and 0x40000001. Subsequently-numbered leaves may also be available.

<span id="_Toc127596647" class="anchor"><span id="_Toc127786268" class="anchor"><span id="_Toc127786584" class="anchor"><span id="_Toc127786900" class="anchor"><span id="_Toc127877496" class="anchor"><span id="_Toc128289567" class="anchor"><span id="_Toc128289960" class="anchor"><span id="_Toc130189642" class="anchor"><span id="_Toc130200858" class="anchor"><span id="_Toc130201174" class="anchor"><span id="_Toc130201495" class="anchor"><span id="_Toc131936582" class="anchor"><span id="_Toc133901020" class="anchor"><span id="_Toc137460925" class="anchor"><span id="_Toc139096440" class="anchor"><span id="_Toc139188361" class="anchor"><span id="_Toc139191224" class="anchor"><span id="_Toc140490274" class="anchor"><span id="_Toc140571177" class="anchor"><span id="_Toc141257447" class="anchor"><span id="_Toc141257774" class="anchor"><span id="_Toc141267301" class="anchor"><span id="_Toc141522319" class="anchor"><span id="_Toc141529410" class="anchor"><span id="_Toc141529727" class="anchor"><span id="_Toc141851334" class="anchor"><span id="_Toc141852268" class="anchor"><span id="_Toc141887812" class="anchor"><span id="_Toc141889652" class="anchor"><span id="_Toc141893321" class="anchor"><span id="_Toc142113170" class="anchor"><span id="_Toc142114198" class="anchor"><span id="_Toc142729358" class="anchor"><span id="_Toc142730642" class="anchor"><span id="_Toc142731015" class="anchor"><span id="_Toc142998380" class="anchor"><span id="_Toc143063471" class="anchor"><span id="_Toc143509581" class="anchor"><span id="_Toc143510028" class="anchor"><span id="_Toc144026118" class="anchor"><span id="_Toc144026449" class="anchor"><span id="_Toc144276092" class="anchor"><span id="_Toc144276436" class="anchor"><span id="_Toc144280024" class="anchor"><span id="_Toc144280370" class="anchor"><span id="_Toc144540585" class="anchor"><span id="_Toc144554467" class="anchor"><span id="_Toc144722089" class="anchor"><span id="_Toc145503551" class="anchor"><span id="_Toc145511993" class="anchor"><span id="_Toc145513016" class="anchor"><span id="_Toc145513400" class="anchor"><span id="_Toc222907155" class="anchor"><span id="_Ref230086186" class="anchor"><span id="_Toc342652725" class="anchor"><span id="_Toc439863936" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Standard Hypervisor CPUID Leaves
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

When the leaf at 0x40000000 is queried, the hypervisor will return
information that provides the maximum hypervisor CPUID leaf number and a
vendor ID signature.

  Leaf         Information Provided
  ------------ ------------------------------------------------------ -----------------------------------------------------------
  0x40000000   Hypervisor CPUID leaf range and vendor ID signature.
               EAX
               EBX
               ECX
               EDX

If the leaf at 0x40000001 is queried, it will return a value that
identifies the hypervisor interface.

  Leaf         Information Provided
  ------------ ------------------------------------------------------------------------------------------------------------------------------------ --------------------------------
  0x40000001   Hypervisor vendor-neutral interface identification. This determines the semantics of the leaves from 0x40000002 through 0x400000FF
               EAX
               EBX
               ECX
               EDX

These two leaves allow the guest to query the hypervisor vendor ID and
interface independently. The vendor ID is provided only for
informational and diagnostic purposes. It is recommended that software
only base compatibility decisions on the interface signature reported
through leaf 0x40000001.

<span id="_Ref121470372" class="anchor"><span id="_Toc127596648" class="anchor"><span id="_Toc127786269" class="anchor"><span id="_Toc127786585" class="anchor"><span id="_Toc127786901" class="anchor"><span id="_Toc127877497" class="anchor"><span id="_Toc128289568" class="anchor"><span id="_Toc128289961" class="anchor"><span id="_Toc130189643" class="anchor"><span id="_Toc130200859" class="anchor"><span id="_Toc130201175" class="anchor"><span id="_Toc130201496" class="anchor"><span id="_Toc131936583" class="anchor"><span id="_Toc133901021" class="anchor"><span id="_Toc137460926" class="anchor"><span id="_Toc139096441" class="anchor"><span id="_Toc139188362" class="anchor"><span id="_Toc139191225" class="anchor"><span id="_Toc140490275" class="anchor"><span id="_Toc140571178" class="anchor"><span id="_Toc141257448" class="anchor"><span id="_Toc141257775" class="anchor"><span id="_Toc141267302" class="anchor"><span id="_Toc141522320" class="anchor"><span id="_Toc141529411" class="anchor"><span id="_Toc141529728" class="anchor"><span id="_Toc141851335" class="anchor"><span id="_Toc141852269" class="anchor"><span id="_Toc141887813" class="anchor"><span id="_Toc141889653" class="anchor"><span id="_Toc141893322" class="anchor"><span id="_Toc142113171" class="anchor"><span id="_Toc142114199" class="anchor"><span id="_Toc142729359" class="anchor"><span id="_Toc142730643" class="anchor"><span id="_Toc142731016" class="anchor"><span id="_Toc142998381" class="anchor"><span id="_Toc143063472" class="anchor"><span id="_Toc143509582" class="anchor"><span id="_Toc143510029" class="anchor"><span id="_Toc144026119" class="anchor"><span id="_Toc144026450" class="anchor"><span id="_Toc144276093" class="anchor"><span id="_Toc144276437" class="anchor"><span id="_Toc144280025" class="anchor"><span id="_Toc144280371" class="anchor"><span id="_Toc144540586" class="anchor"><span id="_Toc144554468" class="anchor"><span id="_Toc144722090" class="anchor"><span id="_Toc145503552" class="anchor"><span id="_Toc145511994" class="anchor"><span id="_Toc145513017" class="anchor"><span id="_Toc145513401" class="anchor"><span id="_Toc222907156" class="anchor"><span id="_Toc342652726" class="anchor"><span id="_Toc439863937" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Microsoft Hypervisor CPUID Leaves
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

On hypervisors conforming to the Microsoft hypervisor CPUID interface,
the 0x40000000 and 0x40000001 leaf registers will have the following
values:

  Leaf         Information Provided
  ------------ ------------------------------------------------------------------------------------------------------------------------------------- ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  0x40000000   Hypervisor CPUID leaf range and vendor ID signature.
               EAX
               EBX
               ECX
               EDX
  0x40000001   Hypervisor vendor-neutral interface identification. This determines the semantics of the leaves from 0x40000002 through 0x400000FF.
               EAX
               EBX
               ECX
               EDX

Hypervisors conforming to the “Hv\#1" interface also provide at least
the following leaves:

  Leaf         Information Provided
  ------------ ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  0x40000002   Hypervisor system identity. This value will be zero until the OS identity MSR is set (see section 3.6); after that, they have the following definitions:
               EAX
               EBX
               ECX
               EDX
  0x40000003   Feature identification. EAX indicates which features are available to the partition based upon the current partition privileges.
               EAX
               Feature identification: EBX indicates which flags were specified at partition creation. The format is the same as the partition creation flag structure defined in section 1.1.1.
               EBX
               Feature identification. ECX contains power management related information.
               ECX

               Feature identification. EDX indicates which miscellaneous features are available to the partition.
  ------------ ------------------------------------------------------------------------------------------------------------------------------------------------- -------------------------------------------------------------------------------------------------------------------------------------------------------------------------
               EDX
  0x40000004   Implementation recommendations. Indicates which behaviors the hypervisor recommends the OS implement for optimal performance.
               EAX
               EBX
               ECX
               EDX
  0x40000005   Implementation limits. If any value is zero, the hypervisor does not expose the corresponding information; otherwise, they have these meanings:
               EAX
               EBX
               ECX
               EDX
  0x40000006   Implementation hardware features. Indicates which hardware-specific features have been detected and are currently in use by the hypervisor.
               EAX
               EBX
               ECX
               EDX

Versioning
----------

The hypervisor version information is encoded in leaf 0x40000002. Two
version numbers are provided: the main version and the service version.

The main version includes a major and minor version number and a build
number. These correspond to Microsoft Windows^®^ release numbers. The
service version describes changes made to the main version. For maximum
forward compatibility, clients should use the hypervisor version
information with extreme care. When checking main versions, clients
should use greater-than-or-equal tests, not equality tests. The
following pseudo-code demonstrates the method that should be employed
when comparing entire version numbers (consisting of both the main and
service versions):

if &lt;your-main-version&gt; greater than
&lt;hypervisor-main-version&gt;

{

your version is compatible

}

else if &lt;your-main-version&gt; equal to
&lt;hypervisor-main-version&gt;

and

&lt;your-service-version&gt; greater than or equal to

&lt;hypervisor-service-version&gt;

{

your version is compatible

}

else

{

your version is NOT compatible

}

Clients are strongly encouraged to check for hypervisor features by
using CPUID leaves 0x40000003 through 0x40000005 rather than by
comparing against version ranges.

<span id="_Ref125170505" class="anchor"><span id="_Toc127596650" class="anchor"><span id="_Toc127786271" class="anchor"><span id="_Toc127786587" class="anchor"><span id="_Toc127786903" class="anchor"><span id="_Toc127877499" class="anchor"><span id="_Toc128289570" class="anchor"><span id="_Toc128289963" class="anchor"><span id="_Toc130189645" class="anchor"><span id="_Toc130200861" class="anchor"><span id="_Toc130201177" class="anchor"><span id="_Toc130201498" class="anchor"><span id="_Toc131936585" class="anchor"><span id="_Toc133901023" class="anchor"><span id="_Toc137460928" class="anchor"><span id="_Toc139096443" class="anchor"><span id="_Toc139188364" class="anchor"><span id="_Toc139191227" class="anchor"><span id="_Toc140490277" class="anchor"><span id="_Toc140571180" class="anchor"><span id="_Toc141257450" class="anchor"><span id="_Toc141257777" class="anchor"><span id="_Toc141267304" class="anchor"><span id="_Toc141522322" class="anchor"><span id="_Toc141529413" class="anchor"><span id="_Toc141529730" class="anchor"><span id="_Toc141851337" class="anchor"><span id="_Toc141852271" class="anchor"><span id="_Toc141887815" class="anchor"><span id="_Toc141889655" class="anchor"><span id="_Toc141893324" class="anchor"><span id="_Toc142113173" class="anchor"><span id="_Toc142114201" class="anchor"><span id="_Toc142729361" class="anchor"><span id="_Toc142730645" class="anchor"><span id="_Toc142731018" class="anchor"><span id="_Toc142998383" class="anchor"><span id="_Toc143063474" class="anchor"><span id="_Toc143509584" class="anchor"><span id="_Toc143510031" class="anchor"><span id="_Toc144026121" class="anchor"><span id="_Toc144026452" class="anchor"><span id="_Toc144276095" class="anchor"><span id="_Toc144276439" class="anchor"><span id="_Toc144280027" class="anchor"><span id="_Toc144280373" class="anchor"><span id="_Toc144540588" class="anchor"><span id="_Toc144554470" class="anchor"><span id="_Toc144722092" class="anchor"><span id="_Toc145503554" class="anchor"><span id="_Toc145511996" class="anchor"><span id="_Toc145513019" class="anchor"><span id="_Toc145513403" class="anchor"><span id="_Toc222907158" class="anchor"><span id="_Toc342652728" class="anchor"><span id="_Toc439863939" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Reporting the Guest OS Identity
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

The guest OS running within the partition must identify itself to the
hypervisor by writing its signature and version to an MSR
(HV\_X64\_MSR\_GUEST\_OS\_ID). This MSR is partition-wide and is shared
among all virtual processors (virtual processors are described in
chapter 10).

This register’s value is initially zero. A non-zero value must be
written to it before the hypercall code page can be enabled (see section
4.12). If this register is subsequently zeroed, the hypercall code page
will be disabled.

\#define HV\_X64\_MSR\_GUEST\_OS\_ID 0x40000000

The following is the recommended encoding for this MSR. Some fields may
not apply for some guest OSs.

  ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  **63**     **62:48**                                                                                                                   **47:40**        **39:32**       **31:24**       **23:16**         **15:0**
  ---------- --------------------------------------------------------------------------------------------------------------------------- ---------------- --------------- --------------- ----------------- --------------
  OS Type    Vendor ID                                                                                                                   OS ID            Major Version   Minor Version   Service Version   Build Number

  **Bits**   **Description**                                                                                                             **Attributes**

  63         OS Type\                                                                                                                    Read/Write
             Indicates the OS types. A value of 0 indicates a proprietary, closed source OS. A value of 1 indicates an open source OS.   

  62:48      Vendor ID                                                                                                                   Read/write
                                                                                                                                         
             Indicates the guest OS vendor. A value of 0 is reserved. A value of 1 indicates Microsoft.                                  

  47:40      OS ID                                                                                                                       Read/write
                                                                                                                                         
             Indicates the OS variant. Encoding is unique to the vendor. Microsoft operating systems are encoded as follows:             
                                                                                                                                         
             0=Undefined, 1=MS-DOS^®^, 2=Windows^®^ 3.x, 3=Windows^®^ 9x, 4=Windows^®^ NT (and derivatives), 5=Windows^®^ CE             

  39:32      Major Version                                                                                                               Read/write
                                                                                                                                         
             Indicates the major version of the OS                                                                                       

  31:24      Minor Version                                                                                                               Read/write
                                                                                                                                         
             Indicates the minor version of the OS                                                                                       

  23:16      Service Version                                                                                                             Read/write
                                                                                                                                         
             Indicates the service version (for example, "service pack" number)                                                          

  15:0       Build Number                                                                                                                Read/write
                                                                                                                                         
             Indicates the build number of the OS                                                                                        
  ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

### <span id="_Toc342652729" class="anchor"><span id="_Ref121466346" class="anchor"><span id="_Toc439863940" class="anchor"></span></span></span>Encoding the Guest OS Identity MSR for Open Source Operating Systems

The following encoding is offered as guidance for open source operating
system vendors intending to conform to this specification. It is
suggested that open source operating systems adapt the following
convention.

  ------------------------------------------------------------------------------------------------------------------------------
  **Bits**   **Description**                                                                                    **Attributes**
  ---------- -------------------------------------------------------------------------------------------------- ----------------
  63         Open Source                                                                                        Read/write
                                                                                                                
             Bit 63 should be set to 1 to indicate an Open Source OS.                                           

  62:56      OS Type                                                                                            Read/write
                                                                                                                
             Bits 62-57 should specify the OS type (e.g., Linux, FreeBSD, etc.). Linux is 0x100.                

  55:48      OS ID                                                                                              Read/write
                                                                                                                
             Bits 55:48 may specify any additional vendor information (distribution‑specific identification).   

  47:16      Version                                                                                            Read/write
                                                                                                                
             Bits 47:16 should specify the upstream kernel version information.                                 

  15:0       Build Number                                                                                       Read/write
                                                                                                                
             Bits 15:0 should specify any additional identification.                                            
  ------------------------------------------------------------------------------------------------------------------------------

1.  <span id="_Toc127596651" class="anchor"><span id="_Ref127608103" class="anchor"><span id="_Toc127786272" class="anchor"><span id="_Toc127786588" class="anchor"><span id="_Toc127786904" class="anchor"><span id="_Toc127877500" class="anchor"><span id="_Toc128289571" class="anchor"><span id="_Toc128289964" class="anchor"><span id="_Toc130189646" class="anchor"><span id="_Toc130200862" class="anchor"><span id="_Toc130201178" class="anchor"><span id="_Toc130201499" class="anchor"><span id="_Toc131936586" class="anchor"><span id="_Toc133901024" class="anchor"><span id="_Toc137460929" class="anchor"><span id="_Toc139096444" class="anchor"><span id="_Toc139188365" class="anchor"><span id="_Toc139191228" class="anchor"><span id="_Toc140490278" class="anchor"><span id="_Toc140571181" class="anchor"><span id="_Toc141257451" class="anchor"><span id="_Toc141257778" class="anchor"><span id="_Toc141267305" class="anchor"><span id="_Toc141522323" class="anchor"><span id="_Toc141529414" class="anchor"><span id="_Toc141529731" class="anchor"><span id="_Toc141851338" class="anchor"><span id="_Toc141852272" class="anchor"><span id="_Toc141887816" class="anchor"><span id="_Toc141889656" class="anchor"><span id="_Toc141893325" class="anchor"><span id="_Toc142113174" class="anchor"><span id="_Toc142114202" class="anchor"><span id="_Toc142729362" class="anchor"><span id="_Toc142730646" class="anchor"><span id="_Toc142731019" class="anchor"><span id="_Toc142998384" class="anchor"><span id="_Toc143063475" class="anchor"><span id="_Toc143509585" class="anchor"><span id="_Toc143510032" class="anchor"><span id="_Toc144026122" class="anchor"><span id="_Toc144026453" class="anchor"><span id="_Toc144276096" class="anchor"><span id="_Toc144276440" class="anchor"><span id="_Toc144280028" class="anchor"><span id="_Toc144280374" class="anchor"><span id="_Toc144540589" class="anchor"><span id="_Toc144554471" class="anchor"><span id="_Toc144722093" class="anchor"><span id="_Toc145503555" class="anchor"><span id="_Toc145511997" class="anchor"><span id="_Toc145513020" class="anchor"><span id="_Toc145513404" class="anchor"><span id="_Toc222907159" class="anchor"><span id="_Toc342652730" class="anchor"><span id="_Toc439863941" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Hypercall Interface
    ===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================

    1.  <span id="_Toc110172660" class="anchor"><span id="_Toc110172659" class="anchor"><span id="_Toc127596652" class="anchor"><span id="_Toc127786273" class="anchor"><span id="_Toc127786589" class="anchor"><span id="_Toc127786905" class="anchor"><span id="_Toc127877501" class="anchor"><span id="_Toc128289572" class="anchor"><span id="_Toc128289965" class="anchor"><span id="_Toc130189647" class="anchor"><span id="_Toc130200863" class="anchor"><span id="_Toc130201179" class="anchor"><span id="_Toc130201500" class="anchor"><span id="_Toc131936587" class="anchor"><span id="_Toc133901025" class="anchor"><span id="_Toc137460930" class="anchor"><span id="_Toc139096445" class="anchor"><span id="_Toc139188366" class="anchor"><span id="_Toc139191229" class="anchor"><span id="_Toc140490279" class="anchor"><span id="_Toc140571182" class="anchor"><span id="_Toc141257452" class="anchor"><span id="_Toc141257779" class="anchor"><span id="_Toc141267306" class="anchor"><span id="_Toc141522324" class="anchor"><span id="_Toc141529415" class="anchor"><span id="_Toc141529732" class="anchor"><span id="_Toc141851339" class="anchor"><span id="_Toc141852273" class="anchor"><span id="_Toc141887817" class="anchor"><span id="_Toc141889657" class="anchor"><span id="_Toc141893326" class="anchor"><span id="_Toc142113175" class="anchor"><span id="_Toc142114203" class="anchor"><span id="_Toc142729363" class="anchor"><span id="_Toc142730647" class="anchor"><span id="_Toc142731020" class="anchor"><span id="_Toc142998385" class="anchor"><span id="_Toc143063476" class="anchor"><span id="_Toc143509586" class="anchor"><span id="_Toc143510033" class="anchor"><span id="_Toc144026123" class="anchor"><span id="_Toc144026454" class="anchor"><span id="_Toc144276097" class="anchor"><span id="_Toc144276441" class="anchor"><span id="_Toc144280029" class="anchor"><span id="_Toc144280375" class="anchor"><span id="_Toc144540590" class="anchor"><span id="_Toc144554472" class="anchor"><span id="_Toc144722094" class="anchor"><span id="_Toc145503556" class="anchor"><span id="_Toc145511998" class="anchor"><span id="_Toc145513021" class="anchor"><span id="_Toc145513405" class="anchor"><span id="_Toc222907160" class="anchor"><span id="_Toc342652731" class="anchor"><span id="_Toc439863942" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Hypercall Overview
        ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

The hypervisor provides a calling mechanism for guests. Such calls are
referred to as *hypercalls*. Each hypercall defines a set of input
and/or output parameters. These parameters are specified in terms of a
memory-based data structure. All elements of the input and output data
structures are padded to natural boundaries up to 8 bytes (that is,
two-byte elements must be on two-byte boundaries and so on).

A second hypercall calling convention can optionally be used for a
subset of hypercalls – in particular, those that have two or fewer input
parameters and no output parameters. When using this calling convention,
the input parameters are passed in registers.

A third hypercall calling convention can optionally be used for a subset
of hypercalls where the input parameter block is up to 112 bytes. When
using this calling convention, the input parameters are passed in
registers, including the volatile XMM registers.

Input and output data structures must both be placed in memory on an
8-byte boundary and padded to a multiple of 8 bytes in size. The values
within the padding regions are ignored by the hypervisor.

For output, the hypervisor is allowed to (but not guaranteed to)
overwrite padding regions. If it overwrites padding regions, it will
write zeros.

<span id="_Toc110172661" class="anchor"><span id="_Toc127596653" class="anchor"><span id="_Toc127786274" class="anchor"><span id="_Toc127786590" class="anchor"><span id="_Toc127786906" class="anchor"><span id="_Toc127877502" class="anchor"><span id="_Toc128289573" class="anchor"><span id="_Toc128289966" class="anchor"><span id="_Toc130189648" class="anchor"><span id="_Toc130200864" class="anchor"><span id="_Toc130201180" class="anchor"><span id="_Toc130201501" class="anchor"><span id="_Toc131936588" class="anchor"><span id="_Toc133901026" class="anchor"><span id="_Toc137460931" class="anchor"><span id="_Toc139096446" class="anchor"><span id="_Toc139188367" class="anchor"><span id="_Toc139191230" class="anchor"><span id="_Toc140490280" class="anchor"><span id="_Toc140571183" class="anchor"><span id="_Toc141257453" class="anchor"><span id="_Toc141257780" class="anchor"><span id="_Toc141267307" class="anchor"><span id="_Toc141522325" class="anchor"><span id="_Toc141529416" class="anchor"><span id="_Toc141529733" class="anchor"><span id="_Toc141851340" class="anchor"><span id="_Toc141852274" class="anchor"><span id="_Toc141887818" class="anchor"><span id="_Toc141889658" class="anchor"><span id="_Toc141893327" class="anchor"><span id="_Toc142113176" class="anchor"><span id="_Toc142114204" class="anchor"><span id="_Toc142729364" class="anchor"><span id="_Toc142730648" class="anchor"><span id="_Toc142731021" class="anchor"><span id="_Toc142998386" class="anchor"><span id="_Toc143063477" class="anchor"><span id="_Toc143509587" class="anchor"><span id="_Toc143510034" class="anchor"><span id="_Toc144026124" class="anchor"><span id="_Toc144026455" class="anchor"><span id="_Toc144276098" class="anchor"><span id="_Toc144276442" class="anchor"><span id="_Toc144280030" class="anchor"><span id="_Toc144280376" class="anchor"><span id="_Toc144540591" class="anchor"><span id="_Toc144554473" class="anchor"><span id="_Toc144722095" class="anchor"><span id="_Toc145503557" class="anchor"><span id="_Toc145511999" class="anchor"><span id="_Toc145513022" class="anchor"><span id="_Toc145513406" class="anchor"><span id="_Toc222907161" class="anchor"><span id="_Toc342652732" class="anchor"><span id="_Toc439863943" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Hypercall Classes
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

There are two classes of hypercalls: *simple* and *rep* (short for
“repeat"). A *simple hypercall* performs a single operation and has a
fixed-size set of input and output parameters. A *rep hypercall* acts
like a series of simple hypercalls. In addition to a fixed-size set of
input and output parameters, rep hypercalls involve a list of fixed-size
input and/or output elements.

When a caller initially invokes a rep hypercall, it specifies a *rep
count* that indicates the number of elements in the input and/or output
parameter list. Callers also specify a *rep start index* that indicates
the next input and/or output element that should be consumed. The
hypervisor processes rep parameters in list order – that is, by
increasing element index.

For subsequent invocations of the rep hypercall, the *rep start index*
indicates how many elements have been completed – and, in conjunction
with the *rep count* value – how many elements are left. For example, if
a caller specifies a rep count of 25, and only 20 iterations are
completed within the 50µs window (described in section 4.3), the
hypercall returns control back to the calling virtual processor after
updating the *rep start index* to 20. (See section 4.7 for more
information about the *rep start index*.) When the hypercall is
re-executed, the hypervisor will resume at element 20 and complete the
remaining 5 elements.

If an error is encountered when processing an element, an appropriate
status code is provided along with a *reps completed count*, indicating
the number of elements that were successfully processed before the error
was encountered. Assuming the specified hypercall control word is valid
(see the following) and the input / output parameter lists are
accessible, the hypervisor is guaranteed to attempt at least one rep,
but it is not required to process the entire list before returning
control back to the caller.

<span id="_Toc133901027" class="anchor"><span id="_Toc137460932" class="anchor"><span id="_Toc139096447" class="anchor"><span id="_Toc139188368" class="anchor"><span id="_Toc139191231" class="anchor"><span id="_Toc140490281" class="anchor"><span id="_Toc140571184" class="anchor"><span id="_Toc141257454" class="anchor"><span id="_Toc141257781" class="anchor"><span id="_Toc141267308" class="anchor"><span id="_Toc141522326" class="anchor"><span id="_Toc141529417" class="anchor"><span id="_Toc141529734" class="anchor"><span id="_Toc141851341" class="anchor"><span id="_Toc141852275" class="anchor"><span id="_Toc141887819" class="anchor"><span id="_Toc141889659" class="anchor"><span id="_Toc141893328" class="anchor"><span id="_Toc142113177" class="anchor"><span id="_Toc142114205" class="anchor"><span id="_Toc142729365" class="anchor"><span id="_Toc142730649" class="anchor"><span id="_Toc142731022" class="anchor"><span id="_Toc142998387" class="anchor"><span id="_Toc143063478" class="anchor"><span id="_Toc143509588" class="anchor"><span id="_Toc143510035" class="anchor"><span id="_Toc144026125" class="anchor"><span id="_Toc144026456" class="anchor"><span id="_Toc144276099" class="anchor"><span id="_Toc144276443" class="anchor"><span id="_Toc144280031" class="anchor"><span id="_Toc144280377" class="anchor"><span id="_Toc144540592" class="anchor"><span id="_Toc144554474" class="anchor"><span id="_Toc144722096" class="anchor"><span id="_Toc145503558" class="anchor"><span id="_Toc145512000" class="anchor"><span id="_Toc145513023" class="anchor"><span id="_Toc145513407" class="anchor"><span id="_Ref221086381" class="anchor"><span id="_Toc222907162" class="anchor"><span id="_Toc342652733" class="anchor"><span id="_Toc110172662" class="anchor"><span id="_Toc127596654" class="anchor"><span id="_Toc127786275" class="anchor"><span id="_Toc127786591" class="anchor"><span id="_Toc127786907" class="anchor"><span id="_Toc127877503" class="anchor"><span id="_Toc128289574" class="anchor"><span id="_Toc128289967" class="anchor"><span id="_Toc130189649" class="anchor"><span id="_Toc130200865" class="anchor"><span id="_Toc130201181" class="anchor"><span id="_Toc130201502" class="anchor"><span id="_Toc131936589" class="anchor"><span id="_Toc439863944" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Hypercall Continuation
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

A hypercall can be thought of as a complex instruction that takes many
cycles. The hypervisor attempts to limit hypercall execution to 50µs or
less before returning control to the virtual processor that invoked the
hypercall. Some hypercall operations are sufficiently complex that a
50µs guarantee is difficult to make. The hypervisor therefore relies on
a *hypercall* *continuation* mechanism for some hypercalls – including
all rep hypercall forms.

The hypercall continuation mechanism is mostly transparent to the
caller. If a hypercall is not able to complete within the prescribed
time limit, control is returned back to the caller, but the instruction
pointer is not advanced past the instruction that invoked the hypercall.
This allows pending interrupts to be handled and other virtual
processors to be scheduled. When the original calling thread resumes
execution, it will re-execute the hypercall instruction and make forward
progress toward completing the operation.

Most simple hypercalls are guaranteed to complete within the prescribed
time limit. However, a small number of simple hypercalls might require
more time. These hypercalls use hypercall continuation in a similar
manner to rep hypercalls. In such cases, the operation involves two or
more internal states. The first invocation places the object (for
example, the partition or virtual processor) into one state, and after
repeated invocations, the state finally transitions to a terminal state.
For each hypercall that follows this pattern, the visible side effects
of intermediate internal states is described.

<span id="_Toc133901028" class="anchor"><span id="_Toc137460933" class="anchor"><span id="_Toc139096448" class="anchor"><span id="_Toc139188369" class="anchor"><span id="_Toc139191232" class="anchor"><span id="_Toc140490282" class="anchor"><span id="_Toc140571185" class="anchor"><span id="_Toc141257455" class="anchor"><span id="_Toc141257782" class="anchor"><span id="_Toc141267309" class="anchor"><span id="_Toc141522327" class="anchor"><span id="_Toc141529418" class="anchor"><span id="_Toc141529735" class="anchor"><span id="_Toc141851342" class="anchor"><span id="_Toc141852276" class="anchor"><span id="_Toc141887820" class="anchor"><span id="_Toc141889660" class="anchor"><span id="_Toc141893329" class="anchor"><span id="_Toc142113178" class="anchor"><span id="_Toc142114206" class="anchor"><span id="_Toc142729366" class="anchor"><span id="_Toc142730650" class="anchor"><span id="_Toc142731023" class="anchor"><span id="_Toc142998388" class="anchor"><span id="_Toc143063479" class="anchor"><span id="_Toc143509589" class="anchor"><span id="_Toc143510036" class="anchor"><span id="_Toc144026126" class="anchor"><span id="_Toc144026457" class="anchor"><span id="_Toc144276100" class="anchor"><span id="_Toc144276444" class="anchor"><span id="_Toc144280032" class="anchor"><span id="_Toc144280378" class="anchor"><span id="_Toc144540593" class="anchor"><span id="_Toc144554475" class="anchor"><span id="_Toc144722097" class="anchor"><span id="_Toc145503559" class="anchor"><span id="_Toc145512001" class="anchor"><span id="_Toc145513024" class="anchor"><span id="_Toc145513408" class="anchor"><span id="_Toc222907163" class="anchor"><span id="_Toc342652734" class="anchor"><span id="_Toc439863945" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Hypercall Atomicity and Ordering
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

Except where noted, the action performed by a hypercall is atomic both
with respect to all other guest operations (for example, instructions
executed within a guest) and all other hypercalls being executed on the
system. A simple hypercall performs a single atomic action; a rep
hypercall performs multiple, independent atomic actions.

Simple hypercalls that use hypercall continuation may involve multiple
internal states that are externally visible. Such calls comprise
multiple atomic operations.

Each hypercall action may read input parameters and/or write results.
The inputs to each action can be read at any granularity and at any time
after the hypercall is made and before the action is executed. The
results (that is, the output parameters) associated with each action may
be written at any granularity and at any time after the action is
executed and before the hypercall returns.

The guest must avoid the examination and/or manipulation of any input or
output parameters related to an executing hypercall. While a virtual
processor executing a hypercall will be incapable of doing so (as its
guest execution is suspended until the hypercall returns), there is
nothing to prevent other virtual processors from doing so. Guests
behaving in this manner may crash or cause corruption within their
partition.

<span id="_Toc110172663" class="anchor"><span id="_Toc127596655" class="anchor"><span id="_Toc127786276" class="anchor"><span id="_Toc127786592" class="anchor"><span id="_Toc127786908" class="anchor"><span id="_Toc127877504" class="anchor"><span id="_Toc128289575" class="anchor"><span id="_Toc128289968" class="anchor"><span id="_Toc130189650" class="anchor"><span id="_Toc130200866" class="anchor"><span id="_Toc130201182" class="anchor"><span id="_Toc130201503" class="anchor"><span id="_Toc131936590" class="anchor"><span id="_Toc133901029" class="anchor"><span id="_Toc137460934" class="anchor"><span id="_Toc139096449" class="anchor"><span id="_Toc139188370" class="anchor"><span id="_Toc139191233" class="anchor"><span id="_Toc140490283" class="anchor"><span id="_Toc140571186" class="anchor"><span id="_Toc141257456" class="anchor"><span id="_Toc141257783" class="anchor"><span id="_Toc141267310" class="anchor"><span id="_Toc141522328" class="anchor"><span id="_Toc141529419" class="anchor"><span id="_Toc141529736" class="anchor"><span id="_Toc141851343" class="anchor"><span id="_Toc141852277" class="anchor"><span id="_Toc141887821" class="anchor"><span id="_Toc141889661" class="anchor"><span id="_Toc141893330" class="anchor"><span id="_Toc142113179" class="anchor"><span id="_Toc142114207" class="anchor"><span id="_Toc142729367" class="anchor"><span id="_Toc142730651" class="anchor"><span id="_Toc142731024" class="anchor"><span id="_Toc142998389" class="anchor"><span id="_Toc143063480" class="anchor"><span id="_Toc143509590" class="anchor"><span id="_Toc143510037" class="anchor"><span id="_Toc144026127" class="anchor"><span id="_Toc144026458" class="anchor"><span id="_Toc144276101" class="anchor"><span id="_Toc144276445" class="anchor"><span id="_Toc144280033" class="anchor"><span id="_Toc144280379" class="anchor"><span id="_Toc144540594" class="anchor"><span id="_Toc144554476" class="anchor"><span id="_Toc144722098" class="anchor"><span id="_Toc145503560" class="anchor"><span id="_Toc145512002" class="anchor"><span id="_Toc145513025" class="anchor"><span id="_Toc145513409" class="anchor"><span id="_Toc222907164" class="anchor"><span id="_Toc342652735" class="anchor"><span id="_Toc439863946" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Legal Hypercall Environments
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

Hypercalls can be invoked only from the most privileged guest processor
mode. In the case of x64, this means protected mode with a current
privilege level (CPL) of zero. Although real-mode code runs with an
effective CPL of zero, hypercalls are *not* allowed in real mode. An
attempt to invoke a hypercall within an illegal processor mode will
generate a \#UD (undefined operation) exception.

All hypercalls should be invoked through the architecturally-defined
hypercall interface. (See the following sections for instructions on
discovering and establishing this interface.) An attempt to invoke a
hypercall by any other means (for example, copying the code from the
hypercall code page to an alternate location and executing it from
there) *might* result in an undefined operation (\#UD) exception. The
hypervisor is not guaranteed to deliver this exception.

<span id="_Toc110172664" class="anchor"><span id="_Toc127596656" class="anchor"><span id="_Toc127786277" class="anchor"><span id="_Toc127786593" class="anchor"><span id="_Toc127786909" class="anchor"><span id="_Toc127877505" class="anchor"><span id="_Toc128289576" class="anchor"><span id="_Toc128289969" class="anchor"><span id="_Toc130189651" class="anchor"><span id="_Toc130200867" class="anchor"><span id="_Toc130201183" class="anchor"><span id="_Toc130201504" class="anchor"><span id="_Toc131936591" class="anchor"><span id="_Toc133901030" class="anchor"><span id="_Toc137460935" class="anchor"><span id="_Toc139096450" class="anchor"><span id="_Toc139188371" class="anchor"><span id="_Toc139191234" class="anchor"><span id="_Toc140490284" class="anchor"><span id="_Toc140571187" class="anchor"><span id="_Toc141257457" class="anchor"><span id="_Toc141257784" class="anchor"><span id="_Toc141267311" class="anchor"><span id="_Toc141522329" class="anchor"><span id="_Toc141529420" class="anchor"><span id="_Toc141529737" class="anchor"><span id="_Toc141851344" class="anchor"><span id="_Toc141852278" class="anchor"><span id="_Toc141887822" class="anchor"><span id="_Toc141889662" class="anchor"><span id="_Toc141893331" class="anchor"><span id="_Toc142113180" class="anchor"><span id="_Toc142114208" class="anchor"><span id="_Toc142729368" class="anchor"><span id="_Toc142730652" class="anchor"><span id="_Toc142731025" class="anchor"><span id="_Toc142998390" class="anchor"><span id="_Toc143063481" class="anchor"><span id="_Toc143509591" class="anchor"><span id="_Toc143510038" class="anchor"><span id="_Toc144026128" class="anchor"><span id="_Toc144026459" class="anchor"><span id="_Toc144276102" class="anchor"><span id="_Toc144276446" class="anchor"><span id="_Toc144280034" class="anchor"><span id="_Toc144280380" class="anchor"><span id="_Toc144540595" class="anchor"><span id="_Toc144554477" class="anchor"><span id="_Toc144722099" class="anchor"><span id="_Toc145503561" class="anchor"><span id="_Toc145512003" class="anchor"><span id="_Toc145513026" class="anchor"><span id="_Toc145513410" class="anchor"><span id="_Toc222907165" class="anchor"><span id="_Toc342652736" class="anchor"><span id="_Toc439863947" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Alignment Requirements
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

Callers must specify the 64-bit guest physical address (GPA) of the
input and/or output parameters. If the hypercall involves no input or
output parameters, the hypervisor ignores the corresponding GPA pointer.

The input and output parameter lists cannot overlap or cross page
boundaries. Hypercall input and output pages are expected to be GPA
pages and not “overlay" pages (for a discussion of overlay pages, see
section 8.1.3). If the virtual processor writes the input parameters to
an overlay page and specifies a GPA within this page, hypervisor access
to the input parameter list is undefined.

The hypervisor will validate that the calling partition can read from
the input page before executing the requested hypercall. This validation
consists of two checks: the specified GPA is mapped and the GPA is
marked *readable*. If either of these tests fails, the hypervisor
generates a memory intercept message. For more information on memory
intercepts, see section 11.6.

For hypercalls that have output parameters, the hypervisor will validate
that the partition can be write to the output page. This validation
consists of two checks: the specified GPA is mapped and the GPA is
marked *writable*. If either of these tests fails, the hypervisor
attempts to generate a memory intercept message. If the validation
succeeds, the hypervisor “locks" the output GPA for the duration of the
operation. Any attempt to remap or unmap this GPA will be deferred until
after the hypercall is complete.

<span id="_Toc127596657" class="anchor"><span id="_Toc127786278" class="anchor"><span id="_Toc127786594" class="anchor"><span id="_Toc127786910" class="anchor"><span id="_Toc127877506" class="anchor"><span id="_Toc128289577" class="anchor"><span id="_Toc128289970" class="anchor"><span id="_Ref128802961" class="anchor"><span id="_Toc130189652" class="anchor"><span id="_Toc130200868" class="anchor"><span id="_Toc130201184" class="anchor"><span id="_Toc130201505" class="anchor"><span id="_Toc131936592" class="anchor"><span id="_Toc133901031" class="anchor"><span id="_Ref134249959" class="anchor"><span id="_Toc137460936" class="anchor"><span id="_Toc139096451" class="anchor"><span id="_Toc139188372" class="anchor"><span id="_Toc139191235" class="anchor"><span id="_Toc140490285" class="anchor"><span id="_Toc140571188" class="anchor"><span id="_Ref141187459" class="anchor"><span id="_Toc141257458" class="anchor"><span id="_Toc141257785" class="anchor"><span id="_Toc141267312" class="anchor"><span id="_Toc141522330" class="anchor"><span id="_Toc141529421" class="anchor"><span id="_Toc141529738" class="anchor"><span id="_Toc141851345" class="anchor"><span id="_Toc141852279" class="anchor"><span id="_Toc141887823" class="anchor"><span id="_Toc141889663" class="anchor"><span id="_Toc141893332" class="anchor"><span id="_Toc142113181" class="anchor"><span id="_Toc142114209" class="anchor"><span id="_Toc142729369" class="anchor"><span id="_Toc142730653" class="anchor"><span id="_Toc142731026" class="anchor"><span id="_Toc142998391" class="anchor"><span id="_Toc143063482" class="anchor"><span id="_Toc143509592" class="anchor"><span id="_Toc143510039" class="anchor"><span id="_Toc144026129" class="anchor"><span id="_Toc144026460" class="anchor"><span id="_Toc144276103" class="anchor"><span id="_Toc144276447" class="anchor"><span id="_Toc144280035" class="anchor"><span id="_Toc144280381" class="anchor"><span id="_Toc144540596" class="anchor"><span id="_Toc144554478" class="anchor"><span id="_Toc144722100" class="anchor"><span id="_Toc145503562" class="anchor"><span id="_Toc145512004" class="anchor"><span id="_Toc145513027" class="anchor"><span id="_Toc145513411" class="anchor"><span id="_Ref147203872" class="anchor"><span id="_Ref221524051" class="anchor"><span id="_Toc222907166" class="anchor"><span id="_Toc342652737" class="anchor"><span id="_Toc110172665" class="anchor"><span id="_Toc439863948" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Hypercall Inputs
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

Callers specify a hypercall by a 64-bit value called a *hypercall input
value*. It is formatted as follows:

  ---------------------------------------------------------------------------------------
  **63:60**   **59:48**         **47:44**   **43:32**   **31:17**   **16**    **15:0**
  ----------- ----------------- ----------- ----------- ----------- --------- -----------
  RsvdZ       Rep start index   RsvdZ       Rep count   RsvdZ       Fast      Call Code
                                                                              
  (4 bits)    (12 bits)         (4 bits)    (12 bits)   (15 bits)   (1 bit)   (16 bits)
  ---------------------------------------------------------------------------------------

  ---------------------------------------------------------------------------------------------------------
  Call code         16 bits   Specifies which hypercall is requested
  ----------------- --------- -----------------------------------------------------------------------------
  Fast              1 bit     Specifies whether the hypercall uses the register-based calling convention.
                              
                              0: Use the memory-based calling convention
                              
                              1: Use the register-based calling convention
                              
                              If this calling convention is used, the Rep fields must be zero.

  RsvdZ             15 bits   Must be zero

  Rep Count         12 bits   Total number of reps (for rep call, must be zero otherwise)

  RsvdZ             4 bits    Must be zero

  Rep Start Index   12 bits   Starting index (for rep call, must be zero otherwise)

  RsvdZ             4 bits    Must be zero
  ---------------------------------------------------------------------------------------------------------

For rep hypercalls, the *rep count* field indicates the total number of
reps. The *rep start index* indicates the particular repetition relative
to the start of the list (zero indicates that the first element in the
list is to be processed). Therefore, the *rep count* value must always
be greater than the *rep start index*.

Register mapping for hypercall inputs when the Fast flag is zero:

  x64   x86       Contents
  ----- --------- -----------------------
  RCX   EDX:EAX   Hypercall Input Value
  RDX   EBX:ECX   Input Parameters GPA
  R8    EDI:ESI   Output Parameters GPA

The hypercall input value is passed in registers along with a GPA that
points to the input and output parameters. The register mappings depend
on whether the caller is running in 32-bit (x86) or 64-bit (x64) mode.
The hypervisor determines the caller’s mode based on the value of
EFER.LMA and CS.L. If both of these flags are set, the caller is assumed
to be a 64-bit caller.

Some register values are considered volatile and can be modified by a
hypercall. This list includes the condition code registers SF, ZF, OF,
CF, AF, and PF. It also includes EAX, ECX, and EDX for x86 callers and
RCX, RDX, R8, R9, R10, R11, and XMM0 through XMM5 for x64 callers.

RAX (on x64) and EDX:EAX (on x86) are always overwritten with the
hypercall result value (discussed in section 4.8).

Register mapping for hypercall inputs when the Fast flag is one:

  x64   x86       Contents
  ----- --------- -----------------------
  RCX   EDX:EAX   Hypercall Input Value
  RDX   EBX:ECX   Input Parameter
  R8    EDI:ESI   Input Parameter

The hypercall input value is passed in registers along with the input
parameters. The register mappings depend on whether the caller is
running in 32-bit (x86) or 64-bit (x64) mode. The hypervisor determines
the caller’s mode based on the value of EFER.LMA and CS.L. If both of
these flags are set, the caller is assumed to be a 64-bit caller.

Some register values are considered volatile and can be modified by a
hypercall. This list includes the condition code registers SF, ZF, OF,
CF, AF, and PF. It also includes EAX, ECX, EDX, EDI and ESI for x86
callers and RCX, RDX, R8, R9, R10, R11, and XMM0 through XMM5 for x64
callers.

RAX, RDX and R8 (on x64) and EDX:EAX, EBX:ECX and EDI:ESI (on x86) are
always overwritten with the hypercall result value and the output
parameters, if any (discussed in section 4.8).

### <span id="_Toc222907167" class="anchor"><span id="_Toc342652738" class="anchor"><span id="_Toc110172666" class="anchor"><span id="_Toc127596658" class="anchor"><span id="_Toc127786279" class="anchor"><span id="_Toc127786595" class="anchor"><span id="_Toc127786911" class="anchor"><span id="_Toc127877507" class="anchor"><span id="_Toc128289578" class="anchor"><span id="_Toc128289971" class="anchor"><span id="_Toc130189653" class="anchor"><span id="_Toc130200869" class="anchor"><span id="_Toc130201185" class="anchor"><span id="_Toc130201506" class="anchor"><span id="_Toc131936593" class="anchor"><span id="_Toc133901032" class="anchor"><span id="_Toc137460937" class="anchor"><span id="_Toc139096452" class="anchor"><span id="_Ref139185836" class="anchor"><span id="_Toc139188373" class="anchor"><span id="_Toc139191236" class="anchor"><span id="_Toc140490286" class="anchor"><span id="_Toc140571189" class="anchor"><span id="_Toc141257459" class="anchor"><span id="_Toc141257786" class="anchor"><span id="_Toc141267313" class="anchor"><span id="_Toc141522331" class="anchor"><span id="_Toc141529422" class="anchor"><span id="_Toc141529739" class="anchor"><span id="_Toc141851346" class="anchor"><span id="_Toc141852280" class="anchor"><span id="_Toc141887824" class="anchor"><span id="_Toc141889664" class="anchor"><span id="_Toc141893333" class="anchor"><span id="_Toc142113182" class="anchor"><span id="_Toc142114210" class="anchor"><span id="_Ref142232032" class="anchor"><span id="_Toc142729370" class="anchor"><span id="_Toc142730654" class="anchor"><span id="_Toc142731027" class="anchor"><span id="_Toc142998392" class="anchor"><span id="_Toc143063483" class="anchor"><span id="_Toc143509593" class="anchor"><span id="_Toc143510040" class="anchor"><span id="_Toc144026130" class="anchor"><span id="_Toc144026461" class="anchor"><span id="_Toc144276104" class="anchor"><span id="_Toc144276448" class="anchor"><span id="_Toc144280036" class="anchor"><span id="_Toc144280382" class="anchor"><span id="_Toc144540597" class="anchor"><span id="_Toc144554479" class="anchor"><span id="_Toc144722101" class="anchor"><span id="_Toc145503563" class="anchor"><span id="_Toc145512005" class="anchor"><span id="_Toc145513028" class="anchor"><span id="_Toc145513412" class="anchor"><span id="_Toc439863949" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Extended Fast Hypercalls

The hypervisor supports the use of *extended fast hypercalls*, which
allows some hypercalls to take advantage of the improved performance of
the fast hypercall interface even though they require more than two
input parameters. The extended fast hypercall interface uses six
volatile XMM registers to allow the caller to pass an input parameter
block up to 112 bytes in size. Availability of the extended fast
hypercall interface is indicated by the presence of a flag returned by
the CPUID instruction for a hypervisor leaf (see section 3.4). Any
attempt to use this interface when the hypervisor does not indicate
availability will result in a \#UD fault.

Register mapping for extended fast hypercall inputs when the Fast flag
is one:

  x64    x86       Contents
  ------ --------- -------------------------------------
  RCX    EDX:EAX   Hypercall Input Value
  RDX    EBX:ECX   Input Parameter Block (Byte 0-7)
  R8     EDI:ESI   Input Parameter Block (Byte 8-15)
  XMM0   XMM0      Input Parameter Block (Byte 16-31)
  XMM1   XMM1      Input Parameter Block (Byte 32-47)
  XMM2   XMM2      Input Parameter Block (Byte 48-63)
  XMM3   XMM3      Input Parameter Block (Byte 64-79)
  XMM4   XMM4      Input Parameter Block (Byte 80-95)
  XMM5   XMM5      Input Parameter Block (Byte 96-111)

The hypercall input value is passed in registers along with the input
parameters. The register mappings depend on whether the caller is
running in 32-bit (x86) or 64-bit (x64) mode. The hypervisor determines
the caller’s mode based on the value of EFER.LMA and CS.L. If both of
these flags are set, the caller is assumed to be a 64-bit caller. If the
input parameter block is smaller than 112 bytes, any extra bytes in the
registers are ignored.

Some register values are considered volatile and can be modified by a
hypercall. This list includes the condition code registers SF, ZF, OF,
CF, AF, and PF. It also includes EAX, ECX, EDX, EDI and ESI for x86
callers and RCX, RDX, R8, R9, R10, R11, and XMM0 through XMM5 for x64
callers.

RAX, RDX and R8 (on x64) and EDX:EAX, EBX:ECX and EDI:ESI (on x86) are
always overwritten with the hypercall result value and the output
parameters, if any (discussed in section 4.8).

<span id="_Ref221936236" class="anchor"><span id="_Ref221936255" class="anchor"><span id="_Ref221936275" class="anchor"><span id="_Toc222907168" class="anchor"><span id="_Toc342652739" class="anchor"><span id="_Toc439863950" class="anchor"></span></span></span></span></span></span>Hypercall Outputs
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

  --------------------------------------------------------------------------------------------------------------------------------------------------
  All hypercalls return a 64-bit value called a *hypercall result value*. It is formatted as follows:63:40   43:32           31:16       15:0
  ---------------------------------------------------------------------------------------------------------- --------------- ----------- -----------
  Rsvd                                                                                                       Reps complete   Rsvd        Result
                                                                                                                                         
  (20 bits)                                                                                                  (12 bits)       (16 bits)   (16 bits)
  --------------------------------------------------------------------------------------------------------------------------------------------------

  Result           16 bits   HV\_STATUS code indicating success or failure
  ---------------- --------- -----------------------------------------------
  Rsvd             16 bits   Callers should ignore the value in these bits
  Reps completed   12 bits   Number of reps successfully completed
  Rsvd             20 bits   Callers should ignore the value in these bits

For rep hypercalls, the *reps complete* field is the total number of
reps complete and not relative to the *rep start index*. For example, if
the caller specified a *rep start index* of 5, and a *rep count* of 10,
the *reps complete* field would indicate 10 upon successful completion.

The hypercall result value is passed back in registers. The register
mapping depends on whether the caller is running in 32-bit (x86) or
64-bit (x64) mode (see above).

  The register mapping for hypercall outputs is as follows:x64   x86       Content
  -------------------------------------------------------------- --------- ------------------------
  RAX                                                            EDX:EAX   Hypercall Result Value

<span id="_Toc110172667" class="anchor"><span id="_Toc127596659" class="anchor"><span id="_Toc127786280" class="anchor"><span id="_Toc127786596" class="anchor"><span id="_Toc127786912" class="anchor"><span id="_Toc127877508" class="anchor"><span id="_Toc128289579" class="anchor"><span id="_Toc128289972" class="anchor"><span id="_Toc130189654" class="anchor"><span id="_Toc130200870" class="anchor"><span id="_Toc130201186" class="anchor"><span id="_Toc130201507" class="anchor"><span id="_Toc131936594" class="anchor"><span id="_Toc133901033" class="anchor"><span id="_Toc137460938" class="anchor"><span id="_Toc139096453" class="anchor"><span id="_Toc139188374" class="anchor"><span id="_Toc139191237" class="anchor"><span id="_Toc140490287" class="anchor"><span id="_Toc140571190" class="anchor"><span id="_Toc141257460" class="anchor"><span id="_Toc141257787" class="anchor"><span id="_Toc141267314" class="anchor"><span id="_Toc141522332" class="anchor"><span id="_Toc141529423" class="anchor"><span id="_Toc141529740" class="anchor"><span id="_Toc141851347" class="anchor"><span id="_Toc141852281" class="anchor"><span id="_Toc141887825" class="anchor"><span id="_Toc141889665" class="anchor"><span id="_Toc141893334" class="anchor"><span id="_Toc142113183" class="anchor"><span id="_Toc142114211" class="anchor"><span id="_Toc142729371" class="anchor"><span id="_Toc142730655" class="anchor"><span id="_Toc142731028" class="anchor"><span id="_Toc142998393" class="anchor"><span id="_Toc143063484" class="anchor"><span id="_Toc143509594" class="anchor"><span id="_Toc143510041" class="anchor"><span id="_Toc144026131" class="anchor"><span id="_Toc144026462" class="anchor"><span id="_Toc144276105" class="anchor"><span id="_Toc144276449" class="anchor"><span id="_Toc144280037" class="anchor"><span id="_Toc144280383" class="anchor"><span id="_Toc144540598" class="anchor"><span id="_Toc144554480" class="anchor"><span id="_Toc144722102" class="anchor"><span id="_Toc145503564" class="anchor"><span id="_Toc145512006" class="anchor"><span id="_Toc145513029" class="anchor"><span id="_Toc145513413" class="anchor"><span id="_Toc222907169" class="anchor"><span id="_Toc342652740" class="anchor"><span id="_Toc439863951" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Hypercall Details
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

Each hypercall in this document is described in two ways: a *wrapper
interface* and a *native interface*. The wrapper interface is the
recommended high-level (C-style) calling convention typically provided
by a “wrapper library" that runs within the guest (for example,
*winhv.sys* on Microsoft Windows^®^). The native interface is the one
actually provided by the hypervisor.

The recommended wrapper interface is described using standard C-style
notation. The following is an example of a wrapper interface for the
hypothetical *HvAssignWidgets* hypercall:

HV\_STATUS

HvAssignWidgets(

\_\_in HV\_PARTITION\_ID PartitionId,

\_\_in UINT64 Flags,

\_\_inout PUINT32 RepCount,

\_\_in PCHV\_WIDGET WidgetList

);

The native interface is defined in terms of memory-based data
structures. Up to four data structures may be defined:

-   Input parameter header

-   Input list element (for rep hypercalls)

-   Output parameter header

-   Output list element (for rep hypercalls)

The following is an example of the native interface documentation for
the hypothetical *HvAssignWidgets* hypercall:

  HvAssignWidgets \[rep\]
  ------------------------- ----------------------- -------------------
  InputParameter Header
  0
  8
  Input List Element
  0
  8

<span id="_Toc110172668" class="anchor"><span id="_Toc127596660"
class="anchor"><span id="_Toc127786281" class="anchor"><span
id="_Toc127786597" class="anchor"><span id="_Toc127786913"
class="anchor"><span id="_Toc127877509" class="anchor"><span
id="_Toc128289580" class="anchor"><span id="_Toc128289973"
class="anchor"></span></span></span></span></span></span></span></span>The
above is an example of a rep (repeating) hypercall. As input, it has two
fixed parameters and an input list consisting of one or more elements.
The first list element can be found at offset 16. The list element is
described using offsets within the element itself, starting with 0.

<span id="_Toc140490288" class="anchor"><span id="_Toc140571191" class="anchor"><span id="_Toc141257461" class="anchor"><span id="_Toc141257788" class="anchor"><span id="_Toc141267315" class="anchor"><span id="_Toc141522333" class="anchor"><span id="_Toc141529424" class="anchor"><span id="_Toc141529741" class="anchor"><span id="_Toc141851348" class="anchor"><span id="_Toc141852282" class="anchor"><span id="_Toc141887826" class="anchor"><span id="_Toc141889666" class="anchor"><span id="_Toc141893335" class="anchor"><span id="_Toc142113184" class="anchor"><span id="_Toc142114212" class="anchor"><span id="_Toc142729372" class="anchor"><span id="_Toc142730656" class="anchor"><span id="_Toc142731029" class="anchor"><span id="_Toc142998394" class="anchor"><span id="_Toc143063485" class="anchor"><span id="_Toc143509595" class="anchor"><span id="_Toc143510042" class="anchor"><span id="_Toc144026132" class="anchor"><span id="_Toc144026463" class="anchor"><span id="_Toc144276106" class="anchor"><span id="_Toc144276450" class="anchor"><span id="_Toc144280038" class="anchor"><span id="_Toc144280384" class="anchor"><span id="_Toc144540599" class="anchor"><span id="_Toc144554481" class="anchor"><span id="_Toc144722103" class="anchor"><span id="_Toc145503565" class="anchor"><span id="_Toc145512007" class="anchor"><span id="_Toc145513030" class="anchor"><span id="_Toc145513414" class="anchor"><span id="_Toc222907170" class="anchor"><span id="_Toc342652741" class="anchor"><span id="_Toc139188375" class="anchor"><span id="_Toc139191238" class="anchor"><span id="_Toc130189655" class="anchor"><span id="_Toc130200871" class="anchor"><span id="_Toc130201187" class="anchor"><span id="_Toc130201508" class="anchor"><span id="_Toc131936595" class="anchor"><span id="_Toc133901034" class="anchor"><span id="_Toc137460939" class="anchor"><span id="_Toc139096454" class="anchor"><span id="_Toc439863952" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Hypercall Restrictions
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

Hypercalls may have restrictions associated with them in order for them
to perform their intended function. If all restrictions are not met, the
hypercall will terminate with an appropriate error. The following
restrictions will be listed, if any apply:

-   The calling partition must possess a particular privilege (see 5.2.3
    for information regarding privilege flags)

-   The calling partition must have been created with a particular
    creation flag (see section 1.1.1 for information regarding
    creation flags)

-   The partition being acted upon must be in a particular state (see
    section 5.2.4 for information regarding partition states)

-   The partition must be the root

-   The partition must be either a parent or child

-   The virtual processor must be in a particular state (see section
    10.1.3 for information regarding virtual processor states).

    1.  <span id="_Toc140490289" class="anchor"><span id="_Toc140571192" class="anchor"><span id="_Toc141257462" class="anchor"><span id="_Toc141257789" class="anchor"><span id="_Toc141267316" class="anchor"><span id="_Toc141522334" class="anchor"><span id="_Toc141529425" class="anchor"><span id="_Toc141529742" class="anchor"><span id="_Toc141851349" class="anchor"><span id="_Toc141852283" class="anchor"><span id="_Toc141887827" class="anchor"><span id="_Toc141889667" class="anchor"><span id="_Toc141893336" class="anchor"><span id="_Toc142113185" class="anchor"><span id="_Toc142114213" class="anchor"><span id="_Toc142729373" class="anchor"><span id="_Toc142730657" class="anchor"><span id="_Toc142731030" class="anchor"><span id="_Toc142998395" class="anchor"><span id="_Toc143063486" class="anchor"><span id="_Toc143509596" class="anchor"><span id="_Toc143510043" class="anchor"><span id="_Toc144026133" class="anchor"><span id="_Toc144026464" class="anchor"><span id="_Toc144276107" class="anchor"><span id="_Toc144276451" class="anchor"><span id="_Toc144280039" class="anchor"><span id="_Toc144280385" class="anchor"><span id="_Toc144540600" class="anchor"><span id="_Toc144554482" class="anchor"><span id="_Toc144722104" class="anchor"><span id="_Toc145503566" class="anchor"><span id="_Toc145512008" class="anchor"><span id="_Toc145513031" class="anchor"><span id="_Toc145513415" class="anchor"><span id="_Ref150588152" class="anchor"><span id="_Toc222907171" class="anchor"><span id="_Toc342652742" class="anchor"><span id="_Toc439863953" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Hypercall Status Codes
        -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

Each hypercall is documented as returning an output value that contains
several fields. A status value field (of type HV\_STATUS) is used to
indicate whether the call succeeded or failed. The hypercall status
value field is discussed in section 4.7.1.

### <span id="_Ref150587937" class="anchor"><span id="_Toc222907172" class="anchor"><span id="_Toc342652743" class="anchor"><span id="_Toc139188376" class="anchor"><span id="_Toc139191239" class="anchor"><span id="_Toc140490290" class="anchor"><span id="_Toc140571193" class="anchor"><span id="_Toc141257463" class="anchor"><span id="_Toc141257790" class="anchor"><span id="_Toc141267317" class="anchor"><span id="_Toc141522335" class="anchor"><span id="_Toc141529426" class="anchor"><span id="_Toc141529743" class="anchor"><span id="_Toc141851350" class="anchor"><span id="_Toc141852284" class="anchor"><span id="_Toc141887828" class="anchor"><span id="_Toc141889668" class="anchor"><span id="_Toc141893337" class="anchor"><span id="_Toc142113186" class="anchor"><span id="_Toc142114214" class="anchor"><span id="_Toc142729374" class="anchor"><span id="_Toc142730658" class="anchor"><span id="_Toc142731031" class="anchor"><span id="_Toc142998396" class="anchor"><span id="_Toc143063487" class="anchor"><span id="_Toc143509597" class="anchor"><span id="_Toc143510044" class="anchor"><span id="_Toc144026134" class="anchor"><span id="_Toc144026465" class="anchor"><span id="_Toc144276108" class="anchor"><span id="_Toc144276452" class="anchor"><span id="_Toc144280040" class="anchor"><span id="_Toc144280386" class="anchor"><span id="_Toc144540601" class="anchor"><span id="_Toc144554483" class="anchor"><span id="_Toc144722105" class="anchor"><span id="_Toc145503567" class="anchor"><span id="_Toc145512009" class="anchor"><span id="_Toc145513032" class="anchor"><span id="_Toc145513416" class="anchor"><span id="_Toc439863954" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Output Parameter Validity on Failed Hypercalls

When a hypercall fails (that is, the result field of the hypercall
result value contains a value other than HV\_STATUS\_SUCCESS), the
content of all output parameters are indeterminate and should not be
examined by the caller. Only when the hypercall succeeds, will all
appropriate output parameters contain valid, expected results.

### <span id="_Toc222907173" class="anchor"><span id="_Toc342652744" class="anchor"><span id="_Toc439863955" class="anchor"></span></span></span>Ordering of Error Conditions

Error conditions are not presented in this document in any particular
sequence. The order in which error conditions are detected and reported
by the hypervisor is undefined. In other words, if multiple errors
exist, the hypervisor must choose which error condition to report.
Priority should be given to those error codes offering greater security,
the intent being to prevent the hypervisor from revealing information to
callers lacking sufficient privilege. For example, the status code
HV\_STATUS\_ACCESS\_DENIED is the preferred status code over one that
would reveal some context or state information purely based upon
privilege.

### <span id="_Toc139188377" class="anchor"><span id="_Toc139191240" class="anchor"><span id="_Toc140490291" class="anchor"><span id="_Toc140571194" class="anchor"><span id="_Toc141257464" class="anchor"><span id="_Toc141257791" class="anchor"><span id="_Toc141267318" class="anchor"><span id="_Toc141522336" class="anchor"><span id="_Toc141529427" class="anchor"><span id="_Toc141529744" class="anchor"><span id="_Toc141851351" class="anchor"><span id="_Toc141852285" class="anchor"><span id="_Toc141887829" class="anchor"><span id="_Toc141889669" class="anchor"><span id="_Toc141893338" class="anchor"><span id="_Toc142113187" class="anchor"><span id="_Toc142114215" class="anchor"><span id="_Toc142729375" class="anchor"><span id="_Toc142730659" class="anchor"><span id="_Toc142731032" class="anchor"><span id="_Toc142998397" class="anchor"><span id="_Toc143063488" class="anchor"><span id="_Toc143509598" class="anchor"><span id="_Toc143510045" class="anchor"><span id="_Toc144026135" class="anchor"><span id="_Toc144026466" class="anchor"><span id="_Toc144276109" class="anchor"><span id="_Toc144276453" class="anchor"><span id="_Toc144280041" class="anchor"><span id="_Toc144280387" class="anchor"><span id="_Toc144540602" class="anchor"><span id="_Toc144554484" class="anchor"><span id="_Toc144722106" class="anchor"><span id="_Toc145503568" class="anchor"><span id="_Toc145512010" class="anchor"><span id="_Toc145513033" class="anchor"><span id="_Toc145513417" class="anchor"><span id="_Toc222907174" class="anchor"><span id="_Toc342652745" class="anchor"><span id="_Toc439863956" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Common Hypercall Status Codes

Several result codes are common to all hypercalls and are therefore not
documented for each hypercall individually. These include the following:

  **Status code**                         **Error condition**
  --------------------------------------- -----------------------------------------------------------------------------------------------------------------------------------------
  HV\_STATUS\_SUCCESS                     The call succeeded.
  HV\_STATUS\_INVALID\_HYPERCALL\_CODE    The hypercall code is not recognized.
  HV\_STATUS\_INVALID\_HYPERCALL\_INPUT   The rep count is incorrect (for example, a non-zero rep count is passed to a non-rep call or a zero rep count is passed to a rep call).
                                          The rep start index is not less than the rep count.
                                          A reserved bit in the specified hypercall input value is non-zero.
  HV\_STATUS\_INVALID\_ALIGNMENT          The specified input or output GPA pointer is not aligned to 8 bytes.
                                          The specified input or output parameter lists spans pages.
                                          The input or output GPA pointer is not within the bounds of the GPA space.

The return code HV\_STATUS\_SUCCESS indicates that no error condition
was detected.

<span id="_Toc110172670" class="anchor"><span id="_Ref121468236" class="anchor"><span id="_Ref121470751" class="anchor"><span id="_Ref125170458" class="anchor"><span id="_Toc127596661" class="anchor"><span id="_Toc127786282" class="anchor"><span id="_Toc127786598" class="anchor"><span id="_Toc127786914" class="anchor"><span id="_Toc127877510" class="anchor"><span id="_Toc128289581" class="anchor"><span id="_Toc128289974" class="anchor"><span id="_Toc130189656" class="anchor"><span id="_Toc130200872" class="anchor"><span id="_Toc130201188" class="anchor"><span id="_Toc130201509" class="anchor"><span id="_Toc131936596" class="anchor"><span id="_Toc133901035" class="anchor"><span id="_Toc137460940" class="anchor"><span id="_Toc139096455" class="anchor"><span id="_Toc139188378" class="anchor"><span id="_Toc139191241" class="anchor"><span id="_Toc140490292" class="anchor"><span id="_Toc140571195" class="anchor"><span id="_Toc141257465" class="anchor"><span id="_Toc141257792" class="anchor"><span id="_Toc141267319" class="anchor"><span id="_Toc141522337" class="anchor"><span id="_Toc141529428" class="anchor"><span id="_Toc141529745" class="anchor"><span id="_Toc141851352" class="anchor"><span id="_Toc141852286" class="anchor"><span id="_Toc141887830" class="anchor"><span id="_Toc141889670" class="anchor"><span id="_Toc141893339" class="anchor"><span id="_Toc142113188" class="anchor"><span id="_Toc142114216" class="anchor"><span id="_Toc142729376" class="anchor"><span id="_Toc142730660" class="anchor"><span id="_Toc142731033" class="anchor"><span id="_Toc142998398" class="anchor"><span id="_Toc143063489" class="anchor"><span id="_Toc143509599" class="anchor"><span id="_Toc143510046" class="anchor"><span id="_Toc144026136" class="anchor"><span id="_Toc144026467" class="anchor"><span id="_Toc144276110" class="anchor"><span id="_Toc144276454" class="anchor"><span id="_Toc144280042" class="anchor"><span id="_Toc144280388" class="anchor"><span id="_Toc144540603" class="anchor"><span id="_Toc144554485" class="anchor"><span id="_Toc144722107" class="anchor"><span id="_Toc145503569" class="anchor"><span id="_Toc145512011" class="anchor"><span id="_Toc145513034" class="anchor"><span id="_Toc145513418" class="anchor"><span id="_Ref159055953" class="anchor"><span id="_Toc222907175" class="anchor"><span id="_Toc342652746" class="anchor"><span id="_Toc439863957" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Establishing the Hypercall Interface
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

Hypercalls are invoked by using a special opcode. Because this opcode
differs among virtualization implementations, it is necessary for the
hypervisor to abstract this difference. This is done through a special
*hypercall page*. This page is provided by the hypervisor and appears
within the guest’s GPA space. The guest is required to specify the
location of the page by programming an MSR.

\#define HV\_X64\_MSR\_HYPERCALL 0x40000001

  **63:12**                                      **11:1**   **0**
  ---------------------------------------------- ---------- --------
  Guest Physical Page Number of Hypercall Page   RsvdP      Enable

  ---------------------------------------------------------------------------------------------------------------------------------------------------------------
  **Bits**   **Description**                                                                                                            **Attributes**
  ---------- -------------------------------------------------------------------------------------------------------------------------- -------------------------
  63:12      Hypercall GPFN                                                                                                             Read/write
                                                                                                                                        
             Indicates the **Guest Physical Page Number** of the hypercall page                                                         

  11:2       RsvdP                                                                                                                      Reserved
                                                                                                                                        
             Guest should ignore on reads and preserve on writes                                                                        

  1          Locked                                                                                                                     Read/Write (unless set)
                                                                                                                                        
             Indicates if this MSR is immutable. If set, this MSR is locked, thereby preventing the relocation of the hypercall page.   
                                                                                                                                        
             Once set, only system reset can clear this bit.                                                                            

  0          Enable Hypercall Page                                                                                                      Read/write
                                                                                                                                        
             Enables the hypercall page                                                                                                 
  ---------------------------------------------------------------------------------------------------------------------------------------------------------------

The hypercall page can be placed anywhere within the guest’s GPA space,
but must be page-aligned. If the guest attempts to move the hypercall
page beyond the bounds of the GPA space, a \#GP fault will result when
the MSR is written.

This MSR is a partition-wide MSR. In other words, it is shared by all
virtual processors in the partition. If one virtual processor
successfully writes to the MSR, another virtual processor will read the
same value.

Before the hypercall page is enabled, the guest OS must report its
identity by writing its version signature to a separate MSR
(HV\_X64\_MSR\_GUEST\_OS\_ID). If no guest OS identity has been
specified, attempts to enable the hypercall will fail. The enable bit
will remain zero even if a one is written to it. Furthermore, if the
guest OS identity is cleared to zero after the hypercall page has been
enabled, it will become disabled.

The hypercall page appears as an “overlay" to the GPA space; that is, it
covers whatever else is mapped to the GPA range. Its contents are
readable and executable by the guest. Attempts to write to the hypercall
page will result in a protection (\#GP) exception.

After the hypercall page has been enabled, invoking a hypercall simply
involves a call to the start of the page.

The following is a detailed list of the steps involved in establishing
the hypercall page:

1.  The guest reads CPUID leaf 1 and determines whether a hypervisor is
    present by checking bit 31 of register ECX.

2.  The guest reads CPUID leaf 0x40000000 to determine the maximum
    hypervisor CPUID leaf (returned in register EAX) and CPUID leaf
    0x40000001 to determine the interface signature (returned in
    register EAX). It verifies that the maximum leaf value is at least
    0x40000005 and that the interface signature is equal to “Hv\#1".
    This signature implies that HV\_X64\_MSR\_GUEST\_OS\_ID,
    HV\_X64\_MSR\_HYPERCALL and HV\_X64\_MSR\_VP\_INDEX are implemented.

3.  The guest writes its OS identity into the MSR
    HV\_X64\_MSR\_GUEST\_OS\_ID if that register is zero.

4.  The guest reads the Hypercall MSR (HV\_X64\_MSR\_HYPERCALL).

5.  The guest checks the Enable Hypercall Page bit. If it is set, the
    interface is already active, and steps 6 and 7 should be omitted.

6.  The guest finds a page within its GPA space, preferably one that is
    not occupied by RAM, MMIO, and so on. If the page is occupied, the
    guest should avoid using the underlying page for other purposes.

7.  The guest writes a new value to the Hypercall
    MSR (HV\_X64\_MSR\_HYPERCALL) that includes the GPA from step 6 and
    sets the Enable Hypercall Page bit to enable the interface.

8.  The guest creates an executable VA mapping to the hypercall
    page GPA.

9.  The guest consults CPUID leaf 0x40000003 to determine which
    hypervisor facilities are available to it.

After the interface has been established, the guest can initiate a
hypercall. To do so, it populates the registers per the hypercall
protocol and issues a CALL to the beginning of the hypercall page. The
guest should assume the hypercall page performs the equivalent of a near
ret (0xC3) to return to the caller. As such, the hypercall must be
invoked with a valid stack.

1.  <span id="_Toc127596662" class="anchor"><span id="_Toc127786283" class="anchor"><span id="_Toc127786599" class="anchor"><span id="_Toc127786915" class="anchor"><span id="_Toc127877511" class="anchor"><span id="_Toc128289582" class="anchor"><span id="_Toc128289975" class="anchor"><span id="_Toc130189657" class="anchor"><span id="_Toc130200873" class="anchor"><span id="_Toc130201189" class="anchor"><span id="_Toc130201510" class="anchor"><span id="_Toc131936597" class="anchor"><span id="_Toc133901036" class="anchor"><span id="_Toc137460941" class="anchor"><span id="_Toc139096456" class="anchor"><span id="_Toc139188379" class="anchor"><span id="_Toc139191242" class="anchor"><span id="_Toc140490293" class="anchor"><span id="_Toc140571196" class="anchor"><span id="_Toc141257466" class="anchor"><span id="_Toc141257793" class="anchor"><span id="_Toc141267320" class="anchor"><span id="_Toc141522338" class="anchor"><span id="_Toc141529429" class="anchor"><span id="_Toc141529746" class="anchor"><span id="_Toc141851353" class="anchor"><span id="_Toc141852287" class="anchor"><span id="_Toc141887831" class="anchor"><span id="_Toc141889671" class="anchor"><span id="_Toc141893340" class="anchor"><span id="_Toc142113189" class="anchor"><span id="_Toc142114217" class="anchor"><span id="_Toc142729377" class="anchor"><span id="_Toc142730661" class="anchor"><span id="_Toc142731034" class="anchor"><span id="_Toc142998399" class="anchor"><span id="_Toc143063490" class="anchor"><span id="_Toc143509600" class="anchor"><span id="_Toc143510047" class="anchor"><span id="_Toc144026137" class="anchor"><span id="_Toc144026468" class="anchor"><span id="_Toc144276111" class="anchor"><span id="_Toc144276455" class="anchor"><span id="_Toc144280043" class="anchor"><span id="_Toc144280389" class="anchor"><span id="_Toc144540604" class="anchor"><span id="_Toc144554486" class="anchor"><span id="_Toc144722108" class="anchor"><span id="_Toc145503570" class="anchor"><span id="_Toc145512012" class="anchor"><span id="_Toc145513035" class="anchor"><span id="_Toc145513419" class="anchor"><span id="_Toc222907176" class="anchor"><span id="_Toc342652747" class="anchor"><span id="_Toc439863958" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Partition Management
    =============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================

    1.  <span id="_Toc110172679" class="anchor"><span id="_Toc127596663" class="anchor"><span id="_Toc127786284" class="anchor"><span id="_Toc127786600" class="anchor"><span id="_Toc127786916" class="anchor"><span id="_Toc127877512" class="anchor"><span id="_Toc128289583" class="anchor"><span id="_Toc128289976" class="anchor"><span id="_Toc130189658" class="anchor"><span id="_Toc130200874" class="anchor"><span id="_Toc130201190" class="anchor"><span id="_Toc130201511" class="anchor"><span id="_Toc131936598" class="anchor"><span id="_Toc133901037" class="anchor"><span id="_Toc137460942" class="anchor"><span id="_Toc139096457" class="anchor"><span id="_Toc139188380" class="anchor"><span id="_Toc139191243" class="anchor"><span id="_Toc140490294" class="anchor"><span id="_Toc140571197" class="anchor"><span id="_Toc141257467" class="anchor"><span id="_Toc141257794" class="anchor"><span id="_Toc141267321" class="anchor"><span id="_Toc141522339" class="anchor"><span id="_Toc141529430" class="anchor"><span id="_Toc141529747" class="anchor"><span id="_Toc141851354" class="anchor"><span id="_Toc141852288" class="anchor"><span id="_Toc141887832" class="anchor"><span id="_Toc141889672" class="anchor"><span id="_Toc141893341" class="anchor"><span id="_Toc142113190" class="anchor"><span id="_Toc142114218" class="anchor"><span id="_Toc142729378" class="anchor"><span id="_Toc142730662" class="anchor"><span id="_Toc142731035" class="anchor"><span id="_Toc142998400" class="anchor"><span id="_Toc143063491" class="anchor"><span id="_Toc143509601" class="anchor"><span id="_Toc143510048" class="anchor"><span id="_Toc144026138" class="anchor"><span id="_Toc144026469" class="anchor"><span id="_Toc144276112" class="anchor"><span id="_Toc144276456" class="anchor"><span id="_Toc144280044" class="anchor"><span id="_Toc144280390" class="anchor"><span id="_Toc144540605" class="anchor"><span id="_Toc144554487" class="anchor"><span id="_Toc144722109" class="anchor"><span id="_Toc145503571" class="anchor"><span id="_Toc145512013" class="anchor"><span id="_Toc145513036" class="anchor"><span id="_Toc145513420" class="anchor"><span id="_Toc222907177" class="anchor"><span id="_Toc342652748" class="anchor"><span id="_Toc439863959" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Overview
        ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

This section defines interfaces that allow guests to create and delete
partitions, to enumerate existing partitions and to manipulate their
state.

1.  <span id="_Toc110172680" class="anchor"><span id="_Toc127596664" class="anchor"><span id="_Toc127786285" class="anchor"><span id="_Toc127786601" class="anchor"><span id="_Toc127786917" class="anchor"><span id="_Toc127877513" class="anchor"><span id="_Toc128289584" class="anchor"><span id="_Toc128289977" class="anchor"><span id="_Toc130189659" class="anchor"><span id="_Toc130200875" class="anchor"><span id="_Toc130201191" class="anchor"><span id="_Toc130201512" class="anchor"><span id="_Toc131936599" class="anchor"><span id="_Toc133901038" class="anchor"><span id="_Toc137460943" class="anchor"><span id="_Toc139096458" class="anchor"><span id="_Toc139188381" class="anchor"><span id="_Toc139191244" class="anchor"><span id="_Toc140490295" class="anchor"><span id="_Toc140571198" class="anchor"><span id="_Toc141257468" class="anchor"><span id="_Toc141257795" class="anchor"><span id="_Toc141267322" class="anchor"><span id="_Toc141522340" class="anchor"><span id="_Toc141529431" class="anchor"><span id="_Toc141529748" class="anchor"><span id="_Toc141851355" class="anchor"><span id="_Toc141852289" class="anchor"><span id="_Toc141887833" class="anchor"><span id="_Toc141889673" class="anchor"><span id="_Toc141893342" class="anchor"><span id="_Toc142113191" class="anchor"><span id="_Toc142114219" class="anchor"><span id="_Toc142729379" class="anchor"><span id="_Toc142730663" class="anchor"><span id="_Toc142731036" class="anchor"><span id="_Toc142998401" class="anchor"><span id="_Toc143063492" class="anchor"><span id="_Toc143509602" class="anchor"><span id="_Toc143510049" class="anchor"><span id="_Toc144026139" class="anchor"><span id="_Toc144026470" class="anchor"><span id="_Toc144276113" class="anchor"><span id="_Toc144276457" class="anchor"><span id="_Toc144280045" class="anchor"><span id="_Toc144280391" class="anchor"><span id="_Toc144540606" class="anchor"><span id="_Toc144554488" class="anchor"><span id="_Toc144722110" class="anchor"><span id="_Toc145503572" class="anchor"><span id="_Toc145512014" class="anchor"><span id="_Toc145513037" class="anchor"><span id="_Toc145513421" class="anchor"><span id="_Toc222907178" class="anchor"><span id="_Toc342652749" class="anchor"><span id="_Toc439863960" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Partition Management Data Types
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

    1.  ### <span id="_Toc110172681" class="anchor"><span id="_Toc127596665" class="anchor"><span id="_Toc127786286" class="anchor"><span id="_Toc127786602" class="anchor"><span id="_Toc127786918" class="anchor"><span id="_Toc127877514" class="anchor"><span id="_Toc128289585" class="anchor"><span id="_Toc128289978" class="anchor"><span id="_Toc130189660" class="anchor"><span id="_Toc130200876" class="anchor"><span id="_Toc130201192" class="anchor"><span id="_Toc130201513" class="anchor"><span id="_Toc131936600" class="anchor"><span id="_Toc133901039" class="anchor"><span id="_Toc137460944" class="anchor"><span id="_Toc139096459" class="anchor"><span id="_Toc139188382" class="anchor"><span id="_Toc139191245" class="anchor"><span id="_Toc140490296" class="anchor"><span id="_Toc140571199" class="anchor"><span id="_Toc141257469" class="anchor"><span id="_Toc141257796" class="anchor"><span id="_Toc141267323" class="anchor"><span id="_Toc141522341" class="anchor"><span id="_Toc141529432" class="anchor"><span id="_Toc141529749" class="anchor"><span id="_Toc141851356" class="anchor"><span id="_Toc141852290" class="anchor"><span id="_Toc141887834" class="anchor"><span id="_Toc141889674" class="anchor"><span id="_Toc141893343" class="anchor"><span id="_Toc142113192" class="anchor"><span id="_Toc142114220" class="anchor"><span id="_Toc142729380" class="anchor"><span id="_Toc142730664" class="anchor"><span id="_Toc142731037" class="anchor"><span id="_Toc142998402" class="anchor"><span id="_Toc143063493" class="anchor"><span id="_Toc143509603" class="anchor"><span id="_Toc143510050" class="anchor"><span id="_Toc144026140" class="anchor"><span id="_Toc144026471" class="anchor"><span id="_Toc144276114" class="anchor"><span id="_Toc144276458" class="anchor"><span id="_Toc144280046" class="anchor"><span id="_Toc144280392" class="anchor"><span id="_Toc144540607" class="anchor"><span id="_Toc144554489" class="anchor"><span id="_Toc144722111" class="anchor"><span id="_Toc145503573" class="anchor"><span id="_Toc145512015" class="anchor"><span id="_Toc145513038" class="anchor"><span id="_Toc145513422" class="anchor"><span id="_Toc222907179" class="anchor"><span id="_Toc342652750" class="anchor"><span id="_Toc439863961" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Partition IDs

Partitions are identified by using a partition ID. This 64-bit number is
allocated by the hypervisor. All partitions are guaranteed by the
hypervisor to have unique IDs. Note that these are not “globally unique"
in that the same ID may be generated across a power cycle (that is, a
reboot of the hypervisor). However, the hypervisor guarantees that IDs
created within a single power cycle are unique.

typedef UINT64 HV\_PARTITION\_ID;

typedef HV\_PARTITION\_ID \*PHV\_PARTITION\_ID;

<span id="_Ref108576137" class="anchor"><span id="_Toc110172682"
class="anchor"></span></span>The guest should not ascribe any meaning to
the value of a partition ID. The “invalid" partition ID is used in
several interfaces to indicate an invalid partition.

\#define HV\_PARTITION\_ID\_INVALID ((HV\_PARTITION\_ID) 0x0)

A partition can specify its own ID using HV\_PARTITION\_SELF

<span id="_Toc127596666" class="anchor"><span id="_Toc127786287"
class="anchor"><span id="_Toc127786603" class="anchor"><span
id="_Toc127786919" class="anchor"><span id="_Toc127877515"
class="anchor"><span id="_Toc128289586" class="anchor"><span
id="_Toc128289979"
class="anchor"></span></span></span></span></span></span></span>\#define
HV\_PARTITION\_ID\_SELF ((HV\_PARTITION\_ID) -1)

### <span id="_Toc130189661" class="anchor"><span id="_Toc130200877" class="anchor"><span id="_Toc130201193" class="anchor"><span id="_Toc130201514" class="anchor"><span id="_Toc131936601" class="anchor"><span id="_Toc133901040" class="anchor"><span id="_Toc137460945" class="anchor"><span id="_Toc139096460" class="anchor"><span id="_Toc139188383" class="anchor"><span id="_Toc139191246" class="anchor"><span id="_Toc140490297" class="anchor"><span id="_Toc140571200" class="anchor"><span id="_Toc141257470" class="anchor"><span id="_Toc141257797" class="anchor"><span id="_Toc141267324" class="anchor"><span id="_Toc141522342" class="anchor"><span id="_Toc141529433" class="anchor"><span id="_Toc141529750" class="anchor"><span id="_Toc141851357" class="anchor"><span id="_Toc141852291" class="anchor"><span id="_Toc141887835" class="anchor"><span id="_Toc141889675" class="anchor"><span id="_Toc141893344" class="anchor"><span id="_Toc142113193" class="anchor"><span id="_Toc142114221" class="anchor"><span id="_Toc142729381" class="anchor"><span id="_Toc142730665" class="anchor"><span id="_Toc142731038" class="anchor"><span id="_Toc142998403" class="anchor"><span id="_Toc143063494" class="anchor"><span id="_Toc143509604" class="anchor"><span id="_Toc143510051" class="anchor"><span id="_Toc144026141" class="anchor"><span id="_Toc144026472" class="anchor"><span id="_Ref144028621" class="anchor"><span id="_Toc144276115" class="anchor"><span id="_Toc144276459" class="anchor"><span id="_Toc144280047" class="anchor"><span id="_Toc144280393" class="anchor"><span id="_Toc144540608" class="anchor"><span id="_Toc144554490" class="anchor"><span id="_Toc144722112" class="anchor"><span id="_Toc145503574" class="anchor"><span id="_Toc145512016" class="anchor"><span id="_Toc145513039" class="anchor"><span id="_Toc145513423" class="anchor"><span id="_Toc222907180" class="anchor"><span id="_Toc342652751" class="anchor"><span id="_Toc439863962" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Partition Properties

Partition properties provide a generic way for a parent partition to
control aspects of its child partitions. After a partition property is
set, its value is constant unless and until it is again modified by a
caller possessing sufficient privilege. Properties are identified by a
32-bit code. Property values are each 64 bits in size.

typedef UINT64 HV\_PARTITION\_PROPERTY;

typedef HV\_PARTITION\_PROPERTY \*PHV\_PARTITION\_PROPERTY;

typedef enum

{

// Privilege properties

HvPartitionPropertyPrivilegeFlags = 0x00010000,

// Scheduling properties

HvPartitionPropertySuspend = 0x00020000,

HvPartitionPropertyCpuReserve = 0x00020001,

HvPartitionPropertyCpuCap = 0x00020002,

HvPartitionPropertyCpuWeight = 0x00020003,

// Timer assist properties

HvPartitionPropertyEmulatedTimerPeriod = 0x00030000,

HvPartitionPropertyEmulatedTimerControl = 0x00030001,

HvPartitionPropertyPmTimerAssist = 0x00030002,

HvPartitionPropertyTimeFreeze = 0x00030003,

// Debugging properties

HvPartitionPropertyDebugChannelId = 0x00040000,

// Resource properties

HvPartitionPropertyVirtualTlbPageCount = 0x00050000,

// Compatibility properties

HvPartitionPropertyProcessorVendor = 0x00060000,

HvPartitionPropertyProcessorFeatures = 0x00060001,

HvPartitionPropertyProcessorXsaveFeatures = 0x00060002,

HvPartitionPropertyProcessorCLFlushSize = 0x00060003,

HvPartitionPropertyEnlightenmentModifications = 0x00060004,

HvPartitionPropertyGuestOsId = 0x00070000

} HV\_PARTITION\_PROPERTY\_CODE;

The following table explains the meaning of each property. The table
also lists the default values.

  > **Partition property**                          > **Meaning**                                                                                                                                                                                 > **Default value**
  ------------------------------------------------- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------------------------------------------------
  > HvPartitionPropertyPrivilegeFlags               > For details about the privilege flags, see section 5.2.3.                                                                                                                                   
  > HvPartitionPropertySuspend                      > This determines whether or not execution of the partition is suspended.                                                                                                                     > 0x0000000000000000
  > HvPartitionPropertyCpuReserve                   > The amount of per-VP CPU time reserved for this partition. For details, see section 20.2.1.                                                                                                 > 0x0000000000000000
  > HvPartitionPropertyCpuCap                       > The maximum amount of per-VP CPU time the partition is allowed to use. For details, see section 20.2.2.                                                                                     > 0x0000000000010000
  > HvPartitionPropertyCpuWeight                    > The relative weight for the virtual processors in the partition. For details, see section 20.2.3.                                                                                           > 0x0000000000000064
  > HvPartitionPropertyEmulatedTimerPeriod          > The periodic timer assist period. For details, see section 18.1.5.                                                                                                                          > 0x0000000000000000
  > HvPartitionPropertyEmulatedTimerControl         > The periodic timer assist control. For details, see section 18.1.5.                                                                                                                         > 0x0000000000000000
  > HvPartitionPropertyPmTimerAssist                > The PM timer assist definition. For details, see section 18.1.6.                                                                                                                            > 0x0000000000000000
  > HvPartitionPropertyTimeFreeze                   > This determines whether or not to freeze the TSC for a partition.                                                                                                                           
  > HvPartitionPropertyDebugChannelId               > The debug session channel identifier. For details, see section 21.1.1.                                                                                                                      > 0x0000000000000000
  > HvPartitionPropertyVirtualTlbPageCount          > The number of pool pages reserved for the virtual TLB. For details, see section 5.2.5.                                                                                                      
  > HvPartitionPropertyProcessorVendor              > The processor vendor. For details, see section 5.2.6. Read-only.                                                                                                                            > The vendor of the platform’s processors.
  > HvPartitionPropertyProcessorFeatures            > The bitmask representing supported processor features. For details, see section 5.2.7. Default value is the value for the root partition. Read-only for the root partition.                 > The guest visible features supported and enabled by the platform.
  > HvPartitionPropertyProcessorXsaveFeatures       > The bitmask representing supported processor XSAVE related features. For details, see section 5.2.8. Default value is the value for the root partition. Read-only for the root partition.   > The guest visible XSAVE features supported and enabled by the platform.
  > HvPartitionPropertyProcessorCLFlushSize         > The size of the processor cache line flush size. For details, see section 5.2.95.2.9. Default value is the value for the root partition. Read-only for the root partition.                  > The minimum cache line flush size of all processors on the platform.
  > HvPartitionPropertyEnlightenmentModifications   > This is used to identify whether or not enlightenments will be offered to a partition by the hypervisor.                                                                                    > 0x0000000000000000
  > HvPartitionPropertyGuestOsId                    > This property contains the Guest OS Identity (TLFS:3.6) and can be queried via HvCallGetPartitionProperty.                                                                                  

### <span id="_Toc342652752" class="anchor"><span id="_Ref112427848" class="anchor"><span id="_Toc127596667" class="anchor"><span id="_Toc127786288" class="anchor"><span id="_Toc127786604" class="anchor"><span id="_Toc127786920" class="anchor"><span id="_Toc127877516" class="anchor"><span id="_Toc128289587" class="anchor"><span id="_Toc128289980" class="anchor"><span id="_Toc130189662" class="anchor"><span id="_Toc130200878" class="anchor"><span id="_Toc130201194" class="anchor"><span id="_Toc130201515" class="anchor"><span id="_Toc131936602" class="anchor"><span id="_Toc133901041" class="anchor"><span id="_Toc137460946" class="anchor"><span id="_Toc139096461" class="anchor"><span id="_Toc139188384" class="anchor"><span id="_Toc139191247" class="anchor"><span id="_Toc140490298" class="anchor"><span id="_Toc140571201" class="anchor"><span id="_Toc141257471" class="anchor"><span id="_Toc141257798" class="anchor"><span id="_Toc141267325" class="anchor"><span id="_Toc141522343" class="anchor"><span id="_Toc141529434" class="anchor"><span id="_Toc141529751" class="anchor"><span id="_Toc141851358" class="anchor"><span id="_Toc141852292" class="anchor"><span id="_Toc141887836" class="anchor"><span id="_Toc141889676" class="anchor"><span id="_Toc141893345" class="anchor"><span id="_Toc142113194" class="anchor"><span id="_Toc142114222" class="anchor"><span id="_Toc142729382" class="anchor"><span id="_Toc142730666" class="anchor"><span id="_Toc142731039" class="anchor"><span id="_Toc142998404" class="anchor"><span id="_Toc143063495" class="anchor"><span id="_Toc143509605" class="anchor"><span id="_Toc143510052" class="anchor"><span id="_Toc144026142" class="anchor"><span id="_Toc144026473" class="anchor"><span id="_Toc144276116" class="anchor"><span id="_Toc144276460" class="anchor"><span id="_Toc144280048" class="anchor"><span id="_Toc144280394" class="anchor"><span id="_Toc144540609" class="anchor"><span id="_Toc144554491" class="anchor"><span id="_Toc144722113" class="anchor"><span id="_Toc145503575" class="anchor"><span id="_Toc145512017" class="anchor"><span id="_Toc145513040" class="anchor"><span id="_Toc145513424" class="anchor"><span id="_Ref148364989" class="anchor"><span id="_Ref148365012" class="anchor"><span id="_Ref148365022" class="anchor"><span id="_Ref148365112" class="anchor"><span id="_Ref148365257" class="anchor"><span id="_Ref148365348" class="anchor"><span id="_Ref148365452" class="anchor"><span id="_Ref148365677" class="anchor"><span id="_Toc222907181" class="anchor"><span id="_Toc342652753" class="anchor"><span id="_Toc439863963" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Partition Privilege Flags

One of the partition properties (HvPartitionPropertyPrivilegeFlags)
defines the hypervisor facilities that the partition is allowed to
access. This enables the parent to control which synthetic MSRs and
hypercalls a child partition can access.

The property is defined with the following structure:

typedef struct

{

// Access to virtual MSRs

UINT64 AccessVpRunTimeReg:1;

UINT64 AccessPartitionReferenceCounter:1;

UINT64 AccessSynicRegs:1;

UINT64 AccessSyntheticTimerRegs:1;

UINT64 AccessIntrCtrlRegs:1;

UINT64 AccessHypercallMsrs:1;

UINT64 AccessVpIndex:1;

UINT64 AccessResetReg:1;

UINT64 AccessStatsReg:1;

UINT64 AccessPartitionReferenceTsc:1;

UINT64 AccessGuestIdleReg:1;

UINT64 AccessFrequencyRegs:1;

UINT64 AccessDebugRegs:1;

UINT64 Reserved1:19;

// Access to hypercalls

UINT64 CreatePartitions:1;

UINT64 AccessPartitionId:1;

UINT64 AccessMemoryPool:1;

UINT64 AdjustMessageBuffers:1;

UINT64 PostMessages:1;

UINT64 SignalEvents:1;

UINT64 CreatePort:1;

UINT64 ConnectPort:1;

UINT64 AccessStats:1;

UINT64 Reserved2:2;

UINT64 Debugging:1;

UINT64 CpuManagement:1;

UINT64 ConfigureProfiler:1;

UINT64 AccessVpExitTracing:1;

UINT64 EnableExtendedGvaRangesForFlushVirtualAddressList:1;

UINT64 Reserved:1;

UINT64 AccessVpRegisters:1;

UINT64 Reserved:1;

UINT64 FastHypercallOutput:1;

UINT64 EnableExtendedHypercalls:1;

UINT64 StartVirtualProcessor:1;

UINT64 Reserved3:10;

} HV\_PARTITION\_PRIVILEGE\_MASK;

The following table explains what each of these flags controls. The
table also lists the default value for non-root partitions. The root
partition has access to all capabilities.

  -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  **Privilege Flag**                                                 **Meaning**                                                                                                                                                                                                                                                                                        **Default Value**
  ------------------------------------------------------------------ -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- -------------------
  AccessVpRunTimeReg                                                 The partition has access to the synthetic MSR HV\_X64\_MSR\_VP\_RUNTIME. If this flag is cleared, accesses to this MSR results in a \#GP fault if the MSR intercept is not installed.                                                                                                              1

  AccessPartitionReferenceCounter                                    The partition has access to the partition-wide reference count MSR, HV\_X64\_MSR\_TIME\_REF\_COUNT. If this flag is cleared, accesses to this MSR results in a \#GP fault if the MSR intercept is not installed.                                                                                   1

  AccessSynicRegs                                                    The partition has access to the synthetic MSRs associated with the Synic (HV\_X64\_MSR\_SCONTROL through HV\_X64\_MSR\_EOM and HV\_X64\_MSR\_SINT0 through HV\_X64\_MSR\_SINT15). If this flag is cleared, accesses to these MSRs results in a \#GP fault if the MSR intercept is not installed.   1

  AccessSyntheticTimerMsrs                                           The partition has access to the synthetic MSRs associated with the Synic (HV\_X64\_MSR\_STIMER0\_CONFIG through HV\_X64\_MSR\_STIMER3\_COUNT). If this flag is cleared, accesses to these MSRs results in a \#GP fault if the MSR intercept is not installed.                                      1

  AccessIntrCtrlRegs                                                 The partition has access to the synthetic MSRs associated with the APIC (HV\_X64\_MSR\_EOI, HV\_X64\_MSR\_ICR and HV\_X64\_MSR\_TPR). If this flag is cleared, accesses to these MSRs results in a \#GP fault if the MSR intercept is not installed.                                               1

  AccessHypercallMsrs                                                The partition has access to the synthetic MSRs related to the hypercall interface (HV\_X64\_MSR\_GUEST\_OS\_ID and HV\_X64\_MSR\_HYPERCALL). If this flag is cleared, accesses to these MSRs result in a \#GP fault if the MSR intercept is not installed.                                         1

  AccessVpIndex                                                      The partition has access to the synthetic MSR that returns the virtual processor index. If this flag is cleared, accesses to this MSR results in a \#GP fault if the MSR intercept is not installed.                                                                                               1

  AccessResetReg                                                     This partition has access to the synthetic MSR that resets the system. If this flag is cleared, accesses to this MSR results in a \#GP fault if the MSR intercept is not installed.                                                                                                                1

  AccessStatsReg                                                     This partition has access to the synthetic MSRs that allows the guest to map and unmap its own statistics pages.                                                                                                                                                                                   1

  AccessPartitionReferenceTsc                                        The partition has access to the reference TSC.                                                                                                                                                                                                                                                     0

  AccessGuestIdleMsr                                                 The partition has access to the synthetic MSR that allows the guest to enter the guest idle state.                                                                                                                                                                                                 1

  CreatePartitions                                                   The partition can invoke the hypercall HvCreatePartition. The partition also can make any other hypercall that is restricted to operating on children.                                                                                                                                             0

  AccessFrequencyRegs                                                The partition has access to the synthetic MSRs that supply the TSC and APIC frequencies, if supported.                                                                                                                                                                                             1

  AccessDebugRegs                                                    The partition has access to the synthetic MSRs used for some forms of guest debugging.                                                                                                                                                                                                             0

  AccessPartitionId                                                  The partition can invoke the hypercall HvGetPartitionId to obtain its own partition ID.                                                                                                                                                                                                            0

  AccessMemoryPool                                                   The partition can invoke the hypercalls HvDepositMemory, HvWithdrawMemory and HvGetMemoryBalance.                                                                                                                                                                                                  0

  PostMessages                                                       The partition can invoke the hypercall HvPostMessage.                                                                                                                                                                                                                                              0

  SignalEvents                                                       The partition can invoke the hypercall HvSignalEvent.                                                                                                                                                                                                                                              0

  CreatePort                                                         The partition can invoke the hypercall HvCreatePort.                                                                                                                                                                                                                                               0

  ConnectPort                                                        The partition can invoke the hypercall HvConnectPort.                                                                                                                                                                                                                                              0

  AccessStats                                                        The partition can invoke the hypercalls HvMapStatsPage and HvUnmapStatsPage.                                                                                                                                                                                                                       0

  Debugging                                                          The partition can invoke the hypercalls HvPostDebugData, HvRetrieveDebugData and HvResetDebugSession.                                                                                                                                                                                              0

  CpuManagement<span id="_Ref158807346" class="anchor"></span>[^1]   The partition can invoke the hypercalls HvGetLogicalProcessorRunTime                                                                                                                                                                                                                               0
                                                                                                                                                                                                                                                                                                                                                                        
                                                                     and HvCallParkedVirtualProcessors.                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                        
                                                                     This partition also has access to the power management MSRs.                                                                                                                                                                                                                                       
  -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

1.  ### <span id="_Ref141265986" class="anchor"><span id="_Toc141267326" class="anchor"><span id="_Toc141522344" class="anchor"><span id="_Toc141529435" class="anchor"><span id="_Toc141529752" class="anchor"><span id="_Toc141851359" class="anchor"><span id="_Toc141852293" class="anchor"><span id="_Toc141887837" class="anchor"><span id="_Toc141889677" class="anchor"><span id="_Toc141893346" class="anchor"><span id="_Toc142113195" class="anchor"><span id="_Toc142114223" class="anchor"><span id="_Toc142729383" class="anchor"><span id="_Toc142730667" class="anchor"><span id="_Toc142731040" class="anchor"><span id="_Toc142998405" class="anchor"><span id="_Toc143063496" class="anchor"><span id="_Toc143509606" class="anchor"><span id="_Toc143510053" class="anchor"><span id="_Toc144026143" class="anchor"><span id="_Toc144026474" class="anchor"><span id="_Toc144276117" class="anchor"><span id="_Toc144276461" class="anchor"><span id="_Toc144280049" class="anchor"><span id="_Toc144280395" class="anchor"><span id="_Toc144540610" class="anchor"><span id="_Toc144554492" class="anchor"><span id="_Toc144722114" class="anchor"><span id="_Toc145503576" class="anchor"><span id="_Toc145512018" class="anchor"><span id="_Toc145513041" class="anchor"><span id="_Toc145513425" class="anchor"><span id="_Toc222907182" class="anchor"><span id="_Toc342652754" class="anchor"><span id="_Toc439857950" class="anchor"><span id="_Toc110172683" class="anchor"><span id="_Toc127596668" class="anchor"><span id="_Toc127786289" class="anchor"><span id="_Toc127786605" class="anchor"><span id="_Toc127786921" class="anchor"><span id="_Toc127877517" class="anchor"><span id="_Toc128289588" class="anchor"><span id="_Toc128289981" class="anchor"><span id="_Toc130189663" class="anchor"><span id="_Toc130200879" class="anchor"><span id="_Toc130201195" class="anchor"><span id="_Toc130201516" class="anchor"><span id="_Toc131936603" class="anchor"><span id="_Toc133901042" class="anchor"><span id="_Toc137460947" class="anchor"><span id="_Toc139096462" class="anchor"><span id="_Toc139188385" class="anchor"><span id="_Toc139191248" class="anchor"><span id="_Ref140390694" class="anchor"><span id="_Toc140490299" class="anchor"><span id="_Toc140571202" class="anchor"><span id="_Toc141257472" class="anchor"><span id="_Toc141257799" class="anchor"><span id="_Toc439863964" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>

2.  ### <span id="_Toc141267327" class="anchor"><span id="_Toc141522345" class="anchor"><span id="_Toc141529436" class="anchor"><span id="_Toc141529753" class="anchor"><span id="_Toc141851360" class="anchor"><span id="_Toc141852294" class="anchor"><span id="_Toc141887838" class="anchor"><span id="_Toc141889678" class="anchor"><span id="_Toc141893347" class="anchor"><span id="_Toc142113196" class="anchor"><span id="_Toc142114224" class="anchor"><span id="_Toc142729384" class="anchor"><span id="_Toc142730668" class="anchor"><span id="_Toc142731041" class="anchor"><span id="_Toc142998406" class="anchor"><span id="_Toc143063497" class="anchor"><span id="_Toc143509607" class="anchor"><span id="_Toc143510054" class="anchor"><span id="_Toc144026144" class="anchor"><span id="_Toc144026475" class="anchor"><span id="_Toc144276118" class="anchor"><span id="_Toc144276462" class="anchor"><span id="_Toc144280050" class="anchor"><span id="_Toc144280396" class="anchor"><span id="_Toc144540611" class="anchor"><span id="_Toc144554493" class="anchor"><span id="_Toc144722115" class="anchor"><span id="_Toc145503577" class="anchor"><span id="_Toc145512019" class="anchor"><span id="_Toc145513042" class="anchor"><span id="_Toc145513426" class="anchor"><span id="_Ref221077900" class="anchor"><span id="_Toc222907183" class="anchor"><span id="_Toc342652755" class="anchor"><span id="_Toc439863965" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Partition State

Each partition is in one of four states:

-   **Uninitialized** – The state of the partition after it has been
    created by a call to HvCreatePartition. Only the HvDepositMemory,
    HvQueryMemoryBalance, HvGetNextChildPartition and
    HvInitializePartition hypercalls are permitted on
    *uninitialized* partitions.

-   **Active** – The state of the partition after it has been
    successfully initialized by a call to HvInitializePartition. All
    hypercalls are permitted on *active* partitions, with the exception
    of HvDeletePartition.

-   **Finalizing** – The transitory state of the partition after
    HvFinalizePartition has been invoked but not yet completed. Only the
    HvQueryMemoryBalance, HvWithdrawMemory, HvGetNextChildPartition and
    HvFinalizePartition hypercalls are permitted on
    *finalizing* partitions.

-   **Finalized** – The state of the partition after it has been
    finalized by a successfully completed call to HvFinalizePartition.
    Only the HvQueryMemoryBalance, HvWithdrawMemory,
    HvGetNextChildPartition and HvDeletePartition hypercalls are
    permitted on *finalized* partitions.

Figure 1 is a state diagram that shows the valid states and actions that
can result in state transitions. All state transitions appear to be
atomic from the perspective of hypervisor callers.

<span id="_Ref137277722" class="anchor"></span>Figure <span
id="figHvPartitionStates" class="anchor"></span>1. Partition management
state diagram

### <span id="_Ref158800076" class="anchor"><span id="_Toc222907184" class="anchor"><span id="_Toc342652756" class="anchor"><span id="_Toc127596669" class="anchor"><span id="_Toc127786290" class="anchor"><span id="_Toc127786606" class="anchor"><span id="_Toc127786922" class="anchor"><span id="_Toc127877518" class="anchor"><span id="_Toc128289589" class="anchor"><span id="_Toc128289982" class="anchor"><span id="_Toc130189664" class="anchor"><span id="_Toc130200880" class="anchor"><span id="_Toc130201196" class="anchor"><span id="_Toc130201517" class="anchor"><span id="_Toc131936604" class="anchor"><span id="_Toc133901043" class="anchor"><span id="_Toc137460948" class="anchor"><span id="_Toc139096463" class="anchor"><span id="_Toc139188386" class="anchor"><span id="_Toc139191249" class="anchor"><span id="_Toc140490300" class="anchor"><span id="_Toc140571203" class="anchor"><span id="_Toc141257473" class="anchor"><span id="_Toc141257800" class="anchor"><span id="_Toc141267328" class="anchor"><span id="_Toc141522346" class="anchor"><span id="_Toc141529437" class="anchor"><span id="_Toc141529754" class="anchor"><span id="_Toc141851361" class="anchor"><span id="_Toc141852295" class="anchor"><span id="_Toc141887839" class="anchor"><span id="_Toc141889679" class="anchor"><span id="_Toc141893348" class="anchor"><span id="_Toc142113197" class="anchor"><span id="_Toc142114225" class="anchor"><span id="_Toc142729385" class="anchor"><span id="_Toc142730669" class="anchor"><span id="_Toc142731042" class="anchor"><span id="_Toc142998407" class="anchor"><span id="_Toc143063498" class="anchor"><span id="_Toc143509608" class="anchor"><span id="_Toc143510055" class="anchor"><span id="_Toc144026145" class="anchor"><span id="_Toc144026476" class="anchor"><span id="_Toc144276119" class="anchor"><span id="_Toc144276463" class="anchor"><span id="_Toc144280051" class="anchor"><span id="_Toc144280397" class="anchor"><span id="_Toc144540612" class="anchor"><span id="_Toc144554494" class="anchor"><span id="_Toc144722116" class="anchor"><span id="_Toc145503578" class="anchor"><span id="_Toc145512020" class="anchor"><span id="_Toc145513043" class="anchor"><span id="_Toc145513427" class="anchor"><span id="_Ref108576161" class="anchor"><span id="_Ref108576197" class="anchor"><span id="_Toc110172685" class="anchor"><span id="_Toc439863966" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Partition Virtual TLB Page Count

The hypervisor maintains a virtual TLB for each virtual processor (see
section 15.1). The memory available for the virtual TLB is reserved and
allocated from the partition’s memory pool. The count of pages reserved
is a partition property that can be modified dynamically. The hypervisor
establishes a default value, which may be different for the root and
other (non-root) partitions. It also enforces minimum and maximum page
count restrictions. Attempts to set the page count outside of the
restrictions will result in the value being set to the appropriate
minimum or maximum value.

### <span id="_Ref210182012" class="anchor"><span id="_Toc222907185" class="anchor"><span id="_Toc342652757" class="anchor"><span id="_Ref210181153" class="anchor"><span id="_Toc439863967" class="anchor"></span></span></span></span></span>Partition Processor Vendor

One of the partition properties (HvPartitionProcessorVendor) defines the
processor vendor of the platform the partition was created on.

The codes are defined as follows.

typedef enum \_HV\_PROCESSOR\_VENDOR

HvProcessorVendorAmd = 0x0000,

HvProcessorVendorIntel = 0x0001,

} HV\_PROCESSOR\_VENDOR, \*PHV\_PROCESSOR\_VENDOR;

### <span id="_Ref219795491" class="anchor"><span id="_Toc222907186" class="anchor"><span id="_Toc342652758" class="anchor"><span id="_Toc439863968" class="anchor"></span></span></span></span>Partition Processor Features

One of the partition properties (HvPartitionProcessorFeatures) defines
the processor features that are verified for migration compatibility
when restoring a VM[^2]. This allows a partition’s processor features to
be enumerated or de-featured, to enable platform migration.

The property is defined with the following structure:

typedef \_HV\_PARTITION\_PROCESSOR\_FEATURES

{

UINT64 AsUINT64;

struct

{

UINT64 Sse3Support:1;

UINT64 LahfSahfSupport:1;

UINT64 Ssse3Support:1;

UINT64 Sse4\_1Support:1;

UINT64 Sse4\_2Support:1;

UINT64 Sse4aSupport:1;

UINT64 XopSupport:1;

UINT64 PopCntSupport:1;

UINT64 Cmpxchg16bSupport:1;

UINT64 Altmovcr8Support:1;

UINT64 LzcntSupport:1;

UINT64 MisAlignSseSupport:1;

UINT64 MmxExtSupport:1;

UINT64 Amd3DNowSupport:1;

UINT64 ExtendedAmd3DNowSupport:1;

UINT64 Page1GBSupport:DEPRECATED1;

UINT64 AesSuppport:1;

UINT64 PclmulqdqSupport:1;

UINT64 PcidSupport:1;

UINT64 Fma4Support:1;

UINT64 F16CSupport:1;

UINT64 RdRandSupport:1;

UINT64 RdWrFsGsSupport:1;

UINT64 SmepSupport:1;

UINT64 EnhancedFastStringSupport:1;

UINT64 Bmi1Support:1;

UINT64 Bmi2Support:1;

UINT64 HleSupport:1;

UINT64 RtmSupport:1;

UINT64 MovbeSupport:1;

UINT64 Npiep1Support:1;

UINT64 DepX87FPUSaveSupport:1;

UINT64 RdSeedSupport:1;

UINT64 AdxSupport:1;

UINT64 IntelPrefetchSupport:1;

UINT64 SmapSupport:1;

UINT64 HleSupport:1;

UINT64 RtmSupport:1;

UINT64 Reserved1:26;

};

} HV\_PARTITION\_PROCESSOR\_FEATURES;

### <span id="_Ref210181178" class="anchor"><span id="_Toc222907187" class="anchor"><span id="_Toc342652759" class="anchor"><span id="_Toc439863969" class="anchor"></span></span></span></span>Partition Processor XSAVE Features

Similar to HvPartitionProcessorFeatures,
HvPartitionProcessorXsaveFeatures defines the processor XSAVE related
features that are verified for migration compatibility when restoring a
VM processor. This allows a partition’s processor XSAVE features to be
enumerated or de‑featured, to enable VM migration.

The property is defined with the following structure:

typedef union \_HV\_PARTITION\_PROCESSOR\_XSAVE\_FEATURES

{

UINT64 AsUINT64;

struct

{

UINT64 XsaveSupport:1;

UINT64 XsaveoptSupport:1;

UINT64 AvxSupport:1;

UINT64 Avx2Support:1;

UINT64 FmaSupport:1;

UINT64 Reserved1:61;

};

HV\_PARTITION\_PROCESSOR\_XSAVE\_FEATURES;

### <span id="_Ref219795548" class="anchor"><span id="_Toc222907188" class="anchor"><span id="_Toc342652760" class="anchor"><span id="_Toc439863970" class="anchor"></span></span></span></span>Partition Cache Line Flush Size

This property defines the cache line flush size of the partition. This
allows a partition’s processor cache line flush size to be enumerated or
specified, to enable VM migration.

This property is a UINT64,

### <span id="_Toc222907189" class="anchor"><span id="_Toc342652761" class="anchor"><span id="_Toc439863971" class="anchor"></span></span></span>Partition Compatibility Mode

To allow a VM to migrate between platforms of the same processor
architecture but with differing processor feature sets and
characteristics, the following defines the partition properties for
compatibility VM.

\#define HV\_PARTITION\_PROCESSOR\_FEATURES\_INTEL\_COMPATIBILITY\_MODE
\\

{ 1, /\* Sse3Support \*/ \\

1, /\* LahfSahfSupport \*/ \\

0, /\* Ssse3Support \*/ \\

0, /\* Sse4\_1Support \*/ \\

0, /\* Sse4\_2Support \*/ \\

0, /\* Sse4aSupport \*/ \\

0, /\* XopSupport \*/ \\

0, /\* PopCntSupport \*/ \\

1, /\* Cmpxchg16bSupport \*/ \\

0, /\* Altmovcr8Support \*/ \\

0, /\* LzcntSupport \*/ \\

0, /\* MisAlignSseSupport \*/ \\

0, /\* MmxExtSupport \*/ \\

0, /\* Amd3DNowSupport \*/ \\

0, /\* ExtendedAmd3DNowSupport \*/ \\

0, /\* Reserved \*/ \\

0, /\* Aes \*/ \\

0, /\* Pclmulqdq \*/ \\

0, /\* Pcid \*/ \\

0, /\* Fma4 \*/ \\

0, /\* F16C \*/ \\

0, /\* RdRand \*/ \\

0, /\* RdWrFsGs \*/ \\

0, /\* Smep \*/ \\

0, /\* EnhancedFastString \*/ \\

0, /\* Bmi1Support \*/ \\

0, /\* Bmi2Support \*/ \\

0, /\* HleSupport \*/ \\

0, /\* RtmSupport \*/ \\

0, /\* MovbeSupport \*/ \\

0, /\* Npiep1Support \*/ \\

0, /\* DepX87FPUSaveSupport \*/ \\

0, /\* RdSeedSupport \*/ \\

0, /\* AdxSupport\*/ \\

0, /\* IntelPrefetchSupport\*/ \\

0, /\* SmapSupport\*/ \\

0, /\* Reserved1 \*/ \\

}

}

\#define HV\_PARTITION\_PROCESSOR\_FEATURES\_AMD\_COMPATIBILITY\_MODE \\

{ \\

1, /\* Sse3Support \*/ \\

1, /\* LahfSahfSupport \*/ \\

0, /\* Ssse3Support \*/ \\

0, /\* Sse4\_1Support \*/ \\

0, /\* Sse4\_2Support \*/ \\

0, /\* Sse4aSupport \*/ \\

0, /\* XopSupport \*/ \\

0, /\* PopCntSupport \*/ \\

1, /\* Cmpxchg16bSupport \*/ \\

1, /\* Altmovcr8Support \*/ \\

0, /\* LzcntSupport \*/ \\

0, /\* MisAlignSseSupport \*/ \\

1, /\* MmxExtSupport \*/ \\

0, /\* Amd3DNowSupport \*/ \\

0, /\* ExtendedAmd3DNowSupport \*/ \\

0, /\* Reserved \*/ \\

0, /\* Aes \*/ \\

0, /\* Pclmulqdq \*/ \\

0, /\* Pcid \*/ \\

0, /\* Fma4 \*/ \\

0, /\* F16C \*/ \\

0, /\* RdRand \*/ \\

0, /\* RdWrFsGs \*/ \\

0, /\* Smep \*/ \\

0, /\* EnhancedFastString \*/ \\

0, /\* Bmi1Support \*/ \\

0, /\* Bmi2Support \*/ \\

0, /\* HleSupport \*/ \\

0, /\* RtmSupport \*/ \\

0, /\* MovbeSupport \*/ \\

1, /\* Npiep1Support \*/ \\

0, /\* DepX87FPUSaveSupport \*/ \\

0, /\* RdSeedSupport \*/ \\

0, /\* AdxSupport\*/ \\

0, /\* IntelPrefetchSupport\*/ \\

0, /\* SmapSupport\*/ \\

0 /\* Reserved1 \*/ \\

}

typedef union \_HV\_PARTITION\_PROCESSOR\_XSAVE\_FEATURES

{

struct

{

UINT64 XsaveSupport:1;

UINT64 XsaveoptSupport:1;

UINT64 AvxSupport:1;

UINT64 Avx2Support:1;

UINT64 FmaSupport:1;

UINT64 Reserved1:59;

};

UINT64 AsUINT64;

} HV\_PARTITION\_PROCESSOR\_XSAVE\_FEATURES,
\*PHV\_PARTITION\_PROCESSOR\_XSAVE\_FEATURES;

\#define
HV\_PARTITION\_PROCESSOR\_XSAVE\_FEATURES\_INTEL\_COMPATIBILITY\_MODE \\

{ \\

0, /\* XsaveSupport \*/ \\

0, /\* XsaveoptSupport \*/ \\

0, /\* AvxSupport \*/ \\

0, /\* Avx2Support \*/ \\

0, /\* FmaSupport \*/ \\

0 /\* Reserved1 \*/ \\

}

\#define
HV\_PARTITION\_PROCESSOR\_XSAVE\_FEATURES\_AMD\_COMPATIBILITY\_MODE \\

{ \\

0, /\* XsaveSupport \*/ \\

0, /\* XsaveoptSupport \*/ \\

0, /\* AvxSupport \*/ \\

0, /\* Avx2Support \*/ \\

0, /\* FmaSupport \*/ \\

0 /\* Reserved1 \*/ \\

}

\#define
HV\_PARTITION\_PROCESSOR\_CL\_FLUSHSIZE\_INTEL\_COMPATIBILITY\_MODE (8)

\#define
HV\_PARTITION\_PROCESSOR\_CL\_FLUSHSIZE\_AMD\_COMPATIBILITY\_MODE (8)

<span id="_Toc342652762" class="anchor"><span id="_Toc222907190" class="anchor"><span id="_Toc342652763" class="anchor"><span id="_Toc439857958" class="anchor"><span id="_Toc439863972" class="anchor"></span></span></span></span></span>
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

-   -   -   -   1.  <span id="_Toc342652764" class="anchor"><span id="_Ref110867879" class="anchor"><span id="_Ref113985044" class="anchor"><span id="_Ref125170567" class="anchor"><span id="_Toc127596670" class="anchor"><span id="_Toc127786291" class="anchor"><span id="_Toc127786607" class="anchor"><span id="_Toc127786923" class="anchor"><span id="_Toc127877519" class="anchor"><span id="_Toc128289590" class="anchor"><span id="_Toc128289983" class="anchor"><span id="_Toc130189665" class="anchor"><span id="_Toc130200881" class="anchor"><span id="_Toc130201197" class="anchor"><span id="_Toc130201518" class="anchor"><span id="_Toc131936605" class="anchor"><span id="_Toc133901044" class="anchor"><span id="_Toc137460949" class="anchor"><span id="_Toc139096464" class="anchor"><span id="_Toc139188387" class="anchor"><span id="_Toc139191250" class="anchor"><span id="_Toc140490301" class="anchor"><span id="_Toc140571204" class="anchor"><span id="_Toc141257474" class="anchor"><span id="_Toc141257801" class="anchor"><span id="_Toc141267329" class="anchor"><span id="_Toc141522347" class="anchor"><span id="_Toc141529438" class="anchor"><span id="_Toc141529755" class="anchor"><span id="_Toc141851362" class="anchor"><span id="_Toc141852296" class="anchor"><span id="_Toc141887840" class="anchor"><span id="_Toc141889680" class="anchor"><span id="_Toc141893349" class="anchor"><span id="_Toc142113198" class="anchor"><span id="_Toc142114226" class="anchor"><span id="_Toc142729386" class="anchor"><span id="_Toc142730670" class="anchor"><span id="_Toc142731043" class="anchor"><span id="_Toc142998408" class="anchor"><span id="_Toc143063499" class="anchor"><span id="_Toc143509609" class="anchor"><span id="_Toc143510056" class="anchor"><span id="_Toc144026146" class="anchor"><span id="_Toc144026477" class="anchor"><span id="_Toc144276120" class="anchor"><span id="_Toc144276464" class="anchor"><span id="_Toc144280052" class="anchor"><span id="_Toc144280398" class="anchor"><span id="_Toc144540613" class="anchor"><span id="_Toc144554495" class="anchor"><span id="_Toc144722117" class="anchor"><span id="_Toc145503579" class="anchor"><span id="_Toc145512021" class="anchor"><span id="_Toc145513044" class="anchor"><span id="_Toc145513428" class="anchor"><span id="_Toc222907191" class="anchor"><span id="_Toc342652765" class="anchor"><span id="_Toc439857959" class="anchor"><span id="_Toc439863973" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>
        ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

<span id="_Toc133901046" class="anchor"><span id="_Toc133901049"
class="anchor"><span id="_Toc133901056" class="anchor"><span
id="_Toc133901057" class="anchor"><span id="_Toc133901063"
class="anchor"><span id="_Toc133901066" class="anchor"><span
id="_Toc133901068" class="anchor"><span id="_Toc110172687"
class="anchor"><span id="_Toc127596674" class="anchor"><span
id="_Toc127786295" class="anchor"><span id="_Toc127786611"
class="anchor"><span id="_Toc127786927" class="anchor"><span
id="_Toc127877523" class="anchor"><span id="_Toc128289594"
class="anchor"><span id="_Toc128289987" class="anchor"><span
id="_Toc130189669" class="anchor"><span id="_Toc130200885"
class="anchor"><span id="_Toc130201201" class="anchor"><span
id="_Toc130201522" class="anchor"><span id="_Toc131936609"
class="anchor"><span id="_Toc133901069" class="anchor"><span
id="_Toc137460950" class="anchor"><span id="_Toc139096465"
class="anchor"><span id="_Toc139188388" class="anchor"><span
id="_Toc139191251" class="anchor"><span id="_Toc140490302"
class="anchor"><span id="_Toc140571205" class="anchor"><span
id="_Toc141257475" class="anchor"><span id="_Toc141257802"
class="anchor"><span id="_Toc141267330" class="anchor"><span
id="_Toc141522348" class="anchor"><span id="_Toc141529439"
class="anchor"><span id="_Toc141529756" class="anchor"><span
id="_Toc141851363" class="anchor"><span id="_Toc141852297"
class="anchor"><span id="_Toc141887841" class="anchor"><span
id="_Toc141889681" class="anchor"><span id="_Toc141893350"
class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>

### <span id="_Toc110172686" class="anchor"><span id="_Toc127596671" class="anchor"><span id="_Toc127786292" class="anchor"><span id="_Toc127786608" class="anchor"><span id="_Toc127786924" class="anchor"><span id="_Toc127877520" class="anchor"><span id="_Toc128289591" class="anchor"><span id="_Toc128289984" class="anchor"><span id="_Toc130189666" class="anchor"><span id="_Toc130200882" class="anchor"><span id="_Toc130201198" class="anchor"><span id="_Toc130201519" class="anchor"><span id="_Toc131936606" class="anchor"><span id="_Toc142113199" class="anchor"><span id="_Toc142114227" class="anchor"><span id="_Toc142729387" class="anchor"><span id="_Toc142730671" class="anchor"><span id="_Toc142731044" class="anchor"><span id="_Toc142998409" class="anchor"><span id="_Toc143063500" class="anchor"><span id="_Toc143509610" class="anchor"><span id="_Toc143510057" class="anchor"><span id="_Toc144026147" class="anchor"><span id="_Toc144026478" class="anchor"><span id="_Toc144276121" class="anchor"><span id="_Toc144276465" class="anchor"><span id="_Toc144280053" class="anchor"><span id="_Toc144280399" class="anchor"><span id="_Toc144540614" class="anchor"><span id="_Toc144554496" class="anchor"><span id="_Toc144722118" class="anchor"><span id="_Toc145503580" class="anchor"><span id="_Toc145512022" class="anchor"><span id="_Toc145513045" class="anchor"><span id="_Toc145513429" class="anchor"><span id="_Toc222907192" class="anchor"><span id="_Toc342652766" class="anchor"><span id="_Toc439857960" class="anchor"><span id="_Toc439863974" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>

-   -   -   1.  ### <span id="_Toc127596672" class="anchor"><span id="_Toc127786293" class="anchor"><span id="_Toc127786609" class="anchor"><span id="_Toc127786925" class="anchor"><span id="_Toc127877521" class="anchor"><span id="_Toc128289592" class="anchor"><span id="_Toc128289985" class="anchor"><span id="_Toc130189667" class="anchor"><span id="_Toc130200883" class="anchor"><span id="_Toc130201199" class="anchor"><span id="_Toc130201520" class="anchor"><span id="_Toc131936607" class="anchor"><span id="_Toc142113200" class="anchor"><span id="_Toc142114228" class="anchor"><span id="_Toc142729388" class="anchor"><span id="_Toc142730672" class="anchor"><span id="_Toc142731045" class="anchor"><span id="_Toc142998410" class="anchor"><span id="_Toc143063501" class="anchor"><span id="_Toc143509611" class="anchor"><span id="_Toc143510058" class="anchor"><span id="_Toc144026148" class="anchor"><span id="_Toc144026479" class="anchor"><span id="_Toc144276122" class="anchor"><span id="_Toc144276466" class="anchor"><span id="_Toc144280054" class="anchor"><span id="_Toc144280400" class="anchor"><span id="_Toc144540615" class="anchor"><span id="_Toc144554497" class="anchor"><span id="_Toc144722119" class="anchor"><span id="_Toc145503581" class="anchor"><span id="_Toc145512023" class="anchor"><span id="_Toc145513046" class="anchor"><span id="_Toc145513430" class="anchor"><span id="_Toc222907193" class="anchor"><span id="_Toc342652767" class="anchor"><span id="_Toc439857961" class="anchor"><span id="_Toc439863975" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>

    2.  ### <span id="_Toc222907194" class="anchor"><span id="_Toc342652768" class="anchor"><span id="_Toc439857962" class="anchor"><span id="_Toc439863976" class="anchor"></span></span></span></span>

-   -   -   1.  <span id="_Toc222907195" class="anchor"><span id="_Toc342652769" class="anchor"><span id="_Toc439857963" class="anchor"><span id="_Toc142113202" class="anchor"><span id="_Toc142114230" class="anchor"><span id="_Toc142729390" class="anchor"><span id="_Toc142730674" class="anchor"><span id="_Toc142731047" class="anchor"><span id="_Toc142998412" class="anchor"><span id="_Toc143063503" class="anchor"><span id="_Toc143509613" class="anchor"><span id="_Toc143510060" class="anchor"><span id="_Toc144026150" class="anchor"><span id="_Toc144026481" class="anchor"><span id="_Toc144276124" class="anchor"><span id="_Toc144276468" class="anchor"><span id="_Toc144280056" class="anchor"><span id="_Toc144280402" class="anchor"><span id="_Toc144540617" class="anchor"><span id="_Toc144554499" class="anchor"><span id="_Toc144722121" class="anchor"><span id="_Toc145503583" class="anchor"><span id="_Toc145512025" class="anchor"><span id="_Toc145513048" class="anchor"><span id="_Toc145513432" class="anchor"><span id="_Toc439863977" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>
        ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

    2.  <span id="_Toc222907196" class="anchor"><span id="_Toc342652770" class="anchor"><span id="_Toc439857964" class="anchor"><span id="_Toc439863978" class="anchor"></span></span></span></span>
        --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

        1.  ### <span id="_Toc110172688" class="anchor"><span id="_Toc127596675" class="anchor"><span id="_Toc127786296" class="anchor"><span id="_Toc127786612" class="anchor"><span id="_Toc127786928" class="anchor"><span id="_Toc127877524" class="anchor"><span id="_Toc128289595" class="anchor"><span id="_Toc128289988" class="anchor"><span id="_Toc130189670" class="anchor"><span id="_Toc130200886" class="anchor"><span id="_Toc130201202" class="anchor"><span id="_Toc130201523" class="anchor"><span id="_Ref130796296" class="anchor"><span id="_Toc131936610" class="anchor"><span id="_Toc133901070" class="anchor"><span id="_Toc137460951" class="anchor"><span id="_Toc139096466" class="anchor"><span id="_Toc139188389" class="anchor"><span id="_Toc139191252" class="anchor"><span id="_Ref139875715" class="anchor"><span id="_Toc140490303" class="anchor"><span id="_Ref140490575" class="anchor"><span id="_Toc140571206" class="anchor"><span id="_Toc141257476" class="anchor"><span id="_Toc141257803" class="anchor"><span id="_Toc141267331" class="anchor"><span id="_Toc141522349" class="anchor"><span id="_Toc141529440" class="anchor"><span id="_Toc141529757" class="anchor"><span id="_Toc141851364" class="anchor"><span id="_Toc141852298" class="anchor"><span id="_Toc141887842" class="anchor"><span id="_Toc141889682" class="anchor"><span id="_Toc141893351" class="anchor"><span id="_Toc142113203" class="anchor"><span id="_Toc142114231" class="anchor"><span id="_Toc142729391" class="anchor"><span id="_Toc142730675" class="anchor"><span id="_Toc142731048" class="anchor"><span id="_Toc142998413" class="anchor"><span id="_Toc143063504" class="anchor"><span id="_Toc143509614" class="anchor"><span id="_Toc143510061" class="anchor"><span id="_Toc144026151" class="anchor"><span id="_Toc144026482" class="anchor"><span id="_Toc144276125" class="anchor"><span id="_Toc144276469" class="anchor"><span id="_Toc144280057" class="anchor"><span id="_Toc144280403" class="anchor"><span id="_Toc144540618" class="anchor"><span id="_Toc144554500" class="anchor"><span id="_Toc144722122" class="anchor"><span id="_Toc145503584" class="anchor"><span id="_Toc145512026" class="anchor"><span id="_Toc145513049" class="anchor"><span id="_Toc145513433" class="anchor"><span id="_Toc222907197" class="anchor"><span id="_Toc342652771" class="anchor"><span id="_Toc439857965" class="anchor"><span id="_Toc439863979" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>

##### 

<span id="_Toc437510989" class="anchor"></span>

<span id="_Toc437510996" class="anchor"></span>

##### 

<span id="_Toc437510998" class="anchor"></span>

  ------------------------------------------------- --
  <span id="_Toc437511001" class="anchor"></span>
  ------------------------------------------------- --

##### 

  ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- --
                                                                                                                                                                                                 
                                                                                                                                                                                                 
  <span id="_Toc437511038" class="anchor"></span>                                                                                                                                                
                                                                                                                                                                                                 
  <span id="_Toc130721553" class="anchor"><span id="_Toc130888034" class="anchor"><span id="_Toc130978366" class="anchor"><span id="_Toc131014041" class="anchor"></span></span></span></span>   
                                                                                                                                                                                                 
  ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- --

### <span id="_Toc127596676" class="anchor"><span id="_Toc127786297" class="anchor"><span id="_Toc127786613" class="anchor"><span id="_Toc127786929" class="anchor"><span id="_Toc127877525" class="anchor"><span id="_Toc128289596" class="anchor"><span id="_Toc128289989" class="anchor"><span id="_Toc130189671" class="anchor"><span id="_Toc130200887" class="anchor"><span id="_Toc130201203" class="anchor"><span id="_Toc130201524" class="anchor"><span id="_Toc131936611" class="anchor"><span id="_Toc133901071" class="anchor"><span id="_Toc137460952" class="anchor"><span id="_Toc139096467" class="anchor"><span id="_Toc139188390" class="anchor"><span id="_Toc139191253" class="anchor"><span id="_Toc140490304" class="anchor"><span id="_Ref140490576" class="anchor"><span id="_Toc140571207" class="anchor"><span id="_Toc141257477" class="anchor"><span id="_Toc141257804" class="anchor"><span id="_Toc141267332" class="anchor"><span id="_Toc141522350" class="anchor"><span id="_Toc141529441" class="anchor"><span id="_Toc141529758" class="anchor"><span id="_Toc141851365" class="anchor"><span id="_Toc141852299" class="anchor"><span id="_Toc141887843" class="anchor"><span id="_Toc141889683" class="anchor"><span id="_Toc141893352" class="anchor"><span id="_Toc142113204" class="anchor"><span id="_Toc142114232" class="anchor"><span id="_Toc142729392" class="anchor"><span id="_Toc142730676" class="anchor"><span id="_Toc142731049" class="anchor"><span id="_Toc142998414" class="anchor"><span id="_Toc143063505" class="anchor"><span id="_Ref143501081" class="anchor"><span id="_Ref143501134" class="anchor"><span id="_Toc143509615" class="anchor"><span id="_Toc143510062" class="anchor"><span id="_Toc144026152" class="anchor"><span id="_Toc144026483" class="anchor"><span id="_Toc144276126" class="anchor"><span id="_Toc144276470" class="anchor"><span id="_Toc144280058" class="anchor"><span id="_Toc144280404" class="anchor"><span id="_Toc144540619" class="anchor"><span id="_Toc144554501" class="anchor"><span id="_Toc144722123" class="anchor"><span id="_Toc145503585" class="anchor"><span id="_Toc145512027" class="anchor"><span id="_Toc145513050" class="anchor"><span id="_Toc145513434" class="anchor"><span id="_Toc222907198" class="anchor"><span id="_Toc342652775" class="anchor"><span id="_Toc439857966" class="anchor"><span id="_Toc110172690" class="anchor"><span id="_Toc439863980" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>

##### 

<span id="_Toc437511053" class="anchor"></span>

<span id="_Toc437511058" class="anchor"></span>

##### 

  ------------------------------------------------- --
  <span id="_Toc437511062" class="anchor"></span>
  ------------------------------------------------- --

##### 

  ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- --
                                                                                                                                                                                                 
                                                                                                                                                                                                 
                                                                                                                                                                                                 
  <span id="_Toc130721561" class="anchor"><span id="_Toc130888042" class="anchor"><span id="_Toc130978374" class="anchor"><span id="_Toc131014049" class="anchor"></span></span></span></span>   
                                                                                                                                                                                                 
  ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- --

### <span id="_Toc127596678" class="anchor"><span id="_Toc127786299" class="anchor"><span id="_Toc127786615" class="anchor"><span id="_Toc127786931" class="anchor"><span id="_Toc127877527" class="anchor"><span id="_Toc128289598" class="anchor"><span id="_Toc128289991" class="anchor"><span id="_Toc130189673" class="anchor"><span id="_Toc130200889" class="anchor"><span id="_Toc130201205" class="anchor"><span id="_Toc130201526" class="anchor"><span id="_Toc131936613" class="anchor"><span id="_Toc142113205" class="anchor"><span id="_Toc142114233" class="anchor"><span id="_Toc142729393" class="anchor"><span id="_Toc142730677" class="anchor"><span id="_Toc142731050" class="anchor"><span id="_Toc142998415" class="anchor"><span id="_Toc143063506" class="anchor"><span id="_Toc143509616" class="anchor"><span id="_Toc143510063" class="anchor"><span id="_Toc144026153" class="anchor"><span id="_Toc144026484" class="anchor"><span id="_Toc144276127" class="anchor"><span id="_Toc144276471" class="anchor"><span id="_Toc144280059" class="anchor"><span id="_Toc144280405" class="anchor"><span id="_Toc144540620" class="anchor"><span id="_Toc144554502" class="anchor"><span id="_Toc144722124" class="anchor"><span id="_Toc145503586" class="anchor"><span id="_Toc145512028" class="anchor"><span id="_Toc145513051" class="anchor"><span id="_Toc145513435" class="anchor"><span id="_Toc222907199" class="anchor"><span id="_Toc342652778" class="anchor"><span id="_Toc439857967" class="anchor"><span id="_Toc127596679" class="anchor"><span id="_Toc127786300" class="anchor"><span id="_Toc127786616" class="anchor"><span id="_Toc127786932" class="anchor"><span id="_Toc127877528" class="anchor"><span id="_Toc128289599" class="anchor"><span id="_Toc128289992" class="anchor"><span id="_Toc130189674" class="anchor"><span id="_Toc130200890" class="anchor"><span id="_Toc130201206" class="anchor"><span id="_Toc130201527" class="anchor"><span id="_Toc131936614" class="anchor"><span id="_Toc133901072" class="anchor"><span id="_Toc137460953" class="anchor"><span id="_Toc139096468" class="anchor"><span id="_Toc139188391" class="anchor"><span id="_Toc139191254" class="anchor"><span id="_Toc140490305" class="anchor"><span id="_Ref140490577" class="anchor"><span id="_Toc140571208" class="anchor"><span id="_Toc141257478" class="anchor"><span id="_Toc141257805" class="anchor"><span id="_Toc141267333" class="anchor"><span id="_Toc141522351" class="anchor"><span id="_Toc141529442" class="anchor"><span id="_Toc141529759" class="anchor"><span id="_Toc141851366" class="anchor"><span id="_Toc141852300" class="anchor"><span id="_Toc141887844" class="anchor"><span id="_Toc141889684" class="anchor"><span id="_Toc141893353" class="anchor"><span id="_Toc439863981" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>

<span id="_Toc437511100" class="anchor"></span>

<span id="_Toc437511105" class="anchor"></span>

##### 

<span id="_Toc437511107" class="anchor"></span>

  ------------------------------------------------- --
  <span id="_Toc437511110" class="anchor"></span>
  ------------------------------------------------- --

##### 

-   -   

  -- --
     
     
     
     
  -- --

### <span id="_Toc142113206" class="anchor"><span id="_Toc142114234" class="anchor"><span id="_Toc142729394" class="anchor"><span id="_Toc142730678" class="anchor"><span id="_Toc142731051" class="anchor"><span id="_Toc142998416" class="anchor"><span id="_Toc143063507" class="anchor"><span id="_Toc143509617" class="anchor"><span id="_Toc143510064" class="anchor"><span id="_Toc144026154" class="anchor"><span id="_Toc144026485" class="anchor"><span id="_Toc144276128" class="anchor"><span id="_Toc144276472" class="anchor"><span id="_Toc144280060" class="anchor"><span id="_Toc144280406" class="anchor"><span id="_Toc144540621" class="anchor"><span id="_Toc144554503" class="anchor"><span id="_Toc144722125" class="anchor"><span id="_Toc145503587" class="anchor"><span id="_Toc145512029" class="anchor"><span id="_Toc145513052" class="anchor"><span id="_Toc145513436" class="anchor"><span id="_Toc222907200" class="anchor"><span id="_Toc342652779" class="anchor"><span id="_Toc439857968" class="anchor"><span id="_Toc439863982" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>

<span id="_Toc437511146" class="anchor"></span>

<span id="_Toc437511151" class="anchor"></span>

  ------------------------------------------------- --
  <span id="_Toc437511155" class="anchor"></span>
  ------------------------------------------------- --

##### 

-   -   -   

  -- --
     
     
     
     
  -- --

### <span id="_Toc127596680" class="anchor"><span id="_Toc127786301" class="anchor"><span id="_Toc127786617" class="anchor"><span id="_Toc127786933" class="anchor"><span id="_Toc127877529" class="anchor"><span id="_Toc128289600" class="anchor"><span id="_Toc128289993" class="anchor"><span id="_Toc130189675" class="anchor"><span id="_Toc130200891" class="anchor"><span id="_Toc130201207" class="anchor"><span id="_Toc130201528" class="anchor"><span id="_Toc131936615" class="anchor"><span id="_Ref133318125" class="anchor"><span id="_Toc133901079" class="anchor"><span id="_Toc137460954" class="anchor"><span id="_Toc139096469" class="anchor"><span id="_Toc139188392" class="anchor"><span id="_Toc139191255" class="anchor"><span id="_Toc140490306" class="anchor"><span id="_Toc140571209" class="anchor"><span id="_Toc141257479" class="anchor"><span id="_Toc141257806" class="anchor"><span id="_Toc141267334" class="anchor"><span id="_Toc141522352" class="anchor"><span id="_Toc141529443" class="anchor"><span id="_Toc141529760" class="anchor"><span id="_Toc141851367" class="anchor"><span id="_Toc141852301" class="anchor"><span id="_Toc141887845" class="anchor"><span id="_Toc141889685" class="anchor"><span id="_Toc141893354" class="anchor"><span id="_Toc142113207" class="anchor"><span id="_Toc142114235" class="anchor"><span id="_Toc142729395" class="anchor"><span id="_Toc142730679" class="anchor"><span id="_Toc142731052" class="anchor"><span id="_Toc142998417" class="anchor"><span id="_Toc143063508" class="anchor"><span id="_Toc143509618" class="anchor"><span id="_Toc143510065" class="anchor"><span id="_Toc144026155" class="anchor"><span id="_Toc144026486" class="anchor"><span id="_Toc144276129" class="anchor"><span id="_Toc144276473" class="anchor"><span id="_Toc144280061" class="anchor"><span id="_Toc144280407" class="anchor"><span id="_Toc144540622" class="anchor"><span id="_Toc144554504" class="anchor"><span id="_Toc144722126" class="anchor"><span id="_Toc145503588" class="anchor"><span id="_Toc145512030" class="anchor"><span id="_Toc145513053" class="anchor"><span id="_Toc145513437" class="anchor"><span id="_Toc222907201" class="anchor"><span id="_Toc342652780" class="anchor"><span id="_Toc439857969" class="anchor"><span id="_Toc439863983" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>

<span id="_Toc437511193" class="anchor"></span>

<span id="_Toc437511200" class="anchor"></span>

##### 

<span id="_Toc437511202" class="anchor"></span>

  ------------------------------------------------- -- --
  <span id="_Toc437511205" class="anchor"></span>
  ------------------------------------------------- -- --

##### 

-   -   

  -- --
     
     
     
     
  -- --

### <span id="_Toc110172691" class="anchor"><span id="_Toc127596681" class="anchor"><span id="_Toc127786302" class="anchor"><span id="_Toc127786618" class="anchor"><span id="_Toc127786934" class="anchor"><span id="_Toc127877530" class="anchor"><span id="_Toc128289601" class="anchor"><span id="_Toc128289994" class="anchor"><span id="_Toc130189676" class="anchor"><span id="_Toc130200892" class="anchor"><span id="_Toc130201208" class="anchor"><span id="_Toc130201529" class="anchor"><span id="_Toc131936616" class="anchor"><span id="_Ref133318172" class="anchor"><span id="_Toc133901080" class="anchor"><span id="_Toc137460955" class="anchor"><span id="_Toc139096470" class="anchor"><span id="_Toc139188393" class="anchor"><span id="_Toc139191256" class="anchor"><span id="_Toc140490307" class="anchor"><span id="_Toc140571210" class="anchor"><span id="_Toc141257480" class="anchor"><span id="_Toc141257807" class="anchor"><span id="_Toc141267335" class="anchor"><span id="_Toc141522353" class="anchor"><span id="_Toc141529444" class="anchor"><span id="_Toc141529761" class="anchor"><span id="_Toc141851368" class="anchor"><span id="_Toc141852302" class="anchor"><span id="_Toc141887846" class="anchor"><span id="_Toc141889686" class="anchor"><span id="_Toc141893355" class="anchor"><span id="_Toc142113208" class="anchor"><span id="_Toc142114236" class="anchor"><span id="_Toc142729396" class="anchor"><span id="_Toc142730680" class="anchor"><span id="_Toc142731053" class="anchor"><span id="_Toc142998418" class="anchor"><span id="_Toc143063509" class="anchor"><span id="_Toc143509619" class="anchor"><span id="_Toc143510066" class="anchor"><span id="_Toc144026156" class="anchor"><span id="_Toc144026487" class="anchor"><span id="_Toc144276130" class="anchor"><span id="_Toc144276474" class="anchor"><span id="_Toc144280062" class="anchor"><span id="_Toc144280408" class="anchor"><span id="_Toc144540623" class="anchor"><span id="_Toc144554505" class="anchor"><span id="_Toc144722127" class="anchor"><span id="_Toc145503589" class="anchor"><span id="_Toc145512031" class="anchor"><span id="_Toc145513054" class="anchor"><span id="_Toc145513438" class="anchor"><span id="_Toc222907202" class="anchor"><span id="_Toc342652781" class="anchor"><span id="_Toc439857970" class="anchor"><span id="_Toc439863984" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>

<span id="_Toc437511251" class="anchor"></span>

<span id="_Toc437511258" class="anchor"></span>

##### 

<span id="_Toc437511260" class="anchor"></span>

  ------------------------------------------------- -- --
  <span id="_Toc437511263" class="anchor"></span>
  ------------------------------------------------- -- --

##### 

-   -   

  ------------------------------------------------- --
                                                    
                                                    
                                                    
                                                    
  <span id="_Toc437511305" class="anchor"></span>   
  <span id="_Toc437511308" class="anchor"></span>   
                                                    
  <span id="_Toc437511315" class="anchor"></span>   
                                                    
                                                    
  ------------------------------------------------- --

### <span id="_Toc127596682" class="anchor"><span id="_Toc127786303" class="anchor"><span id="_Toc127786619" class="anchor"><span id="_Toc127786935" class="anchor"><span id="_Toc127877531" class="anchor"><span id="_Toc128289602" class="anchor"><span id="_Toc128289995" class="anchor"><span id="_Toc130189677" class="anchor"><span id="_Toc130200893" class="anchor"><span id="_Toc130201209" class="anchor"><span id="_Toc130201530" class="anchor"><span id="_Toc131936617" class="anchor"><span id="_Toc133901081" class="anchor"><span id="_Toc137460956" class="anchor"><span id="_Toc139096471" class="anchor"><span id="_Toc139188394" class="anchor"><span id="_Toc139191257" class="anchor"><span id="_Toc140490308" class="anchor"><span id="_Ref140490578" class="anchor"><span id="_Toc140571211" class="anchor"><span id="_Toc141257481" class="anchor"><span id="_Toc141257808" class="anchor"><span id="_Toc141267336" class="anchor"><span id="_Toc141522354" class="anchor"><span id="_Toc141529445" class="anchor"><span id="_Toc141529762" class="anchor"><span id="_Toc141851369" class="anchor"><span id="_Toc141852303" class="anchor"><span id="_Toc141887847" class="anchor"><span id="_Toc141889687" class="anchor"><span id="_Toc141893356" class="anchor"><span id="_Toc142113209" class="anchor"><span id="_Toc142114237" class="anchor"><span id="_Toc142729397" class="anchor"><span id="_Toc142730681" class="anchor"><span id="_Toc142731054" class="anchor"><span id="_Toc142998419" class="anchor"><span id="_Toc143063510" class="anchor"><span id="_Toc143509620" class="anchor"><span id="_Toc143510067" class="anchor"><span id="_Toc144026157" class="anchor"><span id="_Toc144026488" class="anchor"><span id="_Toc144276131" class="anchor"><span id="_Toc144276475" class="anchor"><span id="_Toc144280063" class="anchor"><span id="_Toc144280409" class="anchor"><span id="_Toc144540624" class="anchor"><span id="_Toc144554506" class="anchor"><span id="_Toc144722128" class="anchor"><span id="_Toc145503590" class="anchor"><span id="_Toc145512032" class="anchor"><span id="_Toc145513055" class="anchor"><span id="_Toc145513439" class="anchor"><span id="_Toc222907203" class="anchor"><span id="_Toc342652782" class="anchor"><span id="_Toc439857971" class="anchor"><span id="_Toc439863985" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>

<span id="_Toc437511327" class="anchor"></span>

<span id="_Toc437511332" class="anchor"></span>

##### 

<span id="_Toc437511334" class="anchor"></span>

  ------------------------------------------------- --
  <span id="_Toc437511337" class="anchor"></span>
  ------------------------------------------------- --

##### 

  -- --
     
  -- --

### <span id="_Toc110172694" class="anchor"><span id="_Toc127596683" class="anchor"><span id="_Toc127786304" class="anchor"><span id="_Toc127786620" class="anchor"><span id="_Toc127786936" class="anchor"><span id="_Toc127877532" class="anchor"><span id="_Toc128289603" class="anchor"><span id="_Toc128289996" class="anchor"><span id="_Toc130189678" class="anchor"><span id="_Toc130200894" class="anchor"><span id="_Toc130201210" class="anchor"><span id="_Toc130201531" class="anchor"><span id="_Toc131936618" class="anchor"><span id="_Toc133901082" class="anchor"><span id="_Toc137460957" class="anchor"><span id="_Toc139096472" class="anchor"><span id="_Toc139188395" class="anchor"><span id="_Toc139191258" class="anchor"><span id="_Toc140490309" class="anchor"><span id="_Toc140571212" class="anchor"><span id="_Toc141257482" class="anchor"><span id="_Toc141257809" class="anchor"><span id="_Toc141267337" class="anchor"><span id="_Toc141522355" class="anchor"><span id="_Toc141529446" class="anchor"><span id="_Toc141529763" class="anchor"><span id="_Toc141851370" class="anchor"><span id="_Toc141852304" class="anchor"><span id="_Toc141887848" class="anchor"><span id="_Toc141889688" class="anchor"><span id="_Toc141893357" class="anchor"><span id="_Toc142113210" class="anchor"><span id="_Toc142114238" class="anchor"><span id="_Toc142729398" class="anchor"><span id="_Toc142730682" class="anchor"><span id="_Toc142731055" class="anchor"><span id="_Toc142998420" class="anchor"><span id="_Toc143063511" class="anchor"><span id="_Toc143509621" class="anchor"><span id="_Toc143510068" class="anchor"><span id="_Toc144026158" class="anchor"><span id="_Toc144026489" class="anchor"><span id="_Toc144276132" class="anchor"><span id="_Toc144276476" class="anchor"><span id="_Toc144280064" class="anchor"><span id="_Toc144280410" class="anchor"><span id="_Toc144540625" class="anchor"><span id="_Toc144554507" class="anchor"><span id="_Toc144722129" class="anchor"><span id="_Toc145503591" class="anchor"><span id="_Toc145512033" class="anchor"><span id="_Toc145513056" class="anchor"><span id="_Toc145513440" class="anchor"><span id="_Toc222907204" class="anchor"><span id="_Toc342652783" class="anchor"><span id="_Toc439857972" class="anchor"><span id="_Toc439863986" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>

<span id="_Toc437511363" class="anchor"></span>

<span id="_Toc437511370" class="anchor"></span>

##### 

  ------------------------------------------------- --
  <span id="_Toc437511374" class="anchor"></span>
  ------------------------------------------------- --

##### 

-   

  ------------------------------------------------- --
                                                    
                                                    
  <span id="_Toc437511410" class="anchor"></span>   
  ------------------------------------------------- --

### <span id="_Toc342652784" class="anchor"><span id="_Toc439857973" class="anchor"><span id="_Toc439863987" class="anchor"></span></span></span>

<span id="_Toc437511416" class="anchor"></span>

<span id="_Toc437511422" class="anchor"></span>

  ------------------------------------------------- --
  <span id="_Toc437511426" class="anchor"></span>
  ------------------------------------------------- --

  ------------------------------------------------- --
                                                    
                                                    
  <span id="_Toc437511453" class="anchor"></span>   
  ------------------------------------------------- --

### <span id="_Toc439857974" class="anchor"><span id="_Toc439863988" class="anchor"></span></span>

##### 

<span id="_Toc437511459" class="anchor"></span>

<span id="_Toc437511464" class="anchor"></span>

##### 

<span id="_Toc437511466" class="anchor"></span>

  ------------------------------------------------- --
  <span id="_Toc437511469" class="anchor"></span>
  ------------------------------------------------- --

##### 

Partition Crash Enlightenment
-----------------------------

The hypervisor provides child partitions with a crash enlightenment
facility. This interface allows the operating system running in a child
partition the option of providing any relevant forensic information
about fatal OS conditions to the hypervisor as part of its regular crash
dump procedure. The child partition may also direct the hypervisor to
take specific action in response to the guest OS crash event. Currently,
the only supported hypervisor action is to preserve the contents of the
guest crash parameter MSRs. The hypervisor then makes this information
available to the parent partition for logging. This allows a system
administrator to gather information about the guest OS crash event
without needing to inspect persistent storage attached to the child
partition for crash dump or core dump information that may be stored
there by the crashing OS.

### Guest Crash Enlightenment Interface

The guest crash enlightenment interface is provided through six
synthetic MSRs, as defined below.

\#define HV\_X64\_MSR\_CRASH\_P0 0x40000100

\#define HV\_X64\_MSR\_CRASH\_P1 0x40000101

\#define HV\_X64\_MSR\_CRASH\_P2 0x40000102

\#define HV\_X64\_MSR\_CRASH\_P3 0x40000103

\#define HV\_X64\_MSR\_CRASH\_P4 0x40000104

\#define HV\_X64\_MSR\_CRASH\_CTL 0x40000105

### Guest Crash Enlightenment Data Structures

The following data structure is used to define the contents of the guest
crash enlightenment control register, \_HV\_CRASH\_CTL\_REG\_CONTENTS.

typedef union \_HV\_CRASH\_CTL\_REG\_CONTENTS

{

UINT64 AsUINT64;

struct

{

UINT64 Reserved : 63; // Reserved bits

UINT64 CrashNotify : 1; // Log contents of crash parameter // system
registers

};

} HV\_CRASH\_CTL\_REG\_CONTENTS;

#### Guest Crash Control MSR

The guest crash control MSR HV\_X64\_MSR\_CRASH\_CTL may be used by
child partitions to determine the hypervisor’s guest crash capabilities,
and to invoke the specified action to take.

##### Determining Guest Crash Capabilities

To determine the guest crash capabilities, child partitions may read the
HV\_X64\_MSR\_CRASH\_CTL register. The supported set of actions and
capabilities supported by the hypervisor is reported.

Currently, only one guest crash action is supported – *CrashNotify*.
This action is used to indicate to the hypervisor that the child
partition has completed writing the desired data into the guest crash
parameter MSRs, and the hypervisor should proceed with logging the
contents of these MSRs.

##### Invoking Guest Crash Capabilities

To invoke a supported hypervisor guest crash action, a child partition
writes to the HV\_X64\_MSR\_CRASH\_CTL register, specifying the desired
action.

1.  <span id="_Toc127596684" class="anchor"><span id="_Toc127786305" class="anchor"><span id="_Toc127786621" class="anchor"><span id="_Toc127786937" class="anchor"><span id="_Toc127877533" class="anchor"><span id="_Toc128289604" class="anchor"><span id="_Toc128289997" class="anchor"><span id="_Toc130189679" class="anchor"><span id="_Toc130200895" class="anchor"><span id="_Toc130201211" class="anchor"><span id="_Toc130201532" class="anchor"><span id="_Toc131936619" class="anchor"><span id="_Toc133901083" class="anchor"><span id="_Toc137460958" class="anchor"><span id="_Toc139096473" class="anchor"><span id="_Toc139188396" class="anchor"><span id="_Toc139191259" class="anchor"><span id="_Toc140490310" class="anchor"><span id="_Toc140571213" class="anchor"><span id="_Toc141257483" class="anchor"><span id="_Toc141257810" class="anchor"><span id="_Toc141267338" class="anchor"><span id="_Toc141522356" class="anchor"><span id="_Toc141529447" class="anchor"><span id="_Toc141529764" class="anchor"><span id="_Toc141851371" class="anchor"><span id="_Toc141852305" class="anchor"><span id="_Toc141887849" class="anchor"><span id="_Toc141889689" class="anchor"><span id="_Toc141893358" class="anchor"><span id="_Toc142113211" class="anchor"><span id="_Toc142114239" class="anchor"><span id="_Toc142729399" class="anchor"><span id="_Toc142730683" class="anchor"><span id="_Toc142731056" class="anchor"><span id="_Toc142998421" class="anchor"><span id="_Toc143063512" class="anchor"><span id="_Toc143509622" class="anchor"><span id="_Toc143510069" class="anchor"><span id="_Toc144026159" class="anchor"><span id="_Toc144026490" class="anchor"><span id="_Toc144276133" class="anchor"><span id="_Toc144276477" class="anchor"><span id="_Toc144280065" class="anchor"><span id="_Toc144280411" class="anchor"><span id="_Toc144540626" class="anchor"><span id="_Toc144554508" class="anchor"><span id="_Toc144722130" class="anchor"><span id="_Toc145503592" class="anchor"><span id="_Toc145512034" class="anchor"><span id="_Toc145513057" class="anchor"><span id="_Toc145513441" class="anchor"><span id="_Toc222907205" class="anchor"><span id="_Toc342652785" class="anchor"><span id="_Toc439863992" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Physical Hardware Management
    =====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================

    1.  <span id="_Toc110172696" class="anchor"><span id="_Toc127596685" class="anchor"><span id="_Toc127786306" class="anchor"><span id="_Toc127786622" class="anchor"><span id="_Toc127786938" class="anchor"><span id="_Toc127877534" class="anchor"><span id="_Toc128289605" class="anchor"><span id="_Toc128289998" class="anchor"><span id="_Toc130189680" class="anchor"><span id="_Toc130200896" class="anchor"><span id="_Toc130201212" class="anchor"><span id="_Toc130201533" class="anchor"><span id="_Toc131936620" class="anchor"><span id="_Toc133901084" class="anchor"><span id="_Toc137460959" class="anchor"><span id="_Toc139096474" class="anchor"><span id="_Toc139188397" class="anchor"><span id="_Toc139191260" class="anchor"><span id="_Toc140490311" class="anchor"><span id="_Toc140571214" class="anchor"><span id="_Toc141257484" class="anchor"><span id="_Toc141257811" class="anchor"><span id="_Toc141267339" class="anchor"><span id="_Toc141522357" class="anchor"><span id="_Toc141529448" class="anchor"><span id="_Toc141529765" class="anchor"><span id="_Toc141851372" class="anchor"><span id="_Toc141852306" class="anchor"><span id="_Toc141887850" class="anchor"><span id="_Toc141889690" class="anchor"><span id="_Toc141893359" class="anchor"><span id="_Toc142113212" class="anchor"><span id="_Toc142114240" class="anchor"><span id="_Toc142729400" class="anchor"><span id="_Toc142730684" class="anchor"><span id="_Toc142731057" class="anchor"><span id="_Toc142998422" class="anchor"><span id="_Toc143063513" class="anchor"><span id="_Toc143509623" class="anchor"><span id="_Toc143510070" class="anchor"><span id="_Toc144026160" class="anchor"><span id="_Toc144026491" class="anchor"><span id="_Toc144276134" class="anchor"><span id="_Toc144276478" class="anchor"><span id="_Toc144280066" class="anchor"><span id="_Toc144280412" class="anchor"><span id="_Toc144540627" class="anchor"><span id="_Toc144554509" class="anchor"><span id="_Toc144722131" class="anchor"><span id="_Toc145503593" class="anchor"><span id="_Toc145512035" class="anchor"><span id="_Toc145513058" class="anchor"><span id="_Toc145513442" class="anchor"><span id="_Toc222907206" class="anchor"><span id="_Toc342652786" class="anchor"><span id="_Toc439863993" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Overview
        ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

This section discusses the way in which the hypervisor manages aspects
of the underlying physical hardware.

The hypervisor does not manage or control all hardware in the system.
Rather, it manages a small subset of core hardware facilities—just
enough to enforce isolation guarantees. In some cases, the hypervisor
delegates hardware management responsibilities to the root partition.

The following table shows which aspects of hardware management are
handled by the hypervisor, by the root partition, and (optionally) by
other partitions.

  ----------------------------------------------------------------------------------------------------
  Software Component   Hardware Facility
  -------------------- -------------------------------------------------------------------------------
  Hypervisor           Logical processors (startup, initialization, microcode update, scheduling).
                       
                       Processor power management.
                       
                       Interrupt and DMA remapping (IOMMU)
                       
                       Device domains
                       
                       Local APICs (interrupt routing)
                       
                       Constant-rate system counter (for example, PM timer)
                       
                       System physical address space (access to RAM and device memory)
                       
                       I/O space
                       
                       MSR space
                       
                       Machine Check Exceptions

  Root partition       System power management
                       
                       PCI, PCIe and PCIx configuration space
                       
                       Devices connected directly to a PCIe bus or to a PCIe-attached peripheral bus
                       
                       Machine Check Exceptions
  ----------------------------------------------------------------------------------------------------

### <span id="_Toc110172699" class="anchor"><span id="_Toc127596686" class="anchor"><span id="_Toc127786307" class="anchor"><span id="_Toc127786623" class="anchor"><span id="_Toc127786939" class="anchor"><span id="_Toc127877535" class="anchor"><span id="_Toc128289606" class="anchor"><span id="_Toc128289999" class="anchor"><span id="_Toc130189681" class="anchor"><span id="_Toc130200897" class="anchor"><span id="_Toc130201213" class="anchor"><span id="_Toc130201534" class="anchor"><span id="_Toc131936621" class="anchor"><span id="_Toc133901085" class="anchor"><span id="_Toc137460960" class="anchor"><span id="_Toc139096475" class="anchor"><span id="_Toc139188398" class="anchor"><span id="_Toc139191261" class="anchor"><span id="_Toc140490312" class="anchor"><span id="_Toc140571215" class="anchor"><span id="_Toc141257488" class="anchor"><span id="_Toc141257815" class="anchor"><span id="_Toc141267343" class="anchor"><span id="_Toc141522361" class="anchor"><span id="_Toc141529449" class="anchor"><span id="_Toc141529766" class="anchor"><span id="_Toc141851373" class="anchor"><span id="_Toc141852307" class="anchor"><span id="_Toc141887851" class="anchor"><span id="_Toc141889691" class="anchor"><span id="_Toc141893360" class="anchor"><span id="_Toc142113213" class="anchor"><span id="_Toc142114241" class="anchor"><span id="_Toc142729401" class="anchor"><span id="_Toc142730685" class="anchor"><span id="_Toc142731058" class="anchor"><span id="_Toc142998423" class="anchor"><span id="_Toc143063514" class="anchor"><span id="_Toc143509624" class="anchor"><span id="_Toc143510071" class="anchor"><span id="_Toc144026161" class="anchor"><span id="_Toc144026492" class="anchor"><span id="_Toc144276135" class="anchor"><span id="_Toc144276479" class="anchor"><span id="_Toc144280067" class="anchor"><span id="_Toc144280413" class="anchor"><span id="_Toc144540628" class="anchor"><span id="_Toc144554510" class="anchor"><span id="_Toc144722132" class="anchor"><span id="_Toc145503594" class="anchor"><span id="_Toc145512036" class="anchor"><span id="_Toc145513059" class="anchor"><span id="_Toc145513443" class="anchor"><span id="_Toc222907207" class="anchor"><span id="_Toc342652787" class="anchor"><span id="_Toc439863994" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>System Physical Address Space

The *system physical address space* (or SPA space) of the physical
machine is the range from 0 to some maximum address that depends on the
underlying hardware architecture—typically 2^n^-1, where 32 ≤ n ≤ 64.

SPAs may be backed by RAM or memory-mapped device registers at the
granularity of the architecturally-defined minimum page size
HV\_PAGE\_SIZE. The layout of the SPA space is ultimately dictated by
the physical machine.

SPA pages are specified in terms of *SPA page ranges,* each of which
consists of one or more contiguous SPA pages. RAM SPA ranges are backed
by normal memory.

It is a critical invariant for the correct functioning of the hypervisor
that all RAM SPA pages are backed by RAM at all times; that is, read and
write accesses to these pages should have the expected semantics. The
hypervisor relies on the correct behavior of a privileged partition
(typically the root partition) in ensuring that this invariant holds.
Future versions of the hypervisor may also rely on hardware features to
help enforce this invariant.

The following invariants are assumed (and enforced) by the hypervisor:

-   No two RAM page ranges can overlap.

-   Pages that are not within defined RAM page ranges are assumed to be
    “not backed" or backed by device memory and are not used by
    the hypervisor. They are inaccessible to all partitions except for
    the root partition.

-   The hypervisor uses only pages within RAM SPA page ranges to store
    its code and internal data structures.

    1.  ### <span id="_Toc127596687" class="anchor"><span id="_Toc127786308" class="anchor"><span id="_Toc127786624" class="anchor"><span id="_Toc127786940" class="anchor"><span id="_Toc127877536" class="anchor"><span id="_Toc128289607" class="anchor"><span id="_Toc128290000" class="anchor"><span id="_Toc130189682" class="anchor"><span id="_Toc130200898" class="anchor"><span id="_Toc130201214" class="anchor"><span id="_Toc130201535" class="anchor"><span id="_Toc131936622" class="anchor"><span id="_Toc133901086" class="anchor"><span id="_Toc137460961" class="anchor"><span id="_Toc139096476" class="anchor"><span id="_Toc139188399" class="anchor"><span id="_Toc139191262" class="anchor"><span id="_Toc140490313" class="anchor"><span id="_Toc140571216" class="anchor"><span id="_Toc141257489" class="anchor"><span id="_Toc141257816" class="anchor"><span id="_Toc141267344" class="anchor"><span id="_Toc141522362" class="anchor"><span id="_Toc141529450" class="anchor"><span id="_Toc141529767" class="anchor"><span id="_Toc141851374" class="anchor"><span id="_Toc141852308" class="anchor"><span id="_Toc141887852" class="anchor"><span id="_Toc141889692" class="anchor"><span id="_Toc141893361" class="anchor"><span id="_Toc142113214" class="anchor"><span id="_Toc142114242" class="anchor"><span id="_Toc142729402" class="anchor"><span id="_Toc142730686" class="anchor"><span id="_Toc142731059" class="anchor"><span id="_Toc142998424" class="anchor"><span id="_Toc143063515" class="anchor"><span id="_Toc143509625" class="anchor"><span id="_Toc143510072" class="anchor"><span id="_Toc144026162" class="anchor"><span id="_Toc144026493" class="anchor"><span id="_Toc144276136" class="anchor"><span id="_Toc144276480" class="anchor"><span id="_Toc144280068" class="anchor"><span id="_Toc144280414" class="anchor"><span id="_Toc144540629" class="anchor"><span id="_Toc144554511" class="anchor"><span id="_Toc144722133" class="anchor"><span id="_Toc145503595" class="anchor"><span id="_Toc145512037" class="anchor"><span id="_Toc145513060" class="anchor"><span id="_Toc145513444" class="anchor"><span id="_Toc222907208" class="anchor"><span id="_Toc342652788" class="anchor"><span id="_Toc439863995" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Logical Processors

The hypervisor maintains a list of *logical processors.* Conceptually, a
logical processor is a thread implemented in hardware.

At hypervisor boot time, one virtual processor is created within the
root partition for each present and potential logical processor, up to a
maximum of 64 root virtual processors. For systems with greater than 64
logical processors, the hypervisor will continue to manage and schedule
guest virtual processors on the remaining logical processors, however
these logical processors will have no root virtual processor associated
with them. Unlike normal virtual processors associated with other
partitions, the root partition’s virtual processors have hard
affinities; that is, they are bound to a specific logical processor.

### <span id="_Toc127596688" class="anchor"><span id="_Toc127786309" class="anchor"><span id="_Toc127786625" class="anchor"><span id="_Toc127786941" class="anchor"><span id="_Toc127877537" class="anchor"><span id="_Toc128289608" class="anchor"><span id="_Toc128290001" class="anchor"><span id="_Toc130189683" class="anchor"><span id="_Toc130200899" class="anchor"><span id="_Toc130201215" class="anchor"><span id="_Toc130201536" class="anchor"><span id="_Toc131936623" class="anchor"><span id="_Toc133901087" class="anchor"><span id="_Toc137460962" class="anchor"><span id="_Toc139096477" class="anchor"><span id="_Toc139188400" class="anchor"><span id="_Toc139191263" class="anchor"><span id="_Toc140490314" class="anchor"><span id="_Toc140571217" class="anchor"><span id="_Toc141257490" class="anchor"><span id="_Toc141257817" class="anchor"><span id="_Toc141267345" class="anchor"><span id="_Toc141522363" class="anchor"><span id="_Toc141529451" class="anchor"><span id="_Toc141529768" class="anchor"><span id="_Toc141851375" class="anchor"><span id="_Toc141852309" class="anchor"><span id="_Toc141887853" class="anchor"><span id="_Toc141889693" class="anchor"><span id="_Toc141893362" class="anchor"><span id="_Toc142113215" class="anchor"><span id="_Toc142114243" class="anchor"><span id="_Toc142729403" class="anchor"><span id="_Toc142730687" class="anchor"><span id="_Toc142731060" class="anchor"><span id="_Toc142998425" class="anchor"><span id="_Toc143063516" class="anchor"><span id="_Toc143509626" class="anchor"><span id="_Toc143510073" class="anchor"><span id="_Toc144026163" class="anchor"><span id="_Toc144026494" class="anchor"><span id="_Toc144276137" class="anchor"><span id="_Toc144276481" class="anchor"><span id="_Toc144280069" class="anchor"><span id="_Toc144280415" class="anchor"><span id="_Toc144540630" class="anchor"><span id="_Toc144554512" class="anchor"><span id="_Toc144722134" class="anchor"><span id="_Toc145503596" class="anchor"><span id="_Toc145512038" class="anchor"><span id="_Toc145513061" class="anchor"><span id="_Toc145513445" class="anchor"><span id="_Toc222907209" class="anchor"><span id="_Toc342652789" class="anchor"><span id="_Toc110172702" class="anchor"><span id="_Toc439863996" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Dynamic Addition of Logical Processors

The hypervisor does not support dynamic addition and removal of logical
processors at run time. All potential logical processors must be
declared at system boot time.

### <span id="_Toc127596689" class="anchor"><span id="_Toc127786310" class="anchor"><span id="_Toc127786626" class="anchor"><span id="_Toc127786942" class="anchor"><span id="_Toc127877538" class="anchor"><span id="_Toc128289609" class="anchor"><span id="_Toc128290002" class="anchor"><span id="_Toc130189684" class="anchor"><span id="_Toc130200900" class="anchor"><span id="_Toc130201216" class="anchor"><span id="_Toc130201537" class="anchor"><span id="_Toc131936624" class="anchor"><span id="_Toc133901088" class="anchor"><span id="_Toc137460963" class="anchor"><span id="_Toc139096478" class="anchor"><span id="_Toc139188401" class="anchor"><span id="_Toc139191264" class="anchor"><span id="_Toc140490315" class="anchor"><span id="_Toc140571218" class="anchor"><span id="_Toc141257491" class="anchor"><span id="_Toc141257818" class="anchor"><span id="_Toc141267346" class="anchor"><span id="_Toc141522364" class="anchor"><span id="_Toc141529452" class="anchor"><span id="_Toc141529769" class="anchor"><span id="_Toc141851376" class="anchor"><span id="_Toc141852310" class="anchor"><span id="_Toc141887854" class="anchor"><span id="_Toc141889694" class="anchor"><span id="_Toc141893363" class="anchor"><span id="_Toc142113216" class="anchor"><span id="_Toc142114244" class="anchor"><span id="_Toc142729404" class="anchor"><span id="_Toc142730688" class="anchor"><span id="_Toc142731061" class="anchor"><span id="_Toc142998426" class="anchor"><span id="_Toc143063517" class="anchor"><span id="_Toc143509627" class="anchor"><span id="_Toc143510074" class="anchor"><span id="_Toc144026164" class="anchor"><span id="_Toc144026495" class="anchor"><span id="_Toc144276138" class="anchor"><span id="_Toc144276482" class="anchor"><span id="_Toc144280070" class="anchor"><span id="_Toc144280416" class="anchor"><span id="_Toc144540631" class="anchor"><span id="_Toc144554513" class="anchor"><span id="_Toc144722135" class="anchor"><span id="_Toc145503597" class="anchor"><span id="_Toc145512039" class="anchor"><span id="_Toc145513062" class="anchor"><span id="_Toc145513446" class="anchor"><span id="_Toc222907210" class="anchor"><span id="_Toc342652790" class="anchor"><span id="_Toc439863997" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Physical Nodes

A *physical node* represents a collection of logical processors and
system physical pages. A physical node is sometimes referred to as a
*proximity domain* because all logical processors and pages within the
node are assumed to have similar proximity (that is, similar access
times to intra-node hardware resources).

The hypervisor maintains a map between pairs of physical nodes that
indicate the “distance" (that is, the cost of accessing resources)
between the nodes.

### <span id="_Toc222907211" class="anchor"><span id="_Toc342652791" class="anchor"><span id="_Toc439863998" class="anchor"></span></span></span>System Reset

The hypervisor provides an interface for “enlightened reboot", that is,
a mechanism through which a guest may request the hypervisor to reboot
the hardware platform. The interface is provided through an MSR that is
accessible on all virtual processors of a partition that possesses the
*AccessResetMsr* privilege.

<span id="_Toc127596690" class="anchor"><span id="_Toc127786311" class="anchor"><span id="_Toc127786627" class="anchor"><span id="_Toc127786943" class="anchor"><span id="_Toc127877539" class="anchor"><span id="_Toc128289610" class="anchor"><span id="_Toc128290003" class="anchor"><span id="_Toc130189685" class="anchor"><span id="_Toc130200901" class="anchor"><span id="_Toc130201217" class="anchor"><span id="_Toc130201538" class="anchor"><span id="_Toc131936625" class="anchor"><span id="_Toc133901089" class="anchor"><span id="_Toc137460964" class="anchor"><span id="_Toc139096479" class="anchor"><span id="_Toc139188402" class="anchor"><span id="_Toc139191265" class="anchor"><span id="_Toc140490316" class="anchor"><span id="_Toc140571219" class="anchor"><span id="_Toc141257492" class="anchor"><span id="_Toc141257819" class="anchor"><span id="_Toc141267347" class="anchor"><span id="_Toc141522365" class="anchor"><span id="_Toc141529453" class="anchor"><span id="_Toc141529770" class="anchor"><span id="_Toc141851377" class="anchor"><span id="_Toc141852311" class="anchor"><span id="_Toc141887855" class="anchor"><span id="_Toc141889695" class="anchor"><span id="_Toc141893364" class="anchor"><span id="_Toc142113217" class="anchor"><span id="_Toc142114245" class="anchor"><span id="_Toc142729405" class="anchor"><span id="_Toc142730689" class="anchor"><span id="_Toc142731062" class="anchor"><span id="_Toc142998427" class="anchor"><span id="_Toc143063518" class="anchor"><span id="_Toc143509628" class="anchor"><span id="_Toc143510075" class="anchor"><span id="_Toc144026165" class="anchor"><span id="_Toc144026496" class="anchor"><span id="_Toc144276139" class="anchor"><span id="_Toc144276483" class="anchor"><span id="_Toc144280071" class="anchor"><span id="_Toc144280417" class="anchor"><span id="_Toc144540632" class="anchor"><span id="_Toc144554514" class="anchor"><span id="_Toc144722136" class="anchor"><span id="_Toc145503598" class="anchor"><span id="_Toc145512040" class="anchor"><span id="_Toc145513063" class="anchor"><span id="_Toc145513447" class="anchor"><span id="_Toc222907212" class="anchor"><span id="_Toc342652794" class="anchor"><span id="_Toc439863999" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Hardware Information
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

The hypervisor obtains information about the underlying physical
hardware from three sources:

-   *Boot-time input parameters*: When the hypervisor is booted, input
    parameters provide information about some aspects of the
    physical hardware.

-   *Dynamic discovery*: At run-time, the hypervisor can discover
    information about the underlying physical hardware by using
    architecturally-defined mechanisms (for example, on x64 platforms,
    the CPUID instruction).

-   *Root partition input*: For more complex dynamic hardware changes
    (for example, power management) the hypervisor must be told about
    hardware changes by code running within the root partition.

    1.  ### <span id="_Toc127596691" class="anchor"><span id="_Toc127786312" class="anchor"><span id="_Toc127786628" class="anchor"><span id="_Toc127786944" class="anchor"><span id="_Toc127877540" class="anchor"><span id="_Toc128289611" class="anchor"><span id="_Toc128290004" class="anchor"><span id="_Toc130189686" class="anchor"><span id="_Toc130200902" class="anchor"><span id="_Toc130201218" class="anchor"><span id="_Toc130201539" class="anchor"><span id="_Toc131936626" class="anchor"><span id="_Toc133901090" class="anchor"><span id="_Toc137460965" class="anchor"><span id="_Toc139096480" class="anchor"><span id="_Toc139188403" class="anchor"><span id="_Toc139191266" class="anchor"><span id="_Toc140490317" class="anchor"><span id="_Toc140571220" class="anchor"><span id="_Toc141257493" class="anchor"><span id="_Toc141257820" class="anchor"><span id="_Toc141267348" class="anchor"><span id="_Toc141522366" class="anchor"><span id="_Toc141529454" class="anchor"><span id="_Toc141529771" class="anchor"><span id="_Toc141851378" class="anchor"><span id="_Toc141852312" class="anchor"><span id="_Toc141887856" class="anchor"><span id="_Toc141889696" class="anchor"><span id="_Toc141893365" class="anchor"><span id="_Toc142113218" class="anchor"><span id="_Toc142114246" class="anchor"><span id="_Toc142729406" class="anchor"><span id="_Toc142730690" class="anchor"><span id="_Toc142731063" class="anchor"><span id="_Toc142998428" class="anchor"><span id="_Toc143063519" class="anchor"><span id="_Toc143509629" class="anchor"><span id="_Toc143510076" class="anchor"><span id="_Toc144026166" class="anchor"><span id="_Toc144026497" class="anchor"><span id="_Toc144276140" class="anchor"><span id="_Toc144276484" class="anchor"><span id="_Toc144280072" class="anchor"><span id="_Toc144280418" class="anchor"><span id="_Toc144540633" class="anchor"><span id="_Toc144554515" class="anchor"><span id="_Toc144722137" class="anchor"><span id="_Toc145503599" class="anchor"><span id="_Toc145512041" class="anchor"><span id="_Toc145513064" class="anchor"><span id="_Toc145513448" class="anchor"><span id="_Toc222907213" class="anchor"><span id="_Toc342652795" class="anchor"><span id="_Toc110172698" class="anchor"><span id="_Toc439864000" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Boot-Time Hardware Properties

Aspects of the hardware that are described to the hypervisor at boot
time include:

-   Present and potential logical processors, including those that may
    be hot-plugged at run-time

-   Whether hyperthreading is enabled or disabled in the BIOS

-   Present RAM SPA ranges—system physical address ranges that are
    populated with RAM when the hypervisor is booted

-   Physical nodes (including those that have no associated resources at
    boot time but may be populated at run-time)

-   Addresses of certain hardware features that the hypervisor must
    access (for example, the power management timer)

<span id="_Toc342652796" class="anchor"><span id="_Toc342652797"
class="anchor"><span id="_Toc342652798"
class="anchor"></span></span></span>For more information about the
hypervisor boot process and boot-time input parameters, refer to Chapter
23.

### <span id="_Toc127596692" class="anchor"><span id="_Toc127786313" class="anchor"><span id="_Toc127786629" class="anchor"><span id="_Toc127786945" class="anchor"><span id="_Toc127877541" class="anchor"><span id="_Toc128289612" class="anchor"><span id="_Toc128290005" class="anchor"><span id="_Toc130189687" class="anchor"><span id="_Toc130200903" class="anchor"><span id="_Toc130201219" class="anchor"><span id="_Toc130201540" class="anchor"><span id="_Toc131936627" class="anchor"><span id="_Toc133901091" class="anchor"><span id="_Toc137460966" class="anchor"><span id="_Toc139096481" class="anchor"><span id="_Toc139188404" class="anchor"><span id="_Toc139191267" class="anchor"><span id="_Toc140490318" class="anchor"><span id="_Toc140571221" class="anchor"><span id="_Toc141257494" class="anchor"><span id="_Toc141257821" class="anchor"><span id="_Toc141267349" class="anchor"><span id="_Toc141522367" class="anchor"><span id="_Toc141529455" class="anchor"><span id="_Toc141529772" class="anchor"><span id="_Toc141851379" class="anchor"><span id="_Toc141852313" class="anchor"><span id="_Toc141887857" class="anchor"><span id="_Toc141889697" class="anchor"><span id="_Toc141893366" class="anchor"><span id="_Toc142113219" class="anchor"><span id="_Toc142114247" class="anchor"><span id="_Toc142729407" class="anchor"><span id="_Toc142730691" class="anchor"><span id="_Toc142731064" class="anchor"><span id="_Toc142998429" class="anchor"><span id="_Toc143063520" class="anchor"><span id="_Toc143509630" class="anchor"><span id="_Toc143510077" class="anchor"><span id="_Toc144026167" class="anchor"><span id="_Toc144026498" class="anchor"><span id="_Toc144276141" class="anchor"><span id="_Toc144276485" class="anchor"><span id="_Toc144280073" class="anchor"><span id="_Toc144280419" class="anchor"><span id="_Toc144540634" class="anchor"><span id="_Toc144554516" class="anchor"><span id="_Toc144722138" class="anchor"><span id="_Toc145503600" class="anchor"><span id="_Toc145512042" class="anchor"><span id="_Toc145513065" class="anchor"><span id="_Toc145513449" class="anchor"><span id="_Toc222907214" class="anchor"><span id="_Toc342652799" class="anchor"><span id="_Toc439864001" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Discovered Hardware Properties

Hardware properties discovered or derived by the hypervisor at run-time
include:

-   The relationship between logical processors (for example,
    multi-core, hyperthreading)

-   Memory access ratios between physical nodes

    1.  ### <span id="_Toc342652800" class="anchor"><span id="_Toc342652801" class="anchor"><span id="_Toc127596693" class="anchor"><span id="_Toc127786314" class="anchor"><span id="_Toc127786630" class="anchor"><span id="_Toc127786946" class="anchor"><span id="_Toc127877542" class="anchor"><span id="_Toc128289613" class="anchor"><span id="_Toc128290006" class="anchor"><span id="_Toc130189688" class="anchor"><span id="_Toc130200904" class="anchor"><span id="_Toc130201220" class="anchor"><span id="_Toc130201541" class="anchor"><span id="_Toc131936628" class="anchor"><span id="_Toc133901092" class="anchor"><span id="_Toc137460967" class="anchor"><span id="_Toc139096482" class="anchor"><span id="_Toc139188405" class="anchor"><span id="_Toc139191268" class="anchor"><span id="_Toc140490319" class="anchor"><span id="_Toc140571222" class="anchor"><span id="_Toc141257495" class="anchor"><span id="_Toc141257822" class="anchor"><span id="_Toc141267350" class="anchor"><span id="_Toc141522368" class="anchor"><span id="_Toc141529456" class="anchor"><span id="_Toc141529773" class="anchor"><span id="_Toc141851380" class="anchor"><span id="_Toc141852314" class="anchor"><span id="_Toc141887858" class="anchor"><span id="_Toc141889698" class="anchor"><span id="_Toc141893367" class="anchor"><span id="_Toc142113220" class="anchor"><span id="_Toc142114248" class="anchor"><span id="_Toc142729408" class="anchor"><span id="_Toc142730692" class="anchor"><span id="_Toc142731065" class="anchor"><span id="_Toc142998430" class="anchor"><span id="_Toc143063521" class="anchor"><span id="_Toc143509631" class="anchor"><span id="_Toc143510078" class="anchor"><span id="_Toc144026168" class="anchor"><span id="_Toc144026499" class="anchor"><span id="_Toc144276142" class="anchor"><span id="_Toc144276486" class="anchor"><span id="_Toc144280074" class="anchor"><span id="_Toc144280420" class="anchor"><span id="_Toc144540635" class="anchor"><span id="_Toc144554517" class="anchor"><span id="_Toc144722139" class="anchor"><span id="_Toc145503601" class="anchor"><span id="_Toc145512043" class="anchor"><span id="_Toc145513066" class="anchor"><span id="_Toc145513450" class="anchor"><span id="_Toc222907215" class="anchor"><span id="_Toc342652802" class="anchor"><span id="_Toc439864002" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Root Partition Hardware Properties

The root partition is responsible for notifying the hypervisor of the
following hardware properties:

-   System processor power management capabilities, and the associated
    resources and interface details for controlling power management
    states on logical processors.

    1.  <span id="_Toc342570701" class="anchor"><span id="_Toc342652803" class="anchor"><span id="_Toc127596694" class="anchor"><span id="_Toc127786315" class="anchor"><span id="_Toc127786631" class="anchor"><span id="_Toc127786947" class="anchor"><span id="_Toc127877543" class="anchor"><span id="_Toc128289614" class="anchor"><span id="_Toc128290007" class="anchor"><span id="_Toc130189689" class="anchor"><span id="_Toc130200905" class="anchor"><span id="_Toc130201221" class="anchor"><span id="_Toc130201542" class="anchor"><span id="_Toc131936629" class="anchor"><span id="_Toc133901093" class="anchor"><span id="_Toc137460968" class="anchor"><span id="_Toc139096483" class="anchor"><span id="_Toc139188406" class="anchor"><span id="_Toc139191269" class="anchor"><span id="_Toc140490320" class="anchor"><span id="_Toc140571223" class="anchor"><span id="_Toc141257496" class="anchor"><span id="_Toc141257823" class="anchor"><span id="_Toc141267351" class="anchor"><span id="_Toc141522369" class="anchor"><span id="_Toc141529457" class="anchor"><span id="_Toc141529774" class="anchor"><span id="_Toc141851381" class="anchor"><span id="_Toc141852315" class="anchor"><span id="_Toc141887859" class="anchor"><span id="_Toc141889699" class="anchor"><span id="_Toc141893368" class="anchor"><span id="_Toc142113221" class="anchor"><span id="_Toc142114249" class="anchor"><span id="_Toc142729409" class="anchor"><span id="_Toc142730693" class="anchor"><span id="_Toc142731066" class="anchor"><span id="_Toc142998431" class="anchor"><span id="_Toc143063522" class="anchor"><span id="_Toc143509632" class="anchor"><span id="_Toc143510079" class="anchor"><span id="_Toc144026169" class="anchor"><span id="_Toc144026500" class="anchor"><span id="_Toc144276143" class="anchor"><span id="_Toc144276487" class="anchor"><span id="_Toc144280075" class="anchor"><span id="_Toc144280421" class="anchor"><span id="_Toc144540636" class="anchor"><span id="_Toc144554518" class="anchor"><span id="_Toc144722140" class="anchor"><span id="_Toc145503602" class="anchor"><span id="_Toc145512044" class="anchor"><span id="_Toc145513067" class="anchor"><span id="_Toc145513451" class="anchor"><span id="_Toc222907216" class="anchor"><span id="_Toc342652804" class="anchor"><span id="_Toc439857989" class="anchor"><span id="_Toc439864003" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>
        --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

        1.  ### <span id="_Toc127596695" class="anchor"><span id="_Toc127786316" class="anchor"><span id="_Toc127786632" class="anchor"><span id="_Toc127786948" class="anchor"><span id="_Toc127877544" class="anchor"><span id="_Toc128289615" class="anchor"><span id="_Toc128290008" class="anchor"><span id="_Toc130189690" class="anchor"><span id="_Toc130200906" class="anchor"><span id="_Toc130201222" class="anchor"><span id="_Toc130201543" class="anchor"><span id="_Toc131936630" class="anchor"><span id="_Toc133901094" class="anchor"><span id="_Toc137460969" class="anchor"><span id="_Toc139096484" class="anchor"><span id="_Toc139188407" class="anchor"><span id="_Toc139191270" class="anchor"><span id="_Toc140490321" class="anchor"><span id="_Toc140571224" class="anchor"><span id="_Toc141257497" class="anchor"><span id="_Toc141257824" class="anchor"><span id="_Toc141267352" class="anchor"><span id="_Toc141522370" class="anchor"><span id="_Toc141529458" class="anchor"><span id="_Toc141529775" class="anchor"><span id="_Toc141851382" class="anchor"><span id="_Toc141852316" class="anchor"><span id="_Toc141887860" class="anchor"><span id="_Toc141889700" class="anchor"><span id="_Toc141893369" class="anchor"><span id="_Toc142113222" class="anchor"><span id="_Toc142114250" class="anchor"><span id="_Toc142729410" class="anchor"><span id="_Toc142730694" class="anchor"><span id="_Toc142731067" class="anchor"><span id="_Toc142998432" class="anchor"><span id="_Toc143063523" class="anchor"><span id="_Toc143509633" class="anchor"><span id="_Toc143510080" class="anchor"><span id="_Toc144026170" class="anchor"><span id="_Toc144026501" class="anchor"><span id="_Toc144276144" class="anchor"><span id="_Toc144276488" class="anchor"><span id="_Toc144280076" class="anchor"><span id="_Toc144280422" class="anchor"><span id="_Toc144540637" class="anchor"><span id="_Toc144554519" class="anchor"><span id="_Toc144722141" class="anchor"><span id="_Toc145503603" class="anchor"><span id="_Toc145512045" class="anchor"><span id="_Toc145513068" class="anchor"><span id="_Toc145513452" class="anchor"><span id="_Toc222907217" class="anchor"><span id="_Toc342652805" class="anchor"><span id="_Toc439857990" class="anchor"><span id="_Toc439864004" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>

<span id="_Toc437511498" class="anchor"></span>

<span id="_Toc437511500" class="anchor"></span>

1.  ### <span id="_Toc127596696" class="anchor"><span id="_Toc127786317" class="anchor"><span id="_Toc127786633" class="anchor"><span id="_Toc127786949" class="anchor"><span id="_Toc127877545" class="anchor"><span id="_Toc128289616" class="anchor"><span id="_Toc128290009" class="anchor"><span id="_Toc130189691" class="anchor"><span id="_Toc130200907" class="anchor"><span id="_Toc130201223" class="anchor"><span id="_Toc130201544" class="anchor"><span id="_Toc131936631" class="anchor"><span id="_Toc133901095" class="anchor"><span id="_Toc137460970" class="anchor"><span id="_Toc139096485" class="anchor"><span id="_Toc139188408" class="anchor"><span id="_Toc139191271" class="anchor"><span id="_Toc140490322" class="anchor"><span id="_Toc140571225" class="anchor"><span id="_Toc141257498" class="anchor"><span id="_Toc141257825" class="anchor"><span id="_Toc141267353" class="anchor"><span id="_Toc141522371" class="anchor"><span id="_Toc141529459" class="anchor"><span id="_Toc141529776" class="anchor"><span id="_Toc141851383" class="anchor"><span id="_Toc141852317" class="anchor"><span id="_Toc141887861" class="anchor"><span id="_Toc141889701" class="anchor"><span id="_Toc141893370" class="anchor"><span id="_Toc142113223" class="anchor"><span id="_Toc142114251" class="anchor"><span id="_Toc142729411" class="anchor"><span id="_Toc142730695" class="anchor"><span id="_Toc142731068" class="anchor"><span id="_Toc142998433" class="anchor"><span id="_Toc143063524" class="anchor"><span id="_Toc143509634" class="anchor"><span id="_Toc143510081" class="anchor"><span id="_Toc144026171" class="anchor"><span id="_Toc144026502" class="anchor"><span id="_Toc144276145" class="anchor"><span id="_Toc144276489" class="anchor"><span id="_Toc144280077" class="anchor"><span id="_Toc144280423" class="anchor"><span id="_Toc144540638" class="anchor"><span id="_Toc144554520" class="anchor"><span id="_Toc144722142" class="anchor"><span id="_Toc145503604" class="anchor"><span id="_Toc145512046" class="anchor"><span id="_Toc145513069" class="anchor"><span id="_Toc145513453" class="anchor"><span id="_Toc222907218" class="anchor"><span id="_Toc342652806" class="anchor"><span id="_Toc439857991" class="anchor"><span id="_Toc110172705" class="anchor"><span id="_Toc439864005" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>

    1.  #### <span id="_Toc222907219" class="anchor"><span id="_Toc342652807" class="anchor"></span></span>

  -- -- --
        
        
        
        
        
        
  -- -- --

##### <span id="_Toc222907220" class="anchor"><span id="_Toc342652808" class="anchor"></span></span>

  -- -- -- -- -- -- --
                    
  -- -- -- -- -- -- --

<span id="_Toc437511561" class="anchor"></span>

<span id="_Toc437511569" class="anchor"></span>

  -- --
     
  -- --

  -- -- --
        
  -- -- --

  -- -- -- --
           
  -- -- -- --

##### <span id="_Toc222907221" class="anchor"><span id="_Toc342652809" class="anchor"></span></span>

  -- -- --
        
  -- -- --

<span id="_Toc437511612" class="anchor"></span>

### <span id="_Ref112415905" class="anchor"><span id="_Toc127596697" class="anchor"><span id="_Toc127786318" class="anchor"><span id="_Toc127786634" class="anchor"><span id="_Toc127786950" class="anchor"><span id="_Toc127877546" class="anchor"><span id="_Toc128289617" class="anchor"><span id="_Toc128290010" class="anchor"><span id="_Toc130189692" class="anchor"><span id="_Toc130200908" class="anchor"><span id="_Toc130201224" class="anchor"><span id="_Toc130201545" class="anchor"><span id="_Toc131936632" class="anchor"><span id="_Toc133901096" class="anchor"><span id="_Toc137460971" class="anchor"><span id="_Toc139096486" class="anchor"><span id="_Toc139188409" class="anchor"><span id="_Toc139191272" class="anchor"><span id="_Toc140490323" class="anchor"><span id="_Toc140571226" class="anchor"><span id="_Toc141257499" class="anchor"><span id="_Toc141257826" class="anchor"><span id="_Toc141267354" class="anchor"><span id="_Toc141522372" class="anchor"><span id="_Toc141529460" class="anchor"><span id="_Toc141529777" class="anchor"><span id="_Toc141851384" class="anchor"><span id="_Toc141852318" class="anchor"><span id="_Toc141887862" class="anchor"><span id="_Toc141889702" class="anchor"><span id="_Toc141893371" class="anchor"><span id="_Toc142113224" class="anchor"><span id="_Toc142114252" class="anchor"><span id="_Toc142729412" class="anchor"><span id="_Toc142730696" class="anchor"><span id="_Toc142731069" class="anchor"><span id="_Toc142998434" class="anchor"><span id="_Toc143063525" class="anchor"><span id="_Toc143509635" class="anchor"><span id="_Toc143510082" class="anchor"><span id="_Toc144026172" class="anchor"><span id="_Toc144026503" class="anchor"><span id="_Toc144276146" class="anchor"><span id="_Toc144276490" class="anchor"><span id="_Toc144280078" class="anchor"><span id="_Toc144280424" class="anchor"><span id="_Toc144540639" class="anchor"><span id="_Toc144554521" class="anchor"><span id="_Toc144722143" class="anchor"><span id="_Toc145503605" class="anchor"><span id="_Toc145512047" class="anchor"><span id="_Toc145513070" class="anchor"><span id="_Toc145513454" class="anchor"><span id="_Toc222907222" class="anchor"><span id="_Toc342652810" class="anchor"><span id="_Toc439857992" class="anchor"><span id="_Toc439864006" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>

<span id="_Toc437511620" class="anchor"></span>

1.  ### <span id="_Toc127596699" class="anchor"><span id="_Toc127786320" class="anchor"><span id="_Toc127786636" class="anchor"><span id="_Toc127786952" class="anchor"><span id="_Toc127877548" class="anchor"><span id="_Toc128289619" class="anchor"><span id="_Toc128290012" class="anchor"><span id="_Toc130189694" class="anchor"><span id="_Toc130200910" class="anchor"><span id="_Toc130201226" class="anchor"><span id="_Toc130201547" class="anchor"><span id="_Toc131936634" class="anchor"><span id="_Toc133901098" class="anchor"><span id="_Toc137460973" class="anchor"><span id="_Toc139096488" class="anchor"><span id="_Toc139188411" class="anchor"><span id="_Toc139191274" class="anchor"><span id="_Toc140490325" class="anchor"><span id="_Toc140571228" class="anchor"><span id="_Toc141257501" class="anchor"><span id="_Toc141257828" class="anchor"><span id="_Toc141267356" class="anchor"><span id="_Toc141522374" class="anchor"><span id="_Toc141529462" class="anchor"><span id="_Toc141529779" class="anchor"><span id="_Toc141851386" class="anchor"><span id="_Toc141852320" class="anchor"><span id="_Toc141887864" class="anchor"><span id="_Toc141889704" class="anchor"><span id="_Toc141893373" class="anchor"><span id="_Toc142113226" class="anchor"><span id="_Toc142114254" class="anchor"><span id="_Toc142729414" class="anchor"><span id="_Toc142730698" class="anchor"><span id="_Toc142731071" class="anchor"><span id="_Toc142998436" class="anchor"><span id="_Toc143063527" class="anchor"><span id="_Toc143509637" class="anchor"><span id="_Toc143510084" class="anchor"><span id="_Toc144026174" class="anchor"><span id="_Toc144026505" class="anchor"><span id="_Toc144276148" class="anchor"><span id="_Toc144276492" class="anchor"><span id="_Toc144280080" class="anchor"><span id="_Toc144280426" class="anchor"><span id="_Toc144540641" class="anchor"><span id="_Toc144554523" class="anchor"><span id="_Toc144722145" class="anchor"><span id="_Toc145503607" class="anchor"><span id="_Toc145512049" class="anchor"><span id="_Toc145513072" class="anchor"><span id="_Toc145513456" class="anchor"><span id="_Toc222907224" class="anchor"><span id="_Toc342652811" class="anchor"><span id="_Toc439857993" class="anchor"><span id="_Toc110172706" class="anchor"><span id="_Toc439864007" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>

2.  ### <span id="_Ref159055803" class="anchor"><span id="_Toc222907225" class="anchor"><span id="_Toc342652812" class="anchor"><span id="_Toc439857994" class="anchor"><span id="_Toc439864008" class="anchor"></span></span></span></span></span>

<span id="_Toc437511625" class="anchor"></span>

<span id="_Toc437511627" class="anchor"></span>

  -- --
     
  -- --

### <span id="_Ref358820004" class="anchor"><span id="_Toc439857995" class="anchor"><span id="_Toc439864009" class="anchor"></span></span></span>

<span id="_Toc437511638" class="anchor"></span>

<span id="_Toc437511640" class="anchor"></span>

### <span id="_Ref358820031" class="anchor"><span id="_Toc439857996" class="anchor"><span id="_Toc439864010" class="anchor"></span></span></span>

<span id="_Toc437511644" class="anchor"></span>

<span id="_Toc437511646" class="anchor"></span>

1.  <span id="_Toc127596700" class="anchor"><span id="_Toc127786321" class="anchor"><span id="_Toc127786637" class="anchor"><span id="_Toc127786953" class="anchor"><span id="_Toc127877549" class="anchor"><span id="_Toc128289620" class="anchor"><span id="_Toc128290013" class="anchor"><span id="_Toc130189695" class="anchor"><span id="_Toc130200911" class="anchor"><span id="_Toc130201227" class="anchor"><span id="_Toc130201548" class="anchor"><span id="_Toc131936635" class="anchor"><span id="_Toc133901099" class="anchor"><span id="_Toc137460974" class="anchor"><span id="_Toc139096489" class="anchor"><span id="_Toc139188412" class="anchor"><span id="_Toc139191275" class="anchor"><span id="_Toc140490326" class="anchor"><span id="_Toc140571229" class="anchor"><span id="_Toc141257502" class="anchor"><span id="_Toc141257829" class="anchor"><span id="_Toc141267357" class="anchor"><span id="_Toc141522375" class="anchor"><span id="_Toc141529463" class="anchor"><span id="_Toc141529780" class="anchor"><span id="_Toc141851387" class="anchor"><span id="_Toc141852321" class="anchor"><span id="_Toc141887865" class="anchor"><span id="_Toc141889705" class="anchor"><span id="_Toc141893374" class="anchor"><span id="_Toc142113227" class="anchor"><span id="_Toc142114255" class="anchor"><span id="_Toc142729415" class="anchor"><span id="_Toc142730699" class="anchor"><span id="_Toc142731072" class="anchor"><span id="_Toc142998437" class="anchor"><span id="_Toc143063528" class="anchor"><span id="_Toc143509638" class="anchor"><span id="_Toc143510085" class="anchor"><span id="_Toc144026175" class="anchor"><span id="_Toc144026506" class="anchor"><span id="_Toc144276149" class="anchor"><span id="_Toc144276493" class="anchor"><span id="_Toc144280081" class="anchor"><span id="_Toc144280427" class="anchor"><span id="_Toc144540642" class="anchor"><span id="_Toc144554524" class="anchor"><span id="_Toc144722146" class="anchor"><span id="_Toc145503608" class="anchor"><span id="_Toc145512050" class="anchor"><span id="_Toc145513073" class="anchor"><span id="_Toc145513457" class="anchor"><span id="_Toc222907226" class="anchor"><span id="_Toc342652813" class="anchor"><span id="_Toc439857997" class="anchor"><span id="_Toc439864011" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>
    ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

    1.  ### <span id="_Toc342570712" class="anchor"><span id="_Toc342652814" class="anchor"><span id="_Toc180913373" class="anchor"><span id="_Toc181957567" class="anchor"><span id="_Toc182300898" class="anchor"><span id="_Toc182301792" class="anchor"><span id="_Toc182302686" class="anchor"><span id="_Toc182330509" class="anchor"><span id="_Toc180913374" class="anchor"><span id="_Toc181957568" class="anchor"><span id="_Toc182300899" class="anchor"><span id="_Toc182301793" class="anchor"><span id="_Toc182302687" class="anchor"><span id="_Toc182330510" class="anchor"><span id="_Toc180913375" class="anchor"><span id="_Toc181957569" class="anchor"><span id="_Toc182300900" class="anchor"><span id="_Toc182301794" class="anchor"><span id="_Toc182302688" class="anchor"><span id="_Toc182330511" class="anchor"><span id="_Toc180913376" class="anchor"><span id="_Toc181957570" class="anchor"><span id="_Toc182300901" class="anchor"><span id="_Toc182301795" class="anchor"><span id="_Toc182302689" class="anchor"><span id="_Toc182330512" class="anchor"><span id="_Toc180913377" class="anchor"><span id="_Toc181957571" class="anchor"><span id="_Toc182300902" class="anchor"><span id="_Toc182301796" class="anchor"><span id="_Toc182302690" class="anchor"><span id="_Toc182330513" class="anchor"><span id="_Toc180913378" class="anchor"><span id="_Toc181957572" class="anchor"><span id="_Toc182300903" class="anchor"><span id="_Toc182301797" class="anchor"><span id="_Toc182302691" class="anchor"><span id="_Toc182330514" class="anchor"><span id="_Toc180913379" class="anchor"><span id="_Toc181957573" class="anchor"><span id="_Toc182300904" class="anchor"><span id="_Toc182301798" class="anchor"><span id="_Toc182302692" class="anchor"><span id="_Toc182330515" class="anchor"><span id="_Toc180913380" class="anchor"><span id="_Toc181957574" class="anchor"><span id="_Toc182300905" class="anchor"><span id="_Toc182301799" class="anchor"><span id="_Toc182302693" class="anchor"><span id="_Toc182330516" class="anchor"><span id="_Toc180913381" class="anchor"><span id="_Toc181957575" class="anchor"><span id="_Toc182300906" class="anchor"><span id="_Toc182301800" class="anchor"><span id="_Toc182302694" class="anchor"><span id="_Toc182330517" class="anchor"><span id="_Toc180913382" class="anchor"><span id="_Toc181957576" class="anchor"><span id="_Toc182300907" class="anchor"><span id="_Toc182301801" class="anchor"><span id="_Toc182302695" class="anchor"><span id="_Toc182330518" class="anchor"><span id="_Toc180913383" class="anchor"><span id="_Toc181957577" class="anchor"><span id="_Toc182300908" class="anchor"><span id="_Toc182301802" class="anchor"><span id="_Toc182302696" class="anchor"><span id="_Toc182330519" class="anchor"><span id="_Toc180913384" class="anchor"><span id="_Toc181957578" class="anchor"><span id="_Toc182300909" class="anchor"><span id="_Toc182301803" class="anchor"><span id="_Toc182302697" class="anchor"><span id="_Toc182330520" class="anchor"><span id="_Toc180913387" class="anchor"><span id="_Toc181957581" class="anchor"><span id="_Toc182300912" class="anchor"><span id="_Toc182301806" class="anchor"><span id="_Toc182302700" class="anchor"><span id="_Toc182330523" class="anchor"><span id="_Toc180913396" class="anchor"><span id="_Toc181957590" class="anchor"><span id="_Toc182300921" class="anchor"><span id="_Toc182301815" class="anchor"><span id="_Toc182302709" class="anchor"><span id="_Toc182330532" class="anchor"><span id="_Toc180913397" class="anchor"><span id="_Toc181957591" class="anchor"><span id="_Toc182300922" class="anchor"><span id="_Toc182301816" class="anchor"><span id="_Toc182302710" class="anchor"><span id="_Toc182330533" class="anchor"><span id="_Toc180913398" class="anchor"><span id="_Toc181957592" class="anchor"><span id="_Toc182300923" class="anchor"><span id="_Toc182301817" class="anchor"><span id="_Toc182302711" class="anchor"><span id="_Toc182330534" class="anchor"><span id="_Toc180913399" class="anchor"><span id="_Toc181957593" class="anchor"><span id="_Toc182300924" class="anchor"><span id="_Toc182301818" class="anchor"><span id="_Toc182302712" class="anchor"><span id="_Toc182330535" class="anchor"><span id="_Toc180913400" class="anchor"><span id="_Toc181957594" class="anchor"><span id="_Toc182300925" class="anchor"><span id="_Toc182301819" class="anchor"><span id="_Toc182302713" class="anchor"><span id="_Toc182330536" class="anchor"><span id="_Toc180913401" class="anchor"><span id="_Toc181957595" class="anchor"><span id="_Toc182300926" class="anchor"><span id="_Toc182301820" class="anchor"><span id="_Toc182302714" class="anchor"><span id="_Toc182330537" class="anchor"><span id="_Toc180913402" class="anchor"><span id="_Toc181957596" class="anchor"><span id="_Toc182300927" class="anchor"><span id="_Toc182301821" class="anchor"><span id="_Toc182302715" class="anchor"><span id="_Toc182330538" class="anchor"><span id="_Toc180913403" class="anchor"><span id="_Toc181957597" class="anchor"><span id="_Toc182300928" class="anchor"><span id="_Toc182301822" class="anchor"><span id="_Toc182302716" class="anchor"><span id="_Toc182330539" class="anchor"><span id="_Toc180913404" class="anchor"><span id="_Toc181957598" class="anchor"><span id="_Toc182300929" class="anchor"><span id="_Toc182301823" class="anchor"><span id="_Toc182302717" class="anchor"><span id="_Toc182330540" class="anchor"><span id="_Toc180913405" class="anchor"><span id="_Toc181957599" class="anchor"><span id="_Toc182300930" class="anchor"><span id="_Toc182301824" class="anchor"><span id="_Toc182302718" class="anchor"><span id="_Toc182330541" class="anchor"><span id="_Toc180913406" class="anchor"><span id="_Toc181957600" class="anchor"><span id="_Toc182300931" class="anchor"><span id="_Toc182301825" class="anchor"><span id="_Toc182302719" class="anchor"><span id="_Toc182330542" class="anchor"><span id="_Toc180913407" class="anchor"><span id="_Toc181957601" class="anchor"><span id="_Toc182300932" class="anchor"><span id="_Toc182301826" class="anchor"><span id="_Toc182302720" class="anchor"><span id="_Toc182330543" class="anchor"><span id="_Toc180913408" class="anchor"><span id="_Toc181957602" class="anchor"><span id="_Toc182300933" class="anchor"><span id="_Toc182301827" class="anchor"><span id="_Toc182302721" class="anchor"><span id="_Toc182330544" class="anchor"><span id="_Toc180913409" class="anchor"><span id="_Toc181957603" class="anchor"><span id="_Toc182300934" class="anchor"><span id="_Toc182301828" class="anchor"><span id="_Toc182302722" class="anchor"><span id="_Toc182330545" class="anchor"><span id="_Toc180913410" class="anchor"><span id="_Toc181957604" class="anchor"><span id="_Toc182300935" class="anchor"><span id="_Toc182301829" class="anchor"><span id="_Toc182302723" class="anchor"><span id="_Toc182330546" class="anchor"><span id="_Toc127596704" class="anchor"><span id="_Toc127786325" class="anchor"><span id="_Toc127786641" class="anchor"><span id="_Toc127786957" class="anchor"><span id="_Toc127877553" class="anchor"><span id="_Toc128289624" class="anchor"><span id="_Toc128290017" class="anchor"><span id="_Toc130189699" class="anchor"><span id="_Toc130200915" class="anchor"><span id="_Toc130201231" class="anchor"><span id="_Toc130201552" class="anchor"><span id="_Toc131936639" class="anchor"><span id="_Toc133901103" class="anchor"><span id="_Toc137460978" class="anchor"><span id="_Toc139096493" class="anchor"><span id="_Toc139188416" class="anchor"><span id="_Toc139191279" class="anchor"><span id="_Ref140489251" class="anchor"><span id="_Toc140490330" class="anchor"><span id="_Toc140571233" class="anchor"><span id="_Toc141257506" class="anchor"><span id="_Toc141257833" class="anchor"><span id="_Toc141267361" class="anchor"><span id="_Toc141522379" class="anchor"><span id="_Toc141529467" class="anchor"><span id="_Toc141529784" class="anchor"><span id="_Toc141851391" class="anchor"><span id="_Toc141852325" class="anchor"><span id="_Toc141887869" class="anchor"><span id="_Toc141889709" class="anchor"><span id="_Toc141893378" class="anchor"><span id="_Toc142113231" class="anchor"><span id="_Toc142114259" class="anchor"><span id="_Toc142729419" class="anchor"><span id="_Toc142730703" class="anchor"><span id="_Toc142731076" class="anchor"><span id="_Toc142998441" class="anchor"><span id="_Toc143063532" class="anchor"><span id="_Toc143509642" class="anchor"><span id="_Toc143510089" class="anchor"><span id="_Toc144026179" class="anchor"><span id="_Toc144026510" class="anchor"><span id="_Toc144276153" class="anchor"><span id="_Toc144276497" class="anchor"><span id="_Toc144280085" class="anchor"><span id="_Toc144280431" class="anchor"><span id="_Toc144540646" class="anchor"><span id="_Toc144554528" class="anchor"><span id="_Toc144722150" class="anchor"><span id="_Toc145503612" class="anchor"><span id="_Toc145512054" class="anchor"><span id="_Toc145513077" class="anchor"><span id="_Toc145513461" class="anchor"><span id="_Toc222907229" class="anchor"><span id="_Toc342652815" class="anchor"><span id="_Toc439857998" class="anchor"><span id="_Toc439864012" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>

<span id="_Toc437511652" class="anchor"></span>

<span id="_Toc437511660" class="anchor"></span>

  ------------------------------------------------- --
  <span id="_Toc437511664" class="anchor"></span>
  ------------------------------------------------- --

-   

  -- --
     
  -- --

### <span id="i" class="anchor"><span id="_Toc342652816" class="anchor"><span id="_Toc439857999" class="anchor"><span id="_Toc439864013" class="anchor"></span></span></span></span>

<span id="_Toc437511703" class="anchor"></span>

<span id="_Toc437511708" class="anchor"></span>

  ------------------------------------------------- -- -------------------------------------------------
  <span id="_Toc437511712" class="anchor"></span>
  ------------------------------------------------- -- -------------------------------------------------

-   

  -- --
     
  -- --

### <span id="_Toc342570715" class="anchor"><span id="_Toc342652817" class="anchor"><span id="_Toc342652818" class="anchor"><span id="_Toc439858000" class="anchor"><span id="_Toc439864014" class="anchor"></span></span></span></span></span>

<span id="_Toc437511739" class="anchor"></span>

<span id="_Toc437511745" class="anchor"></span>

  ------------------------------------------------- -- -------------------------------------------------
  <span id="_Toc437511749" class="anchor"></span>
  ------------------------------------------------- -- -------------------------------------------------

  -- --
     
     
     
     
     
     
     
     
     
     
     
     
     
  -- --

### <span id="_Toc342652819" class="anchor"><span id="_Toc439858001" class="anchor"><span id="_Toc439864015" class="anchor"></span></span></span>

<span id="_Toc437511857" class="anchor"></span>

<span id="_Toc437511862" class="anchor"></span>

  ------------------------------------------------- -- -------------------------------------------------
  <span id="_Toc437511866" class="anchor"></span>
  ------------------------------------------------- -- -------------------------------------------------

  -- --
     
     
     
     
     
     
     
  -- --

### <span id="_Toc342652820" class="anchor"><span id="_Toc439858002" class="anchor"><span id="_Toc439864016" class="anchor"></span></span></span>

<span id="_Toc437511916" class="anchor"></span>

<span id="_Toc437511922" class="anchor"></span>

  ------------------------------------------------- -- -------------------------------------------------
  <span id="_Toc437511926" class="anchor"></span>
  ------------------------------------------------- -- -------------------------------------------------

  -- --
     
  -- --

### <span id="_Toc342570719" class="anchor"><span id="_Toc342652821" class="anchor"><span id="_Toc342652822" class="anchor"><span id="_Toc439858003" class="anchor"><span id="_Toc439864017" class="anchor"></span></span></span></span></span>

##### 

<span id="_Toc437511964" class="anchor"></span>

<span id="_Toc437511969" class="anchor"></span>

##### 

  ------------------------------------------------- -- -------------------------------------------------
  <span id="_Toc437511973" class="anchor"></span>
  ------------------------------------------------- -- -------------------------------------------------

##### 

  -- --
     
     
     
  -- --

### <span id="_Toc342652826" class="anchor"><span id="_Toc439858004" class="anchor"><span id="_Toc439864018" class="anchor"></span></span></span>

##### 

<span id="_Toc437512016" class="anchor"></span>

<span id="_Toc437512022" class="anchor"></span>

##### 

  ------------------------------------------------- -- -------------------------------------------------
  <span id="_Toc437512026" class="anchor"></span>
  ------------------------------------------------- -- -------------------------------------------------

##### 

  -- --
     
     
     
  -- --

### <span id="_Toc342652830" class="anchor"><span id="_Toc439858005" class="anchor"><span id="_Toc439864019" class="anchor"></span></span></span>

##### 

<span id="_Toc437512066" class="anchor"></span>

<span id="_Toc437512072" class="anchor"></span>

##### 

  ------------------------------------------------- -- -------------------------------------------------
  <span id="_Toc437512076" class="anchor"></span>
  ------------------------------------------------- -- -------------------------------------------------

##### 

  -- --
     
     
     
     
     
     
     
     
     
  -- --

### <span id="_Toc342652834" class="anchor"><span id="_Toc439858006" class="anchor"><span id="_Toc439864020" class="anchor"></span></span></span>

<span id="_Toc437512146" class="anchor"></span>

<span id="_Toc437512148" class="anchor"></span>

<span id="_Toc437512154" class="anchor"></span>

  ------------------------------------------------- -- -------------------------------------------------
  <span id="_Toc437512158" class="anchor"></span>
  ------------------------------------------------- -- -------------------------------------------------

  -- --
     
     
     
     
     
     
     
  -- --

### <span id="_Toc342652835" class="anchor"><span id="_Toc439858007" class="anchor"><span id="_Toc439864021" class="anchor"></span></span></span>

<span id="_Toc437512209" class="anchor"></span>

<span id="_Toc437512215" class="anchor"></span>

  ------------------------------------------------- -- -------------------------------------------------
  <span id="_Toc437512219" class="anchor"></span>
  ------------------------------------------------- -- -------------------------------------------------

  -- --
     
     
     
     
     
     
     
     
     
     
  -- --

### <span id="_Toc342652836" class="anchor"><span id="_Toc439858008" class="anchor"><span id="_Toc439864022" class="anchor"></span></span></span>

<span id="_Toc437512278" class="anchor"></span>

<span id="_Toc437512284" class="anchor"></span>

  ------------------------------------------------- -- -------------------------------------------------
  <span id="_Toc437512288" class="anchor"></span>
  ------------------------------------------------- -- -------------------------------------------------

  -- --
     
     
     
     
     
  -- --

### <span id="_Toc342652837" class="anchor"><span id="_Toc439858009" class="anchor"><span id="_Toc439864023" class="anchor"></span></span></span>

<span id="_Toc437512332" class="anchor"></span>

<span id="_Toc437512338" class="anchor"></span>

  ------------------------------------------------- -- -------------------------------------------------
  <span id="_Toc437512342" class="anchor"></span>
  ------------------------------------------------- -- -------------------------------------------------

<span id="_Toc437512357" class="anchor"></span>

-   

  -- --
     
     
     
  -- --

### <span id="_Toc342652838" class="anchor"><span id="_Toc439858010" class="anchor"><span id="_Toc439864024" class="anchor"></span></span></span>

<span id="_Toc437512383" class="anchor"></span>

<span id="_Toc437512389" class="anchor"></span>

  ------------------------------------------------- -- -------------------------------------------------
  <span id="_Toc437512393" class="anchor"></span>
  ------------------------------------------------- -- -------------------------------------------------

<span id="_Toc437512408" class="anchor"></span>

-   

  -- --
     
     
     
  -- --

### <span id="_Toc342652839" class="anchor"><span id="_Toc439858011" class="anchor"><span id="_Toc439864025" class="anchor"></span></span></span>

<span id="_Toc437512434" class="anchor"></span>

<span id="_Toc437512440" class="anchor"></span>

  ------------------------------------------------- -- -------------------------------------------------
  <span id="_Toc437512444" class="anchor"></span>
  ------------------------------------------------- -- -------------------------------------------------

<span id="_Toc437512459" class="anchor"></span>

-   

  -- --
     
     
     
  -- --

### <span id="_Toc342652840" class="anchor"><span id="_Toc439858012" class="anchor"><span id="_Toc439864026" class="anchor"></span></span></span>

<span id="_Toc437512485" class="anchor"></span>

<span id="_Toc437512491" class="anchor"></span>

  ------------------------------------------------- -- -------------------------------------------------
  <span id="_Toc437512495" class="anchor"></span>
  ------------------------------------------------- -- -------------------------------------------------

<span id="_Toc437512510" class="anchor"></span>

-   

  -- --
     
     
  -- --

1.  <span id="_Toc127596705" class="anchor"><span id="_Toc127786326" class="anchor"><span id="_Toc127786642" class="anchor"><span id="_Toc127786958" class="anchor"><span id="_Toc127877554" class="anchor"><span id="_Toc128289625" class="anchor"><span id="_Toc128290018" class="anchor"><span id="_Toc130189700" class="anchor"><span id="_Toc130200916" class="anchor"><span id="_Toc130201232" class="anchor"><span id="_Toc130201553" class="anchor"><span id="_Ref130796417" class="anchor"><span id="_Toc131936640" class="anchor"><span id="_Toc133901104" class="anchor"><span id="_Toc137460979" class="anchor"><span id="_Toc139096494" class="anchor"><span id="_Toc139188417" class="anchor"><span id="_Toc139191280" class="anchor"><span id="_Toc140490331" class="anchor"><span id="_Toc140571234" class="anchor"><span id="_Toc141257507" class="anchor"><span id="_Toc141257834" class="anchor"><span id="_Toc141267362" class="anchor"><span id="_Toc141522380" class="anchor"><span id="_Toc141529468" class="anchor"><span id="_Toc141529785" class="anchor"><span id="_Toc141851392" class="anchor"><span id="_Toc141852326" class="anchor"><span id="_Toc141887870" class="anchor"><span id="_Toc141889710" class="anchor"><span id="_Toc141893379" class="anchor"><span id="_Toc142113232" class="anchor"><span id="_Toc142114260" class="anchor"><span id="_Toc142729420" class="anchor"><span id="_Toc142730704" class="anchor"><span id="_Toc142731077" class="anchor"><span id="_Toc142998442" class="anchor"><span id="_Toc143063533" class="anchor"><span id="_Toc143509643" class="anchor"><span id="_Toc143510090" class="anchor"><span id="_Toc144026180" class="anchor"><span id="_Toc144026511" class="anchor"><span id="_Toc144276154" class="anchor"><span id="_Toc144276498" class="anchor"><span id="_Toc144280086" class="anchor"><span id="_Toc144280432" class="anchor"><span id="_Toc144540647" class="anchor"><span id="_Toc144554529" class="anchor"><span id="_Toc144722151" class="anchor"><span id="_Toc145503613" class="anchor"><span id="_Toc145512055" class="anchor"><span id="_Toc145513078" class="anchor"><span id="_Toc145513462" class="anchor"><span id="_Toc222907231" class="anchor"><span id="_Toc342652841" class="anchor"><span id="_Toc439864027" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Resource Management
    ===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================

    1.  <span id="_Toc110172715" class="anchor"><span id="_Toc127596706" class="anchor"><span id="_Toc127786327" class="anchor"><span id="_Toc127786643" class="anchor"><span id="_Toc127786959" class="anchor"><span id="_Toc127877555" class="anchor"><span id="_Toc128289626" class="anchor"><span id="_Toc128290019" class="anchor"><span id="_Toc130189701" class="anchor"><span id="_Toc130200917" class="anchor"><span id="_Toc130201233" class="anchor"><span id="_Toc130201554" class="anchor"><span id="_Toc131936641" class="anchor"><span id="_Toc133901105" class="anchor"><span id="_Toc137460980" class="anchor"><span id="_Toc139096495" class="anchor"><span id="_Toc139188418" class="anchor"><span id="_Toc139191281" class="anchor"><span id="_Toc140490332" class="anchor"><span id="_Toc140571235" class="anchor"><span id="_Toc141257508" class="anchor"><span id="_Toc141257835" class="anchor"><span id="_Toc141267363" class="anchor"><span id="_Toc141522381" class="anchor"><span id="_Toc141529469" class="anchor"><span id="_Toc141529786" class="anchor"><span id="_Toc141851393" class="anchor"><span id="_Toc141852327" class="anchor"><span id="_Toc141887871" class="anchor"><span id="_Toc141889711" class="anchor"><span id="_Toc141893380" class="anchor"><span id="_Toc142113233" class="anchor"><span id="_Toc142114261" class="anchor"><span id="_Toc142729421" class="anchor"><span id="_Toc142730705" class="anchor"><span id="_Toc142731078" class="anchor"><span id="_Toc142998443" class="anchor"><span id="_Toc143063534" class="anchor"><span id="_Toc143509644" class="anchor"><span id="_Toc143510091" class="anchor"><span id="_Toc144026181" class="anchor"><span id="_Toc144026512" class="anchor"><span id="_Toc144276155" class="anchor"><span id="_Toc144276499" class="anchor"><span id="_Toc144280087" class="anchor"><span id="_Toc144280433" class="anchor"><span id="_Toc144540648" class="anchor"><span id="_Toc144554530" class="anchor"><span id="_Toc144722152" class="anchor"><span id="_Toc145503614" class="anchor"><span id="_Toc145512056" class="anchor"><span id="_Toc145513079" class="anchor"><span id="_Toc145513463" class="anchor"><span id="_Toc222907232" class="anchor"><span id="_Toc342652842" class="anchor"><span id="_Toc439864028" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Overview
        ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

One of the design goals of the hypervisor is to provide availability
guarantees to guests. For example, multiple servers that have been
consolidated onto a single physical machine should not be able to
prevent each other from making progress. It should be possible to run a
partition that provides telephony or DVR support such that this
partition continues to function irrespective of the potentially
adversarial actions of other partitions. This section addresses only the
memory management aspects of this problem and only as far as the
hypervisor is involved.

In accordance with the overall microkernel architecture of the
hypervisor, support for specific resource policy types, such as quotas
or reserves, are moved from the hypervisor into guests. The hypervisor
must provide minimal support for resource management in connection with
several hypercalls that “consume" memory, where “consume" means that the
calls may need to allocate memory for internal data structures and that
this memory remains allocated beyond the duration of the call.

The resource management state affects, and is affected by, any hypercall
that needs to allocate or free memory in the hypervisor. Whether and how
a particular call interacts with the resource management state are
described as part of the specification for each call. For example, the
section on partition creation will specify from whose memory pool the
initial resources needed to set up a partition will be deducted.

### <span id="_Toc110172716" class="anchor"><span id="_Ref110236820" class="anchor"><span id="_Toc127596707" class="anchor"><span id="_Toc127786328" class="anchor"><span id="_Toc127786644" class="anchor"><span id="_Toc127786960" class="anchor"><span id="_Toc127877556" class="anchor"><span id="_Toc128289627" class="anchor"><span id="_Toc128290020" class="anchor"><span id="_Toc130189702" class="anchor"><span id="_Toc130200918" class="anchor"><span id="_Toc130201234" class="anchor"><span id="_Toc130201555" class="anchor"><span id="_Toc131936642" class="anchor"><span id="_Toc133901106" class="anchor"><span id="_Toc137460981" class="anchor"><span id="_Toc139096496" class="anchor"><span id="_Toc139188419" class="anchor"><span id="_Toc139191282" class="anchor"><span id="_Ref140302964" class="anchor"><span id="_Toc140490333" class="anchor"><span id="_Toc140571236" class="anchor"><span id="_Toc141257509" class="anchor"><span id="_Toc141257836" class="anchor"><span id="_Toc141267364" class="anchor"><span id="_Toc141522382" class="anchor"><span id="_Toc141529470" class="anchor"><span id="_Toc141529787" class="anchor"><span id="_Toc141851394" class="anchor"><span id="_Toc141852328" class="anchor"><span id="_Toc141887872" class="anchor"><span id="_Toc141889712" class="anchor"><span id="_Toc141893381" class="anchor"><span id="_Toc142113234" class="anchor"><span id="_Toc142114262" class="anchor"><span id="_Toc142729422" class="anchor"><span id="_Toc142730706" class="anchor"><span id="_Toc142731079" class="anchor"><span id="_Toc142998444" class="anchor"><span id="_Toc143063535" class="anchor"><span id="_Toc143509645" class="anchor"><span id="_Toc143510092" class="anchor"><span id="_Toc144026182" class="anchor"><span id="_Toc144026513" class="anchor"><span id="_Toc144276156" class="anchor"><span id="_Toc144276500" class="anchor"><span id="_Toc144280088" class="anchor"><span id="_Toc144280434" class="anchor"><span id="_Toc144540649" class="anchor"><span id="_Toc144554531" class="anchor"><span id="_Toc144722153" class="anchor"><span id="_Toc145503615" class="anchor"><span id="_Toc145512057" class="anchor"><span id="_Toc145513080" class="anchor"><span id="_Toc145513464" class="anchor"><span id="_Toc222907233" class="anchor"><span id="_Toc342652843" class="anchor"><span id="_Toc439864029" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Memory Pools

For each partition, the hypervisor maintains a *memory pool* of RAM SPA
pages. This pool is managed like a bank account. The number of pages in
the pool is referred to as the *balance*. Pages can be *deposited* into
or *withdrawn* from the pool.

When a partition makes a hypercall that requires memory, the hypervisor
draws the required memory from the pool. If the balance in the pool is
insufficient, the call fails. If such a hypercall is made by one guest
*on behalf of* another guest (in another partition), the hypervisor
draws the required memory from the pool of the latter partition. The
phrase “on behalf of" refers to any hypervisor call with a
HV\_PARTITION\_ID parameter. Examples of such calls are HvCreateVp and
HvMapGpaPages.

Pages within a partition’s memory pool are managed by the hypervisor.
These pages cannot be accessed through any partition’s GPA space. That
is, in all partitions’ GPA spaces, they must be inaccessible (mapped
such that no read, write or execute access is allowed). In general, the
only partition that can deposit into or withdraw from a partition is
that partition’s parent.

When a partition is created, the memory pool is initially empty. Memory
can be deposited by means of the hypercall HvDepositMemory.

-   The following invariants are maintained:All memory pool pages are
    RAM SPA pages that were previously mapped into the GPA space of the
    parent partition.

-   All pages in a partition’s memory pool must have been explicitly
    deposited into that partition’s pool; that is, memory does not
    migrate between memory pools of different partitions.

-   Pages in a partition’s memory pool cannot be accessed by any guest;
    that is, these pages are not mapped into any partition’s GPA space
    with read, write, or execute privileges.

    1.  ### <span id="_Toc342652844" class="anchor"><span id="_Ref148171596" class="anchor"><span id="_Ref148171597" class="anchor"><span id="_Ref148171598" class="anchor"><span id="_Ref148171599" class="anchor"><span id="_Ref148171600" class="anchor"><span id="_Toc222907234" class="anchor"><span id="_Toc342652845" class="anchor"><span id="_Toc130189703" class="anchor"><span id="_Toc130200919" class="anchor"><span id="_Toc130201235" class="anchor"><span id="_Toc130201556" class="anchor"><span id="_Toc131936643" class="anchor"><span id="_Toc133901107" class="anchor"><span id="_Toc137460982" class="anchor"><span id="_Toc139096497" class="anchor"><span id="_Toc139188420" class="anchor"><span id="_Toc139191283" class="anchor"><span id="_Toc140490334" class="anchor"><span id="_Toc140571237" class="anchor"><span id="_Toc141257510" class="anchor"><span id="_Toc141257837" class="anchor"><span id="_Toc141267365" class="anchor"><span id="_Toc141522383" class="anchor"><span id="_Toc141529471" class="anchor"><span id="_Toc141529788" class="anchor"><span id="_Toc141851395" class="anchor"><span id="_Toc141852329" class="anchor"><span id="_Toc141887873" class="anchor"><span id="_Toc141889713" class="anchor"><span id="_Toc141893382" class="anchor"><span id="_Toc142113235" class="anchor"><span id="_Toc142114263" class="anchor"><span id="_Toc142729423" class="anchor"><span id="_Toc142730707" class="anchor"><span id="_Toc142731080" class="anchor"><span id="_Toc142998445" class="anchor"><span id="_Toc143063536" class="anchor"><span id="_Toc143509646" class="anchor"><span id="_Toc143510093" class="anchor"><span id="_Toc144026183" class="anchor"><span id="_Toc144026514" class="anchor"><span id="_Toc144276157" class="anchor"><span id="_Toc144276501" class="anchor"><span id="_Toc144280089" class="anchor"><span id="_Toc144280435" class="anchor"><span id="_Toc144540650" class="anchor"><span id="_Toc144554532" class="anchor"><span id="_Toc144722154" class="anchor"><span id="_Toc145503616" class="anchor"><span id="_Toc145512058" class="anchor"><span id="_Toc145513081" class="anchor"><span id="_Toc145513465" class="anchor"><span id="_Toc439864030" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>NUMA Proximity Domains

The ACPI tables include topology information for all processors and
memory present in a system at system boot. They also contain information
for memory that can be added while the system is running without
requiring a reboot. The information identifies sets of logical
processors and physical memory ranges, enabling a tight coupling between
logical processors and memory ranges. Each coupling is referred to as a
*Proximity Domain.* The latency of memory accesses by logical processors
within the same proximity domain is typically shorter than the latency
of accesses outside of the proximity domain. The root partition can
relay this affinity information to the hypervisor by selecting memory
resources or specifying the proximity domain to be used with certain
hypercalls.

1.  <span id="_Toc222907235" class="anchor"><span id="_Toc342652846" class="anchor"><span id="_Toc439858017" class="anchor"><span id="_Toc439864031" class="anchor"></span></span></span></span>
    --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

    1.  ### <span id="_Ref148171601" class="anchor"><span id="_Ref148171602" class="anchor"><span id="_Ref148171604" class="anchor"><span id="_Ref148171605" class="anchor"><span id="_Ref148171606" class="anchor"><span id="_Toc222907236" class="anchor"><span id="_Toc342652847" class="anchor"><span id="_Toc439858018" class="anchor"><span id="_Toc439864032" class="anchor"></span></span></span></span></span></span></span></span></span>

<span id="_Toc437512537" class="anchor"></span>

<span id="_Toc437512540" class="anchor"></span>

<span id="_Toc437512552" class="anchor"></span>

<span id="_Toc437512553" class="anchor"></span>

1.  <span id="_Toc222907237" class="anchor"><span id="_Toc342652848" class="anchor"><span id="_Toc439858019" class="anchor"><span id="_Toc439864033" class="anchor"></span></span></span></span>
    --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

    1.  ### <span id="_Toc110172719" class="anchor"><span id="_Toc127596709" class="anchor"><span id="_Toc127786330" class="anchor"><span id="_Toc127786646" class="anchor"><span id="_Toc127786962" class="anchor"><span id="_Toc127877558" class="anchor"><span id="_Toc128289629" class="anchor"><span id="_Toc128290022" class="anchor"><span id="_Toc130189704" class="anchor"><span id="_Toc130200920" class="anchor"><span id="_Toc130201236" class="anchor"><span id="_Toc130201557" class="anchor"><span id="_Toc131936644" class="anchor"><span id="_Toc133901108" class="anchor"><span id="_Toc137460983" class="anchor"><span id="_Toc139096498" class="anchor"><span id="_Toc139188421" class="anchor"><span id="_Toc139191284" class="anchor"><span id="_Toc140490335" class="anchor"><span id="_Toc140571238" class="anchor"><span id="_Toc141257511" class="anchor"><span id="_Toc141257838" class="anchor"><span id="_Toc141267366" class="anchor"><span id="_Toc141522384" class="anchor"><span id="_Toc141529472" class="anchor"><span id="_Toc141529789" class="anchor"><span id="_Toc141851396" class="anchor"><span id="_Toc141852330" class="anchor"><span id="_Toc141887874" class="anchor"><span id="_Toc141889714" class="anchor"><span id="_Toc141893383" class="anchor"><span id="_Toc142113236" class="anchor"><span id="_Toc142114264" class="anchor"><span id="_Toc142729424" class="anchor"><span id="_Toc142730708" class="anchor"><span id="_Toc142731081" class="anchor"><span id="_Toc142998446" class="anchor"><span id="_Toc143063537" class="anchor"><span id="_Toc143509647" class="anchor"><span id="_Toc143510094" class="anchor"><span id="_Toc144026184" class="anchor"><span id="_Toc144026515" class="anchor"><span id="_Toc144276158" class="anchor"><span id="_Toc144276502" class="anchor"><span id="_Toc144280090" class="anchor"><span id="_Toc144280436" class="anchor"><span id="_Toc144540651" class="anchor"><span id="_Toc144554533" class="anchor"><span id="_Toc144722155" class="anchor"><span id="_Toc145503617" class="anchor"><span id="_Toc145512059" class="anchor"><span id="_Toc145513082" class="anchor"><span id="_Toc145513466" class="anchor"><span id="_Toc222907238" class="anchor"><span id="_Toc342652849" class="anchor"><span id="_Toc439858020" class="anchor"><span id="_Toc439864034" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>

<span id="_Toc437512562" class="anchor"></span>

<span id="_Toc437512570" class="anchor"></span>

<span id="_Toc437512571" class="anchor"></span>

  ------------------------------------------------- --
  <span id="_Toc437512575" class="anchor"></span>
  ------------------------------------------------- --

-   -   

<!-- -->

-   -   -   -   -   

<span id="_Toc437512604" class="anchor"></span>

  ------------------------------------------------- --
                                                    
                                                    
                                                    
  <span id="_Toc437512620" class="anchor"></span>   
  <span id="_Toc437512623" class="anchor"></span>   
  <span id="_Toc437512626" class="anchor"></span>   
                                                    
                                                    
  ------------------------------------------------- --

### <span id="_Toc110172720" class="anchor"><span id="_Toc127596710" class="anchor"><span id="_Toc127786331" class="anchor"><span id="_Toc127786647" class="anchor"><span id="_Toc127786963" class="anchor"><span id="_Toc127877559" class="anchor"><span id="_Toc128289630" class="anchor"><span id="_Toc128290023" class="anchor"><span id="_Toc130189705" class="anchor"><span id="_Toc130200921" class="anchor"><span id="_Toc130201237" class="anchor"><span id="_Toc130201558" class="anchor"><span id="_Toc131936645" class="anchor"><span id="_Toc133901109" class="anchor"><span id="_Toc137460984" class="anchor"><span id="_Toc139096499" class="anchor"><span id="_Toc139188422" class="anchor"><span id="_Toc139191285" class="anchor"><span id="_Toc140490336" class="anchor"><span id="_Toc140571239" class="anchor"><span id="_Toc141257512" class="anchor"><span id="_Toc141257839" class="anchor"><span id="_Toc141267367" class="anchor"><span id="_Toc141522385" class="anchor"><span id="_Toc141529473" class="anchor"><span id="_Toc141529790" class="anchor"><span id="_Toc141851397" class="anchor"><span id="_Toc141852331" class="anchor"><span id="_Toc141887875" class="anchor"><span id="_Toc141889715" class="anchor"><span id="_Toc141893384" class="anchor"><span id="_Toc142113237" class="anchor"><span id="_Toc142114265" class="anchor"><span id="_Toc142729425" class="anchor"><span id="_Toc142730709" class="anchor"><span id="_Toc142731082" class="anchor"><span id="_Toc142998447" class="anchor"><span id="_Toc143063538" class="anchor"><span id="_Toc143509648" class="anchor"><span id="_Toc143510095" class="anchor"><span id="_Toc144026185" class="anchor"><span id="_Toc144026516" class="anchor"><span id="_Toc144276159" class="anchor"><span id="_Toc144276503" class="anchor"><span id="_Toc144280091" class="anchor"><span id="_Toc144280437" class="anchor"><span id="_Toc144540652" class="anchor"><span id="_Toc144554534" class="anchor"><span id="_Toc144722156" class="anchor"><span id="_Toc145503618" class="anchor"><span id="_Toc145512060" class="anchor"><span id="_Toc145513083" class="anchor"><span id="_Toc145513467" class="anchor"><span id="_Toc222907239" class="anchor"><span id="_Toc342652850" class="anchor"><span id="_Toc439858021" class="anchor"><span id="_Toc439864035" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>

<span id="_Toc437512638" class="anchor"></span>

<span id="_Toc437512647" class="anchor"></span>

  ------------------------------------------------- --
  <span id="_Toc437512651" class="anchor"></span>
  ------------------------------------------------- --

-   -   

  -- --
     
     
     
     
  -- --

### <span id="_Toc106181445" class="anchor"><span id="_Toc106422491" class="anchor"><span id="_Toc106525886" class="anchor"><span id="_Toc106181446" class="anchor"><span id="_Toc106422492" class="anchor"><span id="_Toc106525887" class="anchor"><span id="_Toc106181450" class="anchor"><span id="_Toc106422496" class="anchor"><span id="_Toc106525891" class="anchor"><span id="_Toc106181452" class="anchor"><span id="_Toc106422498" class="anchor"><span id="_Toc106525893" class="anchor"><span id="_Toc106181454" class="anchor"><span id="_Toc106422500" class="anchor"><span id="_Toc106525895" class="anchor"><span id="_Toc110172721" class="anchor"><span id="_Toc127596711" class="anchor"><span id="_Toc127786332" class="anchor"><span id="_Toc127786648" class="anchor"><span id="_Toc127786964" class="anchor"><span id="_Toc127877560" class="anchor"><span id="_Toc128289631" class="anchor"><span id="_Toc128290024" class="anchor"><span id="_Toc130189706" class="anchor"><span id="_Toc130200922" class="anchor"><span id="_Toc130201238" class="anchor"><span id="_Toc130201559" class="anchor"><span id="_Toc131936646" class="anchor"><span id="_Toc133901110" class="anchor"><span id="_Toc137460985" class="anchor"><span id="_Toc139096500" class="anchor"><span id="_Toc139188423" class="anchor"><span id="_Toc139191286" class="anchor"><span id="_Toc140490337" class="anchor"><span id="_Toc140571240" class="anchor"><span id="_Toc141257513" class="anchor"><span id="_Toc141257840" class="anchor"><span id="_Toc141267368" class="anchor"><span id="_Toc141522386" class="anchor"><span id="_Toc141529474" class="anchor"><span id="_Toc141529791" class="anchor"><span id="_Toc141851398" class="anchor"><span id="_Toc141852332" class="anchor"><span id="_Toc141887876" class="anchor"><span id="_Toc141889716" class="anchor"><span id="_Toc141893385" class="anchor"><span id="_Toc142113238" class="anchor"><span id="_Toc142114266" class="anchor"><span id="_Toc142729426" class="anchor"><span id="_Toc142730710" class="anchor"><span id="_Toc142731083" class="anchor"><span id="_Toc142998448" class="anchor"><span id="_Toc143063539" class="anchor"><span id="_Toc143509649" class="anchor"><span id="_Toc143510096" class="anchor"><span id="_Toc144026186" class="anchor"><span id="_Toc144026517" class="anchor"><span id="_Toc144276160" class="anchor"><span id="_Toc144276504" class="anchor"><span id="_Toc144280092" class="anchor"><span id="_Toc144280438" class="anchor"><span id="_Toc144540653" class="anchor"><span id="_Toc144554535" class="anchor"><span id="_Toc144722157" class="anchor"><span id="_Toc145503619" class="anchor"><span id="_Toc145512061" class="anchor"><span id="_Toc145513084" class="anchor"><span id="_Toc145513468" class="anchor"><span id="_Toc222907240" class="anchor"><span id="_Toc342652851" class="anchor"><span id="_Toc439858022" class="anchor"><span id="_Toc439864036" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>

<span id="_Toc437512699" class="anchor"></span>

<span id="_Toc437512707" class="anchor"></span>

  ------------------------------------------------- --
  <span id="_Toc437512711" class="anchor"></span>
  ------------------------------------------------- --

  -- --
     
     
  -- --

1.  <span id="_Toc127596712" class="anchor"><span id="_Toc127786333" class="anchor"><span id="_Toc127786649" class="anchor"><span id="_Toc127786965" class="anchor"><span id="_Toc127877561" class="anchor"><span id="_Toc128289632" class="anchor"><span id="_Toc128290025" class="anchor"><span id="_Toc130189707" class="anchor"><span id="_Toc130200923" class="anchor"><span id="_Toc130201239" class="anchor"><span id="_Toc130201560" class="anchor"><span id="_Ref130796367" class="anchor"><span id="_Toc131936647" class="anchor"><span id="_Toc133901111" class="anchor"><span id="_Toc137460986" class="anchor"><span id="_Toc139096501" class="anchor"><span id="_Toc139188424" class="anchor"><span id="_Toc139191287" class="anchor"><span id="_Toc140490338" class="anchor"><span id="_Toc140571241" class="anchor"><span id="_Toc141257514" class="anchor"><span id="_Toc141257841" class="anchor"><span id="_Toc141267369" class="anchor"><span id="_Toc141522387" class="anchor"><span id="_Toc141529475" class="anchor"><span id="_Toc141529792" class="anchor"><span id="_Toc141851399" class="anchor"><span id="_Toc141852333" class="anchor"><span id="_Toc141887877" class="anchor"><span id="_Toc141889717" class="anchor"><span id="_Toc141893386" class="anchor"><span id="_Toc142113239" class="anchor"><span id="_Toc142114267" class="anchor"><span id="_Toc142729427" class="anchor"><span id="_Toc142730711" class="anchor"><span id="_Toc142731084" class="anchor"><span id="_Toc142998449" class="anchor"><span id="_Toc143063540" class="anchor"><span id="_Toc143509650" class="anchor"><span id="_Toc143510097" class="anchor"><span id="_Toc144026187" class="anchor"><span id="_Toc144026518" class="anchor"><span id="_Toc144276161" class="anchor"><span id="_Toc144276505" class="anchor"><span id="_Toc144280093" class="anchor"><span id="_Toc144280439" class="anchor"><span id="_Toc144540654" class="anchor"><span id="_Toc144554536" class="anchor"><span id="_Toc144722158" class="anchor"><span id="_Toc145503620" class="anchor"><span id="_Toc145512062" class="anchor"><span id="_Toc145513085" class="anchor"><span id="_Toc145513469" class="anchor"><span id="_Toc222907241" class="anchor"><span id="_Toc342652852" class="anchor"><span id="_Toc439864037" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Guest Physical Address Spaces
    =====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================

    1.  <span id="_Toc110172738" class="anchor"><span id="_Toc127596713" class="anchor"><span id="_Toc127786334" class="anchor"><span id="_Toc127786650" class="anchor"><span id="_Toc127786966" class="anchor"><span id="_Toc127877562" class="anchor"><span id="_Toc128289633" class="anchor"><span id="_Toc128290026" class="anchor"><span id="_Toc130189708" class="anchor"><span id="_Toc130200924" class="anchor"><span id="_Toc130201240" class="anchor"><span id="_Toc130201561" class="anchor"><span id="_Toc131936648" class="anchor"><span id="_Toc133901112" class="anchor"><span id="_Toc137460987" class="anchor"><span id="_Toc139096502" class="anchor"><span id="_Toc139188425" class="anchor"><span id="_Toc139191288" class="anchor"><span id="_Toc140490339" class="anchor"><span id="_Toc140571242" class="anchor"><span id="_Toc141257515" class="anchor"><span id="_Toc141257842" class="anchor"><span id="_Toc141267370" class="anchor"><span id="_Toc141522388" class="anchor"><span id="_Toc141529476" class="anchor"><span id="_Toc141529793" class="anchor"><span id="_Toc141851400" class="anchor"><span id="_Toc141852334" class="anchor"><span id="_Toc141887878" class="anchor"><span id="_Toc141889718" class="anchor"><span id="_Toc141893387" class="anchor"><span id="_Toc142113240" class="anchor"><span id="_Toc142114268" class="anchor"><span id="_Toc142729428" class="anchor"><span id="_Toc142730712" class="anchor"><span id="_Toc142731085" class="anchor"><span id="_Toc142998450" class="anchor"><span id="_Toc143063541" class="anchor"><span id="_Toc143509651" class="anchor"><span id="_Toc143510098" class="anchor"><span id="_Toc144026188" class="anchor"><span id="_Toc144026519" class="anchor"><span id="_Toc144276162" class="anchor"><span id="_Toc144276506" class="anchor"><span id="_Toc144280094" class="anchor"><span id="_Toc144280440" class="anchor"><span id="_Toc144540655" class="anchor"><span id="_Toc144554537" class="anchor"><span id="_Toc144722159" class="anchor"><span id="_Toc145503621" class="anchor"><span id="_Toc145512063" class="anchor"><span id="_Toc145513086" class="anchor"><span id="_Toc145513470" class="anchor"><span id="_Toc222907242" class="anchor"><span id="_Toc342652853" class="anchor"><span id="_Toc439864038" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Overview
        ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

        1.  ### <span id="_Toc110172739" class="anchor"><span id="_Toc127596714" class="anchor"><span id="_Toc127786335" class="anchor"><span id="_Toc127786651" class="anchor"><span id="_Toc127786967" class="anchor"><span id="_Toc127877563" class="anchor"><span id="_Toc128289634" class="anchor"><span id="_Toc128290027" class="anchor"><span id="_Toc130189709" class="anchor"><span id="_Toc130200925" class="anchor"><span id="_Toc130201241" class="anchor"><span id="_Toc130201562" class="anchor"><span id="_Toc131936649" class="anchor"><span id="_Toc133901113" class="anchor"><span id="_Toc137460988" class="anchor"><span id="_Toc139096503" class="anchor"><span id="_Toc139188426" class="anchor"><span id="_Toc139191289" class="anchor"><span id="_Toc140490340" class="anchor"><span id="_Toc140571243" class="anchor"><span id="_Toc141257516" class="anchor"><span id="_Toc141257843" class="anchor"><span id="_Toc141267371" class="anchor"><span id="_Toc141522389" class="anchor"><span id="_Toc141529477" class="anchor"><span id="_Toc141529794" class="anchor"><span id="_Toc141851401" class="anchor"><span id="_Toc141852335" class="anchor"><span id="_Toc141887879" class="anchor"><span id="_Toc141889719" class="anchor"><span id="_Toc141893388" class="anchor"><span id="_Toc142113241" class="anchor"><span id="_Toc142114269" class="anchor"><span id="_Toc142729429" class="anchor"><span id="_Toc142730713" class="anchor"><span id="_Toc142731086" class="anchor"><span id="_Toc142998451" class="anchor"><span id="_Toc143063542" class="anchor"><span id="_Toc143509652" class="anchor"><span id="_Toc143510099" class="anchor"><span id="_Toc144026189" class="anchor"><span id="_Toc144026520" class="anchor"><span id="_Toc144276163" class="anchor"><span id="_Toc144276507" class="anchor"><span id="_Toc144280095" class="anchor"><span id="_Toc144280441" class="anchor"><span id="_Toc144540656" class="anchor"><span id="_Toc144554538" class="anchor"><span id="_Toc144722160" class="anchor"><span id="_Toc145503622" class="anchor"><span id="_Toc145512064" class="anchor"><span id="_Toc145513087" class="anchor"><span id="_Toc145513471" class="anchor"><span id="_Toc222907243" class="anchor"><span id="_Toc342652854" class="anchor"><span id="_Toc439864039" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>GPA Space

The size of the GPA space for a partition is the range from 0 to some
maximum address that depends on architectural attributes of the virtual
machine exposed by the partition.

-   Each page within a GPA space is in one of three states:*Mapped*: A
    mapped GPA page is associated with a RAM SPA page.

    -   *Inaccessible:* An inaccessible GPA page may not be read,
        written, or executed by the partition.

    -   *Unmapped*: An unmapped GPA page is not associated with a RAM
        SPA page.

-   For the root partition:Its GPA space is identity-mapped—that is, all
    mapped GPA pages map directly to the SPA page with the same address.

-   The GPA mappings are defined by the hypervisor at boot time or when
    SPA RAM ranges are added or removed. All valid SPA RAM pages are
    therefore always mapped within the root partition’s GPA space. The
    root partition is not allowed to unmap these. The root partition
    may, however, modify its access rights to its mapped pages.

-   Unmapped GPA pages within the root partition’s GPA space (that is,
    SPA pages that are not part of known SPA RAM ranges) can be accessed
    by the root partition. This allows the partition to access
    memory-mapped registers, video memory buffers and so on. Some
    unmapped pages are off limits even to the root partition. These
    include SPA pages that correspond to hardware resources that must be
    managed by the hypervisor for correct operation. For example, the
    hypervisor does not allow the root partition to directly access the
    local APIC’s memory-mapped registers.

-   <span id="_Ref117773355" class="anchor"><span id="_Ref119464279"
    class="anchor"></span></span>For non-root partitions:Its GPA
    mappings are not necessarily identity-mapped. That is, a GPA does
    not necessarily refer to the same SPA.

-   The GPA mappings are defined by the partition’s parent. At the time
    they are mapped (through a call to HvMapGpaPages), they are
    specified in terms of the parent’s GPA space. Therefore, these pages
    must be mapped into the parent’s GPA space; however, the parent is
    not required to have read, write or execute access to these
    mapped pages.

-   When a virtual processor accesses an unmapped GPA page, the
    hypervisor suspends the virtual processor and sends a message to the
    partition’s parent. Code within the parent will typically respond by
    creating a mapping or by emulating the instruction that generated
    the memory access. In either case, it is up to the software in the
    parent partition to “unsuspend" the child’s virtual processor. For a
    detailed description of the memory access messages, see
    section 19.2.6.

    1.  ### <span id="_Ref121486495" class="anchor"><span id="_Toc127596715" class="anchor"><span id="_Toc127786336" class="anchor"><span id="_Toc127786652" class="anchor"><span id="_Toc127786968" class="anchor"><span id="_Toc127877564" class="anchor"><span id="_Toc128289635" class="anchor"><span id="_Toc128290028" class="anchor"><span id="_Toc130189710" class="anchor"><span id="_Toc130200926" class="anchor"><span id="_Toc130201242" class="anchor"><span id="_Toc130201563" class="anchor"><span id="_Toc131936650" class="anchor"><span id="_Toc133901114" class="anchor"><span id="_Toc137460989" class="anchor"><span id="_Toc139096504" class="anchor"><span id="_Toc139188427" class="anchor"><span id="_Toc139191290" class="anchor"><span id="_Toc140490341" class="anchor"><span id="_Toc140571244" class="anchor"><span id="_Toc141257517" class="anchor"><span id="_Toc141257844" class="anchor"><span id="_Toc141267372" class="anchor"><span id="_Toc141522390" class="anchor"><span id="_Toc141529478" class="anchor"><span id="_Toc141529795" class="anchor"><span id="_Toc141851402" class="anchor"><span id="_Toc141852336" class="anchor"><span id="_Toc141887880" class="anchor"><span id="_Toc141889720" class="anchor"><span id="_Toc141893389" class="anchor"><span id="_Toc142113242" class="anchor"><span id="_Toc142114270" class="anchor"><span id="_Toc142729430" class="anchor"><span id="_Toc142730714" class="anchor"><span id="_Toc142731087" class="anchor"><span id="_Toc142998452" class="anchor"><span id="_Toc143063543" class="anchor"><span id="_Toc143509653" class="anchor"><span id="_Toc143510100" class="anchor"><span id="_Toc144026190" class="anchor"><span id="_Toc144026521" class="anchor"><span id="_Toc144276164" class="anchor"><span id="_Toc144276508" class="anchor"><span id="_Toc144280096" class="anchor"><span id="_Toc144280442" class="anchor"><span id="_Toc144540657" class="anchor"><span id="_Toc144554539" class="anchor"><span id="_Toc144722161" class="anchor"><span id="_Toc145503623" class="anchor"><span id="_Toc145512065" class="anchor"><span id="_Toc145513088" class="anchor"><span id="_Toc145513472" class="anchor"><span id="_Toc222907244" class="anchor"><span id="_Toc342652855" class="anchor"><span id="_Toc439864040" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Page Access Rights

-   Mapped GPA pages have the following attributes which define the
    access rights of the partition:*Readable*: Data on the page can
    be read.

    -   *Writeable*: Data to the page can be written.

    -   *Executable*: Code on the page can be executed.

These access rights are enforced for explicit accesses performed by the
child’s virtual processors. They are also enforced for implicit reads or
writes performed by the hypervisor (for example, due to guest page table
flag updates).

Access right combinations are limited by the underlying hardware. The
following table shows the valid combinations for an x64 system.

  Access Type   Description
  ------------- ------------- ------ ----------------------------------------------------
  Read          Write
  •             •
                •
  •             
                
  •             •
                •
  •             
                

If an attempted memory access is not permitted according to the access
rights, the virtual processor that performed the access is suspended (on
an instruction boundary) and a message is sent to the parent partition.
Code within the parent will typically respond by adjusting the access
rights to allow the access or emulating the instruction that performed
the memory access. In either case, it is up to the software in the
parent partition to “unsuspend" the child’s virtual processor. For a
detailed description of the memory access messages, see section 19.2.6.

<span id="_Ref108576503" class="anchor"><span id="_Ref108576532"
class="anchor"><span id="_Toc110172741"
class="anchor"></span></span></span>Memory accesses that cross page
boundaries are handled in a manner that is consistent with the
underlying processor architecture. For x64, this means the entire access
is validated before any data exchange occurs. For example, if a
four-byte write is split across two pages and the first page is writable
but the second is not, the first two bytes are not written.

### <span id="_GPA_Overlays" class="anchor"><span id="_Ref119463930" class="anchor"><span id="_Toc127596716" class="anchor"><span id="_Toc127786337" class="anchor"><span id="_Toc127786653" class="anchor"><span id="_Toc127786969" class="anchor"><span id="_Toc127877565" class="anchor"><span id="_Toc128289636" class="anchor"><span id="_Toc128290029" class="anchor"><span id="_Toc130189711" class="anchor"><span id="_Toc130200927" class="anchor"><span id="_Toc130201243" class="anchor"><span id="_Toc130201564" class="anchor"><span id="_Toc131936651" class="anchor"><span id="_Toc133901115" class="anchor"><span id="_Toc137460990" class="anchor"><span id="_Toc139096505" class="anchor"><span id="_Toc139188428" class="anchor"><span id="_Toc139191291" class="anchor"><span id="_Toc140490342" class="anchor"><span id="_Toc140571245" class="anchor"><span id="_Toc141257518" class="anchor"><span id="_Toc141257845" class="anchor"><span id="_Toc141267373" class="anchor"><span id="_Toc141522391" class="anchor"><span id="_Toc141529479" class="anchor"><span id="_Toc141529796" class="anchor"><span id="_Toc141851403" class="anchor"><span id="_Toc141852337" class="anchor"><span id="_Toc141887881" class="anchor"><span id="_Toc141889721" class="anchor"><span id="_Toc141893390" class="anchor"><span id="_Toc142113243" class="anchor"><span id="_Toc142114271" class="anchor"><span id="_Toc142729431" class="anchor"><span id="_Toc142730715" class="anchor"><span id="_Toc142731088" class="anchor"><span id="_Toc142998453" class="anchor"><span id="_Toc143063544" class="anchor"><span id="_Toc143509654" class="anchor"><span id="_Toc143510101" class="anchor"><span id="_Toc144026191" class="anchor"><span id="_Toc144026522" class="anchor"><span id="_Toc144276165" class="anchor"><span id="_Toc144276509" class="anchor"><span id="_Toc144280097" class="anchor"><span id="_Toc144280443" class="anchor"><span id="_Toc144540658" class="anchor"><span id="_Toc144554540" class="anchor"><span id="_Toc144722162" class="anchor"><span id="_Toc145503624" class="anchor"><span id="_Toc145512066" class="anchor"><span id="_Toc145513089" class="anchor"><span id="_Toc145513473" class="anchor"><span id="_Toc222907245" class="anchor"><span id="_Toc342652856" class="anchor"><span id="_Toc439864041" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>GPA Overlay Pages

The hypervisor defines several special pages that “overlay" the guest’s
GPA space. The hypercall code page is an example of an overlay page.
Overlays are addressed by guest physical addresses but are not included
in the normal GPA map maintained internally by the hypervisor.
Conceptually, they exist in a separate map that overlays the GPA map.

If a page within the GPA space is overlaid, any SPA page mapped to the
GPA page is effectively “obscured" and generally unreachable by the
virtual processor through processor memory accesses. Furthermore, access
rights installed on the underlying GPA page are not honored when
accessing an overlay page.

If an overlay page is disabled or is moved to a new location in the GPA
space, the underlying GPA page is “uncovered", and an existing mapping
becomes accessible to the guest.

If multiple overlay pages are programmed to appear on top of each other
(for example, the guest programs the APIC to appear on top of the
hypercall page), the hypervisor will choose an ordering (which is
undefined) and only one of these overlays will be visible to code
running within the partition. In such cases, if the “top-most" overlay
is disabled or moved, another overlay page will become visible.

Parent partitions that include instruction completion logic should use
the hypercalls HvTranslateVirtualAddress, HvReadGpa, and HvWriteGpa to
emulate virtual processor memory accesses correctly in the presence of
overlays.

HvTranslateVirtualAddress returns a flag indicating whether the
specified virtual address maps to an overlay page. HvReadGpa and
HvWriteGpa perform the GPA access in the same way the specified virtual
processor would have. If an overlay page is present at the specified
address, the access is directed to that overlay page. Otherwise, the
access is directed to the underlying GPA page.

When the hypervisor performs a guest page table walk either in response
to a virtual processor memory access or a call to
HvTranslateVirtualAddress, it might find that a page table is located on
a GPA location associated with an overlay page. In this case, the
hypervisor may choose to do any one of the following: generate a guest
page fault, reference the contents of the overlay page, or reference the
contents of the underlying GPA mapping. Because this behavior can vary
from one hypervisor implementation to the next, it is strongly
recommended that guests avoid this situation.

1.  <span id="_Toc127596717" class="anchor"><span id="_Toc127786338" class="anchor"><span id="_Toc127786654" class="anchor"><span id="_Toc127786970" class="anchor"><span id="_Toc127877566" class="anchor"><span id="_Toc128289637" class="anchor"><span id="_Toc128290030" class="anchor"><span id="_Toc130189712" class="anchor"><span id="_Toc130200928" class="anchor"><span id="_Toc130201244" class="anchor"><span id="_Toc130201565" class="anchor"><span id="_Toc131936652" class="anchor"><span id="_Toc133901116" class="anchor"><span id="_Toc137460991" class="anchor"><span id="_Toc139096506" class="anchor"><span id="_Toc139188429" class="anchor"><span id="_Toc139191292" class="anchor"><span id="_Toc140490343" class="anchor"><span id="_Toc140571246" class="anchor"><span id="_Toc141257519" class="anchor"><span id="_Toc141257846" class="anchor"><span id="_Toc141267374" class="anchor"><span id="_Toc141522392" class="anchor"><span id="_Toc141529480" class="anchor"><span id="_Toc141529797" class="anchor"><span id="_Toc141851404" class="anchor"><span id="_Toc141852338" class="anchor"><span id="_Toc141887882" class="anchor"><span id="_Toc141889722" class="anchor"><span id="_Toc141893391" class="anchor"><span id="_Toc142113244" class="anchor"><span id="_Toc142114272" class="anchor"><span id="_Toc142729432" class="anchor"><span id="_Toc142730716" class="anchor"><span id="_Toc142731089" class="anchor"><span id="_Toc142998454" class="anchor"><span id="_Toc143063545" class="anchor"><span id="_Toc143509655" class="anchor"><span id="_Toc143510102" class="anchor"><span id="_Toc144026192" class="anchor"><span id="_Toc144026523" class="anchor"><span id="_Toc144276166" class="anchor"><span id="_Toc144276510" class="anchor"><span id="_Toc144280098" class="anchor"><span id="_Toc144280444" class="anchor"><span id="_Toc144540659" class="anchor"><span id="_Toc144554541" class="anchor"><span id="_Toc144722163" class="anchor"><span id="_Toc145503625" class="anchor"><span id="_Toc145512067" class="anchor"><span id="_Toc145513090" class="anchor"><span id="_Toc145513474" class="anchor"><span id="_Toc222907246" class="anchor"><span id="_Toc342652857" class="anchor"><span id="_Toc439858028" class="anchor"><span id="_Toc110172742" class="anchor"><span id="_Toc439864042" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>
    ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

2.  ### <span id="_Toc127596718" class="anchor"><span id="_Toc127786339" class="anchor"><span id="_Toc127786655" class="anchor"><span id="_Toc127786971" class="anchor"><span id="_Toc127877567" class="anchor"><span id="_Toc128289638" class="anchor"><span id="_Toc128290031" class="anchor"><span id="_Toc130189713" class="anchor"><span id="_Toc130200929" class="anchor"><span id="_Toc130201245" class="anchor"><span id="_Toc130201566" class="anchor"><span id="_Toc131936653" class="anchor"><span id="_Toc133901117" class="anchor"><span id="_Toc137460992" class="anchor"><span id="_Toc139096507" class="anchor"><span id="_Toc139188430" class="anchor"><span id="_Toc139191293" class="anchor"><span id="_Toc140490344" class="anchor"><span id="_Toc140571247" class="anchor"><span id="_Toc141257520" class="anchor"><span id="_Toc141257847" class="anchor"><span id="_Toc141267375" class="anchor"><span id="_Toc141522393" class="anchor"><span id="_Toc141529481" class="anchor"><span id="_Toc141529798" class="anchor"><span id="_Toc141851405" class="anchor"><span id="_Toc141852339" class="anchor"><span id="_Toc141887883" class="anchor"><span id="_Toc141889723" class="anchor"><span id="_Toc141893392" class="anchor"><span id="_Toc142113245" class="anchor"><span id="_Toc142114273" class="anchor"><span id="_Toc142729433" class="anchor"><span id="_Toc142730717" class="anchor"><span id="_Toc142731090" class="anchor"><span id="_Toc142998455" class="anchor"><span id="_Toc143063546" class="anchor"><span id="_Toc143509656" class="anchor"><span id="_Toc143510103" class="anchor"><span id="_Toc144026193" class="anchor"><span id="_Toc144026524" class="anchor"><span id="_Toc144276167" class="anchor"><span id="_Toc144276511" class="anchor"><span id="_Toc144280099" class="anchor"><span id="_Toc144280445" class="anchor"><span id="_Toc144540660" class="anchor"><span id="_Toc144554542" class="anchor"><span id="_Toc144722164" class="anchor"><span id="_Toc145503626" class="anchor"><span id="_Toc145512068" class="anchor"><span id="_Toc145513091" class="anchor"><span id="_Toc145513475" class="anchor"><span id="_Toc222907247" class="anchor"><span id="_Toc342652858" class="anchor"><span id="_Toc439858029" class="anchor"><span id="_Toc439864043" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>

3.  4.  5.  <span id="_Toc436731679" class="anchor"><span
    id="_Toc437512759" class="anchor"></span></span>

6.  7.  8.  9.  10. <span id="_Toc436731684" class="anchor"><span
    id="_Toc437512764" class="anchor"></span></span>

11. 12. 13. <span id="_Toc127596719" class="anchor"><span id="_Toc127786340" class="anchor"><span id="_Toc127786656" class="anchor"><span id="_Toc127786972" class="anchor"><span id="_Toc127877568" class="anchor"><span id="_Toc128289639" class="anchor"><span id="_Toc128290032" class="anchor"><span id="_Toc130189714" class="anchor"><span id="_Toc130200930" class="anchor"><span id="_Toc130201246" class="anchor"><span id="_Toc130201567" class="anchor"><span id="_Toc131936654" class="anchor"><span id="_Toc133901118" class="anchor"><span id="_Toc137460993" class="anchor"><span id="_Toc139096508" class="anchor"><span id="_Toc139188431" class="anchor"><span id="_Toc139191294" class="anchor"><span id="_Toc140490345" class="anchor"><span id="_Toc140571248" class="anchor"><span id="_Toc141257521" class="anchor"><span id="_Toc141257848" class="anchor"><span id="_Toc141267376" class="anchor"><span id="_Toc141522394" class="anchor"><span id="_Toc141529482" class="anchor"><span id="_Toc141529799" class="anchor"><span id="_Toc141851406" class="anchor"><span id="_Toc141852340" class="anchor"><span id="_Toc141887884" class="anchor"><span id="_Toc141889724" class="anchor"><span id="_Toc141893393" class="anchor"><span id="_Toc142113246" class="anchor"><span id="_Toc142114274" class="anchor"><span id="_Toc142729434" class="anchor"><span id="_Toc142730718" class="anchor"><span id="_Toc142731091" class="anchor"><span id="_Toc142998456" class="anchor"><span id="_Toc143063547" class="anchor"><span id="_Toc143509657" class="anchor"><span id="_Toc143510104" class="anchor"><span id="_Toc144026194" class="anchor"><span id="_Toc144026525" class="anchor"><span id="_Toc144276168" class="anchor"><span id="_Toc144276512" class="anchor"><span id="_Toc144280100" class="anchor"><span id="_Toc144280446" class="anchor"><span id="_Toc144540661" class="anchor"><span id="_Toc144554543" class="anchor"><span id="_Toc144722165" class="anchor"><span id="_Toc145503627" class="anchor"><span id="_Toc145512069" class="anchor"><span id="_Toc145513092" class="anchor"><span id="_Toc145513476" class="anchor"><span id="_Toc222907248" class="anchor"><span id="_Toc342652859" class="anchor"><span id="_Toc439858030" class="anchor"><span id="_Toc439864044" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>
    ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

    1.  ### <span id="_Toc110172743" class="anchor"><span id="_Toc127596720" class="anchor"><span id="_Toc127786341" class="anchor"><span id="_Toc127786657" class="anchor"><span id="_Toc127786973" class="anchor"><span id="_Toc127877569" class="anchor"><span id="_Toc128289640" class="anchor"><span id="_Toc128290033" class="anchor"><span id="_Toc130189715" class="anchor"><span id="_Toc130200931" class="anchor"><span id="_Toc130201247" class="anchor"><span id="_Toc130201568" class="anchor"><span id="_Toc131936655" class="anchor"><span id="_Toc133901119" class="anchor"><span id="_Toc137460994" class="anchor"><span id="_Toc139096509" class="anchor"><span id="_Toc139188432" class="anchor"><span id="_Toc139191295" class="anchor"><span id="_Toc140490346" class="anchor"><span id="_Toc140571249" class="anchor"><span id="_Toc141257522" class="anchor"><span id="_Toc141257849" class="anchor"><span id="_Toc141267377" class="anchor"><span id="_Toc141522395" class="anchor"><span id="_Toc141529483" class="anchor"><span id="_Toc141529800" class="anchor"><span id="_Toc141851407" class="anchor"><span id="_Toc141852341" class="anchor"><span id="_Toc141887885" class="anchor"><span id="_Toc141889725" class="anchor"><span id="_Toc141893394" class="anchor"><span id="_Toc142113247" class="anchor"><span id="_Toc142114275" class="anchor"><span id="_Toc142729435" class="anchor"><span id="_Toc142730719" class="anchor"><span id="_Toc142731092" class="anchor"><span id="_Toc142998457" class="anchor"><span id="_Toc143063548" class="anchor"><span id="_Toc143509658" class="anchor"><span id="_Toc143510105" class="anchor"><span id="_Toc144026195" class="anchor"><span id="_Toc144026526" class="anchor"><span id="_Toc144276169" class="anchor"><span id="_Toc144276513" class="anchor"><span id="_Toc144280101" class="anchor"><span id="_Toc144280447" class="anchor"><span id="_Toc144540662" class="anchor"><span id="_Toc144554544" class="anchor"><span id="_Toc144722166" class="anchor"><span id="_Toc145503628" class="anchor"><span id="_Toc145512070" class="anchor"><span id="_Toc145513093" class="anchor"><span id="_Toc145513477" class="anchor"><span id="_Toc222907249" class="anchor"><span id="_Toc342652860" class="anchor"><span id="_Toc439858031" class="anchor"><span id="_Toc439864045" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>

<span id="_Toc437512771" class="anchor"></span>

<span id="_Toc437512781" class="anchor"></span>

  ------------------------------------------------- -- --
  <span id="_Toc437512785" class="anchor"></span>
  ------------------------------------------------- -- --

-   -   -   -   -   

  ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- -------------------------------------------------
                                                                                                                                                                                                 

  <span id="_Toc437512833" class="anchor"></span>                                                                                                                                                <span id="_Toc437512837" class="anchor"></span>

                                                                                                                                                                                                 

  <span id="_Toc437512843" class="anchor"></span>                                                                                                                                                
                                                                                                                                                                                                 
  <span id="_Toc437512844" class="anchor"></span>                                                                                                                                                
                                                                                                                                                                                                 
  <span id="_Toc437512845" class="anchor"></span>                                                                                                                                                

  <span id="_Toc437512848" class="anchor"></span>                                                                                                                                                

  <span id="_Toc437512851" class="anchor"></span>                                                                                                                                                

  <span id="_Toc437512854" class="anchor"></span>                                                                                                                                                

                                                                                                                                                                                                 

  <span id="_Toc437512860" class="anchor"></span>                                                                                                                                                

                                                                                                                                                                                                 

  <span id="_Toc130721612" class="anchor"><span id="_Toc130888093" class="anchor"><span id="_Toc130978425" class="anchor"><span id="_Toc131014100" class="anchor"></span></span></span></span>   

                                                                                                                                                                                                 
  ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- -------------------------------------------------

### <span id="_Toc110172744" class="anchor"><span id="_Toc127596721" class="anchor"><span id="_Toc127786342" class="anchor"><span id="_Toc127786658" class="anchor"><span id="_Toc127786974" class="anchor"><span id="_Toc127877570" class="anchor"><span id="_Toc128289641" class="anchor"><span id="_Toc128290034" class="anchor"><span id="_Toc130189716" class="anchor"><span id="_Toc130200932" class="anchor"><span id="_Toc130201248" class="anchor"><span id="_Toc130201569" class="anchor"><span id="_Toc131936656" class="anchor"><span id="_Toc133901120" class="anchor"><span id="_Toc137460995" class="anchor"><span id="_Toc139096510" class="anchor"><span id="_Toc139188433" class="anchor"><span id="_Toc139191296" class="anchor"><span id="_Toc140490347" class="anchor"><span id="_Toc140571250" class="anchor"><span id="_Toc141257523" class="anchor"><span id="_Toc141257850" class="anchor"><span id="_Toc141267378" class="anchor"><span id="_Toc141522396" class="anchor"><span id="_Toc141529484" class="anchor"><span id="_Toc141529801" class="anchor"><span id="_Toc141851408" class="anchor"><span id="_Toc141852342" class="anchor"><span id="_Toc141887886" class="anchor"><span id="_Toc141889726" class="anchor"><span id="_Toc141893395" class="anchor"><span id="_Toc142113248" class="anchor"><span id="_Toc142114276" class="anchor"><span id="_Toc142729436" class="anchor"><span id="_Toc142730720" class="anchor"><span id="_Toc142731093" class="anchor"><span id="_Toc142998458" class="anchor"><span id="_Toc143063549" class="anchor"><span id="_Toc143509659" class="anchor"><span id="_Toc143510106" class="anchor"><span id="_Toc144026196" class="anchor"><span id="_Toc144026527" class="anchor"><span id="_Toc144276170" class="anchor"><span id="_Toc144276514" class="anchor"><span id="_Toc144280102" class="anchor"><span id="_Toc144280448" class="anchor"><span id="_Toc144540663" class="anchor"><span id="_Toc144554545" class="anchor"><span id="_Toc144722167" class="anchor"><span id="_Toc145503629" class="anchor"><span id="_Toc145512071" class="anchor"><span id="_Toc145513094" class="anchor"><span id="_Toc145513478" class="anchor"><span id="_Toc222907250" class="anchor"><span id="_Toc342652861" class="anchor"><span id="_Toc439858032" class="anchor"><span id="_Toc439864046" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>

<span id="_Toc437512875" class="anchor"></span>

<span id="_Toc437512882" class="anchor"></span>

  ------------------------------------------------- --
  <span id="_Toc437512886" class="anchor"></span>
  ------------------------------------------------- --

-   -   -   

<!-- -->

-   -   

  ------------------------------------------------- --
                                                    
  <span id="_Toc437512922" class="anchor"></span>   
                                                    
                                                    
                                                    
                                                    
  ------------------------------------------------- --

### <span id="_Toc222907251" class="anchor"><span id="_Toc342652862" class="anchor"><span id="_Toc439858033" class="anchor"><span id="_Toc439864047" class="anchor"></span></span></span></span>

<span id="_Toc437512945" class="anchor"></span>

<span id="_Toc437512954" class="anchor"></span>

  ------------------------------------------------- -- --
  <span id="_Toc437512958" class="anchor"></span>
  ------------------------------------------------- -- --

-   -   -   

<!-- -->

-   -   

<span id="_Toc437512995" class="anchor"></span>

  ------------------------------------------------- --
                                                    

  <span id="_Toc437513003" class="anchor"></span>   

                                                    

  <span id="_Toc437513013" class="anchor"></span>   
                                                    
  <span id="_Toc437513014" class="anchor"></span>   
                                                    
  <span id="_Toc437513015" class="anchor"></span>   

  <span id="_Toc437513018" class="anchor"></span>   

  <span id="_Toc437513021" class="anchor"></span>   

  <span id="_Toc437513024" class="anchor"></span>   

                                                    

  <span id="_Toc437513030" class="anchor"></span>   

                                                    

                                                    
  ------------------------------------------------- --

1.  <span id="_Toc110172746" class="anchor"><span id="_Toc111176464" class="anchor"><span id="_Toc118467506" class="anchor"><span id="_Toc127596722" class="anchor"><span id="_Toc127786343" class="anchor"><span id="_Toc127786659" class="anchor"><span id="_Toc127786975" class="anchor"><span id="_Toc127877571" class="anchor"><span id="_Toc128289642" class="anchor"><span id="_Toc128290035" class="anchor"><span id="_Toc130189717" class="anchor"><span id="_Toc130200933" class="anchor"><span id="_Toc130201249" class="anchor"><span id="_Toc130201570" class="anchor"><span id="_Ref130721967" class="anchor"><span id="_Toc131936657" class="anchor"><span id="_Toc133901121" class="anchor"><span id="_Toc137460996" class="anchor"><span id="_Toc139096511" class="anchor"><span id="_Toc139188434" class="anchor"><span id="_Toc139191297" class="anchor"><span id="_Toc140490348" class="anchor"><span id="_Toc140571251" class="anchor"><span id="_Toc141257524" class="anchor"><span id="_Toc141257851" class="anchor"><span id="_Toc141267379" class="anchor"><span id="_Toc141522397" class="anchor"><span id="_Toc141529485" class="anchor"><span id="_Toc141529802" class="anchor"><span id="_Toc141851409" class="anchor"><span id="_Toc141852343" class="anchor"><span id="_Toc141887887" class="anchor"><span id="_Toc141889727" class="anchor"><span id="_Toc141893396" class="anchor"><span id="_Toc142113249" class="anchor"><span id="_Toc142114277" class="anchor"><span id="_Toc142729437" class="anchor"><span id="_Toc142730721" class="anchor"><span id="_Toc142731094" class="anchor"><span id="_Toc142998459" class="anchor"><span id="_Toc143063550" class="anchor"><span id="_Toc143509660" class="anchor"><span id="_Toc143510107" class="anchor"><span id="_Toc144026197" class="anchor"><span id="_Toc144026528" class="anchor"><span id="_Toc144276171" class="anchor"><span id="_Toc144276515" class="anchor"><span id="_Toc144280103" class="anchor"><span id="_Toc144280449" class="anchor"><span id="_Toc144540664" class="anchor"><span id="_Toc144554546" class="anchor"><span id="_Toc144722168" class="anchor"><span id="_Toc145503630" class="anchor"><span id="_Toc145512072" class="anchor"><span id="_Toc145513095" class="anchor"><span id="_Toc145513479" class="anchor"><span id="_Toc222907252" class="anchor"><span id="_Toc342652863" class="anchor"><span id="_Toc439864048" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Host Intercept<span id="_Toc105831251" class="anchor"><span id="_Toc106181458" class="anchor"><span id="_Toc106422504" class="anchor"><span id="_Toc106525898" class="anchor"></span></span></span></span>s
    ================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================

    1.  <span id="_Toc110172747" class="anchor"><span id="_Toc127596723" class="anchor"><span id="_Toc127786344" class="anchor"><span id="_Toc127786660" class="anchor"><span id="_Toc127786976" class="anchor"><span id="_Toc127877572" class="anchor"><span id="_Toc128289643" class="anchor"><span id="_Toc128290036" class="anchor"><span id="_Toc130189718" class="anchor"><span id="_Toc130200934" class="anchor"><span id="_Toc130201250" class="anchor"><span id="_Toc130201571" class="anchor"><span id="_Toc131936658" class="anchor"><span id="_Toc133901122" class="anchor"><span id="_Toc137460997" class="anchor"><span id="_Toc139096512" class="anchor"><span id="_Toc139188435" class="anchor"><span id="_Toc139191298" class="anchor"><span id="_Toc140490349" class="anchor"><span id="_Toc140571252" class="anchor"><span id="_Toc141257525" class="anchor"><span id="_Toc141257852" class="anchor"><span id="_Toc141267380" class="anchor"><span id="_Toc141522398" class="anchor"><span id="_Toc141529486" class="anchor"><span id="_Toc141529803" class="anchor"><span id="_Toc141851410" class="anchor"><span id="_Toc141852344" class="anchor"><span id="_Toc141887888" class="anchor"><span id="_Toc141889728" class="anchor"><span id="_Toc141893397" class="anchor"><span id="_Toc142113250" class="anchor"><span id="_Toc142114278" class="anchor"><span id="_Toc142729438" class="anchor"><span id="_Toc142730722" class="anchor"><span id="_Toc142731095" class="anchor"><span id="_Toc142998460" class="anchor"><span id="_Toc143063551" class="anchor"><span id="_Toc143509661" class="anchor"><span id="_Toc143510108" class="anchor"><span id="_Toc144026198" class="anchor"><span id="_Toc144026529" class="anchor"><span id="_Toc144276172" class="anchor"><span id="_Toc144276516" class="anchor"><span id="_Toc144280104" class="anchor"><span id="_Toc144280450" class="anchor"><span id="_Toc144540665" class="anchor"><span id="_Toc144554547" class="anchor"><span id="_Toc144722169" class="anchor"><span id="_Toc145503631" class="anchor"><span id="_Toc145512073" class="anchor"><span id="_Toc145513096" class="anchor"><span id="_Toc145513480" class="anchor"><span id="_Toc222907253" class="anchor"><span id="_Toc342652864" class="anchor"><span id="_Toc439864049" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Overview
        ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

        1.  ### <span id="_Ref110507260" class="anchor"><span id="_Toc127596724" class="anchor"><span id="_Toc127786345" class="anchor"><span id="_Toc127786661" class="anchor"><span id="_Toc127786977" class="anchor"><span id="_Toc127877573" class="anchor"><span id="_Toc128289644" class="anchor"><span id="_Toc128290037" class="anchor"><span id="_Toc130189719" class="anchor"><span id="_Toc130200935" class="anchor"><span id="_Toc130201251" class="anchor"><span id="_Toc130201572" class="anchor"><span id="_Toc131936659" class="anchor"><span id="_Toc133901123" class="anchor"><span id="_Toc137460998" class="anchor"><span id="_Toc139096513" class="anchor"><span id="_Toc139188436" class="anchor"><span id="_Toc139191299" class="anchor"><span id="_Toc140490350" class="anchor"><span id="_Toc140571253" class="anchor"><span id="_Toc141257526" class="anchor"><span id="_Toc141257853" class="anchor"><span id="_Toc141267381" class="anchor"><span id="_Toc141522399" class="anchor"><span id="_Toc141529487" class="anchor"><span id="_Toc141529804" class="anchor"><span id="_Toc141851411" class="anchor"><span id="_Toc141852345" class="anchor"><span id="_Toc141887889" class="anchor"><span id="_Toc141889729" class="anchor"><span id="_Toc141893398" class="anchor"><span id="_Toc142113251" class="anchor"><span id="_Toc142114279" class="anchor"><span id="_Toc142729439" class="anchor"><span id="_Toc142730723" class="anchor"><span id="_Toc142731096" class="anchor"><span id="_Toc142998461" class="anchor"><span id="_Toc143063552" class="anchor"><span id="_Toc143509662" class="anchor"><span id="_Toc143510109" class="anchor"><span id="_Toc144026199" class="anchor"><span id="_Toc144026530" class="anchor"><span id="_Toc144276173" class="anchor"><span id="_Toc144276517" class="anchor"><span id="_Toc144280105" class="anchor"><span id="_Toc144280451" class="anchor"><span id="_Toc144540666" class="anchor"><span id="_Toc144554548" class="anchor"><span id="_Toc144722170" class="anchor"><span id="_Toc145503632" class="anchor"><span id="_Toc145512074" class="anchor"><span id="_Toc145513097" class="anchor"><span id="_Toc145513481" class="anchor"><span id="_Toc222907254" class="anchor"><span id="_Toc342652865" class="anchor"><span id="_Toc439864050" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Programmable Intercept Types

This section describes the principal mechanism the hypervisor provides
to facilitate the virtualization of certain guest events. These events
occur when a virtual processor executes certain instructions or
generates certain exceptions. An authorized guest (a parent partition)
can install an *intercept* for certain events on another guest (a child
partition). An intercept involves the detection of an event performed by
a virtual processor (explicitly or implicitly). When an intercepted
event occurs in the child partition, the virtual processor that
triggered the event is suspended, and an *intercept message* is sent to
the parent. The virtual processor remains suspended until the parent
explicitly clears the virtual processor register
HvRegisterInterceptSuspend.

In general, the register state of the virtual processor when it is
suspended corresponds to the state before the execution of the
instruction that triggered the intercept. As such, the instruction can
be restarted.

The purpose of this mechanism is to allow a virtualization-aware parent
to create a virtual environment that allows an unmodified legacy
guest—that was written to execute on the physical hardware—to execute in
a hypervisor partition. Such legacy guests may attempt to access
physical devices that do not exist in a hypervisor partition (for
example, by accessing certain I/O ports). The mechanism described in
this section makes it possible to intercept all such accesses and
transfer control to the parent partition. The parent partition can alter
the effect of the intercepted instruction such that, to the child, it
mirrors the expected behavior in physical hardware.

An intercept only affects the state of a single virtual processor. Other
virtual processors within the same partition continue to run. Therefore,
it’s possible that multiple intercept messages can be “in progress"
concurrently. Intercept messages are queued to the parent in the order
in which they are detected.

The available processor intercept events depend on the (virtual)
processor architecture and the capabilities of the physical hardware’s
virtualization facilities.

-   The following types of processor events can be intercepted on x64
    platforms:

    -   Accesses to I/O Ports

    -   Accesses to MSRs

    -   Execution of the CPUID instruction

    -   Exceptions

    -   Accesses to control registers

The following table describes the scope and intercept access flags that
are allowed for each intercept type:

  -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  Intercept Type                Intercept Applies To                                                                                                                                      Valid Access Flags
  ----------------------------- --------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------------------------------------------------
  I/O port access               A specific I/O port. The I/O port is specified with each hypercall.                                                                                       Read *and* Write access flags must be specified to install an intercept.
                                                                                                                                                                                          
  (see section 11.9)                                                                                                                                                                      

  MSR access                    All MSRs not being virtualized by the hypervisor. Note that certain privileges affect MSR virtualization. No MSR value is specified with the hypercall.   Read *and* Write access flags must be specified to install the intercept.
                                                                                                                                                                                          
  (see section 11.10)                                                                                                                                                                     

  CPUID instruction execution   A specific CPUID leaf. The CPUID leaf is specified with each hypercall.                                                                                   Execute access flag must be specified to install an intercept.
                                                                                                                                                                                          
  (see section 11.11)                                                                                                                                                                     

  Exceptions                    A specific exception vector. The exception vector is specified with each hypercall.                                                                       Execute access flag must be specified to install an intercept.
                                                                                                                                                                                          
  (see section 14.1)                                                                                                                                                                      

  Control Register Access       A specific control register. The specific control register is specified with each hypercall.                                                              Read or Write access flags must be specified to install the intercept.
  -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

### <span id="_Toc127596725" class="anchor"><span id="_Toc127786346" class="anchor"><span id="_Toc127786662" class="anchor"><span id="_Toc127786978" class="anchor"><span id="_Toc127877574" class="anchor"><span id="_Toc128289645" class="anchor"><span id="_Toc128290038" class="anchor"><span id="_Toc130189720" class="anchor"><span id="_Toc130200936" class="anchor"><span id="_Toc130201252" class="anchor"><span id="_Toc130201573" class="anchor"><span id="_Toc131936660" class="anchor"><span id="_Toc133901124" class="anchor"><span id="_Toc137460999" class="anchor"><span id="_Toc139096514" class="anchor"><span id="_Toc139188437" class="anchor"><span id="_Toc139191300" class="anchor"><span id="_Toc140490351" class="anchor"><span id="_Toc140571254" class="anchor"><span id="_Toc141257527" class="anchor"><span id="_Toc141257854" class="anchor"><span id="_Toc141267382" class="anchor"><span id="_Toc141522400" class="anchor"><span id="_Toc141529488" class="anchor"><span id="_Toc141529805" class="anchor"><span id="_Toc141851412" class="anchor"><span id="_Toc141852346" class="anchor"><span id="_Toc141887890" class="anchor"><span id="_Toc141889730" class="anchor"><span id="_Toc141893399" class="anchor"><span id="_Toc142113252" class="anchor"><span id="_Toc142114280" class="anchor"><span id="_Toc142729440" class="anchor"><span id="_Toc142730724" class="anchor"><span id="_Toc142731097" class="anchor"><span id="_Toc142998462" class="anchor"><span id="_Toc143063553" class="anchor"><span id="_Toc143509663" class="anchor"><span id="_Toc143510110" class="anchor"><span id="_Toc144026200" class="anchor"><span id="_Toc144026531" class="anchor"><span id="_Toc144276174" class="anchor"><span id="_Toc144276518" class="anchor"><span id="_Toc144280106" class="anchor"><span id="_Toc144280452" class="anchor"><span id="_Toc144540667" class="anchor"><span id="_Toc144554549" class="anchor"><span id="_Toc144722171" class="anchor"><span id="_Toc145503633" class="anchor"><span id="_Toc145512075" class="anchor"><span id="_Toc145513098" class="anchor"><span id="_Toc145513482" class="anchor"><span id="_Toc222907255" class="anchor"><span id="_Toc342652866" class="anchor"><span id="_Toc439864051" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Unsolicited Intercept Types

Several conditions always cause a virtual processor to be suspended and
an intercept message to be sent to the parent. If certain events occur
within the root partition, which has no parent, the condition is
considered fatal, and the system is restarted.

The following table describes the intercepts defined on x64
implementations of the hypervisor.

  ----------------------------------------------------------------------------
  Unsolicited Intercept Type           Root Partition Behavior
  ------------------------------------ ---------------------------------------
  Invalid virtual processor state\     Fatal error. The system is restarted.
  (see section 10.1.2)                 

  Unrecoverable processor exception\   Fatal error. The system is restarted.
  (for example, triple fault on X64)   

  Unsupported functionality error      Fatal error. The system is restarted.

  FERR asserted\                       Ignored. No message is generated.
  (legacy floating point error)        

  APIC EOIs                            Ignored. No message is generated.
  ----------------------------------------------------------------------------

Unsupported functionality errors are delivered to the parent if the
guest uses a feature of the underlying processor architecture that is
not virtualized by the hypervisor and cannot otherwise be reported as
“not implemented". For example, on the x64 architecture, some features
can be reported as “not implemented" by using CPUID feature bits or by
generating a \#GP fault when accessing an MSR. If there is no
architectural way for a guest to determine whether a feature is
supported, the hypervisor may detect the use of the unsupported feature
and deliver an “unsupported functionality" error to the parent.

1.  <span id="_Toc110172748" class="anchor"><span id="_Toc127596726" class="anchor"><span id="_Toc127786347" class="anchor"><span id="_Toc127786663" class="anchor"><span id="_Toc127786979" class="anchor"><span id="_Toc127877575" class="anchor"><span id="_Toc128289646" class="anchor"><span id="_Toc128290039" class="anchor"><span id="_Toc130189721" class="anchor"><span id="_Toc130200937" class="anchor"><span id="_Toc130201253" class="anchor"><span id="_Toc130201574" class="anchor"><span id="_Toc131936661" class="anchor"><span id="_Toc133901125" class="anchor"><span id="_Toc137461000" class="anchor"><span id="_Toc139096515" class="anchor"><span id="_Toc139188438" class="anchor"><span id="_Toc139191301" class="anchor"><span id="_Toc140490352" class="anchor"><span id="_Toc140571255" class="anchor"><span id="_Toc141257528" class="anchor"><span id="_Toc141257855" class="anchor"><span id="_Toc141267383" class="anchor"><span id="_Toc141522401" class="anchor"><span id="_Toc141529489" class="anchor"><span id="_Toc141529806" class="anchor"><span id="_Toc141851413" class="anchor"><span id="_Toc141852347" class="anchor"><span id="_Toc141887891" class="anchor"><span id="_Toc141889731" class="anchor"><span id="_Toc141893400" class="anchor"><span id="_Toc142113253" class="anchor"><span id="_Toc142114281" class="anchor"><span id="_Toc142729441" class="anchor"><span id="_Toc142730725" class="anchor"><span id="_Toc142731098" class="anchor"><span id="_Toc142998463" class="anchor"><span id="_Toc143063554" class="anchor"><span id="_Toc143509664" class="anchor"><span id="_Toc143510111" class="anchor"><span id="_Toc144026201" class="anchor"><span id="_Toc144026532" class="anchor"><span id="_Toc144276175" class="anchor"><span id="_Toc144276519" class="anchor"><span id="_Toc144280107" class="anchor"><span id="_Toc144280453" class="anchor"><span id="_Toc144540668" class="anchor"><span id="_Toc144554550" class="anchor"><span id="_Toc144722172" class="anchor"><span id="_Toc145503634" class="anchor"><span id="_Toc145512076" class="anchor"><span id="_Toc145513099" class="anchor"><span id="_Toc145513483" class="anchor"><span id="_Toc222907256" class="anchor"><span id="_Toc342652867" class="anchor"><span id="_Toc439858038" class="anchor"><span id="_Toc439864052" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>
    ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

    1.  ### <span id="_Toc110172749" class="anchor"><span id="_Toc127596727" class="anchor"><span id="_Toc127786348" class="anchor"><span id="_Toc127786664" class="anchor"><span id="_Toc127786980" class="anchor"><span id="_Toc127877576" class="anchor"><span id="_Toc128289647" class="anchor"><span id="_Toc128290040" class="anchor"><span id="_Toc130189722" class="anchor"><span id="_Toc130200938" class="anchor"><span id="_Toc130201254" class="anchor"><span id="_Toc130201575" class="anchor"><span id="_Toc131936662" class="anchor"><span id="_Toc133901126" class="anchor"><span id="_Toc137461001" class="anchor"><span id="_Toc139096516" class="anchor"><span id="_Toc139188439" class="anchor"><span id="_Toc139191302" class="anchor"><span id="_Toc140490353" class="anchor"><span id="_Toc140571256" class="anchor"><span id="_Toc141257529" class="anchor"><span id="_Toc141257856" class="anchor"><span id="_Toc141267384" class="anchor"><span id="_Toc141522402" class="anchor"><span id="_Toc141529490" class="anchor"><span id="_Toc141529807" class="anchor"><span id="_Toc141851414" class="anchor"><span id="_Toc141852348" class="anchor"><span id="_Toc141887892" class="anchor"><span id="_Toc141889732" class="anchor"><span id="_Toc141893401" class="anchor"><span id="_Toc142113254" class="anchor"><span id="_Toc142114282" class="anchor"><span id="_Toc142729442" class="anchor"><span id="_Toc142730726" class="anchor"><span id="_Toc142731099" class="anchor"><span id="_Toc142998464" class="anchor"><span id="_Toc143063555" class="anchor"><span id="_Toc143509665" class="anchor"><span id="_Toc143510112" class="anchor"><span id="_Toc144026202" class="anchor"><span id="_Toc144026533" class="anchor"><span id="_Toc144276176" class="anchor"><span id="_Toc144276520" class="anchor"><span id="_Toc144280108" class="anchor"><span id="_Toc144280454" class="anchor"><span id="_Toc144540669" class="anchor"><span id="_Toc144554551" class="anchor"><span id="_Toc144722173" class="anchor"><span id="_Toc145503635" class="anchor"><span id="_Toc145512077" class="anchor"><span id="_Toc145513100" class="anchor"><span id="_Toc145513484" class="anchor"><span id="_Toc222907257" class="anchor"><span id="_Toc342652868" class="anchor"><span id="_Toc439858039" class="anchor"><span id="_Toc439864053" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>

    2.  ### <span id="_Toc105831256" class="anchor"><span id="_Toc106181463" class="anchor"><span id="_Toc106422509" class="anchor"><span id="_Toc106525903" class="anchor"><span id="_Toc105831257" class="anchor"><span id="_Toc106181464" class="anchor"><span id="_Toc106422510" class="anchor"><span id="_Toc106525904" class="anchor"><span id="_Toc105831259" class="anchor"><span id="_Toc106181466" class="anchor"><span id="_Toc106422512" class="anchor"><span id="_Toc106525906" class="anchor"><span id="_Toc342652869" class="anchor"><span id="_Toc110172750" class="anchor"><span id="_Toc127596728" class="anchor"><span id="_Toc127786349" class="anchor"><span id="_Toc127786665" class="anchor"><span id="_Toc127786981" class="anchor"><span id="_Toc127877577" class="anchor"><span id="_Toc128289648" class="anchor"><span id="_Toc128290041" class="anchor"><span id="_Toc130189723" class="anchor"><span id="_Toc130200939" class="anchor"><span id="_Toc130201255" class="anchor"><span id="_Toc130201576" class="anchor"><span id="_Toc131936663" class="anchor"><span id="_Toc133901127" class="anchor"><span id="_Toc137461002" class="anchor"><span id="_Toc139096517" class="anchor"><span id="_Toc139188440" class="anchor"><span id="_Toc139191303" class="anchor"><span id="_Toc140490354" class="anchor"><span id="_Toc140571257" class="anchor"><span id="_Toc141257530" class="anchor"><span id="_Toc141257857" class="anchor"><span id="_Toc141267385" class="anchor"><span id="_Toc141522403" class="anchor"><span id="_Toc141529491" class="anchor"><span id="_Toc141529808" class="anchor"><span id="_Toc141851415" class="anchor"><span id="_Toc141852349" class="anchor"><span id="_Toc141887893" class="anchor"><span id="_Toc141889733" class="anchor"><span id="_Toc141893402" class="anchor"><span id="_Toc142113255" class="anchor"><span id="_Toc142114283" class="anchor"><span id="_Toc142729443" class="anchor"><span id="_Toc142730727" class="anchor"><span id="_Toc142731100" class="anchor"><span id="_Toc142998465" class="anchor"><span id="_Toc143063556" class="anchor"><span id="_Toc143509666" class="anchor"><span id="_Toc143510113" class="anchor"><span id="_Toc144026203" class="anchor"><span id="_Toc144026534" class="anchor"><span id="_Toc144276177" class="anchor"><span id="_Toc144276521" class="anchor"><span id="_Toc144280109" class="anchor"><span id="_Toc144280455" class="anchor"><span id="_Toc144540670" class="anchor"><span id="_Toc144554552" class="anchor"><span id="_Toc144722174" class="anchor"><span id="_Toc145503636" class="anchor"><span id="_Toc145512078" class="anchor"><span id="_Toc145513101" class="anchor"><span id="_Toc145513485" class="anchor"><span id="_Toc222907258" class="anchor"><span id="_Toc342652870" class="anchor"><span id="_Toc439858040" class="anchor"><span id="_Toc439864054" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>

    3.  ### <span id="_Toc110172751" class="anchor"><span id="_Toc127596729" class="anchor"><span id="_Toc127786350" class="anchor"><span id="_Toc127786666" class="anchor"><span id="_Toc127786982" class="anchor"><span id="_Toc127877578" class="anchor"><span id="_Toc128289649" class="anchor"><span id="_Toc128290042" class="anchor"><span id="_Toc130189724" class="anchor"><span id="_Toc130200940" class="anchor"><span id="_Toc130201256" class="anchor"><span id="_Toc130201577" class="anchor"><span id="_Toc131936664" class="anchor"><span id="_Toc133901128" class="anchor"><span id="_Toc137461003" class="anchor"><span id="_Toc139096518" class="anchor"><span id="_Toc139188441" class="anchor"><span id="_Toc139191304" class="anchor"><span id="_Toc140490355" class="anchor"><span id="_Toc140571258" class="anchor"><span id="_Toc141257531" class="anchor"><span id="_Toc141257858" class="anchor"><span id="_Toc141267386" class="anchor"><span id="_Toc141522404" class="anchor"><span id="_Toc141529492" class="anchor"><span id="_Toc141529809" class="anchor"><span id="_Toc141851416" class="anchor"><span id="_Toc141852350" class="anchor"><span id="_Toc141887894" class="anchor"><span id="_Toc141889734" class="anchor"><span id="_Toc141893403" class="anchor"><span id="_Toc142113256" class="anchor"><span id="_Toc142114284" class="anchor"><span id="_Toc142729444" class="anchor"><span id="_Toc142730728" class="anchor"><span id="_Toc142731101" class="anchor"><span id="_Toc142998466" class="anchor"><span id="_Toc143063557" class="anchor"><span id="_Toc143509667" class="anchor"><span id="_Toc143510114" class="anchor"><span id="_Toc144026204" class="anchor"><span id="_Toc144026535" class="anchor"><span id="_Toc144276178" class="anchor"><span id="_Toc144276522" class="anchor"><span id="_Toc144280110" class="anchor"><span id="_Toc144280456" class="anchor"><span id="_Toc144540671" class="anchor"><span id="_Toc144554553" class="anchor"><span id="_Toc144722175" class="anchor"><span id="_Toc145503637" class="anchor"><span id="_Toc145512079" class="anchor"><span id="_Toc145513102" class="anchor"><span id="_Toc145513486" class="anchor"><span id="_Toc222907259" class="anchor"><span id="_Toc342652871" class="anchor"><span id="_Toc439858041" class="anchor"><span id="_Toc439864055" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>

    4.  ### <span id="_Toc342652872" class="anchor"><span id="_Ref148774815" class="anchor"><span id="_Toc222907260" class="anchor"><span id="_Toc342652873" class="anchor"><span id="_Toc439858042" class="anchor"><span id="_Toc110172752" class="anchor"><span id="_Toc439864056" class="anchor"></span></span></span></span></span></span></span>

2.  <span id="_Toc127596730" class="anchor"><span id="_Toc127786351" class="anchor"><span id="_Toc127786667" class="anchor"><span id="_Toc127786983" class="anchor"><span id="_Toc127877579" class="anchor"><span id="_Toc128289650" class="anchor"><span id="_Toc128290043" class="anchor"><span id="_Toc130189725" class="anchor"><span id="_Toc130200941" class="anchor"><span id="_Toc130201257" class="anchor"><span id="_Toc130201578" class="anchor"><span id="_Toc131936665" class="anchor"><span id="_Toc133901129" class="anchor"><span id="_Toc137461004" class="anchor"><span id="_Toc139096519" class="anchor"><span id="_Toc139188442" class="anchor"><span id="_Toc139191305" class="anchor"><span id="_Toc140490356" class="anchor"><span id="_Toc140571259" class="anchor"><span id="_Toc141257532" class="anchor"><span id="_Toc141257859" class="anchor"><span id="_Toc141267387" class="anchor"><span id="_Toc141522405" class="anchor"><span id="_Toc141529493" class="anchor"><span id="_Toc141529810" class="anchor"><span id="_Toc141851417" class="anchor"><span id="_Toc141852351" class="anchor"><span id="_Toc141887895" class="anchor"><span id="_Toc141889735" class="anchor"><span id="_Toc141893404" class="anchor"><span id="_Toc142113257" class="anchor"><span id="_Toc142114285" class="anchor"><span id="_Toc142729445" class="anchor"><span id="_Toc142730729" class="anchor"><span id="_Toc142731102" class="anchor"><span id="_Toc142998467" class="anchor"><span id="_Toc143063558" class="anchor"><span id="_Toc143509668" class="anchor"><span id="_Toc143510115" class="anchor"><span id="_Toc144026205" class="anchor"><span id="_Toc144026536" class="anchor"><span id="_Toc144276179" class="anchor"><span id="_Toc144276523" class="anchor"><span id="_Toc144280111" class="anchor"><span id="_Toc144280457" class="anchor"><span id="_Toc144540672" class="anchor"><span id="_Toc144554554" class="anchor"><span id="_Toc144722176" class="anchor"><span id="_Toc145503638" class="anchor"><span id="_Toc145512080" class="anchor"><span id="_Toc145513103" class="anchor"><span id="_Toc145513487" class="anchor"><span id="_Toc222907261" class="anchor"><span id="_Toc342652874" class="anchor"><span id="_Toc439858043" class="anchor"><span id="_Toc439864057" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>
    ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

    1.  ### <span id="_Toc110172753" class="anchor"><span id="_Toc127596731" class="anchor"><span id="_Toc127786352" class="anchor"><span id="_Toc127786668" class="anchor"><span id="_Toc127786984" class="anchor"><span id="_Toc127877580" class="anchor"><span id="_Toc128289651" class="anchor"><span id="_Toc128290044" class="anchor"><span id="_Toc130189726" class="anchor"><span id="_Toc130200942" class="anchor"><span id="_Toc130201258" class="anchor"><span id="_Toc130201579" class="anchor"><span id="_Toc131936666" class="anchor"><span id="_Toc133901130" class="anchor"><span id="_Toc137461005" class="anchor"><span id="_Toc139096520" class="anchor"><span id="_Toc139188443" class="anchor"><span id="_Toc139191306" class="anchor"><span id="_Toc140490357" class="anchor"><span id="_Toc140571260" class="anchor"><span id="_Toc141257533" class="anchor"><span id="_Toc141257860" class="anchor"><span id="_Toc141267388" class="anchor"><span id="_Toc141522406" class="anchor"><span id="_Toc141529494" class="anchor"><span id="_Toc141529811" class="anchor"><span id="_Toc141851418" class="anchor"><span id="_Toc141852352" class="anchor"><span id="_Toc141887896" class="anchor"><span id="_Toc141889736" class="anchor"><span id="_Toc141893405" class="anchor"><span id="_Toc142113258" class="anchor"><span id="_Toc142114286" class="anchor"><span id="_Toc142729446" class="anchor"><span id="_Toc142730730" class="anchor"><span id="_Toc142731103" class="anchor"><span id="_Toc142998468" class="anchor"><span id="_Toc143063559" class="anchor"><span id="_Toc143509669" class="anchor"><span id="_Toc143510116" class="anchor"><span id="_Toc144026206" class="anchor"><span id="_Toc144026537" class="anchor"><span id="_Toc144276180" class="anchor"><span id="_Toc144276524" class="anchor"><span id="_Toc144280112" class="anchor"><span id="_Toc144280458" class="anchor"><span id="_Toc144540673" class="anchor"><span id="_Toc144554555" class="anchor"><span id="_Toc144722177" class="anchor"><span id="_Toc145503639" class="anchor"><span id="_Toc145512081" class="anchor"><span id="_Toc145513104" class="anchor"><span id="_Toc145513488" class="anchor"><span id="_Toc222907262" class="anchor"><span id="_Toc342652875" class="anchor"><span id="_Toc439858044" class="anchor"><span id="_Toc439864058" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>

  -- -- --
  -- -- --

  -- --
     
     
     
     
  -- --

-   -   

  ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- --
                                                                                                                                                                                                 
                                                                                                                                                                                                 
                                                                                                                                                                                                 
                                                                                                                                                                                                 
                                                                                                                                                                                                 
                                                                                                                                                                                                 
  <span id="_Toc130721630" class="anchor"><span id="_Toc130888111" class="anchor"><span id="_Toc130978443" class="anchor"><span id="_Toc131014118" class="anchor"></span></span></span></span>   
  ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- --

<span id="_Ref107642502" class="anchor"><span id="_Toc110172754" class="anchor"><span id="_Toc127596732" class="anchor"><span id="_Toc127786353" class="anchor"><span id="_Toc127786669" class="anchor"><span id="_Toc127786985" class="anchor"><span id="_Toc127877581" class="anchor"><span id="_Toc128289652" class="anchor"><span id="_Toc128290045" class="anchor"><span id="_Toc130189727" class="anchor"><span id="_Toc130200943" class="anchor"><span id="_Toc130201259" class="anchor"><span id="_Toc130201580" class="anchor"><span id="_Toc131936667" class="anchor"><span id="_Toc133901131" class="anchor"><span id="_Toc137461006" class="anchor"><span id="_Toc139096521" class="anchor"><span id="_Toc139188444" class="anchor"><span id="_Toc139191307" class="anchor"><span id="_Toc140490358" class="anchor"><span id="_Toc140571261" class="anchor"><span id="_Toc141257534" class="anchor"><span id="_Toc141257861" class="anchor"><span id="_Toc141267389" class="anchor"><span id="_Toc141522407" class="anchor"><span id="_Toc141529495" class="anchor"><span id="_Toc141529812" class="anchor"><span id="_Toc141851419" class="anchor"><span id="_Toc141852353" class="anchor"><span id="_Toc141887897" class="anchor"><span id="_Toc141889737" class="anchor"><span id="_Toc141893406" class="anchor"><span id="_Toc142113259" class="anchor"><span id="_Toc142114287" class="anchor"><span id="_Toc142729447" class="anchor"><span id="_Toc142730731" class="anchor"><span id="_Toc142731104" class="anchor"><span id="_Toc142998469" class="anchor"><span id="_Toc143063560" class="anchor"><span id="_Toc143509670" class="anchor"><span id="_Toc143510117" class="anchor"><span id="_Toc144026207" class="anchor"><span id="_Toc144026538" class="anchor"><span id="_Toc144276181" class="anchor"><span id="_Toc144276525" class="anchor"><span id="_Toc144280113" class="anchor"><span id="_Toc144280459" class="anchor"><span id="_Toc144540674" class="anchor"><span id="_Toc144554556" class="anchor"><span id="_Toc144722178" class="anchor"><span id="_Toc145503640" class="anchor"><span id="_Toc145512082" class="anchor"><span id="_Toc145513105" class="anchor"><span id="_Toc145513489" class="anchor"><span id="_Toc222907263" class="anchor"><span id="_Toc342652876" class="anchor"><span id="_Toc439858045" class="anchor"><span id="_Toc439864059" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

1.  <span id="_Toc127596733" class="anchor"><span id="_Toc127786354" class="anchor"><span id="_Toc127786670" class="anchor"><span id="_Toc127786986" class="anchor"><span id="_Toc127877582" class="anchor"><span id="_Toc128289653" class="anchor"><span id="_Toc128290046" class="anchor"><span id="_Toc130189728" class="anchor"><span id="_Toc130200944" class="anchor"><span id="_Toc130201260" class="anchor"><span id="_Toc130201581" class="anchor"><span id="_Ref130792218" class="anchor"><span id="_Ref130792466" class="anchor"><span id="_Ref130796118" class="anchor"><span id="_Ref130880790" class="anchor"><span id="_Toc131936668" class="anchor"><span id="_Toc133901132" class="anchor"><span id="_Toc137461007" class="anchor"><span id="_Toc139096522" class="anchor"><span id="_Toc139188445" class="anchor"><span id="_Toc139191308" class="anchor"><span id="_Toc140490359" class="anchor"><span id="_Toc140571262" class="anchor"><span id="_Toc141257535" class="anchor"><span id="_Toc141257862" class="anchor"><span id="_Toc141267390" class="anchor"><span id="_Toc141522408" class="anchor"><span id="_Toc141529496" class="anchor"><span id="_Toc141529813" class="anchor"><span id="_Toc141851420" class="anchor"><span id="_Toc141852354" class="anchor"><span id="_Toc141887898" class="anchor"><span id="_Toc141889738" class="anchor"><span id="_Toc141893407" class="anchor"><span id="_Toc142113260" class="anchor"><span id="_Toc142114288" class="anchor"><span id="_Toc142729448" class="anchor"><span id="_Toc142730732" class="anchor"><span id="_Toc142731105" class="anchor"><span id="_Toc142998470" class="anchor"><span id="_Toc143063561" class="anchor"><span id="_Toc143509671" class="anchor"><span id="_Toc143510118" class="anchor"><span id="_Toc144026208" class="anchor"><span id="_Toc144026539" class="anchor"><span id="_Toc144276182" class="anchor"><span id="_Toc144276526" class="anchor"><span id="_Toc144280114" class="anchor"><span id="_Toc144280460" class="anchor"><span id="_Toc144540675" class="anchor"><span id="_Toc144554557" class="anchor"><span id="_Toc144722179" class="anchor"><span id="_Toc145503641" class="anchor"><span id="_Toc145512083" class="anchor"><span id="_Toc145513106" class="anchor"><span id="_Toc145513490" class="anchor"><span id="_Ref148178386" class="anchor"><span id="_Ref221086229" class="anchor"><span id="_Toc222907264" class="anchor"><span id="_Toc342652877" class="anchor"><span id="_Toc439864060" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Virtual Processor Management
    ===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================

    1.  <span id="_Toc110172756" class="anchor"><span id="_Toc127596734" class="anchor"><span id="_Toc127786355" class="anchor"><span id="_Toc127786671" class="anchor"><span id="_Toc127786987" class="anchor"><span id="_Toc127877583" class="anchor"><span id="_Toc128289654" class="anchor"><span id="_Toc128290047" class="anchor"><span id="_Toc130189729" class="anchor"><span id="_Toc130200945" class="anchor"><span id="_Toc130201261" class="anchor"><span id="_Toc130201582" class="anchor"><span id="_Toc131936669" class="anchor"><span id="_Toc133901133" class="anchor"><span id="_Toc137461008" class="anchor"><span id="_Toc139096523" class="anchor"><span id="_Toc139188446" class="anchor"><span id="_Toc139191309" class="anchor"><span id="_Toc140490360" class="anchor"><span id="_Toc140571263" class="anchor"><span id="_Toc141257536" class="anchor"><span id="_Toc141257863" class="anchor"><span id="_Toc141267391" class="anchor"><span id="_Toc141522409" class="anchor"><span id="_Toc141529497" class="anchor"><span id="_Toc141529814" class="anchor"><span id="_Toc141851421" class="anchor"><span id="_Toc141852355" class="anchor"><span id="_Toc141887899" class="anchor"><span id="_Toc141889739" class="anchor"><span id="_Toc141893408" class="anchor"><span id="_Toc142113261" class="anchor"><span id="_Toc142114289" class="anchor"><span id="_Toc142729449" class="anchor"><span id="_Toc142730733" class="anchor"><span id="_Toc142731106" class="anchor"><span id="_Toc142998471" class="anchor"><span id="_Toc143063562" class="anchor"><span id="_Toc143509672" class="anchor"><span id="_Toc143510119" class="anchor"><span id="_Toc144026209" class="anchor"><span id="_Toc144026540" class="anchor"><span id="_Toc144276183" class="anchor"><span id="_Toc144276527" class="anchor"><span id="_Toc144280115" class="anchor"><span id="_Toc144280461" class="anchor"><span id="_Toc144540676" class="anchor"><span id="_Toc144554558" class="anchor"><span id="_Toc144722180" class="anchor"><span id="_Toc145503642" class="anchor"><span id="_Toc145512084" class="anchor"><span id="_Toc145513107" class="anchor"><span id="_Toc145513491" class="anchor"><span id="_Toc222907265" class="anchor"><span id="_Toc342652878" class="anchor"><span id="_Toc439864061" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Overview
        ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

Each partition may have zero or more virtual processors. This section
specifies how the state of a virtual processor can be programmatically
accessed or modified by another sufficiently privileged partition by
using hypercalls. This facility can be used in conjunction with
intercepts to virtualize the processor.

### <span id="_Toc110172757" class="anchor"><span id="_Toc127596735" class="anchor"><span id="_Toc127786356" class="anchor"><span id="_Toc127786672" class="anchor"><span id="_Toc127786988" class="anchor"><span id="_Toc127877584" class="anchor"><span id="_Toc128289655" class="anchor"><span id="_Toc128290048" class="anchor"><span id="_Toc130189730" class="anchor"><span id="_Toc130200946" class="anchor"><span id="_Toc130201262" class="anchor"><span id="_Toc130201583" class="anchor"><span id="_Toc131936670" class="anchor"><span id="_Toc133901134" class="anchor"><span id="_Toc137461009" class="anchor"><span id="_Toc139096524" class="anchor"><span id="_Toc139188447" class="anchor"><span id="_Toc139191310" class="anchor"><span id="_Toc140490361" class="anchor"><span id="_Toc140571264" class="anchor"><span id="_Toc141257537" class="anchor"><span id="_Toc141257864" class="anchor"><span id="_Toc141267392" class="anchor"><span id="_Toc141522410" class="anchor"><span id="_Toc141529498" class="anchor"><span id="_Toc141529815" class="anchor"><span id="_Toc141851422" class="anchor"><span id="_Toc141852356" class="anchor"><span id="_Toc141887900" class="anchor"><span id="_Toc141889740" class="anchor"><span id="_Toc141893409" class="anchor"><span id="_Toc142113262" class="anchor"><span id="_Toc142114290" class="anchor"><span id="_Toc142729450" class="anchor"><span id="_Toc142730734" class="anchor"><span id="_Toc142731107" class="anchor"><span id="_Toc142998472" class="anchor"><span id="_Toc143063563" class="anchor"><span id="_Toc143509673" class="anchor"><span id="_Toc143510120" class="anchor"><span id="_Toc144026210" class="anchor"><span id="_Toc144026541" class="anchor"><span id="_Toc144276184" class="anchor"><span id="_Toc144276528" class="anchor"><span id="_Toc144280116" class="anchor"><span id="_Toc144280462" class="anchor"><span id="_Toc144540677" class="anchor"><span id="_Toc144554559" class="anchor"><span id="_Toc144722181" class="anchor"><span id="_Toc145503643" class="anchor"><span id="_Toc145512085" class="anchor"><span id="_Toc145513108" class="anchor"><span id="_Toc145513492" class="anchor"><span id="_Toc222907266" class="anchor"><span id="_Toc342652879" class="anchor"><span id="_Toc439864062" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Virtual Processor Indices

A virtual processor is identified by a tuple composed of its partition
ID and its processor index. The processor index is assigned to the
virtual processor when it is created, and it is unchanged through the
lifetime of the virtual processor.

### <span id="_Toc110172758" class="anchor"><span id="_Ref110504634" class="anchor"><span id="_Ref110504659" class="anchor"><span id="_Toc127596736" class="anchor"><span id="_Toc127786357" class="anchor"><span id="_Toc127786673" class="anchor"><span id="_Toc127786989" class="anchor"><span id="_Toc127877585" class="anchor"><span id="_Toc128289656" class="anchor"><span id="_Toc128290049" class="anchor"><span id="_Toc130189731" class="anchor"><span id="_Toc130200947" class="anchor"><span id="_Toc130201263" class="anchor"><span id="_Toc130201584" class="anchor"><span id="_Toc131936671" class="anchor"><span id="_Toc133901135" class="anchor"><span id="_Toc137461010" class="anchor"><span id="_Toc139096525" class="anchor"><span id="_Toc139188448" class="anchor"><span id="_Toc139191311" class="anchor"><span id="_Toc140490362" class="anchor"><span id="_Toc140571265" class="anchor"><span id="_Toc141257538" class="anchor"><span id="_Toc141257865" class="anchor"><span id="_Toc141267393" class="anchor"><span id="_Toc141522411" class="anchor"><span id="_Toc141529499" class="anchor"><span id="_Toc141529816" class="anchor"><span id="_Toc141851423" class="anchor"><span id="_Toc141852357" class="anchor"><span id="_Toc141887901" class="anchor"><span id="_Toc141889741" class="anchor"><span id="_Toc141893410" class="anchor"><span id="_Toc142113263" class="anchor"><span id="_Toc142114291" class="anchor"><span id="_Toc142729451" class="anchor"><span id="_Toc142730735" class="anchor"><span id="_Toc142731108" class="anchor"><span id="_Toc142998473" class="anchor"><span id="_Toc143063564" class="anchor"><span id="_Toc143509674" class="anchor"><span id="_Toc143510121" class="anchor"><span id="_Toc144026211" class="anchor"><span id="_Toc144026542" class="anchor"><span id="_Toc144276185" class="anchor"><span id="_Toc144276529" class="anchor"><span id="_Toc144280117" class="anchor"><span id="_Toc144280463" class="anchor"><span id="_Toc144540678" class="anchor"><span id="_Toc144554560" class="anchor"><span id="_Toc144722182" class="anchor"><span id="_Toc145503644" class="anchor"><span id="_Toc145512086" class="anchor"><span id="_Toc145513109" class="anchor"><span id="_Toc145513493" class="anchor"><span id="_Ref147828972" class="anchor"><span id="_Toc222907267" class="anchor"><span id="_Toc342652880" class="anchor"><span id="_Toc439864063" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Virtual Processor Registers

Associated with each virtual processor is a variety of state modeled as
processor registers. Most of this state is defined by the underlying
processor architecture and consists of architected register values. The
hypervisor provides a mechanism for reading and writing these registers
through hypercalls HvGetVpRegisters and HvSetVpRegisters.

If a virtual processor register is modified and the newly-specified
value is invalid in some way, the hypervisor may or may not immediately
return an error. In some cases, a value is invalid only in certain
contexts (for example, if a bit within another virtual processor
register is set). Therefore, some invalid register values are not
detected until the virtual processor resumes execution. In such a case,
the virtual processor is suspended, and an intercept message (with a
message type HvMessageTypeInvalidVpRegisterValue) is sent to its parent
partition.

### <span id="_Ref109056767" class="anchor"><span id="_Toc110172759" class="anchor"><span id="_Toc127596737" class="anchor"><span id="_Toc127786358" class="anchor"><span id="_Toc127786674" class="anchor"><span id="_Toc127786990" class="anchor"><span id="_Toc127877586" class="anchor"><span id="_Toc128289657" class="anchor"><span id="_Toc128290050" class="anchor"><span id="_Toc130189732" class="anchor"><span id="_Toc130200948" class="anchor"><span id="_Toc130201264" class="anchor"><span id="_Toc130201585" class="anchor"><span id="_Toc131936672" class="anchor"><span id="_Toc133901136" class="anchor"><span id="_Toc137461011" class="anchor"><span id="_Toc139096526" class="anchor"><span id="_Toc139188449" class="anchor"><span id="_Toc139191312" class="anchor"><span id="_Toc140490363" class="anchor"><span id="_Ref140569226" class="anchor"><span id="_Toc140571266" class="anchor"><span id="_Toc141257539" class="anchor"><span id="_Toc141257866" class="anchor"><span id="_Toc141267394" class="anchor"><span id="_Toc141522412" class="anchor"><span id="_Toc141529500" class="anchor"><span id="_Toc141529817" class="anchor"><span id="_Toc141851424" class="anchor"><span id="_Toc141852358" class="anchor"><span id="_Toc141887902" class="anchor"><span id="_Toc141889742" class="anchor"><span id="_Toc141893411" class="anchor"><span id="_Toc142113264" class="anchor"><span id="_Toc142114292" class="anchor"><span id="_Toc142729452" class="anchor"><span id="_Toc142730736" class="anchor"><span id="_Toc142731109" class="anchor"><span id="_Toc142998474" class="anchor"><span id="_Toc143063565" class="anchor"><span id="_Toc143509675" class="anchor"><span id="_Toc143510122" class="anchor"><span id="_Toc144026212" class="anchor"><span id="_Toc144026543" class="anchor"><span id="_Toc144276186" class="anchor"><span id="_Toc144276530" class="anchor"><span id="_Toc144280118" class="anchor"><span id="_Toc144280464" class="anchor"><span id="_Toc144540679" class="anchor"><span id="_Toc144554561" class="anchor"><span id="_Toc144722183" class="anchor"><span id="_Toc145503645" class="anchor"><span id="_Toc145512087" class="anchor"><span id="_Toc145513110" class="anchor"><span id="_Toc145513494" class="anchor"><span id="_Ref221077921" class="anchor"><span id="_Toc222907268" class="anchor"><span id="_Toc342652881" class="anchor"><span id="_Toc439864064" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Virtual Processor States

Conceptually, a virtual processor is in one of four states:

-   *Running*—actively consuming processor cycles of a logical processor

-   *Ready—*ready to run, but not actively running because other virtual
    processors are running

-   *Waiting—*in a state defined by the processor architecture that does
    not involve the active execution of instructions (for example, for
    the x64 architecture, at a HLT instruction, within “waiting for
    SIPI" state or if the scheduler has capped the virtual processor)

-   *Suspended—*stopped on a guest instruction boundary either
    explicitly suspended or implicitly suspended due to an intercept.

-   A suspended virtual processor consumes no processor cycles. It is
    stopped on a guest instruction boundary. A virtual processor is
    suspended *when any* of the following are true:

    -   The virtual processor is explicitly suspended

    -   The virtual processor is implicitly suspended due to an
        intercept

Both suspension reasons must be cleared before a virtual processor
becomes active. They can be set or cleared by using HvSetVpRegisters.

### <span id="_Toc147670483" class="anchor"><span id="_Toc148793094" class="anchor"><span id="_Toc149363968" class="anchor"><span id="_Toc149376863" class="anchor"><span id="_Toc149377271" class="anchor"><span id="_Toc342652882" class="anchor"><span id="_Toc127596738" class="anchor"><span id="_Toc127786359" class="anchor"><span id="_Toc127786675" class="anchor"><span id="_Toc127786991" class="anchor"><span id="_Toc127877587" class="anchor"><span id="_Toc128289658" class="anchor"><span id="_Toc128290051" class="anchor"><span id="_Toc130189733" class="anchor"><span id="_Toc130200949" class="anchor"><span id="_Toc130201265" class="anchor"><span id="_Toc130201586" class="anchor"><span id="_Toc131936673" class="anchor"><span id="_Toc133901137" class="anchor"><span id="_Toc137461012" class="anchor"><span id="_Toc139096527" class="anchor"><span id="_Toc139188450" class="anchor"><span id="_Toc139191313" class="anchor"><span id="_Toc140490364" class="anchor"><span id="_Toc140571267" class="anchor"><span id="_Toc141257540" class="anchor"><span id="_Toc141257867" class="anchor"><span id="_Toc141267395" class="anchor"><span id="_Toc141522413" class="anchor"><span id="_Toc141529501" class="anchor"><span id="_Toc141529818" class="anchor"><span id="_Toc141851425" class="anchor"><span id="_Toc141852359" class="anchor"><span id="_Toc141887903" class="anchor"><span id="_Toc141889743" class="anchor"><span id="_Toc141893412" class="anchor"><span id="_Toc142113265" class="anchor"><span id="_Toc142114293" class="anchor"><span id="_Toc142729453" class="anchor"><span id="_Toc142730737" class="anchor"><span id="_Toc142731110" class="anchor"><span id="_Toc142998475" class="anchor"><span id="_Toc143063566" class="anchor"><span id="_Toc143509676" class="anchor"><span id="_Toc143510123" class="anchor"><span id="_Toc144026213" class="anchor"><span id="_Toc144026544" class="anchor"><span id="_Toc144276187" class="anchor"><span id="_Toc144276531" class="anchor"><span id="_Toc144280119" class="anchor"><span id="_Toc144280465" class="anchor"><span id="_Toc144540680" class="anchor"><span id="_Toc144554562" class="anchor"><span id="_Toc144722184" class="anchor"><span id="_Toc145503646" class="anchor"><span id="_Toc145512088" class="anchor"><span id="_Toc145513111" class="anchor"><span id="_Toc145513495" class="anchor"><span id="_Toc222907269" class="anchor"><span id="_Toc110172760" class="anchor"><span id="_Toc439864065" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Virtual Processor Idle Sleep State

Virtual processors may be placed in a virtual idle processor power
state, or processor sleep state. This enhanced virtual idle state allows
a virtual processor that is placed in to a low power idle state to be
woken with the arrival of an interrupt even when interrupt is masked on
the virtual processor. The virtual idle state allows the operating
system in the guest partition to take advantage of processor power
saving techniques in the OS that would otherwise be unavailable when
running in a guest partition.

A partition which possesses the AccessGuestIdleMsr privilege (refer to
section 5.2.3) may trigger entry into the virtual processor idle sleep
state through a read to the hypervisor-defined MSR
HV\_X64\_MSR\_GUEST\_IDLE. The virtual processor will be woken when an
interrupt arrives, regardless of if the interrupt is enabled on the
virtual processor or not.

### <span id="_Toc342652883" class="anchor"><span id="_Toc439864066" class="anchor"></span></span>Virtual Boot Processor

The virtual processor created with the index of zero is the *virtual*
*boot processor* for the partition that it is related to*.* It will be
the only virtual processor with the BSP flag set in the
IA32\_APIC\_BASE\_MSR register. Virtual processors created with non-zero
indices are *virtual application processors.* Both the virtual boot
processor and virtual application processors may be created or deleted
at any time.

### <span id="_Toc127596739" class="anchor"><span id="_Toc127786360" class="anchor"><span id="_Toc127786676" class="anchor"><span id="_Toc127786992" class="anchor"><span id="_Toc127877588" class="anchor"><span id="_Toc128289659" class="anchor"><span id="_Toc128290052" class="anchor"><span id="_Toc130189734" class="anchor"><span id="_Toc130200950" class="anchor"><span id="_Toc130201266" class="anchor"><span id="_Toc130201587" class="anchor"><span id="_Toc131936674" class="anchor"><span id="_Toc133901138" class="anchor"><span id="_Toc137461013" class="anchor"><span id="_Toc139096528" class="anchor"><span id="_Toc139188451" class="anchor"><span id="_Toc139191314" class="anchor"><span id="_Toc140490365" class="anchor"><span id="_Toc140571268" class="anchor"><span id="_Toc141257541" class="anchor"><span id="_Toc141257868" class="anchor"><span id="_Toc141267396" class="anchor"><span id="_Toc141522414" class="anchor"><span id="_Toc141529502" class="anchor"><span id="_Toc141529819" class="anchor"><span id="_Toc141851426" class="anchor"><span id="_Toc141852360" class="anchor"><span id="_Toc141887904" class="anchor"><span id="_Toc141889744" class="anchor"><span id="_Toc141893413" class="anchor"><span id="_Toc142113266" class="anchor"><span id="_Toc142114294" class="anchor"><span id="_Toc142729454" class="anchor"><span id="_Toc142730738" class="anchor"><span id="_Toc142731111" class="anchor"><span id="_Toc142998476" class="anchor"><span id="_Toc143063567" class="anchor"><span id="_Toc143509677" class="anchor"><span id="_Toc143510124" class="anchor"><span id="_Toc144026214" class="anchor"><span id="_Toc144026545" class="anchor"><span id="_Toc144276188" class="anchor"><span id="_Toc144276532" class="anchor"><span id="_Toc144280120" class="anchor"><span id="_Toc144280466" class="anchor"><span id="_Toc144540681" class="anchor"><span id="_Toc144554563" class="anchor"><span id="_Toc144722185" class="anchor"><span id="_Toc145503647" class="anchor"><span id="_Toc145512089" class="anchor"><span id="_Toc145513112" class="anchor"><span id="_Toc145513496" class="anchor"><span id="_Toc222907270" class="anchor"><span id="_Toc342652884" class="anchor"><span id="_Toc439864067" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Virtual Processor APIC IDs

On a real x64 system, each processor starts with a hard-coded *initial
APIC ID*. This value can be retrieved through the CPUID instruction. On
some systems, the initial APIC ID is not necessarily unique across all
processors, so the APIC ID accessible through the APIC’s MMIO space can
be modified. This allows software to allocate unique APIC IDs for all
processors within the system.

Virtual processors also have an initial APIC ID value that cannot be
modified by software running within the partition. This value is
initialized at virtual processor creation time to the virtual
processor’s index. The value can be modified by the parent partition by
calling HvSetVpRegisters and specifying the register
HvX64RegisterInitialApicId.

Virtual processors also have a guest-programmable APIC ID that is
accessible through the APIC’s MMIO space. This value is also initialized
based on the virtual processor’s index.

### <span id="_Toc342652885" class="anchor"><span id="_Toc127596740" class="anchor"><span id="_Toc127786361" class="anchor"><span id="_Toc127786677" class="anchor"><span id="_Toc127786993" class="anchor"><span id="_Toc127877589" class="anchor"><span id="_Toc128289660" class="anchor"><span id="_Toc128290053" class="anchor"><span id="_Toc130189735" class="anchor"><span id="_Toc130200951" class="anchor"><span id="_Toc130201267" class="anchor"><span id="_Toc130201588" class="anchor"><span id="_Toc131936675" class="anchor"><span id="_Toc133901139" class="anchor"><span id="_Toc137461014" class="anchor"><span id="_Toc139096529" class="anchor"><span id="_Toc139188452" class="anchor"><span id="_Toc139191315" class="anchor"><span id="_Toc140490366" class="anchor"><span id="_Toc140571269" class="anchor"><span id="_Toc141257542" class="anchor"><span id="_Toc141257869" class="anchor"><span id="_Toc141267397" class="anchor"><span id="_Toc141522415" class="anchor"><span id="_Toc141529503" class="anchor"><span id="_Toc141529820" class="anchor"><span id="_Toc141851427" class="anchor"><span id="_Toc141852361" class="anchor"><span id="_Toc141887905" class="anchor"><span id="_Toc141889745" class="anchor"><span id="_Toc141893414" class="anchor"><span id="_Toc142113267" class="anchor"><span id="_Toc142114295" class="anchor"><span id="_Toc142729455" class="anchor"><span id="_Toc142730739" class="anchor"><span id="_Toc142731112" class="anchor"><span id="_Toc142998477" class="anchor"><span id="_Toc143063568" class="anchor"><span id="_Toc143509678" class="anchor"><span id="_Toc143510125" class="anchor"><span id="_Toc144026215" class="anchor"><span id="_Toc144026546" class="anchor"><span id="_Toc144276189" class="anchor"><span id="_Toc144276533" class="anchor"><span id="_Toc144280121" class="anchor"><span id="_Toc144280467" class="anchor"><span id="_Toc144540682" class="anchor"><span id="_Toc144554564" class="anchor"><span id="_Toc144722186" class="anchor"><span id="_Toc145503648" class="anchor"><span id="_Toc145512090" class="anchor"><span id="_Toc145513113" class="anchor"><span id="_Toc145513497" class="anchor"><span id="_Toc222907271" class="anchor"><span id="_Toc439864068" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Virtual Processor Synthetic Machine Checks

On a real x64 system, a processor may have the ability to detect and
report hardware (machine) errors. These are signaled by the processor by
generating a machine-check exception (\#MC). Some processors may also
include a means to signal system or application level software to
respond to certain uncorrected machine check errors in order to allow
software to participate in the containment of and recovery from these
errors.

The hypervisor provides a facility to inject a synthetic machine check
on a virtual processor. This enables the operating system and
application software running in a guest partition to be notified about
physical platform errors, and to participate in any supported software
error recovery scheme.

1.  <span id="_Toc342652886" class="anchor"><span id="_Toc439864069" class="anchor"></span></span>Virtual Processor Data Types
    --------------------------------------------------------------------------------------------------------------------------

    1.  ### <span id="_Toc110172761" class="anchor"><span id="_Toc127596741" class="anchor"><span id="_Toc127786362" class="anchor"><span id="_Toc127786678" class="anchor"><span id="_Toc127786994" class="anchor"><span id="_Toc127877590" class="anchor"><span id="_Toc128289661" class="anchor"><span id="_Toc128290054" class="anchor"><span id="_Toc130189736" class="anchor"><span id="_Toc130200952" class="anchor"><span id="_Toc130201268" class="anchor"><span id="_Toc130201589" class="anchor"><span id="_Toc131936676" class="anchor"><span id="_Toc133901140" class="anchor"><span id="_Toc137461015" class="anchor"><span id="_Toc139096530" class="anchor"><span id="_Toc139188453" class="anchor"><span id="_Toc139191316" class="anchor"><span id="_Toc140490367" class="anchor"><span id="_Toc140571270" class="anchor"><span id="_Toc141257543" class="anchor"><span id="_Toc141257870" class="anchor"><span id="_Toc141267398" class="anchor"><span id="_Toc141522416" class="anchor"><span id="_Toc141529504" class="anchor"><span id="_Toc141529821" class="anchor"><span id="_Toc141851428" class="anchor"><span id="_Toc141852362" class="anchor"><span id="_Toc141887906" class="anchor"><span id="_Toc141889746" class="anchor"><span id="_Toc141893415" class="anchor"><span id="_Toc142113268" class="anchor"><span id="_Toc142114296" class="anchor"><span id="_Toc142729456" class="anchor"><span id="_Toc142730740" class="anchor"><span id="_Toc142731113" class="anchor"><span id="_Toc142998478" class="anchor"><span id="_Toc143063569" class="anchor"><span id="_Toc143509679" class="anchor"><span id="_Toc143510126" class="anchor"><span id="_Toc144026216" class="anchor"><span id="_Toc144026547" class="anchor"><span id="_Toc144276190" class="anchor"><span id="_Toc144276534" class="anchor"><span id="_Toc144280122" class="anchor"><span id="_Toc144280468" class="anchor"><span id="_Toc144540683" class="anchor"><span id="_Toc144554565" class="anchor"><span id="_Toc144722187" class="anchor"><span id="_Toc145503649" class="anchor"><span id="_Toc145512091" class="anchor"><span id="_Toc145513114" class="anchor"><span id="_Toc145513498" class="anchor"><span id="_Ref159055878" class="anchor"><span id="_Toc222907272" class="anchor"><span id="_Toc342652887" class="anchor"><span id="_Toc439864070" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Virtual Processor Index

Virtual processors are identified by using an index (VP index). The
maximum number of virtual processors per partition supported by the
current implementation of the hypervisor can be obtained through CPUID
leaf 0x40000005. A virtual processor index must be less than the maximum
number of virtual processors per partition.

A special value HV\_ANY\_VP can be used in certain situations to specify
“any virtual processor".

typedef UINT32 HV\_VP\_INDEX;

\#define HV\_ANY\_VP ((HV\_VP\_INDEX)-1)

\#define HV\_VP\_INDEX\_SELF ((HV\_VP\_INDEX)-2)

\#define HV\_MAX\_VP\_INDEX (319)

<span id="_Toc109490389" class="anchor"><span id="_Toc109491711"
class="anchor"><span id="_Toc110148974" class="anchor"><span
id="_Toc110170569" class="anchor"><span id="_Toc110170937"
class="anchor"><span id="_Toc110171198" class="anchor"><span
id="_Toc110171459" class="anchor"><span id="_Toc110171720"
class="anchor"><span id="_Toc110171981" class="anchor"><span
id="_Toc110172502" class="anchor"><span id="_Toc110172762"
class="anchor"><span id="_Toc110172764"
class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span>A
virtual processor’s ID can be retrieved by the guest through a
hypervisor-defined MSR (model-specific register)
HV\_X64\_MSR\_VP\_INDEX. A value of HV\_VP\_INDEX\_SELF can be used to
specify one’s own VP index.

\#define HV\_X64\_MSR\_VP\_INDEX 0x40000002

### <span id="_Toc127596742" class="anchor"><span id="_Toc127786363" class="anchor"><span id="_Toc127786679" class="anchor"><span id="_Toc127786995" class="anchor"><span id="_Toc127877591" class="anchor"><span id="_Toc128289662" class="anchor"><span id="_Toc128290055" class="anchor"><span id="_Toc130189737" class="anchor"><span id="_Toc130200953" class="anchor"><span id="_Toc130201269" class="anchor"><span id="_Toc130201590" class="anchor"><span id="_Toc131936677" class="anchor"><span id="_Toc133901141" class="anchor"><span id="_Toc137461016" class="anchor"><span id="_Toc139096531" class="anchor"><span id="_Toc139188454" class="anchor"><span id="_Toc139191317" class="anchor"><span id="_Toc140490368" class="anchor"><span id="_Toc140571271" class="anchor"><span id="_Toc141257544" class="anchor"><span id="_Toc141257871" class="anchor"><span id="_Toc141267399" class="anchor"><span id="_Toc141522417" class="anchor"><span id="_Toc141529505" class="anchor"><span id="_Toc141529822" class="anchor"><span id="_Toc141851429" class="anchor"><span id="_Toc141852363" class="anchor"><span id="_Toc141887907" class="anchor"><span id="_Toc141889747" class="anchor"><span id="_Toc141893416" class="anchor"><span id="_Toc142113269" class="anchor"><span id="_Toc142114297" class="anchor"><span id="_Toc142729457" class="anchor"><span id="_Toc142730741" class="anchor"><span id="_Toc142731114" class="anchor"><span id="_Toc142998479" class="anchor"><span id="_Toc143063570" class="anchor"><span id="_Toc143509680" class="anchor"><span id="_Toc143510127" class="anchor"><span id="_Toc144026217" class="anchor"><span id="_Toc144026548" class="anchor"><span id="_Toc144276191" class="anchor"><span id="_Toc144276535" class="anchor"><span id="_Toc144280123" class="anchor"><span id="_Toc144280469" class="anchor"><span id="_Toc144540684" class="anchor"><span id="_Toc144554566" class="anchor"><span id="_Toc144722188" class="anchor"><span id="_Toc145503650" class="anchor"><span id="_Toc145512092" class="anchor"><span id="_Toc145513115" class="anchor"><span id="_Toc145513499" class="anchor"><span id="_Toc222907273" class="anchor"><span id="_Toc342652888" class="anchor"><span id="_Toc439864071" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Virtual Processor Register Names

Virtual processor state is referenced by *register names*, 32-bit
numbers that uniquely identify a register.

typedef enum

{

// Suspend Registers

HvRegisterExplicitSuspend = 0x00000000,

HvRegisterInterceptSuspend = 0x00000001,

// Version

HvRegisterHypervisorVersion = 0x00000100,

// Feature Access (registers are 128 bits)

// 128-bit result same as CPUID 0x40000003

HvRegisterPrivilegesAndFeaturesInfo = 0x00000200,

// 128-bit result same as CPUID 0x40000004

HvRegisterFeaturesInfo = 0x00000201,

// 128-bit result same as CPUID 0x40000005

HvRegisterImplementationLimitsInfo = 0x00000202,

// 128-bit result same as CPUID 0x40000006

HvRegisterHardwareFeaturesInfo = 0x00000203,

// Guest Crash Registers

HvRegisterGuestCrashP0 = 0x00000210,

HvRegisterGuestCrashP1 = 0x00000211,

HvRegisterGuestCrashP2 = 0x00000212,

HvRegisterGuestCrashP3 = 0x00000213,

HvRegisterGuestCrashP4 = 0x00000214,

HvRegisterGuestCrashCtl = 0x00000215,

// Power State Configuration

HvRegisterPowerStateConfigC1 = 0x00000220,

HvRegisterPowerStateTriggerC1 = 0x00000221,

HvRegisterPowerStateConfigC2 = 0x00000222,

HvRegisterPowerStateTriggerC2 = 0x00000223,

HvRegisterPowerStateConfigC3 = 0x00000224,

HvRegisterPowerStateTriggerC3 = 0x00000225,

// System Reset

HvRegisterSystemReset = 0x00000230,

// Frequency Registers

HvRegisterProcessorClockFrequency = 0x00000240,

HvRegisterInterruptClockFrequency = 0x00000241,

// Idle Register

HvRegisterGuestIdle = 0x00000250,

// Guest Debug

HvRegisterDebugDeviceOptions = 0x00000260,

// Interrupt Registers

HvRegisterPendingInterruption = 0x00010002,

HvRegisterInterruptState = 0x00010003,

// Pending Event Register

HvRegisterPendingEvent0 = 0x00010004,

HvRegisterPendingEvent1 = 0x00010005,

// User-Mode Registers

HvX64RegisterRax = 0x00020000,

HvX64RegisterRcx = 0x00020001,

HvX64RegisterRdx = 0x00020002,

HvX64RegisterRbx = 0x00020003,

HvX64RegisterRsp = 0x00020004,

HvX64RegisterRbp = 0x00020005,

HvX64RegisterRsi = 0x00020006,

HvX64RegisterRdi = 0x00020007,

HvX64RegisterR8 = 0x00020008,

HvX64RegisterR9 = 0x00020009,

HvX64RegisterR10 = 0x0002000A,

HvX64RegisterR11 = 0x0002000B,

HvX64RegisterR12 = 0x0002000C,

HvX64RegisterR13 = 0x0002000D,

HvX64RegisterR14 = 0x0002000E,

HvX64RegisterR15 = 0x0002000F,

HvX64RegisterRip = 0x00020010,

HvX64RegisterRflags = 0x00020011,

// Floating Point and Vector Registers

HvX64RegisterXmm0 = 0x00030000,

HvX64RegisterXmm1 = 0x00030001,

HvX64RegisterXmm2 = 0x00030002,

HvX64RegisterXmm3 = 0x00030003,

HvX64RegisterXmm4 = 0x00030004,

HvX64RegisterXmm5 = 0x00030005,

HvX64RegisterXmm6 = 0x00030006,

HvX64RegisterXmm7 = 0x00030007,

HvX64RegisterXmm8 = 0x00030008,

HvX64RegisterXmm9 = 0x00030009,

HvX64RegisterXmm10 = 0x0003000A,

HvX64RegisterXmm11 = 0x0003000B,

HvX64RegisterXmm12 = 0x0003000C,

HvX64RegisterXmm13 = 0x0003000D,

HvX64RegisterXmm14 = 0x0003000E,

HvX64RegisterXmm15 = 0x0003000F,

HvX64RegisterFpMmx0 = 0x00030010,

HvX64RegisterFpMmx1 = 0x00030011,

HvX64RegisterFpMmx2 = 0x00030012,

HvX64RegisterFpMmx3 = 0x00030013,

HvX64RegisterFpMmx4 = 0x00030014,

HvX64RegisterFpMmx5 = 0x00030015,

HvX64RegisterFpMmx6 = 0x00030016,

HvX64RegisterFpMmx7 = 0x00030017,

HvX64RegisterFpControlStatus = 0x00030018,

HvX64RegisterXmmControlStatus = 0x00030019,

// Control Registers

HvX64RegisterCr0 = 0x00040000,

HvX64RegisterCr2 = 0x00040001,

HvX64RegisterCr3 = 0x00040002,

HvX64RegisterCr4 = 0x00040003,

HvX64RegisterCr8 = 0x00040004,

HvX64RegisterXfem = 0x00040005,

// X64 Intermediate Control Registers

HvX64RegisterIntermediateCr0 = 0x00041000,

HvX64RegisterIntermediateCr4 = 0x00041003,

HvX64RegisterIntermediateCr8 = 0x00041004,

// Debug Registers

HvX64RegisterDr0 = 0x00050000,

HvX64RegisterDr1 = 0x00050001,

HvX64RegisterDr2 = 0x00050002,

HvX64RegisterDr3 = 0x00050003,

HvX64RegisterDr6 = 0x00050004,

HvX64RegisterDr7 = 0x00050005,

// Segment Registers

HvX64RegisterEs = 0x00060000,

HvX64RegisterCs = 0x00060001,

HvX64RegisterSs = 0x00060002,

HvX64RegisterDs = 0x00060003,

HvX64RegisterFs = 0x00060004,

HvX64RegisterGs = 0x00060005,

HvX64RegisterLdtr = 0x00060006,

HvX64RegisterTr = 0x00060007,

// Table Registers

HvX64RegisterIdtr = 0x00070000,

HvX64RegisterGdtr = 0x00070001,

// Virtualized MSRs

HvX64RegisterTsc = 0x00080000,

HvX64RegisterEfer = 0x00080001,

HvX64RegisterKernelGsBase = 0x00080002,

HvX64RegisterApicBase = 0x00080003,

HvX64RegisterPat = 0x00080004,

HvX64RegisterSysenterCs = 0x00080005,

HvX64RegisterSysenterRip = 0x00080006,

HvX64RegisterSysenterRsp = 0x00080007,

HvX64RegisterStar = 0x00080008,

HvX64RegisterLstar = 0x00080009,

HvX64RegisterCstar = 0x0008000A,

HvX64RegisterSfmask = 0x0008000B,

HvX64RegisterInitialApicId = 0x0008000C,

// Cache control MSRs

HvX64RegisterMtrrCap = 0x0008000D,

HvX64RegisterMtrrDefType = 0x0008000E,

HvX64RegisterMtrrPhysBase0 = 0x00080010,

HvX64RegisterMtrrPhysBase1 = 0x00080011,

HvX64RegisterMtrrPhysBase2 = 0x00080012,

HvX64RegisterMtrrPhysBase3 = 0x00080013,

HvX64RegisterMtrrPhysBase4 = 0x00080014,

HvX64RegisterMtrrPhysBase5 = 0x00080015,

HvX64RegisterMtrrPhysBase6 = 0x00080016,

HvX64RegisterMtrrPhysBase7 = 0x00080017,

HvX64RegisterMtrrPhysBase8 = 0x00080018,

HvX64RegisterMtrrPhysBase9 = 0x00080019,

HvX64RegisterMtrrPhysBaseA = 0x0008001A,

HvX64RegisterMtrrPhysBaseB = 0x0008001B,

HvX64RegisterMtrrPhysBaseC = 0x0008001C,

HvX64RegisterMtrrPhysBaseD = 0x0008001D,

HvX64RegisterMtrrPhysBaseE = 0x0008001E,

HvX64RegisterMtrrPhysBaseF = 0x0008001F,

HvX64RegisterMtrrPhysMask0 = 0x00080040,

HvX64RegisterMtrrPhysMask1 = 0x00080041,

HvX64RegisterMtrrPhysMask2 = 0x00080042,

HvX64RegisterMtrrPhysMask3 = 0x00080043,

HvX64RegisterMtrrPhysMask4 = 0x00080044,

HvX64RegisterMtrrPhysMask5 = 0x00080045,

HvX64RegisterMtrrPhysMask6 = 0x00080046,

HvX64RegisterMtrrPhysMask7 = 0x00080047,

HvX64RegisterMtrrPhysMask8 = 0x00080048,

HvX64RegisterMtrrPhysMask9 = 0x00080049,

HvX64RegisterMtrrPhysMaskA = 0x0008004A,

HvX64RegisterMtrrPhysMaskB = 0x0008004B,

HvX64RegisterMtrrPhysMaskC = 0x0008004C,

HvX64RegisterMtrrPhysMaskD = 0x0008004D,

HvX64RegisterMtrrPhysMaskE = 0x0008004E,

HvX64RegisterMtrrPhysMaskF = 0x0008004F,

HvX64RegisterMtrrFix64k00000 = 0x00080070,

HvX64RegisterMtrrFix16k80000 = 0x00080071,

HvX64RegisterMtrrFix16kA0000 = 0x00080072,

HvX64RegisterMtrrFix4kC0000 = 0x00080073,

HvX64RegisterMtrrFix4kC8000 = 0x00080074,

HvX64RegisterMtrrFix4kD0000 = 0x00080075,

HvX64RegisterMtrrFix4kD8000 = 0x00080076,

HvX64RegisterMtrrFix4kE0000 = 0x00080077,

HvX64RegisterMtrrFix4kE8000 = 0x00080078,

HvX64RegisterMtrrFix4kF0000 = 0x00080079,

HvX64RegisterMtrrFix4kF8000 = 0x0008007A,

// Hypervisor-defined MSRs (Misc)

HvX64RegisterVpRuntime = 0x00090000,

HvX64RegisterHypercall = 0x00090001,

HvRegisterGuestOsId = 0x00090002,

HvRegisterVpIndex = 0x00090003,

HvRegisterTimeRefCount = 0x00090004,

HvRegisterCpuManagementVersion = 0x00090007,

HvRegisterVpAssistPage = 0x00090013,

// Hypervisor-defined registers (Misc)

HvX64RegisterVpRuntime = 0x00090000,

HvX64RegisterHypercall = 0x00090001,

// Virtual APIC registers MSRs

HvX64RegisterEoi = 0x00090010,

HvX64RegisterIcr = 0x00090011,

HvX64RegisterTpr = 0x00090012,

// Performance statistics MSRs

HvRegisterStatsPartitionRetail = 0x00090020,

HvRegisterStatsPartitionInternal = 0x00090021,

HvRegisterStatsVpRetail = 0x00090022,

HvRegisterStatsVpInternal = 0x00090023,

// Hypervisor-defined MSRs (Synic)

HvRegisterSint0 = 0x000A0000,

HvRegisterSint1 = 0x000A0001,

HvRegisterSint2 = 0x000A0002,

HvRegisterSint3 = 0x000A0003,

HvRegisterSint4 = 0x000A0004,

HvRegisterSint5 = 0x000A0005,

HvRegisterSint6 = 0x000A0006,

HvRegisterSint7 = 0x000A0007,

HvRegisterSint8 = 0x000A0008,

HvRegisterSint9 = 0x000A0009,

HvRegisterSint10 = 0x000A000A,

HvRegisterSint11 = 0x000A000B,

HvRegisterSint12 = 0x000A000C,

HvRegisterSint13 = 0x000A000D,

HvRegisterSint14 = 0x000A000E,

HvRegisterSint15 = 0x000A000F,

HvRegisterScontrol = 0x000A0010,

HvRegisterSversion = 0x000A0011,

HvRegisterSiefp = 0x000A0012,

HvRegisterSimp = 0x000A0013,

HvRegisterEom = 0x000A0014,

HvRegisterSirbp = 0x000A0015,

// Hypervisor-defined MSRs (Synthetic Timers)

HvRegisterStimer0Config = 0x000B0000,

HvRegisterStimer0Count = 0x000B0001,

HvRegisterStimer1Config = 0x000B0002,

HvRegisterStimer1Count = 0x000B0003,

HvRegisterStimer2Config = 0x000B0004,

HvRegisterStimer2Count = 0x000B0005,

HvRegisterStimer3Config = 0x000B0006,

HvRegisterStimer3Count = 0x000B0007,

//

// XSAVE/XRSTOR register names.

//

// XSAVE AFX extended state registers.

HvX64RegisterYmm0Low = 0x000C0000,

HvX64RegisterYmm1Low = 0x000C0001,

HvX64RegisterYmm2Low = 0x000C0002,

HvX64RegisterYmm3Low = 0x000C0003,

HvX64RegisterYmm4Low = 0x000C0004,

HvX64RegisterYmm5Low = 0x000C0005,

HvX64RegisterYmm6Low = 0x000C0006,

HvX64RegisterYmm7Low = 0x000C0007,

HvX64RegisterYmm8Low = 0x000C0008,

HvX64RegisterYmm9Low = 0x000C0009,

HvX64RegisterYmm10Low = 0x000C000A,

HvX64RegisterYmm11Low = 0x000C000B,

HvX64RegisterYmm12Low = 0x000C000C,

HvX64RegisterYmm13Low = 0x000C000D,

HvX64RegisterYmm14Low = 0x000C000E,

HvX64RegisterYmm15Low = 0x000C000F,

HvX64RegisterYmm0High = 0x000C0010,

HvX64RegisterYmm1High = 0x000C0011,

HvX64RegisterYmm2High = 0x000C0012,

HvX64RegisterYmm3High = 0x000C0013,

HvX64RegisterYmm4High = 0x000C0014,

HvX64RegisterYmm5High = 0x000C0015,

HvX64RegisterYmm6High = 0x000C0016,

HvX64RegisterYmm7High = 0x000C0017,

HvX64RegisterYmm8High = 0x000C0018,

HvX64RegisterYmm9High = 0x000C0019,

HvX64RegisterYmm10High = 0x000C001A,

HvX64RegisterYmm11High = 0x000C001B,

HvX64RegisterYmm12High = 0x000C001C,

HvX64RegisterYmm13High = 0x000C001D,

HvX64RegisterYmm14High = 0x000C001E,

HvX64RegisterYmm15High = 0x000C001F

// Other MSRs

HvX64RegisterMsrIa32MiscEnable = 0x000800A0,

HvX64RegisterIa32FeatureControl = 0x000800A1,

HvX64RegisterIa32VmxBasic = 0x000800A2,

HvX64RegisterIa32VmxPinbasedCtls = 0x000800A3,

HvX64RegisterIa32VmxProcbasedCtls = 0x000800A4,

HvX64RegisterIa32VmxExitCtls = 0x000800A5,

HvX64RegisterIa32VmxEntryCtls = 0x000800A6,

HvX64RegisterIa32VmxMisc = 0x000800A7,

HvX64RegisterIa32VmxCr0Fixed0 = 0x000800A8,

HvX64RegisterIa32VmxCr0Fixed1 = 0x000800A9,

HvX64RegisterIa32VmxCr4Fixed0 = 0x000800AA,

HvX64RegisterIa32VmxCr4Fixed1 = 0x000800AB,

HvX64RegisterIa32VmxVmcsEnum = 0x000800AC,

HvX64RegisterIa32VmxProcbasedCtls2 = 0x000800AD,

HvX64RegisterIa32VmxEptVpidCap = 0x000800AE,

HvX64RegisterIa32VmxTruePinbasedCtls = 0x000800AF,

HvX64RegisterIa32VmxTrueProcbasedCtls = 0x000800B0,

HvX64RegisterIa32VmxTrueExitCtls = 0x000800B1,

HvX64RegisterIa32VmxTrueEntryCtls = 0x000800B2,

} HV\_REGISTER\_NAME;

### <span id="_Toc110172765" class="anchor"><span id="_Ref110504602" class="anchor"><span id="_Toc127596743" class="anchor"><span id="_Toc127786364" class="anchor"><span id="_Toc127786680" class="anchor"><span id="_Toc127786996" class="anchor"><span id="_Toc127877592" class="anchor"><span id="_Toc128289663" class="anchor"><span id="_Toc128290056" class="anchor"><span id="_Toc130189738" class="anchor"><span id="_Toc130200954" class="anchor"><span id="_Toc130201270" class="anchor"><span id="_Toc130201591" class="anchor"><span id="_Toc131936678" class="anchor"><span id="_Toc133901142" class="anchor"><span id="_Toc137461017" class="anchor"><span id="_Toc139096532" class="anchor"><span id="_Toc139188455" class="anchor"><span id="_Toc139191318" class="anchor"><span id="_Toc140490369" class="anchor"><span id="_Toc140571272" class="anchor"><span id="_Toc141257545" class="anchor"><span id="_Toc141257872" class="anchor"><span id="_Toc141267400" class="anchor"><span id="_Toc141522418" class="anchor"><span id="_Toc141529506" class="anchor"><span id="_Toc141529823" class="anchor"><span id="_Toc141851430" class="anchor"><span id="_Toc141852364" class="anchor"><span id="_Toc141887908" class="anchor"><span id="_Toc141889748" class="anchor"><span id="_Toc141893417" class="anchor"><span id="_Toc142113270" class="anchor"><span id="_Toc142114298" class="anchor"><span id="_Toc142729458" class="anchor"><span id="_Toc142730742" class="anchor"><span id="_Toc142731115" class="anchor"><span id="_Toc142998480" class="anchor"><span id="_Toc143063571" class="anchor"><span id="_Toc143509681" class="anchor"><span id="_Toc143510128" class="anchor"><span id="_Toc144026218" class="anchor"><span id="_Toc144026549" class="anchor"><span id="_Toc144276192" class="anchor"><span id="_Toc144276536" class="anchor"><span id="_Toc144280124" class="anchor"><span id="_Toc144280470" class="anchor"><span id="_Toc144540685" class="anchor"><span id="_Toc144554567" class="anchor"><span id="_Toc144722189" class="anchor"><span id="_Toc145503651" class="anchor"><span id="_Toc145512093" class="anchor"><span id="_Toc145513116" class="anchor"><span id="_Toc145513500" class="anchor"><span id="_Toc222907274" class="anchor"><span id="_Toc342652889" class="anchor"><span id="_Toc439864072" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Virtual Processor Register Values

Virtual processor register values are all 128 bits in size. Values that
do not consume the full 128 bits are zero-extended to fill out the
entire 128 bits.

typedef union

{

UINT128 Reg128;

UINT64 Reg64;

UINT32 Reg32;

UINT16 Reg16;

UINT8 Reg8;

HV\_X64\_FP\_REGISTER Fp;

HV\_X64\_FP\_CONTROL\_STATUS\_REGISTER FpControlStatus;

HV\_X64\_XMM\_CONTROL\_STATUS\_REGISTER XmmControlStatus;

HV\_X64\_SEGMENT\_REGISTER Segment;

HV\_X64\_TABLE\_REGISTER Table;

HV\_EXPLICIT\_SUSPEND\_REGISTER ExplicitSuspend;

HV\_INTERCEPT\_SUSPEND\_REGISTER InterceptSuspend;

HV\_X64\_INTERRUPT\_STATE\_REGISTER InterruptState;

HV\_X64\_PENDING\_INTERRUPTION\_REGISTER PendingInterruption;

HV\_X64\_MSR\_NPIEP\_CONFIG\_CONTENTS NpiepConfig;

} HV\_REGISTER\_VALUE;

typedef HV\_REGISTER\_VALUE \*PHV\_REGISTER\_VALUE;

### <span id="_Toc342652890" class="anchor"><span id="_Ref108762808" class="anchor"><span id="_Ref108768314" class="anchor"><span id="_Toc110172766" class="anchor"><span id="_Toc127596744" class="anchor"><span id="_Toc127786365" class="anchor"><span id="_Toc127786681" class="anchor"><span id="_Toc127786997" class="anchor"><span id="_Toc127877593" class="anchor"><span id="_Toc128289664" class="anchor"><span id="_Toc128290057" class="anchor"><span id="_Toc130189739" class="anchor"><span id="_Toc130200955" class="anchor"><span id="_Toc130201271" class="anchor"><span id="_Toc130201592" class="anchor"><span id="_Toc131936679" class="anchor"><span id="_Toc133901143" class="anchor"><span id="_Toc137461018" class="anchor"><span id="_Toc139096533" class="anchor"><span id="_Toc139188456" class="anchor"><span id="_Toc139191319" class="anchor"><span id="_Toc140490370" class="anchor"><span id="_Toc140571273" class="anchor"><span id="_Toc141257546" class="anchor"><span id="_Toc141257873" class="anchor"><span id="_Toc141267401" class="anchor"><span id="_Toc141522419" class="anchor"><span id="_Toc141529507" class="anchor"><span id="_Toc141529824" class="anchor"><span id="_Toc141851431" class="anchor"><span id="_Toc141852365" class="anchor"><span id="_Toc141887909" class="anchor"><span id="_Toc141889749" class="anchor"><span id="_Toc141893418" class="anchor"><span id="_Toc142113271" class="anchor"><span id="_Toc142114299" class="anchor"><span id="_Toc142729459" class="anchor"><span id="_Toc142730743" class="anchor"><span id="_Toc142731116" class="anchor"><span id="_Toc142998481" class="anchor"><span id="_Toc143063572" class="anchor"><span id="_Toc143509682" class="anchor"><span id="_Toc143510129" class="anchor"><span id="_Toc144026219" class="anchor"><span id="_Toc144026550" class="anchor"><span id="_Toc144276193" class="anchor"><span id="_Toc144276537" class="anchor"><span id="_Toc144280125" class="anchor"><span id="_Toc144280471" class="anchor"><span id="_Toc144540686" class="anchor"><span id="_Toc144554568" class="anchor"><span id="_Toc144722190" class="anchor"><span id="_Toc145503652" class="anchor"><span id="_Toc145512094" class="anchor"><span id="_Toc145513117" class="anchor"><span id="_Toc145513501" class="anchor"><span id="_Toc222907275" class="anchor"><span id="_Toc439864073" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Synthetic Machine Check Status Data Structure

typedef union \_HV\_X64\_MSR\_SYNMC\_STATUS\_CONTENTS

{

struct

{

UINT16 McaErrorCode;

union

{

UINT16 ModelSpecificErrorCode;

struct

{

UINT16 ErrorDetail : 14;

UINT16 HypervisorError : 1;

UINT16 SoftwareError : 1;

};

};

struct

{

UINT32 Reserved : 23;

UINT32 ActionRequired : 1;

UINT32 Signaling : 1;

UINT32 ContextCorrupt : 1; // Hypervisor/virt stack\
// context corrupt

UINT32 AddressValid : 1;

UINT32 MiscValid : 1;

UINT32 ErrorEnabled : 1;

UINT32 Uncorrected : 1; // Uncorrected error

UINT32 Overflow : 1; // Error overflow

UINT32 Valid : 1; // Register valid

};

};

UINT64 AsUINT64;

} HV\_X64\_MSR\_SYNMC\_STATUS\_CONTENTS;

### <span id="_Toc342652891" class="anchor"><span id="_Toc439864074" class="anchor"></span></span>Synthetic Machine Check Error Code

\#define HV\_SYNMC\_MCA\_ERROR\_CODE (0x0001) // Unclassified error

### <span id="_Toc342652892" class="anchor"><span id="_Toc439864075" class="anchor"></span></span>Synthetic Machine Check Event Data Structure

typedef struct \_HV\_SYNMC\_EVENT

{

HV\_X64\_MSR\_SYNMC\_STATUS\_CONTENTS Status;

HV\_X64\_MSR\_SYNMC\_ADDR\_CONTENTS Addr;

HV\_X64\_MSR\_SYNMC\_MISC\_CONTENTS Misc;

BOOLEAN RipValid;

BOOLEAN EipValid;

} HV\_SYNMC\_EVENT;

1.  <span id="_Toc342652893" class="anchor"><span id="_Toc439864076" class="anchor"></span></span>Virtual Processor Register Formats
    --------------------------------------------------------------------------------------------------------------------------------

    1.  ### <span id="_Ref109489275" class="anchor"><span id="_Toc110172767" class="anchor"><span id="_Toc127596745" class="anchor"><span id="_Toc127786366" class="anchor"><span id="_Toc127786682" class="anchor"><span id="_Toc127786998" class="anchor"><span id="_Toc127877594" class="anchor"><span id="_Toc128289665" class="anchor"><span id="_Toc128290058" class="anchor"><span id="_Toc130189740" class="anchor"><span id="_Toc130200956" class="anchor"><span id="_Toc130201272" class="anchor"><span id="_Toc130201593" class="anchor"><span id="_Toc131936680" class="anchor"><span id="_Toc133901144" class="anchor"><span id="_Toc137461019" class="anchor"><span id="_Toc139096534" class="anchor"><span id="_Toc139188457" class="anchor"><span id="_Toc139191320" class="anchor"><span id="_Toc140490371" class="anchor"><span id="_Toc140571274" class="anchor"><span id="_Toc141257547" class="anchor"><span id="_Toc141257874" class="anchor"><span id="_Toc141267402" class="anchor"><span id="_Toc141522420" class="anchor"><span id="_Toc141529508" class="anchor"><span id="_Toc141529825" class="anchor"><span id="_Toc141851432" class="anchor"><span id="_Toc141852366" class="anchor"><span id="_Toc141887910" class="anchor"><span id="_Toc141889750" class="anchor"><span id="_Toc141893419" class="anchor"><span id="_Toc142113272" class="anchor"><span id="_Toc142114300" class="anchor"><span id="_Toc142729460" class="anchor"><span id="_Toc142730744" class="anchor"><span id="_Toc142731117" class="anchor"><span id="_Toc142998482" class="anchor"><span id="_Toc143063573" class="anchor"><span id="_Toc143509683" class="anchor"><span id="_Toc143510130" class="anchor"><span id="_Toc144026220" class="anchor"><span id="_Toc144026551" class="anchor"><span id="_Toc144276194" class="anchor"><span id="_Toc144276538" class="anchor"><span id="_Toc144280126" class="anchor"><span id="_Toc144280472" class="anchor"><span id="_Toc144540687" class="anchor"><span id="_Toc144554569" class="anchor"><span id="_Toc144722191" class="anchor"><span id="_Toc145503653" class="anchor"><span id="_Toc145512095" class="anchor"><span id="_Toc145513118" class="anchor"><span id="_Toc145513502" class="anchor"><span id="_Toc222907276" class="anchor"><span id="_Toc342652894" class="anchor"><span id="_Toc439858063" class="anchor"><span id="_Toc439864077" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>

<span id="_Toc437513063" class="anchor"></span>

<span id="_Toc437513069" class="anchor"></span>

<span id="_Toc437513071" class="anchor"></span>

<span id="_Toc437513078" class="anchor"></span>

### <span id="_Toc127596746" class="anchor"><span id="_Toc127786367" class="anchor"><span id="_Toc127786683" class="anchor"><span id="_Toc127786999" class="anchor"><span id="_Toc127877595" class="anchor"><span id="_Toc128289666" class="anchor"><span id="_Toc128290059" class="anchor"><span id="_Toc130189741" class="anchor"><span id="_Toc130200957" class="anchor"><span id="_Toc130201273" class="anchor"><span id="_Toc130201594" class="anchor"><span id="_Toc131936681" class="anchor"><span id="_Toc133901145" class="anchor"><span id="_Toc137461020" class="anchor"><span id="_Toc139096535" class="anchor"><span id="_Toc139188458" class="anchor"><span id="_Toc139191321" class="anchor"><span id="_Toc140490372" class="anchor"><span id="_Toc140571275" class="anchor"><span id="_Toc141257548" class="anchor"><span id="_Toc141257875" class="anchor"><span id="_Toc141267403" class="anchor"><span id="_Toc141522421" class="anchor"><span id="_Toc141529509" class="anchor"><span id="_Toc141529826" class="anchor"><span id="_Toc141851433" class="anchor"><span id="_Toc141852367" class="anchor"><span id="_Toc141887911" class="anchor"><span id="_Toc141889751" class="anchor"><span id="_Toc141893420" class="anchor"><span id="_Toc142113273" class="anchor"><span id="_Toc142114301" class="anchor"><span id="_Toc142729461" class="anchor"><span id="_Toc142730745" class="anchor"><span id="_Toc142731118" class="anchor"><span id="_Toc142998483" class="anchor"><span id="_Toc143063574" class="anchor"><span id="_Toc143509684" class="anchor"><span id="_Toc143510131" class="anchor"><span id="_Toc144026221" class="anchor"><span id="_Toc144026552" class="anchor"><span id="_Toc144276195" class="anchor"><span id="_Toc144276539" class="anchor"><span id="_Toc144280127" class="anchor"><span id="_Toc144280473" class="anchor"><span id="_Toc144540688" class="anchor"><span id="_Toc144554570" class="anchor"><span id="_Toc144722192" class="anchor"><span id="_Toc145503654" class="anchor"><span id="_Toc145512096" class="anchor"><span id="_Toc145513119" class="anchor"><span id="_Toc145513503" class="anchor"><span id="_Ref159056064" class="anchor"><span id="_Toc222907277" class="anchor"><span id="_Toc342652895" class="anchor"><span id="_Toc110172768" class="anchor"><span id="_Toc439864078" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Virtual Processor Run Time Register

The hypervisor’s scheduler internally tracks how much time each virtual
processor consumes in executing code. The time tracked is a combination
of the time the virtual processor consumes running guest code, and the
time the associated logical processor spends running hypervisor code on
behalf of that guest. This cumulative time is accessible through the
64-bit read-only HV\_X64\_MSR\_VP\_RUNTIME hypervisor MSR. The time
quantity is measured in 100ns units.

  63:0
  ------------
  VP Runtime

### <span id="_Toc127596747" class="anchor"><span id="_Toc127786368" class="anchor"><span id="_Toc127786684" class="anchor"><span id="_Toc127787000" class="anchor"><span id="_Toc127877596" class="anchor"><span id="_Toc128289667" class="anchor"><span id="_Toc128290060" class="anchor"><span id="_Toc130189742" class="anchor"><span id="_Toc130200958" class="anchor"><span id="_Toc130201274" class="anchor"><span id="_Toc130201595" class="anchor"><span id="_Toc131936682" class="anchor"><span id="_Toc133901146" class="anchor"><span id="_Toc137461021" class="anchor"><span id="_Toc139096536" class="anchor"><span id="_Toc139188459" class="anchor"><span id="_Toc139191322" class="anchor"><span id="_Toc140490373" class="anchor"><span id="_Toc140571276" class="anchor"><span id="_Toc141257549" class="anchor"><span id="_Toc141257876" class="anchor"><span id="_Toc141267404" class="anchor"><span id="_Toc141522422" class="anchor"><span id="_Toc141529510" class="anchor"><span id="_Toc141529827" class="anchor"><span id="_Toc141851434" class="anchor"><span id="_Toc141852368" class="anchor"><span id="_Toc141887912" class="anchor"><span id="_Toc141889752" class="anchor"><span id="_Toc141893421" class="anchor"><span id="_Toc142113274" class="anchor"><span id="_Toc142114302" class="anchor"><span id="_Toc142729462" class="anchor"><span id="_Toc142730746" class="anchor"><span id="_Toc142731119" class="anchor"><span id="_Toc142998484" class="anchor"><span id="_Toc143063575" class="anchor"><span id="_Toc143509685" class="anchor"><span id="_Toc143510132" class="anchor"><span id="_Toc144026222" class="anchor"><span id="_Toc144026553" class="anchor"><span id="_Toc144276196" class="anchor"><span id="_Toc144276540" class="anchor"><span id="_Toc144280128" class="anchor"><span id="_Toc144280474" class="anchor"><span id="_Toc144540689" class="anchor"><span id="_Toc144554571" class="anchor"><span id="_Toc144722193" class="anchor"><span id="_Toc145503655" class="anchor"><span id="_Toc145512097" class="anchor"><span id="_Toc145513120" class="anchor"><span id="_Toc145513504" class="anchor"><span id="_Toc222907278" class="anchor"><span id="_Toc342652896" class="anchor"><span id="_Toc439864079" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Virtual Processor Interrupt State Register

The *interrupt state* register provides information about the interrupt
state of the virtual processor. It indicates whether the virtual
processor is in an “interrupt shadow" and whether non-maskable
interrupts are currently masked. Certain instructions inhibit the
delivery of hardware interrupts and debug traps for one instruction.
Furthermore, when a non-maskable interrupt is delivered to the virtual
processor, subsequent non-maskable interrupts are masked until the
virtual processor executes an IRET instruction.

The interrupt state register is encoded as follows:

typedef struct

{

UINT64 InterruptShadow:1;

UINT64 NmiMasked:1;

UINT64 Reserved:62;

} HV\_X64\_INTERRUPT\_STATE\_REGISTER;

### <span id="_Toc342652897" class="anchor"><span id="_Ref114504480" class="anchor"><span id="_Ref119464929" class="anchor"><span id="_Toc127596748" class="anchor"><span id="_Toc127786369" class="anchor"><span id="_Toc127786685" class="anchor"><span id="_Toc127787001" class="anchor"><span id="_Toc127877597" class="anchor"><span id="_Toc128289668" class="anchor"><span id="_Toc128290061" class="anchor"><span id="_Toc130189743" class="anchor"><span id="_Toc130200959" class="anchor"><span id="_Toc130201275" class="anchor"><span id="_Toc130201596" class="anchor"><span id="_Toc131936683" class="anchor"><span id="_Toc133901147" class="anchor"><span id="_Toc137461022" class="anchor"><span id="_Toc139096537" class="anchor"><span id="_Toc139188460" class="anchor"><span id="_Toc139191323" class="anchor"><span id="_Toc140490374" class="anchor"><span id="_Toc140571277" class="anchor"><span id="_Toc141257550" class="anchor"><span id="_Toc141257877" class="anchor"><span id="_Toc141267405" class="anchor"><span id="_Toc141522423" class="anchor"><span id="_Toc141529511" class="anchor"><span id="_Toc141529828" class="anchor"><span id="_Toc141851435" class="anchor"><span id="_Toc141852369" class="anchor"><span id="_Toc141887913" class="anchor"><span id="_Toc141889753" class="anchor"><span id="_Toc141893422" class="anchor"><span id="_Toc142113275" class="anchor"><span id="_Toc142114303" class="anchor"><span id="_Toc142729463" class="anchor"><span id="_Toc142730747" class="anchor"><span id="_Toc142731120" class="anchor"><span id="_Toc142998485" class="anchor"><span id="_Toc143063576" class="anchor"><span id="_Toc143509686" class="anchor"><span id="_Toc143510133" class="anchor"><span id="_Toc144026223" class="anchor"><span id="_Toc144026554" class="anchor"><span id="_Toc144276197" class="anchor"><span id="_Toc144276541" class="anchor"><span id="_Toc144280129" class="anchor"><span id="_Toc144280475" class="anchor"><span id="_Toc144540690" class="anchor"><span id="_Toc144554572" class="anchor"><span id="_Toc144722194" class="anchor"><span id="_Toc145503656" class="anchor"><span id="_Toc145512098" class="anchor"><span id="_Toc145513121" class="anchor"><span id="_Toc145513505" class="anchor"><span id="_Toc222907279" class="anchor"><span id="_Toc342652898" class="anchor"><span id="_Toc439864080" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Virtual Processor Pending Interruption Register

The *pending interruption* register is used to indicate whether a
pending interruption exists for the virtual processor. An interruption
is defined as any event that is delivered through the virtual
processor’s interrupt descriptor table (for example, exceptions,
interrupts, or debug traps). If an interruption is pending, the
hypervisor will generate the interruption when the virtual processor
resumes execution. This allows code running within the parent partition,
for example, to respond to an MSR intercept by generating a general
protection fault.

If an intercept is generated during the delivery of an interruption, the
interruption is held pending and an intercept message is sent to the
parent partition. The parent partition can resolve the intercept and
resume the virtual processor, in which case the interruption will be
re-delivered.

The type of a pending interruption is encoded as follows:

typedef enum

{

HvX64PendingInterrupt = 0,

HvX64PendingNmi = 2,

HvX64PendingException = 3,

HvX64PendingSoftwareInterrupt = 4,

HvX64PendingSoftwareException = 6

} HV\_X64\_PENDING\_INTERRUPTION\_TYPE;

The format of the pending interruption register is as follows:

typedef struct

{

UINT32 InterruptionPending:1;

UINT32 InterruptionType:3

UINT32 DeliverErrorCode:1;

UINT32 InstructionLength:4;

UINT32 Reserved:7;

UINT32 InterruptionVector:16;

UINT32 ErrorCode;

} HV\_X64\_PENDING\_INTERRUPTION\_REGISTER;

If the *InterruptionPending* bit is cleared, no interruption is pending,
and the values in the other fields are ignored.

*InterruptionType* indicates the type of the interruption and can be any
of the following values:

-   *HvX64PendingInterrupt —* The interruption is due to an interrupt.

-   *HvX64PendingNmi —* The interruption is due to a
    non-maskable interrupt.

-   *HvX64PendingException —* The interruption is due to a
    hardware exception.

*DeliverErrorCode* indicates whether an error code should be pushed on
the stack as part of the interruption.

*InterruptionVector* indicates the vector to use for the exception.

*ErrorCode* indicates the error code value that will be pushed as part
of the interruption frame.

### <span id="_Toc110172771" class="anchor"><span id="_Toc127596749" class="anchor"><span id="_Toc127786370" class="anchor"><span id="_Toc127786686" class="anchor"><span id="_Toc127787002" class="anchor"><span id="_Toc127877598" class="anchor"><span id="_Toc128289669" class="anchor"><span id="_Toc128290062" class="anchor"><span id="_Toc130189744" class="anchor"><span id="_Toc130200960" class="anchor"><span id="_Toc130201276" class="anchor"><span id="_Toc130201597" class="anchor"><span id="_Toc131936684" class="anchor"><span id="_Toc133901148" class="anchor"><span id="_Toc137461023" class="anchor"><span id="_Toc139096538" class="anchor"><span id="_Toc139188461" class="anchor"><span id="_Toc139191324" class="anchor"><span id="_Toc140490375" class="anchor"><span id="_Toc140571278" class="anchor"><span id="_Toc141257551" class="anchor"><span id="_Toc141257878" class="anchor"><span id="_Toc141267406" class="anchor"><span id="_Toc141522424" class="anchor"><span id="_Toc141529512" class="anchor"><span id="_Toc141529829" class="anchor"><span id="_Toc141851436" class="anchor"><span id="_Toc141852370" class="anchor"><span id="_Toc141887914" class="anchor"><span id="_Toc141889754" class="anchor"><span id="_Toc141893423" class="anchor"><span id="_Toc142113276" class="anchor"><span id="_Toc142114304" class="anchor"><span id="_Toc142729464" class="anchor"><span id="_Toc142730748" class="anchor"><span id="_Toc142731121" class="anchor"><span id="_Toc142998486" class="anchor"><span id="_Toc143063577" class="anchor"><span id="_Toc143509687" class="anchor"><span id="_Toc143510134" class="anchor"><span id="_Toc144026224" class="anchor"><span id="_Toc144026555" class="anchor"><span id="_Toc144276198" class="anchor"><span id="_Toc144276542" class="anchor"><span id="_Toc144280130" class="anchor"><span id="_Toc144280476" class="anchor"><span id="_Toc144540691" class="anchor"><span id="_Toc144554573" class="anchor"><span id="_Toc144722195" class="anchor"><span id="_Toc145503657" class="anchor"><span id="_Toc145512099" class="anchor"><span id="_Toc145513122" class="anchor"><span id="_Toc145513506" class="anchor"><span id="_Toc222907280" class="anchor"><span id="_Toc342652899" class="anchor"><span id="_Toc439864081" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Virtual Processor Floating-point and Vector Registers

Floating point registers are encoded as 80-bit values, as follows:

typedef struct

{

UINT64 Mantissa;

UINT64 BiasedExponent:15;

UINT64 Sign:1;

UINT64 Reserved:48;

} HV\_X64\_FP\_REGISTER;

<span id="_Toc110172772" class="anchor"></span>Additional status and
control information for the floating point and vector units are stored
in the following formats:

typedef struct

{

UINT16 FpControl;

UINT16 FpStatus;

UINT8 FpTag;

UINT8 IgnNe:1;

UINT8 Reserved:7;

UINT16 LastFpOp;

union

{

UINT64 LastFpRip;

struct

{

UINT32 LastFpEip;

UINT16 LastFpCs;

};

};

} HV\_X64\_FP\_STATUS\_CONTROL\_REGISTER;

typedef struct

{

union

{

UINT64 LastFpRdp;

struct

{

UINT32 LastFpDp;

UINT16 LastFpDs;

};

};

UINT32 XmmStatusControl;

UINT32 XmmStatusControlMask;

} HV\_X64\_XMM\_STATUS\_CONTROL\_REGISTER;

### <span id="_Toc342652900" class="anchor"><span id="_Toc127596750" class="anchor"><span id="_Toc127786371" class="anchor"><span id="_Toc127786687" class="anchor"><span id="_Toc127787003" class="anchor"><span id="_Toc127877599" class="anchor"><span id="_Toc128289670" class="anchor"><span id="_Toc128290063" class="anchor"><span id="_Toc130189745" class="anchor"><span id="_Toc130200961" class="anchor"><span id="_Toc130201277" class="anchor"><span id="_Toc130201598" class="anchor"><span id="_Toc131936685" class="anchor"><span id="_Toc133901149" class="anchor"><span id="_Toc137461024" class="anchor"><span id="_Toc139096539" class="anchor"><span id="_Toc139188462" class="anchor"><span id="_Toc139191325" class="anchor"><span id="_Toc140490376" class="anchor"><span id="_Toc140571279" class="anchor"><span id="_Toc141257552" class="anchor"><span id="_Toc141257879" class="anchor"><span id="_Toc141267407" class="anchor"><span id="_Toc141522425" class="anchor"><span id="_Toc141529513" class="anchor"><span id="_Toc141529830" class="anchor"><span id="_Toc141851437" class="anchor"><span id="_Toc141852371" class="anchor"><span id="_Toc141887915" class="anchor"><span id="_Toc141889755" class="anchor"><span id="_Toc141893424" class="anchor"><span id="_Toc142113277" class="anchor"><span id="_Toc142114305" class="anchor"><span id="_Toc142729465" class="anchor"><span id="_Toc142730749" class="anchor"><span id="_Toc142731122" class="anchor"><span id="_Toc142998487" class="anchor"><span id="_Toc143063578" class="anchor"><span id="_Toc143509688" class="anchor"><span id="_Toc143510135" class="anchor"><span id="_Toc144026225" class="anchor"><span id="_Toc144026556" class="anchor"><span id="_Toc144276199" class="anchor"><span id="_Toc144276543" class="anchor"><span id="_Toc144280131" class="anchor"><span id="_Toc144280477" class="anchor"><span id="_Toc144540692" class="anchor"><span id="_Toc144554574" class="anchor"><span id="_Toc144722196" class="anchor"><span id="_Toc145503658" class="anchor"><span id="_Toc145512100" class="anchor"><span id="_Toc145513123" class="anchor"><span id="_Toc145513507" class="anchor"><span id="_Toc222907281" class="anchor"><span id="_Toc342652901" class="anchor"><span id="_Toc439864082" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Virtual Processor Segment Registers

Segment register state is encoded as follows:

typedef struct

{

UINT64 Base;

UINT32 Limit;

union

{

struct

{

UINT16 SegmentType:4;

UINT16 NonSystemSegment:1;

UINT16 DescriptorPrivilegeLevel:2;

UINT16 Present:1;

UINT16 Reserved:4;

UINT16 Available:1;

UINT16 Long:1;

UINT16 Default:1;

UINT16 Granularity:1;

};

> UINT16 Selector;

UINT16 Attributes;

};

} HV\_X64\_SEGMENT\_REGISTER;

The limit is encoded as a 32-bit value. For X64 long-mode segments, the
limit is ignored. For legacy x86 segments, the limit must be expressible
within the bounds of the x64 processor architecture. For example, if the
“G" (granularity) bit is set within the attributes of a code or data
segment, the low-order 12 bits of the limit must be 1s.

The “Present" bit controls whether the segment acts like a null segment
(that is, whether a memory access performed through that segment
generates a \#GP fault).

The MSRs IA32\_FS\_BASE and IA32\_GS\_BASE are not defined in the
register list, as they are aliases to the base element of the segment
register structure, Use HvX64RegisterFs and HvX64RegisterGs and the
structure above instead.

### <span id="_Toc127596751" class="anchor"><span id="_Toc127786372" class="anchor"><span id="_Toc127786688" class="anchor"><span id="_Toc127787004" class="anchor"><span id="_Toc127877600" class="anchor"><span id="_Toc128289671" class="anchor"><span id="_Toc128290064" class="anchor"><span id="_Toc130189746" class="anchor"><span id="_Toc130200962" class="anchor"><span id="_Toc130201278" class="anchor"><span id="_Toc130201599" class="anchor"><span id="_Toc131936686" class="anchor"><span id="_Toc133901150" class="anchor"><span id="_Toc137461025" class="anchor"><span id="_Toc139096540" class="anchor"><span id="_Toc139188463" class="anchor"><span id="_Toc139191326" class="anchor"><span id="_Toc140490377" class="anchor"><span id="_Toc140571280" class="anchor"><span id="_Toc141257553" class="anchor"><span id="_Toc141257880" class="anchor"><span id="_Toc141267408" class="anchor"><span id="_Toc141522426" class="anchor"><span id="_Toc141529514" class="anchor"><span id="_Toc141529831" class="anchor"><span id="_Toc141851438" class="anchor"><span id="_Toc141852372" class="anchor"><span id="_Toc141887916" class="anchor"><span id="_Toc141889756" class="anchor"><span id="_Toc141893425" class="anchor"><span id="_Toc142113278" class="anchor"><span id="_Toc142114306" class="anchor"><span id="_Toc142729466" class="anchor"><span id="_Toc142730750" class="anchor"><span id="_Toc142731123" class="anchor"><span id="_Toc142998488" class="anchor"><span id="_Toc143063579" class="anchor"><span id="_Toc143509689" class="anchor"><span id="_Toc143510136" class="anchor"><span id="_Toc144026226" class="anchor"><span id="_Toc144026557" class="anchor"><span id="_Toc144276200" class="anchor"><span id="_Toc144276544" class="anchor"><span id="_Toc144280132" class="anchor"><span id="_Toc144280478" class="anchor"><span id="_Toc144540693" class="anchor"><span id="_Toc144554575" class="anchor"><span id="_Toc144722197" class="anchor"><span id="_Toc145503659" class="anchor"><span id="_Toc145512101" class="anchor"><span id="_Toc145513124" class="anchor"><span id="_Toc145513508" class="anchor"><span id="_Toc222907282" class="anchor"><span id="_Toc342652902" class="anchor"><span id="_Toc110172773" class="anchor"><span id="_Toc439864083" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Virtual Processor Table Registers

<span id="_Toc110172774" class="anchor"></span>Table registers are
similar to segment registers, but they have no selector or attributes,
and the limit is restricted to 16 bits.

typedef struct

{

UINT16 Pad\[3\];

UINT16 Limit;

UINT64 Base;

} HV\_X64\_TABLE\_REGISTER;

### <span id="_Toc342652903" class="anchor"><span id="_Toc110172776" class="anchor"><span id="_Toc127596752" class="anchor"><span id="_Toc127786373" class="anchor"><span id="_Toc127786689" class="anchor"><span id="_Toc127787005" class="anchor"><span id="_Toc127877601" class="anchor"><span id="_Toc128289672" class="anchor"><span id="_Toc128290065" class="anchor"><span id="_Toc130189747" class="anchor"><span id="_Toc130200963" class="anchor"><span id="_Toc130201279" class="anchor"><span id="_Toc130201600" class="anchor"><span id="_Toc131936687" class="anchor"><span id="_Toc133901151" class="anchor"><span id="_Toc137461026" class="anchor"><span id="_Toc139096541" class="anchor"><span id="_Toc139188464" class="anchor"><span id="_Toc139191327" class="anchor"><span id="_Toc140490378" class="anchor"><span id="_Toc140571281" class="anchor"><span id="_Toc141257554" class="anchor"><span id="_Toc141257881" class="anchor"><span id="_Toc141267409" class="anchor"><span id="_Toc141522427" class="anchor"><span id="_Toc141529515" class="anchor"><span id="_Toc141529832" class="anchor"><span id="_Toc141851439" class="anchor"><span id="_Toc141852373" class="anchor"><span id="_Toc141887917" class="anchor"><span id="_Toc141889757" class="anchor"><span id="_Toc141893426" class="anchor"><span id="_Toc142113279" class="anchor"><span id="_Toc142114307" class="anchor"><span id="_Toc142729467" class="anchor"><span id="_Toc142730751" class="anchor"><span id="_Toc142731124" class="anchor"><span id="_Toc142998489" class="anchor"><span id="_Toc143063580" class="anchor"><span id="_Toc143509690" class="anchor"><span id="_Toc143510137" class="anchor"><span id="_Toc144026227" class="anchor"><span id="_Toc144026558" class="anchor"><span id="_Toc144276201" class="anchor"><span id="_Toc144276545" class="anchor"><span id="_Toc144280133" class="anchor"><span id="_Toc144280479" class="anchor"><span id="_Toc144540694" class="anchor"><span id="_Toc144554576" class="anchor"><span id="_Toc144722198" class="anchor"><span id="_Toc145503660" class="anchor"><span id="_Toc145512102" class="anchor"><span id="_Toc145513125" class="anchor"><span id="_Toc145513509" class="anchor"><span id="_Toc222907283" class="anchor"><span id="_Toc439864084" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Synthetic Machine Check Registers

typedef UINT64 HV\_X64\_MSR\_SYNMC\_ADDR\_CONTENTS

typedef UINT64 HV\_X64\_MSR\_SYNMC\_MISC\_CONTENTS

1.  <span id="_Toc342652904" class="anchor"><span id="_Toc439864085" class="anchor"></span></span>Virtual Processor Interfaces
    --------------------------------------------------------------------------------------------------------------------------

    1.  ### <span id="_Toc110172777" class="anchor"><span id="_Toc127596753" class="anchor"><span id="_Toc127786374" class="anchor"><span id="_Toc127786690" class="anchor"><span id="_Toc127787006" class="anchor"><span id="_Toc127877602" class="anchor"><span id="_Toc128289673" class="anchor"><span id="_Toc128290066" class="anchor"><span id="_Toc130189748" class="anchor"><span id="_Toc130200964" class="anchor"><span id="_Toc130201280" class="anchor"><span id="_Toc130201601" class="anchor"><span id="_Toc131936688" class="anchor"><span id="_Toc133901152" class="anchor"><span id="_Toc137461027" class="anchor"><span id="_Toc139096542" class="anchor"><span id="_Toc139188465" class="anchor"><span id="_Toc139191328" class="anchor"><span id="_Toc140490379" class="anchor"><span id="_Toc140571282" class="anchor"><span id="_Toc141257555" class="anchor"><span id="_Toc141257882" class="anchor"><span id="_Toc141267410" class="anchor"><span id="_Toc141522428" class="anchor"><span id="_Toc141529516" class="anchor"><span id="_Toc141529833" class="anchor"><span id="_Toc141851440" class="anchor"><span id="_Toc141852374" class="anchor"><span id="_Toc141887918" class="anchor"><span id="_Toc141889758" class="anchor"><span id="_Toc141893427" class="anchor"><span id="_Toc142113280" class="anchor"><span id="_Toc142114308" class="anchor"><span id="_Toc142729468" class="anchor"><span id="_Toc142730752" class="anchor"><span id="_Toc142731125" class="anchor"><span id="_Toc142998490" class="anchor"><span id="_Toc143063581" class="anchor"><span id="_Toc143509691" class="anchor"><span id="_Toc143510138" class="anchor"><span id="_Toc144026228" class="anchor"><span id="_Toc144026559" class="anchor"><span id="_Toc144276202" class="anchor"><span id="_Toc144276546" class="anchor"><span id="_Toc144280134" class="anchor"><span id="_Toc144280480" class="anchor"><span id="_Toc144540695" class="anchor"><span id="_Toc144554577" class="anchor"><span id="_Toc144722199" class="anchor"><span id="_Toc145503661" class="anchor"><span id="_Toc145512103" class="anchor"><span id="_Toc145513126" class="anchor"><span id="_Toc145513510" class="anchor"><span id="_Toc222907284" class="anchor"><span id="_Toc342652905" class="anchor"><span id="_Toc439858072" class="anchor"><span id="_Toc439864086" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>

##### 

<span id="_Toc437513090" class="anchor"></span>

<span id="_Toc437513098" class="anchor"></span>

##### 

  ------------------------------------------------- -- --
  <span id="_Toc437513102" class="anchor"></span>
  ------------------------------------------------- -- --

##### 

  ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- --
                                                                                                                                                                                                 
                                                                                                                                                                                                 
                                                                                                                                                                                                 
                                                                                                                                                                                                 
  <span id="_Toc437513146" class="anchor"></span>                                                                                                                                                
                                                                                                                                                                                                 
  <span id="_Toc437513152" class="anchor"></span>                                                                                                                                                
                                                                                                                                                                                                 
  <span id="_Toc130721655" class="anchor"><span id="_Toc130888136" class="anchor"><span id="_Toc130978468" class="anchor"><span id="_Toc131014143" class="anchor"></span></span></span></span>   
                                                                                                                                                                                                 
  ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- --

### <span id="_Toc142729469" class="anchor"><span id="_Toc142730753" class="anchor"><span id="_Toc142731126" class="anchor"><span id="_Toc142998491" class="anchor"><span id="_Toc143063582" class="anchor"><span id="_Toc143509692" class="anchor"><span id="_Toc143510139" class="anchor"><span id="_Toc142729470" class="anchor"><span id="_Toc142730754" class="anchor"><span id="_Toc142731127" class="anchor"><span id="_Toc142998492" class="anchor"><span id="_Toc143063583" class="anchor"><span id="_Toc143509693" class="anchor"><span id="_Toc143510140" class="anchor"><span id="_Toc142729471" class="anchor"><span id="_Toc142730755" class="anchor"><span id="_Toc142731128" class="anchor"><span id="_Toc142998493" class="anchor"><span id="_Toc143063584" class="anchor"><span id="_Toc143509694" class="anchor"><span id="_Toc143510141" class="anchor"><span id="_Toc142729472" class="anchor"><span id="_Toc142730756" class="anchor"><span id="_Toc142731129" class="anchor"><span id="_Toc142998494" class="anchor"><span id="_Toc143063585" class="anchor"><span id="_Toc143509695" class="anchor"><span id="_Toc143510142" class="anchor"><span id="_Toc142729478" class="anchor"><span id="_Toc142730762" class="anchor"><span id="_Toc142731135" class="anchor"><span id="_Toc142998500" class="anchor"><span id="_Toc143063591" class="anchor"><span id="_Toc143509701" class="anchor"><span id="_Toc143510148" class="anchor"><span id="_Toc142729479" class="anchor"><span id="_Toc142730763" class="anchor"><span id="_Toc142731136" class="anchor"><span id="_Toc142998501" class="anchor"><span id="_Toc143063592" class="anchor"><span id="_Toc143509702" class="anchor"><span id="_Toc143510149" class="anchor"><span id="_Toc142729480" class="anchor"><span id="_Toc142730764" class="anchor"><span id="_Toc142731137" class="anchor"><span id="_Toc142998502" class="anchor"><span id="_Toc143063593" class="anchor"><span id="_Toc143509703" class="anchor"><span id="_Toc143510150" class="anchor"><span id="_Toc142729481" class="anchor"><span id="_Toc142730765" class="anchor"><span id="_Toc142731138" class="anchor"><span id="_Toc142998503" class="anchor"><span id="_Toc143063594" class="anchor"><span id="_Toc143509704" class="anchor"><span id="_Toc143510151" class="anchor"><span id="_Toc142729484" class="anchor"><span id="_Toc142730768" class="anchor"><span id="_Toc142731141" class="anchor"><span id="_Toc142998506" class="anchor"><span id="_Toc143063597" class="anchor"><span id="_Toc143509707" class="anchor"><span id="_Toc143510154" class="anchor"><span id="_Toc142729496" class="anchor"><span id="_Toc142730780" class="anchor"><span id="_Toc142731153" class="anchor"><span id="_Toc142998518" class="anchor"><span id="_Toc143063609" class="anchor"><span id="_Toc143509719" class="anchor"><span id="_Toc143510166" class="anchor"><span id="_Toc142729503" class="anchor"><span id="_Toc142730787" class="anchor"><span id="_Toc142731160" class="anchor"><span id="_Toc142998525" class="anchor"><span id="_Toc143063616" class="anchor"><span id="_Toc143509726" class="anchor"><span id="_Toc143510173" class="anchor"><span id="_Toc142729504" class="anchor"><span id="_Toc142730788" class="anchor"><span id="_Toc142731161" class="anchor"><span id="_Toc142998526" class="anchor"><span id="_Toc143063617" class="anchor"><span id="_Toc143509727" class="anchor"><span id="_Toc143510174" class="anchor"><span id="_Toc110172778" class="anchor"><span id="_Toc127596755" class="anchor"><span id="_Toc127786376" class="anchor"><span id="_Toc127786692" class="anchor"><span id="_Toc127787008" class="anchor"><span id="_Toc127877604" class="anchor"><span id="_Toc128289675" class="anchor"><span id="_Toc128290068" class="anchor"><span id="_Toc130189750" class="anchor"><span id="_Toc130200966" class="anchor"><span id="_Toc130201282" class="anchor"><span id="_Toc130201603" class="anchor"><span id="_Toc131936690" class="anchor"><span id="_Toc133901154" class="anchor"><span id="_Toc137461029" class="anchor"><span id="_Toc139096544" class="anchor"><span id="_Toc139188467" class="anchor"><span id="_Toc139191330" class="anchor"><span id="_Toc140490381" class="anchor"><span id="_Toc140571284" class="anchor"><span id="_Toc141257557" class="anchor"><span id="_Toc141257884" class="anchor"><span id="_Toc141267412" class="anchor"><span id="_Toc141522430" class="anchor"><span id="_Toc141529518" class="anchor"><span id="_Toc141529835" class="anchor"><span id="_Toc141851442" class="anchor"><span id="_Toc141852376" class="anchor"><span id="_Toc141887920" class="anchor"><span id="_Toc141889760" class="anchor"><span id="_Toc141893429" class="anchor"><span id="_Toc142113282" class="anchor"><span id="_Toc142114310" class="anchor"><span id="_Toc142729527" class="anchor"><span id="_Toc142730811" class="anchor"><span id="_Toc142731184" class="anchor"><span id="_Toc142998549" class="anchor"><span id="_Toc143063640" class="anchor"><span id="_Toc143509750" class="anchor"><span id="_Toc143510197" class="anchor"><span id="_Toc144026229" class="anchor"><span id="_Toc144026560" class="anchor"><span id="_Toc144276203" class="anchor"><span id="_Toc144276547" class="anchor"><span id="_Toc144280135" class="anchor"><span id="_Toc144280481" class="anchor"><span id="_Toc144540696" class="anchor"><span id="_Toc144554578" class="anchor"><span id="_Toc144722200" class="anchor"><span id="_Toc145503662" class="anchor"><span id="_Toc145512104" class="anchor"><span id="_Toc145513127" class="anchor"><span id="_Toc145513511" class="anchor"><span id="_Toc222907285" class="anchor"><span id="_Toc342652909" class="anchor"><span id="_Toc439858073" class="anchor"><span id="_Toc439864087" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>

##### 

<span id="_Toc437513167" class="anchor"></span>

<span id="_Toc437513173" class="anchor"></span>

##### 

  ------------------------------------------------- -- --
  <span id="_Toc437513177" class="anchor"></span>
  ------------------------------------------------- -- --

##### 

-   -   

  -- --
     
     
     
     
  -- --

### <span id="_Toc342652913" class="anchor"><span id="_Toc110172779" class="anchor"><span id="_Toc127596757" class="anchor"><span id="_Toc127786378" class="anchor"><span id="_Toc127786694" class="anchor"><span id="_Toc127787010" class="anchor"><span id="_Toc127877606" class="anchor"><span id="_Toc128289677" class="anchor"><span id="_Toc128290070" class="anchor"><span id="_Toc130189752" class="anchor"><span id="_Toc130200968" class="anchor"><span id="_Toc130201284" class="anchor"><span id="_Toc130201605" class="anchor"><span id="_Toc131936692" class="anchor"><span id="_Toc133901156" class="anchor"><span id="_Toc137461030" class="anchor"><span id="_Toc139096545" class="anchor"><span id="_Toc139188468" class="anchor"><span id="_Toc139191331" class="anchor"><span id="_Toc140490382" class="anchor"><span id="_Toc140571285" class="anchor"><span id="_Toc141257558" class="anchor"><span id="_Toc141257885" class="anchor"><span id="_Toc141267413" class="anchor"><span id="_Toc141522431" class="anchor"><span id="_Toc141529519" class="anchor"><span id="_Toc141529836" class="anchor"><span id="_Toc141851443" class="anchor"><span id="_Toc141852377" class="anchor"><span id="_Toc141887921" class="anchor"><span id="_Toc141889761" class="anchor"><span id="_Toc141893430" class="anchor"><span id="_Toc142113283" class="anchor"><span id="_Toc142114311" class="anchor"><span id="_Toc142729528" class="anchor"><span id="_Toc142730812" class="anchor"><span id="_Toc142731185" class="anchor"><span id="_Toc142998550" class="anchor"><span id="_Toc143063641" class="anchor"><span id="_Toc143509751" class="anchor"><span id="_Toc143510198" class="anchor"><span id="_Toc144026230" class="anchor"><span id="_Toc144026561" class="anchor"><span id="_Toc144276204" class="anchor"><span id="_Toc144276548" class="anchor"><span id="_Toc144280136" class="anchor"><span id="_Toc144280482" class="anchor"><span id="_Toc144540697" class="anchor"><span id="_Toc144554579" class="anchor"><span id="_Toc144722201" class="anchor"><span id="_Toc145503663" class="anchor"><span id="_Toc145512105" class="anchor"><span id="_Toc145513128" class="anchor"><span id="_Toc145513512" class="anchor"><span id="_Toc222907286" class="anchor"><span id="_Toc342652914" class="anchor"><span id="_Toc439864088" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>HvGetVpRegisters

The HvGetVpRegisters hypercall reads the architectural state of a
virtual processor.

##### Wrapper Interface

HV\_STATUS

HvGetVpRegisters(

\_\_in HV\_PARTITION\_ID PartitionId,

\_\_in HV\_VP\_INDEX VpIndex,

\_\_inout PUINT32 RegisterCount,

\_\_in\_ecount(RegisterCount)

PCHV\_REGISTER\_NAME RegisterNameList,

\_\_out\_ecount(RegisterCount)

PHV\_REGISTER\_VALUE RegisterValueList

);

##### Native Interface

  HvGetVpRegisters \[rep\]
  -------------------------- -------------------------------------- -----------------------------
  Input Parameter Header
  0
  8
  Input List Element
  0
  Output List Element
  0
  8

##### Description

The state is returned as a series of register values, each corresponding
to a register name provided as input.

Input Parameters

*PartitionId* specifies the partition.

*VpIndex* specifies the index of the virtual processor.

*RegisterName* specifies a list of names for the requested register
state.

Output Parameters

*RegisterValue* returns a list of register values for the requested
register state.

Restrictions

-   The partition specified by *PartitionId* must be in the
    “active" state.

-   The caller must be the parent of the partition specified by
    *PartitionId* or the partition specifying its own partition ID.

Return Values

  Status code                             Error condition
  --------------------------------------- -----------------------------------------------------------------------------------------------
  HV\_STATUS\_ACCESS\_DENIED              The caller is neither the partition itself nor the parent of the specified partition.
  HV\_STATUS\_INVALID\_PARTITION\_ID      The specified partition is invalid.
  HV\_STATUS\_INVALID\_VP\_INDEX          The specified VP index does not reference a virtual processor within the specified partition.
  HV\_STATUS\_INVALID\_PARAMETER          The specified register name is invalid.
  HV\_STATUS\_INVALID\_PARTITION\_STATE   The specified partition is not in the "active" state.

### <span id="_Toc110172780" class="anchor"><span id="_Toc127596758" class="anchor"><span id="_Toc127786379" class="anchor"><span id="_Toc127786695" class="anchor"><span id="_Toc127787011" class="anchor"><span id="_Toc127877607" class="anchor"><span id="_Toc128289678" class="anchor"><span id="_Toc128290071" class="anchor"><span id="_Toc130189753" class="anchor"><span id="_Toc130200969" class="anchor"><span id="_Toc130201285" class="anchor"><span id="_Toc130201606" class="anchor"><span id="_Ref130791994" class="anchor"><span id="_Toc131936693" class="anchor"><span id="_Toc133901157" class="anchor"><span id="_Toc137461031" class="anchor"><span id="_Toc139096546" class="anchor"><span id="_Toc139188469" class="anchor"><span id="_Toc139191332" class="anchor"><span id="_Toc140490383" class="anchor"><span id="_Toc140571286" class="anchor"><span id="_Toc141257559" class="anchor"><span id="_Toc141257886" class="anchor"><span id="_Toc141267414" class="anchor"><span id="_Toc141522432" class="anchor"><span id="_Toc141529520" class="anchor"><span id="_Toc141529837" class="anchor"><span id="_Toc141851444" class="anchor"><span id="_Toc141852378" class="anchor"><span id="_Toc141887922" class="anchor"><span id="_Toc141889762" class="anchor"><span id="_Toc141893431" class="anchor"><span id="_Toc142113284" class="anchor"><span id="_Toc142114312" class="anchor"><span id="_Toc142729529" class="anchor"><span id="_Toc142730813" class="anchor"><span id="_Toc142731186" class="anchor"><span id="_Toc142998551" class="anchor"><span id="_Toc143063642" class="anchor"><span id="_Toc143509752" class="anchor"><span id="_Toc143510199" class="anchor"><span id="_Toc144026231" class="anchor"><span id="_Toc144026562" class="anchor"><span id="_Toc144276205" class="anchor"><span id="_Toc144276549" class="anchor"><span id="_Toc144280137" class="anchor"><span id="_Toc144280483" class="anchor"><span id="_Toc144540698" class="anchor"><span id="_Toc144554580" class="anchor"><span id="_Toc144722202" class="anchor"><span id="_Toc145503664" class="anchor"><span id="_Toc145512106" class="anchor"><span id="_Toc145513129" class="anchor"><span id="_Toc145513513" class="anchor"><span id="_Toc222907287" class="anchor"><span id="_Toc342652918" class="anchor"><span id="_Toc439858075" class="anchor"><span id="_Toc439864089" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>

##### 

<span id="_Toc437513219" class="anchor"></span>

<span id="_Toc437513230" class="anchor"></span>

##### 

  ------------------------------------------------- ------------------------------------------------- --
  <span id="_Toc437513234" class="anchor"></span>
  <span id="_Toc437513252" class="anchor"></span>
  ------------------------------------------------- ------------------------------------------------- --

##### 

-   -   

  ------------------------------------------------- --
                                                    

                                                    

                                                    

  <span id="_Toc437513290" class="anchor"></span>   
                                                    
  <span id="_Toc437513291" class="anchor"></span>   

  <span id="_Toc437513294" class="anchor"></span>   

  <span id="_Toc437513297" class="anchor"></span>   

                                                    
  ------------------------------------------------- --

### <span id="_Toc106525937" class="anchor"><span id="_Toc342652922" class="anchor"><span id="_Toc439858076" class="anchor"><span id="_Toc439864090" class="anchor"></span></span></span></span>

##### 

<span id="_Toc437513306" class="anchor"></span>

<span id="_Toc437513313" class="anchor"></span>

##### 

  ------------------------------------------------- --
  <span id="_Toc437513317" class="anchor"></span>
  ------------------------------------------------- --

##### 

-   -   

  ------------------------------------------------- --
                                                    

                                                    

                                                    

  <span id="_Toc437513354" class="anchor"></span>   
                                                    
  <span id="_Toc437513355" class="anchor"></span>   

  <span id="_Toc437513358" class="anchor"></span>   

  <span id="_Toc437513361" class="anchor"></span>   
  ------------------------------------------------- --

<span id="_Toc127596759" class="anchor"><span id="_Toc127786380" class="anchor"><span id="_Toc127786696" class="anchor"><span id="_Toc127787012" class="anchor"><span id="_Toc127877608" class="anchor"><span id="_Toc128289679" class="anchor"><span id="_Toc128290072" class="anchor"><span id="_Toc130189754" class="anchor"><span id="_Toc130200970" class="anchor"><span id="_Toc130201286" class="anchor"><span id="_Toc130201607" class="anchor"><span id="_Toc131936694" class="anchor"><span id="_Toc133901158" class="anchor"><span id="_Toc137461032" class="anchor"><span id="_Toc139096547" class="anchor"><span id="_Toc139188470" class="anchor"><span id="_Toc139191333" class="anchor"><span id="_Toc140490384" class="anchor"><span id="_Toc140571287" class="anchor"><span id="_Toc141257560" class="anchor"><span id="_Toc141257887" class="anchor"><span id="_Toc141267415" class="anchor"><span id="_Toc141522433" class="anchor"><span id="_Toc141529521" class="anchor"><span id="_Toc141529838" class="anchor"><span id="_Toc141851445" class="anchor"><span id="_Toc141852379" class="anchor"><span id="_Toc141887923" class="anchor"><span id="_Toc141889763" class="anchor"><span id="_Toc141893432" class="anchor"><span id="_Toc142113285" class="anchor"><span id="_Toc142114313" class="anchor"><span id="_Toc142729530" class="anchor"><span id="_Toc142730814" class="anchor"><span id="_Toc142731187" class="anchor"><span id="_Toc142998552" class="anchor"><span id="_Toc143063643" class="anchor"><span id="_Toc143509753" class="anchor"><span id="_Toc143510200" class="anchor"><span id="_Toc144026232" class="anchor"><span id="_Toc144026563" class="anchor"><span id="_Toc144276206" class="anchor"><span id="_Toc144276550" class="anchor"><span id="_Toc144280138" class="anchor"><span id="_Toc144280484" class="anchor"><span id="_Toc144540699" class="anchor"><span id="_Toc144554581" class="anchor"><span id="_Toc144722203" class="anchor"><span id="_Toc145503665" class="anchor"><span id="_Toc145512107" class="anchor"><span id="_Toc145513130" class="anchor"><span id="_Toc145513514" class="anchor"><span id="_Toc222907288" class="anchor"><span id="_Toc342652926" class="anchor"><span id="_Toc439864091" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Virtual Processor Execution
====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================

The virtual machine interface exposed by each partition exposes virtual
processors, and these are architecture specific. This section specifies
the core CPU aspects of virtual processors. The following two sections
specify the MMU (memory management unit) and interrupt controller
aspects of virtual processors.

A complete definition of virtual processor behavior requires hundreds of
pages of CPU manuals. This document specifies the behavior of virtual
processors by referencing processor manuals for physical X64 processors
and discussing only cases where a virtual processor’s behavior differs
from that of a logical processor; that is, the baseline behavior of a
virtual processor is defined by the Intel and AMD processor reference
manuals.

-   Some differences exist between AMD’s and Intel’s implementations.
    These differences, which are visible to guests, may include
    the following. Note that this list is not comprehensive and is
    likely to change as newer generations of processors are released.
    Intel processors support:

<!-- -->

-   SSE3 instruction

-   Hyperthreading

<!-- -->

-   AMD processors support:

<!-- -->

-   3DNow! instructions

-   Fast FXSAVE mechanism

-   Additional MMX extensions

-   PREFETCHW instruction

-   SAHF and LAHF instructions in long mode

    1.  <span id="_Toc342652927" class="anchor"><span id="_Toc110172783" class="anchor"><span id="_Toc127596760" class="anchor"><span id="_Toc127786381" class="anchor"><span id="_Toc127786697" class="anchor"><span id="_Toc127787013" class="anchor"><span id="_Toc127877609" class="anchor"><span id="_Toc128289680" class="anchor"><span id="_Toc128290073" class="anchor"><span id="_Toc130189755" class="anchor"><span id="_Toc130200971" class="anchor"><span id="_Toc130201287" class="anchor"><span id="_Toc130201608" class="anchor"><span id="_Toc131936695" class="anchor"><span id="_Toc133901159" class="anchor"><span id="_Toc137461033" class="anchor"><span id="_Toc139096548" class="anchor"><span id="_Toc139188471" class="anchor"><span id="_Toc139191334" class="anchor"><span id="_Toc140490385" class="anchor"><span id="_Toc140571288" class="anchor"><span id="_Toc141257561" class="anchor"><span id="_Toc141257888" class="anchor"><span id="_Toc141267416" class="anchor"><span id="_Toc141522434" class="anchor"><span id="_Toc141529522" class="anchor"><span id="_Toc141529839" class="anchor"><span id="_Toc141851446" class="anchor"><span id="_Toc141852380" class="anchor"><span id="_Toc141887924" class="anchor"><span id="_Toc141889764" class="anchor"><span id="_Toc141893433" class="anchor"><span id="_Toc142113286" class="anchor"><span id="_Toc142114314" class="anchor"><span id="_Toc142729531" class="anchor"><span id="_Toc142730815" class="anchor"><span id="_Toc142731188" class="anchor"><span id="_Toc142998553" class="anchor"><span id="_Toc143063644" class="anchor"><span id="_Toc143509754" class="anchor"><span id="_Toc143510201" class="anchor"><span id="_Toc144026233" class="anchor"><span id="_Toc144026564" class="anchor"><span id="_Toc144276207" class="anchor"><span id="_Toc144276551" class="anchor"><span id="_Toc144280139" class="anchor"><span id="_Toc144280485" class="anchor"><span id="_Toc144540700" class="anchor"><span id="_Toc144554582" class="anchor"><span id="_Toc144722204" class="anchor"><span id="_Toc145503666" class="anchor"><span id="_Toc145512108" class="anchor"><span id="_Toc145513131" class="anchor"><span id="_Toc145513515" class="anchor"><span id="_Toc222907289" class="anchor"><span id="_Toc342652928" class="anchor"><span id="_Toc439864092" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Processor Features and CPUID
        -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

The processor intercept mechanism of the hypervisor allows a parent
partition to intercept the execution of the CPUID instruction by virtual
processors within its child partitions. The parent partition can set the
return values of the CPUID instruction in arbitrary ways. Doing so does
not automatically alter the set of processor features of a virtual
processor; that is, if a parent partition chooses to alter the behavior
of the CPUID instruction, it is responsible for ensuring that the set of
virtual processor features matches what is indicated by the CPUID
instruction.

<span id="_Ref147666255" class="anchor"><span id="_Toc222907290" class="anchor"><span id="_Toc342652929" class="anchor"><span id="_Toc110172784" class="anchor"><span id="_Toc127596761" class="anchor"><span id="_Toc127786382" class="anchor"><span id="_Toc127786698" class="anchor"><span id="_Toc127787014" class="anchor"><span id="_Toc127877610" class="anchor"><span id="_Toc128289681" class="anchor"><span id="_Toc128290074" class="anchor"><span id="_Toc130189756" class="anchor"><span id="_Toc130200972" class="anchor"><span id="_Toc130201288" class="anchor"><span id="_Toc130201609" class="anchor"><span id="_Toc131936696" class="anchor"><span id="_Toc133901160" class="anchor"><span id="_Toc137461034" class="anchor"><span id="_Toc139096549" class="anchor"><span id="_Toc139188472" class="anchor"><span id="_Toc139191335" class="anchor"><span id="_Toc140490386" class="anchor"><span id="_Toc140571289" class="anchor"><span id="_Toc141257562" class="anchor"><span id="_Toc141257889" class="anchor"><span id="_Toc141267417" class="anchor"><span id="_Toc141522435" class="anchor"><span id="_Toc141529523" class="anchor"><span id="_Toc141529840" class="anchor"><span id="_Toc141851447" class="anchor"><span id="_Toc141852381" class="anchor"><span id="_Toc141887925" class="anchor"><span id="_Toc141889765" class="anchor"><span id="_Toc141893434" class="anchor"><span id="_Toc142113287" class="anchor"><span id="_Toc142114315" class="anchor"><span id="_Toc142729532" class="anchor"><span id="_Toc142730816" class="anchor"><span id="_Toc142731189" class="anchor"><span id="_Toc142998554" class="anchor"><span id="_Toc143063645" class="anchor"><span id="_Toc143509755" class="anchor"><span id="_Toc143510202" class="anchor"><span id="_Toc144026234" class="anchor"><span id="_Toc144026565" class="anchor"><span id="_Toc144276208" class="anchor"><span id="_Toc144276552" class="anchor"><span id="_Toc144280140" class="anchor"><span id="_Toc144280486" class="anchor"><span id="_Toc144540701" class="anchor"><span id="_Toc144554583" class="anchor"><span id="_Toc144722205" class="anchor"><span id="_Toc145503667" class="anchor"><span id="_Toc145512109" class="anchor"><span id="_Toc145513132" class="anchor"><span id="_Toc145513516" class="anchor"><span id="_Toc439864093" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Family, Model and Stepping Reported by CPUID
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

The CPUID instruction can be used to obtain a logical processor’s
family, model and stepping information. It is possible, but not
guaranteed, that logical processors reporting differing information may
coexist on a single system. To properly use this information, a
partition must be able to execute with a hard affinity between virtual
and logical processors. Only the root partition executes in this manner.
As a result, the hypervisor will expose the true family, model and
stepping only to the root partition and will report the minimum value
detected in the logical processor configuration to all other partitions.

<span id="_Ref148792147" class="anchor"><span id="_Toc222907291" class="anchor"><span id="_Toc342652930" class="anchor"><span id="_Toc439864094" class="anchor"></span></span></span></span>Platform ID Reported by MSR
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

The value returned by the IA32\_PLATFORM\_ID MSR (0x17) can be used in
conjunction with the family, model and stepping information as reported
by the CPUID instruction (as described in the previous section). The
hypervisor is consistent in its handling of this MSR and will expose the
true content of the IA32\_PLATFORM\_ID MSR only to the root partition.
It will present all other partitions with the value obtained from the
logical processor possessing the minimum family, model and stepping
value.

<span id="_Toc222907292" class="anchor"><span id="_Toc342652931" class="anchor"><span id="_Toc439864095" class="anchor"></span></span></span>Real Mode
------------------------------------------------------------------------------------------------------------------------------------------------------

The hypervisor attempts to support real mode in a fully transparent
manner. There may be situations, however, where specific processor
implementations may not make this entirely possible. As a result, the
hypervisor may be required to emulate or manipulate the environment to
some degree to provide real mode support. The following is a list of
potential areas where real mode support may not be transparent.

-   Hypervisor overhead inconsistencies.\
    As a consequence of an increase in the frequency of instruction
    emulation by the hypervisor, performance of both the guest and the
    system may be affected.

-   Visible processor state changes as a consequence of switching
    modes.\
    The hypervisor may be required to make changes to the guest’s
    runtime environment when mode switches occur, such as between real
    and protected mode or vice versa. Such changes may be detected by
    the guest.

    1.  <span id="_Toc127596762" class="anchor"><span id="_Toc127786383" class="anchor"><span id="_Toc127786699" class="anchor"><span id="_Toc127787015" class="anchor"><span id="_Toc127877611" class="anchor"><span id="_Toc128289682" class="anchor"><span id="_Toc128290075" class="anchor"><span id="_Toc130189757" class="anchor"><span id="_Toc130200973" class="anchor"><span id="_Toc130201289" class="anchor"><span id="_Toc130201610" class="anchor"><span id="_Toc131936697" class="anchor"><span id="_Toc133901161" class="anchor"><span id="_Toc137461035" class="anchor"><span id="_Toc139096550" class="anchor"><span id="_Toc139188473" class="anchor"><span id="_Toc139191336" class="anchor"><span id="_Toc140490387" class="anchor"><span id="_Toc140571290" class="anchor"><span id="_Toc141257563" class="anchor"><span id="_Toc141257890" class="anchor"><span id="_Toc141267418" class="anchor"><span id="_Toc141522436" class="anchor"><span id="_Toc141529524" class="anchor"><span id="_Toc141529841" class="anchor"><span id="_Toc141851448" class="anchor"><span id="_Toc141852382" class="anchor"><span id="_Toc141887926" class="anchor"><span id="_Toc141889766" class="anchor"><span id="_Toc141893435" class="anchor"><span id="_Toc142113288" class="anchor"><span id="_Toc142114316" class="anchor"><span id="_Toc142729533" class="anchor"><span id="_Toc142730817" class="anchor"><span id="_Toc142731190" class="anchor"><span id="_Toc142998555" class="anchor"><span id="_Toc143063646" class="anchor"><span id="_Toc143509756" class="anchor"><span id="_Toc143510203" class="anchor"><span id="_Toc144026235" class="anchor"><span id="_Toc144026566" class="anchor"><span id="_Toc144276209" class="anchor"><span id="_Toc144276553" class="anchor"><span id="_Toc144280141" class="anchor"><span id="_Toc144280487" class="anchor"><span id="_Toc144540702" class="anchor"><span id="_Toc144554584" class="anchor"><span id="_Toc144722206" class="anchor"><span id="_Toc145503668" class="anchor"><span id="_Toc145512110" class="anchor"><span id="_Toc145513133" class="anchor"><span id="_Toc145513517" class="anchor"><span id="_Ref148176765" class="anchor"><span id="_Toc222907293" class="anchor"><span id="_Toc342652932" class="anchor"><span id="_Toc439864096" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>MONITOR / MWAIT
        -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

The hypervisor does not support the use of the MONITOR instruction but
does have limited support for MWAIT. Partitions possessing the
*CpuManagement* privilege may use MWAIT to set the logical processor’s
C-state if support for the instruction is present in hardware.
Availability is indicated by the presence of a flag returned by the
CPUID instruction for a hypervisor leaf (see section 3.4). Any attempt
to use these instructions when the hypervisor does not indicate
availability will result in a \#UD fault.

<span id="_Toc127596763" class="anchor"><span id="_Toc127786384" class="anchor"><span id="_Toc127786700" class="anchor"><span id="_Toc127787016" class="anchor"><span id="_Toc127877612" class="anchor"><span id="_Toc128289683" class="anchor"><span id="_Toc128290076" class="anchor"><span id="_Toc130189758" class="anchor"><span id="_Toc130200974" class="anchor"><span id="_Toc130201290" class="anchor"><span id="_Toc130201611" class="anchor"><span id="_Toc131936698" class="anchor"><span id="_Toc133901162" class="anchor"><span id="_Toc137461036" class="anchor"><span id="_Toc139096551" class="anchor"><span id="_Toc139188474" class="anchor"><span id="_Toc139191337" class="anchor"><span id="_Toc140490388" class="anchor"><span id="_Toc140571291" class="anchor"><span id="_Toc141257564" class="anchor"><span id="_Toc141257891" class="anchor"><span id="_Toc141267419" class="anchor"><span id="_Toc141522437" class="anchor"><span id="_Toc141529525" class="anchor"><span id="_Toc141529842" class="anchor"><span id="_Toc141851449" class="anchor"><span id="_Toc141852383" class="anchor"><span id="_Toc141887927" class="anchor"><span id="_Toc141889767" class="anchor"><span id="_Toc141893436" class="anchor"><span id="_Toc142113289" class="anchor"><span id="_Toc142114317" class="anchor"><span id="_Toc142729534" class="anchor"><span id="_Toc142730818" class="anchor"><span id="_Toc142731191" class="anchor"><span id="_Toc142998556" class="anchor"><span id="_Toc143063647" class="anchor"><span id="_Toc143509757" class="anchor"><span id="_Toc143510204" class="anchor"><span id="_Toc144026236" class="anchor"><span id="_Toc144026567" class="anchor"><span id="_Toc144276210" class="anchor"><span id="_Toc144276554" class="anchor"><span id="_Toc144280142" class="anchor"><span id="_Toc144280488" class="anchor"><span id="_Toc144540703" class="anchor"><span id="_Toc144554585" class="anchor"><span id="_Toc144722207" class="anchor"><span id="_Toc145503669" class="anchor"><span id="_Toc145512111" class="anchor"><span id="_Toc145513134" class="anchor"><span id="_Toc145513518" class="anchor"><span id="_Toc222907294" class="anchor"><span id="_Toc342652933" class="anchor"><span id="_Ref110089804" class="anchor"><span id="_Toc110172785" class="anchor"><span id="_Toc439864097" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>System Management Mode
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

The hypervisor does not support or participate in the virtualization of
system management mode within guest partitions. Physical system
management interrupts are still handled normally by the system’s
hardware and firmware and is opaque to the hypervisor.

<span id="_Toc127596764" class="anchor"><span id="_Toc127786385" class="anchor"><span id="_Toc127786701" class="anchor"><span id="_Toc127787017" class="anchor"><span id="_Toc127877613" class="anchor"><span id="_Toc128289684" class="anchor"><span id="_Toc128290077" class="anchor"><span id="_Toc130189759" class="anchor"><span id="_Toc130200975" class="anchor"><span id="_Toc130201291" class="anchor"><span id="_Toc130201612" class="anchor"><span id="_Toc131936699" class="anchor"><span id="_Toc133901163" class="anchor"><span id="_Toc137461037" class="anchor"><span id="_Toc139096552" class="anchor"><span id="_Toc139188475" class="anchor"><span id="_Toc139191338" class="anchor"><span id="_Toc140490389" class="anchor"><span id="_Toc140571292" class="anchor"><span id="_Toc141257565" class="anchor"><span id="_Toc141257892" class="anchor"><span id="_Toc141267420" class="anchor"><span id="_Toc141522438" class="anchor"><span id="_Toc141529526" class="anchor"><span id="_Toc141529843" class="anchor"><span id="_Toc141851450" class="anchor"><span id="_Toc141852384" class="anchor"><span id="_Toc141887928" class="anchor"><span id="_Toc141889768" class="anchor"><span id="_Toc141893437" class="anchor"><span id="_Toc142113290" class="anchor"><span id="_Toc142114318" class="anchor"><span id="_Toc142729535" class="anchor"><span id="_Toc142730819" class="anchor"><span id="_Toc142731192" class="anchor"><span id="_Toc142998557" class="anchor"><span id="_Toc143063648" class="anchor"><span id="_Toc143509758" class="anchor"><span id="_Toc143510205" class="anchor"><span id="_Toc144026237" class="anchor"><span id="_Toc144026568" class="anchor"><span id="_Toc144276211" class="anchor"><span id="_Toc144276555" class="anchor"><span id="_Toc144280143" class="anchor"><span id="_Toc144280489" class="anchor"><span id="_Toc144540704" class="anchor"><span id="_Toc144554586" class="anchor"><span id="_Toc144722208" class="anchor"><span id="_Toc145503670" class="anchor"><span id="_Toc145512112" class="anchor"><span id="_Toc145513135" class="anchor"><span id="_Toc145513519" class="anchor"><span id="_Toc222907295" class="anchor"><span id="_Toc342652934" class="anchor"><span id="_Toc439864098" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Time Stamp Counter
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

The time stamp counter (TSC) is virtualized for each virtual processor.
Generally, the TSC value continues to run while a virtual processor is
suspended.

Seamless TSC virtualization is not feasible on the x64 architecture. TSC
virtualization is typically implemented through a simple TSC bias (an
offset added to the logical processor’s TSC). Attempts will be made by
the hypervisor to prevent the TSC from jumping forward or backward as a
virtual processor is scheduled on different logical processors. However,
it cannot compensate for the situation where the TSC for a logical
processor is set to zero by an SMI handler. Furthermore, the TSC
increment rate may slow down or speed up depending on thermal or
performance throttling, over which the hypervisor has no control.

Guest software should only use the TSC for measuring short durations.
Even when using the TSC in this simple way, algorithms should be
resilient to sudden jumps forward or backward in the TSC value.

<span id="_Toc127596765" class="anchor"><span id="_Toc127786386" class="anchor"><span id="_Toc127786702" class="anchor"><span id="_Toc127787018" class="anchor"><span id="_Toc127877614" class="anchor"><span id="_Toc128289685" class="anchor"><span id="_Toc128290078" class="anchor"><span id="_Toc130189760" class="anchor"><span id="_Toc130200976" class="anchor"><span id="_Toc130201292" class="anchor"><span id="_Toc130201613" class="anchor"><span id="_Toc131936700" class="anchor"><span id="_Toc133901164" class="anchor"><span id="_Toc137461038" class="anchor"><span id="_Toc139096553" class="anchor"><span id="_Toc139188476" class="anchor"><span id="_Toc139191339" class="anchor"><span id="_Toc140490390" class="anchor"><span id="_Toc140571293" class="anchor"><span id="_Toc141257566" class="anchor"><span id="_Toc141257893" class="anchor"><span id="_Toc141267421" class="anchor"><span id="_Toc141522439" class="anchor"><span id="_Toc141529527" class="anchor"><span id="_Toc141529844" class="anchor"><span id="_Toc141851451" class="anchor"><span id="_Toc141852385" class="anchor"><span id="_Toc141887929" class="anchor"><span id="_Toc141889769" class="anchor"><span id="_Toc141893438" class="anchor"><span id="_Toc142113291" class="anchor"><span id="_Toc142114319" class="anchor"><span id="_Toc142729536" class="anchor"><span id="_Toc142730820" class="anchor"><span id="_Toc142731193" class="anchor"><span id="_Toc142998558" class="anchor"><span id="_Toc143063649" class="anchor"><span id="_Toc143509759" class="anchor"><span id="_Toc143510206" class="anchor"><span id="_Toc144026238" class="anchor"><span id="_Toc144026569" class="anchor"><span id="_Toc144276212" class="anchor"><span id="_Toc144276556" class="anchor"><span id="_Toc144280144" class="anchor"><span id="_Toc144280490" class="anchor"><span id="_Toc144540705" class="anchor"><span id="_Toc144554587" class="anchor"><span id="_Toc144722209" class="anchor"><span id="_Toc145503671" class="anchor"><span id="_Toc145512113" class="anchor"><span id="_Toc145513136" class="anchor"><span id="_Toc145513520" class="anchor"><span id="_Toc222907296" class="anchor"><span id="_Toc342652935" class="anchor"><span id="_Toc439864099" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Memory Accesses
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

The behavior of instructions that access memory may differ from the
behavior of the same instruction on a logical processor. This is the
result of the hypervisor’s physical memory virtualization mechanisms and
of the existence of address ranges with special semantics (hypervisor
call page or SynIC area). In a broad sense, this applies to all
instructions because the processor fetches instructions from memory.
However, it applies in particular to instructions with memory operands.

The following pseudo-code defines the different behaviors that can
result from an access by a virtual processor to its partition’s GPA
space. The pseudo-code assumes that a GPA memory access has been
performed directly (that is, an explicit memory operand) or indirectly
(an implicit access) by a virtual processor. The access is one of three
types: Read, Write, and Execute (Instruction Fetch).

if the address is within an overlay page

{

if the access type is not allowed for the page

{

Generate \#MC fault within guest

}

else

{

Perform access

}

}

else if the address is within an unmapped GPA page

{

if the partition is the root partition

{

Allow the access to proceed to identity-mapped SPA

}

else

{

Suspend VP and send message to parent (umapped GPA)

}

}

else if the address is within a mapped GPA and

the access type violates the mapping’s access rights

{

if the partition is the root partition

{

Generate \#MC fault in root

}

else

{

Suspend VP and send message to parent (GPA access right)

}

}

else

{

Memory access proceeds normally

}

<span id="_Toc109490413" class="anchor"><span id="_Toc109491735" class="anchor"><span id="_Toc110148998" class="anchor"><span id="_Toc110170593" class="anchor"><span id="_Toc110170961" class="anchor"><span id="_Toc110171222" class="anchor"><span id="_Toc110171483" class="anchor"><span id="_Toc110171744" class="anchor"><span id="_Toc110172005" class="anchor"><span id="_Toc110172526" class="anchor"><span id="_Toc110172786" class="anchor"><span id="_Toc342652936" class="anchor"><span id="_Toc110172787" class="anchor"><span id="_Toc127596766" class="anchor"><span id="_Toc127786387" class="anchor"><span id="_Toc127786703" class="anchor"><span id="_Toc127787019" class="anchor"><span id="_Toc127877615" class="anchor"><span id="_Toc128289686" class="anchor"><span id="_Toc128290079" class="anchor"><span id="_Toc130189761" class="anchor"><span id="_Toc130200977" class="anchor"><span id="_Toc130201293" class="anchor"><span id="_Toc130201614" class="anchor"><span id="_Toc131936701" class="anchor"><span id="_Toc133901165" class="anchor"><span id="_Toc137461039" class="anchor"><span id="_Toc139096554" class="anchor"><span id="_Toc139188477" class="anchor"><span id="_Toc139191340" class="anchor"><span id="_Toc140490391" class="anchor"><span id="_Toc140571294" class="anchor"><span id="_Toc141257567" class="anchor"><span id="_Toc141257894" class="anchor"><span id="_Toc141267422" class="anchor"><span id="_Toc141522440" class="anchor"><span id="_Toc141529528" class="anchor"><span id="_Toc141529845" class="anchor"><span id="_Toc141851452" class="anchor"><span id="_Toc141852386" class="anchor"><span id="_Toc141887930" class="anchor"><span id="_Toc141889770" class="anchor"><span id="_Toc141893439" class="anchor"><span id="_Toc142113292" class="anchor"><span id="_Toc142114320" class="anchor"><span id="_Ref142230079" class="anchor"><span id="_Toc142729537" class="anchor"><span id="_Toc142730821" class="anchor"><span id="_Toc142731194" class="anchor"><span id="_Toc142998559" class="anchor"><span id="_Toc143063650" class="anchor"><span id="_Toc143509760" class="anchor"><span id="_Toc143510207" class="anchor"><span id="_Toc144026239" class="anchor"><span id="_Toc144026570" class="anchor"><span id="_Toc144276213" class="anchor"><span id="_Toc144276557" class="anchor"><span id="_Toc144280145" class="anchor"><span id="_Toc144280491" class="anchor"><span id="_Toc144540706" class="anchor"><span id="_Toc144554588" class="anchor"><span id="_Toc144722210" class="anchor"><span id="_Toc145503672" class="anchor"><span id="_Toc145512114" class="anchor"><span id="_Toc145513137" class="anchor"><span id="_Toc145513521" class="anchor"><span id="_Ref147655821" class="anchor"><span id="_Ref147655929" class="anchor"><span id="_Ref158628441" class="anchor"><span id="_Toc222907297" class="anchor"><span id="_Toc342652937" class="anchor"><span id="_Toc439864100" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>I/O Accesses
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

The behavior of instructions that access I/O ports may differ from the
behavior of the same instruction on a logical processor. This is the
result of the hypervisor’s processor intercept mechanism.

The following pseudo-code defines the different behaviors that can
result from an access by a virtual processor to I/O ports (through the
instructions IN, OUT, INS, or OUTS). Note that each of these
instructions has an operand size of 1, 2, or 4 bytes. As such, one or
more I/O ports are effectively accessed.

if any of the accessed ports is virtualized\
by the hypervisor for this access type

{

Access is emulated

}

else if the I/O Port intercept is installed

{

Suspend VP and send message to parent (I/O Port Intercept)

}

else if the partition is a non-root partition

{

Discard writes; return all bits set for reads

}

else

{

I/O port access proceeds normally

}

<span id="_Toc342652938" class="anchor"><span id="_Toc110172788" class="anchor"><span id="_Toc127596767" class="anchor"><span id="_Toc127786388" class="anchor"><span id="_Toc127786704" class="anchor"><span id="_Toc127787020" class="anchor"><span id="_Toc127877616" class="anchor"><span id="_Toc128289687" class="anchor"><span id="_Toc128290080" class="anchor"><span id="_Toc130189762" class="anchor"><span id="_Toc130200978" class="anchor"><span id="_Toc130201294" class="anchor"><span id="_Toc130201615" class="anchor"><span id="_Toc131936702" class="anchor"><span id="_Toc133901166" class="anchor"><span id="_Toc137461040" class="anchor"><span id="_Toc139096555" class="anchor"><span id="_Toc139188478" class="anchor"><span id="_Toc139191341" class="anchor"><span id="_Toc140490392" class="anchor"><span id="_Toc140571295" class="anchor"><span id="_Toc141257568" class="anchor"><span id="_Toc141257895" class="anchor"><span id="_Toc141267423" class="anchor"><span id="_Toc141522441" class="anchor"><span id="_Toc141529529" class="anchor"><span id="_Toc141529846" class="anchor"><span id="_Toc141851453" class="anchor"><span id="_Toc141852387" class="anchor"><span id="_Toc141887931" class="anchor"><span id="_Toc141889771" class="anchor"><span id="_Toc141893440" class="anchor"><span id="_Toc142113293" class="anchor"><span id="_Toc142114321" class="anchor"><span id="_Toc142729538" class="anchor"><span id="_Toc142730822" class="anchor"><span id="_Toc142731195" class="anchor"><span id="_Toc142998560" class="anchor"><span id="_Toc143063651" class="anchor"><span id="_Toc143509761" class="anchor"><span id="_Toc143510208" class="anchor"><span id="_Toc144026240" class="anchor"><span id="_Toc144026571" class="anchor"><span id="_Toc144276214" class="anchor"><span id="_Toc144276558" class="anchor"><span id="_Toc144280146" class="anchor"><span id="_Toc144280492" class="anchor"><span id="_Toc144540707" class="anchor"><span id="_Toc144554589" class="anchor"><span id="_Toc144722211" class="anchor"><span id="_Toc145503673" class="anchor"><span id="_Toc145512115" class="anchor"><span id="_Toc145513138" class="anchor"><span id="_Toc145513522" class="anchor"><span id="_Ref147655880" class="anchor"><span id="_Ref147655902" class="anchor"><span id="_Ref158628464" class="anchor"><span id="_Toc222907298" class="anchor"><span id="_Toc342652939" class="anchor"><span id="_Toc439864101" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>MSR Accesses
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

The behavior of instructions that access MSRs may differ from the
behavior of the same instruction on a logical processor. This is the
result of the hypervisor’s processor intercept mechanism.

The following pseudo-code defines the different behaviors that can
result from an access by a virtual processor to MSRs.

if the MSR is virtualized by the hypervisor AND

the partition possesses the privilege required by the MSR

{

Access is emulated

}

else if the MSR intercept is installed

{

Suspend VP and send message to parent (MSR intercept)

}

else

{

Generate \#GP fault within the guest

}

The hypervisor may virtualize MSRs as part of its interface with the
guest. A summary of these can be found in 27

For those MSRs that are not virtualized by the hypervisor, internal
security policy may require that certain fields within certain MSRs
remain unmodified, are explicitly set for or hidden from the guest. In
these cases, the access will appear to succeed from the guest’s
perspective, but the value actually written or read may not match the
underlying physical MSR value. The tables in 29 outline the policy for
those MSRs whose contents are modified by the hypervisor.

### <span id="_Toc222907299" class="anchor"><span id="_Toc342652940" class="anchor"><span id="_Toc439864102" class="anchor"></span></span></span>Modified MSR Behavior

Certain MSR accesses are intercepted by the hypervisor. The behavior of
MSR accesses by the root guest may differ from accesses by other guests.
These are described in Appendix F: Architectural MSRs.

<span id="_Toc221333831" class="anchor"><span id="_Toc222906875" class="anchor"><span id="_Toc224555051" class="anchor"><span id="_Toc224555457" class="anchor"><span id="_Ref113363681" class="anchor"><span id="_Toc127596768" class="anchor"><span id="_Toc127786389" class="anchor"><span id="_Toc127786705" class="anchor"><span id="_Toc127787021" class="anchor"><span id="_Toc127877617" class="anchor"><span id="_Toc128289688" class="anchor"><span id="_Toc128290081" class="anchor"><span id="_Toc130189763" class="anchor"><span id="_Toc130200979" class="anchor"><span id="_Toc130201295" class="anchor"><span id="_Toc130201616" class="anchor"><span id="_Toc131936703" class="anchor"><span id="_Toc133901167" class="anchor"><span id="_Toc137461041" class="anchor"><span id="_Toc139096556" class="anchor"><span id="_Toc139188479" class="anchor"><span id="_Toc139191342" class="anchor"><span id="_Toc140490393" class="anchor"><span id="_Toc140571296" class="anchor"><span id="_Toc141257569" class="anchor"><span id="_Toc141257896" class="anchor"><span id="_Toc141267424" class="anchor"><span id="_Toc141522442" class="anchor"><span id="_Toc141529530" class="anchor"><span id="_Toc141529847" class="anchor"><span id="_Toc141851454" class="anchor"><span id="_Toc141852388" class="anchor"><span id="_Toc141887932" class="anchor"><span id="_Toc141889772" class="anchor"><span id="_Toc141893441" class="anchor"><span id="_Toc142113294" class="anchor"><span id="_Toc142114322" class="anchor"><span id="_Toc142729539" class="anchor"><span id="_Toc142730823" class="anchor"><span id="_Toc142731196" class="anchor"><span id="_Toc142998561" class="anchor"><span id="_Toc143063652" class="anchor"><span id="_Toc143509762" class="anchor"><span id="_Toc143510209" class="anchor"><span id="_Toc144026241" class="anchor"><span id="_Toc144026572" class="anchor"><span id="_Toc144276215" class="anchor"><span id="_Toc144276559" class="anchor"><span id="_Toc144280147" class="anchor"><span id="_Toc144280493" class="anchor"><span id="_Toc144540708" class="anchor"><span id="_Toc144554590" class="anchor"><span id="_Toc144722212" class="anchor"><span id="_Toc145503674" class="anchor"><span id="_Toc145512116" class="anchor"><span id="_Toc145513139" class="anchor"><span id="_Toc145513523" class="anchor"><span id="_Toc222907300" class="anchor"><span id="_Toc342652941" class="anchor"><span id="_Toc110172789" class="anchor"><span id="_Toc439864103" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>CPUID Execution
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

The behavior of the CPUID instruction may differ from the behavior of
the same instruction on a logical processor.

The following pseudo-code defines the different behaviors that can
result from the execution of a CPUID instruction by a virtual processor.

if an intercept has been set for the CPUID instruction for

the index specified in EAX

{

Suspend VP and send message to parent (CPUID Intercept)

}

else

{

CPUID instruction returns information as dictated by the

logical processor and the hypervisor

}

The hypervisor may override the standard CPUID information returned by
the logical processor. The table in Appendix D: Architectural CPUID
details the ways in which CPUID information is modified by the
hypervisor. In some cases, the CPUID values returned to the root
partition differ from non-root partitions. In such cases, the
differences are noted.

***NOTE***

The hypervisor does not attempt to dictate a processor selection or to
standardize on a particular processor model. The manipulation of various
CPUID output is used to accommodate processor specifics or to reflect
limitations on the partition’s accessibility or privilege to use certain
processor features.

<span id="_Toc182330626" class="anchor"><span id="_Toc182330627" class="anchor"><span id="_Toc182301055" class="anchor"><span id="_Toc182301949" class="anchor"><span id="_Toc182302843" class="anchor"><span id="_Toc182330666" class="anchor"><span id="_Toc182330667" class="anchor"><span id="_Toc182330668" class="anchor"><span id="_Toc182301070" class="anchor"><span id="_Toc182301964" class="anchor"><span id="_Toc182302858" class="anchor"><span id="_Toc182330681" class="anchor"><span id="_Toc182301082" class="anchor"><span id="_Toc182301976" class="anchor"><span id="_Toc182302870" class="anchor"><span id="_Toc182330693" class="anchor"><span id="_Toc182301090" class="anchor"><span id="_Toc182301984" class="anchor"><span id="_Toc182302878" class="anchor"><span id="_Toc182330701" class="anchor"><span id="_Toc182301099" class="anchor"><span id="_Toc182301993" class="anchor"><span id="_Toc182302887" class="anchor"><span id="_Toc182330710" class="anchor"><span id="_Toc182301136" class="anchor"><span id="_Toc182302030" class="anchor"><span id="_Toc182302924" class="anchor"><span id="_Toc182330747" class="anchor"><span id="_Toc182301148" class="anchor"><span id="_Toc182302042" class="anchor"><span id="_Toc182302936" class="anchor"><span id="_Toc182330759" class="anchor"><span id="_Toc182301154" class="anchor"><span id="_Toc182302048" class="anchor"><span id="_Toc182302942" class="anchor"><span id="_Toc182330765" class="anchor"><span id="_Toc182301164" class="anchor"><span id="_Toc182302058" class="anchor"><span id="_Toc182302952" class="anchor"><span id="_Toc182330775" class="anchor"><span id="_Toc182301230" class="anchor"><span id="_Toc182302124" class="anchor"><span id="_Toc182303018" class="anchor"><span id="_Toc182330841" class="anchor"><span id="_Toc182301235" class="anchor"><span id="_Toc182302129" class="anchor"><span id="_Toc182303023" class="anchor"><span id="_Toc182330846" class="anchor"><span id="_Toc182301242" class="anchor"><span id="_Toc182302136" class="anchor"><span id="_Toc182303030" class="anchor"><span id="_Toc182330853" class="anchor"><span id="_Toc182330875" class="anchor"><span id="_Toc182330876" class="anchor"><span id="_Toc182301278" class="anchor"><span id="_Toc182302172" class="anchor"><span id="_Toc182303066" class="anchor"><span id="_Toc182330889" class="anchor"><span id="_Toc182301290" class="anchor"><span id="_Toc182302184" class="anchor"><span id="_Toc182303078" class="anchor"><span id="_Toc182330901" class="anchor"><span id="_Toc182301298" class="anchor"><span id="_Toc182302192" class="anchor"><span id="_Toc182303086" class="anchor"><span id="_Toc182330909" class="anchor"><span id="_Toc182301319" class="anchor"><span id="_Toc182302213" class="anchor"><span id="_Toc182303107" class="anchor"><span id="_Toc182330930" class="anchor"><span id="_Toc182301385" class="anchor"><span id="_Toc182302279" class="anchor"><span id="_Toc182303173" class="anchor"><span id="_Toc182330996" class="anchor"><span id="_Toc182301398" class="anchor"><span id="_Toc182302292" class="anchor"><span id="_Toc182303186" class="anchor"><span id="_Toc182331009" class="anchor"><span id="_Toc182301404" class="anchor"><span id="_Toc182302298" class="anchor"><span id="_Toc182303192" class="anchor"><span id="_Toc182331015" class="anchor"><span id="_Toc182301442" class="anchor"><span id="_Toc182302336" class="anchor"><span id="_Toc182303230" class="anchor"><span id="_Toc182331053" class="anchor"><span id="_Toc182301448" class="anchor"><span id="_Toc182302342" class="anchor"><span id="_Toc182303236" class="anchor"><span id="_Toc182331059" class="anchor"><span id="_Toc127596769" class="anchor"><span id="_Toc127786390" class="anchor"><span id="_Toc127786706" class="anchor"><span id="_Toc127787022" class="anchor"><span id="_Toc127877618" class="anchor"><span id="_Toc128289689" class="anchor"><span id="_Toc128290082" class="anchor"><span id="_Toc130189764" class="anchor"><span id="_Toc130200980" class="anchor"><span id="_Toc130201296" class="anchor"><span id="_Toc130201617" class="anchor"><span id="_Toc131936704" class="anchor"><span id="_Toc133901168" class="anchor"><span id="_Toc137461042" class="anchor"><span id="_Toc139096557" class="anchor"><span id="_Toc139188480" class="anchor"><span id="_Toc139191343" class="anchor"><span id="_Toc140490394" class="anchor"><span id="_Toc140571297" class="anchor"><span id="_Toc141257570" class="anchor"><span id="_Toc141257897" class="anchor"><span id="_Toc141267425" class="anchor"><span id="_Toc141522443" class="anchor"><span id="_Toc141529531" class="anchor"><span id="_Toc141529848" class="anchor"><span id="_Toc141851455" class="anchor"><span id="_Toc141852389" class="anchor"><span id="_Toc141887933" class="anchor"><span id="_Toc141889773" class="anchor"><span id="_Toc141893442" class="anchor"><span id="_Toc142113295" class="anchor"><span id="_Toc142114323" class="anchor"><span id="_Toc142729540" class="anchor"><span id="_Toc142730824" class="anchor"><span id="_Toc142731197" class="anchor"><span id="_Toc142998564" class="anchor"><span id="_Toc143063656" class="anchor"><span id="_Toc143509766" class="anchor"><span id="_Toc143510213" class="anchor"><span id="_Toc144026245" class="anchor"><span id="_Toc144026576" class="anchor"><span id="_Toc144276219" class="anchor"><span id="_Toc144276563" class="anchor"><span id="_Toc144280151" class="anchor"><span id="_Toc144280497" class="anchor"><span id="_Toc144540712" class="anchor"><span id="_Toc144554594" class="anchor"><span id="_Toc144722216" class="anchor"><span id="_Toc145503678" class="anchor"><span id="_Toc145512120" class="anchor"><span id="_Toc145513143" class="anchor"><span id="_Toc145513527" class="anchor"><span id="_Ref158628504" class="anchor"><span id="_Toc222907301" class="anchor"><span id="_Toc342652942" class="anchor"><span id="_Toc439864104" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Non-Privileged Instruction Execution Prevention (NPIEP)
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

Non-Privileged Instruction Execution (NPIEP) is a feature that limits
the use of certain instructions by user-mode code. Specifically, when
enabled, this feature can block the execution of the SIDT, SGDT, SLDT,
and STR instructions. Execution of these instructions results in a \#GP
fault.

This feature must be configured on a per-VP basis using
HV\_X64\_MSR\_NPIEP\_CONFIG\_CONTENTS:

union

{

UINT64 AsUINT64;

struct

{

// These bits enable instruction execution prevention for specific

// instructions.

UINT64 PreventSgdt:1;

UINT64 PreventSidt:1;

UINT64 PreventSldt:1;

UINT64 PreventStr:1;

UINT64 Reserved:60;

};

} HV\_X64\_MSR\_NPIEP\_CONFIG\_CONTENTS;

Exceptions
----------

The hypervisor’s intercept redirection mechanism allows a parent
partition to intercept processor-generated exceptions in the virtual
processors of a child partition. When the intercept message is
delivered, the virtual processor will be in a restartable state (that
is, the instruction pointer will point to the instruction that generated
the exception).

Exception intercepts are checked before multiple exceptions are combined
into a double fault or a triple fault. For example, if an exception
intercept is installed on the \#NP exception and a \#NP exception occurs
during the delivery of a \#GP exception, the \#NP exception intercept is
triggered. Conversely, if no intercept was installed on the \#NP
exception, the nested \#NP exception is converted into a double fault,
which will trigger an intercept on the \#DF if such an intercept was
installed.

Note that exception intercepts do not occur for software-generated
interrupts (that is, through the instructions INT, INTO, INT 3, and
ICEBKPT).

The order in which exceptions are detected and reported by the processor
depends on the instruction. For example, many instructions can generate
multiple exceptions and the order in which these exceptions are detected
is well defined.

The way in which exception intercepts interact with other intercept
types also depends on the instruction. For example, an IN instruction
may generate a \#GP exception intercept before an I/O port intercept,
and a RDMSR instruction may generate an MSR intercept before a \#GP
exception intercept. For details on the order of intercept delivery,
consult the documentation for Intel’s and AMD’s processor virtualization
extensions.<span id="_Toc147670520" class="anchor"><span
id="_Toc148793135" class="anchor"><span id="_Toc149364009"
class="anchor"><span id="_Toc149376904" class="anchor"><span
id="_Toc149377312" class="anchor"><span id="_Toc147670521"
class="anchor"><span id="_Toc148793136" class="anchor"><span
id="_Toc149364010" class="anchor"><span id="_Toc149376905"
class="anchor"><span id="_Toc149377313" class="anchor"><span
id="_Toc147670522" class="anchor"><span id="_Toc148793137"
class="anchor"><span id="_Toc149364011" class="anchor"><span
id="_Toc149376906" class="anchor"><span id="_Toc149377314"
class="anchor"><span id="_Toc147670523" class="anchor"><span
id="_Toc148793138" class="anchor"><span id="_Toc149364012"
class="anchor"><span id="_Toc149376907" class="anchor"><span
id="_Toc149377315" class="anchor"><span id="_Toc147670524"
class="anchor"><span id="_Toc148793139" class="anchor"><span
id="_Toc149364013" class="anchor"><span id="_Toc149376908"
class="anchor"><span id="_Toc149377316" class="anchor"><span
id="_Toc147670525" class="anchor"><span id="_Toc148793140"
class="anchor"><span id="_Toc149364014" class="anchor"><span
id="_Toc149376909" class="anchor"><span id="_Toc149377317"
class="anchor"><span id="_Toc147670526" class="anchor"><span
id="_Toc148793141" class="anchor"><span id="_Toc149364015"
class="anchor"><span id="_Toc149376910" class="anchor"><span
id="_Toc149377318" class="anchor"><span id="_Toc147670527"
class="anchor"><span id="_Toc148793142" class="anchor"><span
id="_Toc149364016" class="anchor"><span id="_Toc149376911"
class="anchor"><span id="_Toc149377319" class="anchor"><span
id="_Toc147670528" class="anchor"><span id="_Toc148793143"
class="anchor"><span id="_Toc149364017" class="anchor"><span
id="_Toc149376912" class="anchor"><span id="_Toc149377320"
class="anchor"><span id="_Toc147670529" class="anchor"><span
id="_Toc148793144" class="anchor"><span id="_Toc149364018"
class="anchor"><span id="_Toc149376913" class="anchor"><span
id="_Toc149377321" class="anchor"><span id="_Toc147670530"
class="anchor"><span id="_Toc148793145" class="anchor"><span
id="_Toc149364019" class="anchor"><span id="_Toc149376914"
class="anchor"><span id="_Toc149377322" class="anchor"><span
id="_Toc147670531" class="anchor"><span id="_Toc148793146"
class="anchor"><span id="_Toc149364020" class="anchor"><span
id="_Toc149376915" class="anchor"><span id="_Toc149377323"
class="anchor"><span id="_Toc147670532" class="anchor"><span
id="_Toc148793147" class="anchor"><span id="_Toc149364021"
class="anchor"><span id="_Toc149376916" class="anchor"><span
id="_Toc149377324" class="anchor"><span id="_Toc147670533"
class="anchor"><span id="_Toc148793148" class="anchor"><span
id="_Toc149364022" class="anchor"><span id="_Toc149376917"
class="anchor"><span id="_Toc149377325" class="anchor"><span
id="_Toc147670534" class="anchor"><span id="_Toc148793149"
class="anchor"><span id="_Toc149364023" class="anchor"><span
id="_Toc149376918" class="anchor"><span id="_Toc149377326"
class="anchor"><span id="_Toc147670535" class="anchor"><span
id="_Toc148793150" class="anchor"><span id="_Toc149364024"
class="anchor"><span id="_Toc149376919" class="anchor"><span
id="_Toc149377327" class="anchor"><span id="_Toc147670536"
class="anchor"><span id="_Toc148793151" class="anchor"><span
id="_Toc149364025" class="anchor"><span id="_Toc149376920"
class="anchor"><span id="_Toc149377328" class="anchor"><span
id="_Toc147670537" class="anchor"><span id="_Toc148793152"
class="anchor"><span id="_Toc149364026" class="anchor"><span
id="_Toc149376921" class="anchor"><span id="_Toc149377329"
class="anchor"><span id="_Toc147670538" class="anchor"><span
id="_Toc148793153" class="anchor"><span id="_Toc149364027"
class="anchor"><span id="_Toc149376922" class="anchor"><span
id="_Toc149377330" class="anchor"><span id="_Toc147670539"
class="anchor"><span id="_Toc148793154" class="anchor"><span
id="_Toc149364028" class="anchor"><span id="_Toc149376923"
class="anchor"><span id="_Toc149377331" class="anchor"><span
id="_Toc147670540" class="anchor"><span id="_Toc148793155"
class="anchor"><span id="_Toc149364029" class="anchor"><span
id="_Toc149376924" class="anchor"><span id="_Toc149377332"
class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>

<span id="_Toc127596771" class="anchor"><span id="_Toc127786392" class="anchor"><span id="_Toc127786708" class="anchor"><span id="_Toc127787024" class="anchor"><span id="_Toc127877620" class="anchor"><span id="_Toc128289691" class="anchor"><span id="_Toc128290084" class="anchor"><span id="_Toc130189766" class="anchor"><span id="_Toc130200982" class="anchor"><span id="_Toc130201298" class="anchor"><span id="_Toc130201619" class="anchor"><span id="_Toc131936706" class="anchor"><span id="_Toc133901170" class="anchor"><span id="_Toc137461044" class="anchor"><span id="_Toc139096559" class="anchor"><span id="_Toc139188482" class="anchor"><span id="_Toc139191345" class="anchor"><span id="_Toc140490396" class="anchor"><span id="_Toc140571299" class="anchor"><span id="_Toc141257572" class="anchor"><span id="_Toc141257899" class="anchor"><span id="_Toc141267427" class="anchor"><span id="_Toc141522445" class="anchor"><span id="_Toc141529533" class="anchor"><span id="_Toc141529850" class="anchor"><span id="_Toc141851457" class="anchor"><span id="_Toc141852391" class="anchor"><span id="_Toc141887935" class="anchor"><span id="_Toc141889775" class="anchor"><span id="_Toc141893444" class="anchor"><span id="_Toc142113297" class="anchor"><span id="_Toc142114325" class="anchor"><span id="_Toc142729542" class="anchor"><span id="_Toc142730826" class="anchor"><span id="_Toc142731199" class="anchor"><span id="_Toc142998566" class="anchor"><span id="_Toc143063658" class="anchor"><span id="_Toc143509768" class="anchor"><span id="_Toc143510215" class="anchor"><span id="_Toc144026247" class="anchor"><span id="_Toc144026578" class="anchor"><span id="_Toc144276221" class="anchor"><span id="_Toc144276565" class="anchor"><span id="_Toc144280153" class="anchor"><span id="_Toc144280499" class="anchor"><span id="_Toc144540714" class="anchor"><span id="_Toc144554596" class="anchor"><span id="_Toc144722218" class="anchor"><span id="_Toc145503680" class="anchor"><span id="_Toc145512122" class="anchor"><span id="_Toc145513145" class="anchor"><span id="_Toc145513529" class="anchor"><span id="_Toc222907302" class="anchor"><span id="_Toc342652943" class="anchor"><span id="_Toc439864106" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Virtual MMU and Caching
================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================

The virtual machine interface exposed by each partition includes a
memory management unit (MMU). The virtual MMU exposed by hypervisor
partitions is generally compatible with existing MMUs.

The hypervisor also supports guest-defined memory cacheability
attributes for pages mapped into a partition’s GVA space.

<span id="_Toc110172792" class="anchor"><span id="_Toc127596772" class="anchor"><span id="_Toc127786393" class="anchor"><span id="_Toc127786709" class="anchor"><span id="_Toc127787025" class="anchor"><span id="_Toc127877621" class="anchor"><span id="_Toc128289692" class="anchor"><span id="_Toc128290085" class="anchor"><span id="_Toc130189767" class="anchor"><span id="_Toc130200983" class="anchor"><span id="_Toc130201299" class="anchor"><span id="_Toc130201620" class="anchor"><span id="_Toc131936707" class="anchor"><span id="_Toc133901171" class="anchor"><span id="_Toc137461045" class="anchor"><span id="_Toc139096560" class="anchor"><span id="_Toc139188483" class="anchor"><span id="_Toc139191346" class="anchor"><span id="_Toc140490397" class="anchor"><span id="_Toc140571300" class="anchor"><span id="_Toc141257573" class="anchor"><span id="_Toc141257900" class="anchor"><span id="_Toc141267428" class="anchor"><span id="_Toc141522446" class="anchor"><span id="_Toc141529534" class="anchor"><span id="_Toc141529851" class="anchor"><span id="_Toc141851458" class="anchor"><span id="_Toc141852392" class="anchor"><span id="_Toc141887936" class="anchor"><span id="_Toc141889776" class="anchor"><span id="_Toc141893445" class="anchor"><span id="_Toc142113298" class="anchor"><span id="_Toc142114326" class="anchor"><span id="_Toc142729543" class="anchor"><span id="_Toc142730827" class="anchor"><span id="_Toc142731200" class="anchor"><span id="_Toc142998567" class="anchor"><span id="_Toc143063659" class="anchor"><span id="_Toc143509769" class="anchor"><span id="_Toc143510216" class="anchor"><span id="_Toc144026248" class="anchor"><span id="_Toc144026579" class="anchor"><span id="_Toc144276222" class="anchor"><span id="_Toc144276566" class="anchor"><span id="_Toc144280154" class="anchor"><span id="_Toc144280500" class="anchor"><span id="_Toc144540715" class="anchor"><span id="_Toc144554597" class="anchor"><span id="_Toc144722219" class="anchor"><span id="_Toc145503681" class="anchor"><span id="_Toc145512123" class="anchor"><span id="_Toc145513146" class="anchor"><span id="_Toc145513530" class="anchor"><span id="_Ref158804460" class="anchor"><span id="_Ref158804524" class="anchor"><span id="_Toc222907303" class="anchor"><span id="_Toc342652944" class="anchor"><span id="_Toc439864107" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Virtual MMU Overview
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

Virtual processors expose virtual memory and a virtual TLB (translation
look-aside buffer), which caches translations from virtual addresses to
(guest) physical addresses. As with the TLB on a logical processor, the
virtual TLB is a non-coherent cache, and this non-coherence is visible
to guests. The hypervisor exposes operations to flush the TLB. Guests
can use these operations to remove potentially inconsistent entries and
make virtual address translations predictable.

### <span id="_Ref108794117" class="anchor"><span id="_Toc110172793" class="anchor"><span id="_Toc127596773" class="anchor"><span id="_Toc127786394" class="anchor"><span id="_Toc127786710" class="anchor"><span id="_Toc127787026" class="anchor"><span id="_Toc127877622" class="anchor"><span id="_Toc128289693" class="anchor"><span id="_Toc128290086" class="anchor"><span id="_Toc130189768" class="anchor"><span id="_Toc130200984" class="anchor"><span id="_Toc130201300" class="anchor"><span id="_Toc130201621" class="anchor"><span id="_Toc131936708" class="anchor"><span id="_Toc133901172" class="anchor"><span id="_Toc137461046" class="anchor"><span id="_Toc139096561" class="anchor"><span id="_Toc139188484" class="anchor"><span id="_Toc139191347" class="anchor"><span id="_Toc140490398" class="anchor"><span id="_Toc140571301" class="anchor"><span id="_Toc141257574" class="anchor"><span id="_Toc141257901" class="anchor"><span id="_Toc141267429" class="anchor"><span id="_Toc141522447" class="anchor"><span id="_Toc141529535" class="anchor"><span id="_Toc141529852" class="anchor"><span id="_Toc141851459" class="anchor"><span id="_Toc141852393" class="anchor"><span id="_Toc141887937" class="anchor"><span id="_Toc141889777" class="anchor"><span id="_Toc141893446" class="anchor"><span id="_Toc142113299" class="anchor"><span id="_Toc142114327" class="anchor"><span id="_Toc142729544" class="anchor"><span id="_Toc142730828" class="anchor"><span id="_Toc142731201" class="anchor"><span id="_Toc142998568" class="anchor"><span id="_Toc143063660" class="anchor"><span id="_Toc143509770" class="anchor"><span id="_Toc143510217" class="anchor"><span id="_Toc144026249" class="anchor"><span id="_Toc144026580" class="anchor"><span id="_Toc144276223" class="anchor"><span id="_Toc144276567" class="anchor"><span id="_Toc144280155" class="anchor"><span id="_Toc144280501" class="anchor"><span id="_Toc144540716" class="anchor"><span id="_Toc144554598" class="anchor"><span id="_Toc144722220" class="anchor"><span id="_Toc145503682" class="anchor"><span id="_Toc145512124" class="anchor"><span id="_Toc145513147" class="anchor"><span id="_Toc145513531" class="anchor"><span id="_Toc222907304" class="anchor"><span id="_Toc342652945" class="anchor"><span id="_Toc439864108" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Compatibility

The virtual MMU exposed by the hypervisor is generally compatible with
the physical MMU found within an x64 processor. The following
guest-observable differences exist:

-   The CR3.PWT and CR3.PCD bits may not be supported in some
    hypervisor implementations. On such implementations, any attempt by
    the guest to set these flags through a MOV to CR3 instruction or a
    task gate switch will be ignored. Attempts to set these bits
    programmatically through HvSetVpRegisters or
    HvSwitchVirtualAddressSpace may result in an error.

-   The PWT and PCD bits within a leaf page table entry (for example, a
    PTE for 4‑K pages and a PDE for large pages) specify the
    cacheability of the page being mapped. The PAT, PWT, and PCD bits
    within non-leaf page table entries indicate the cacheability of the
    next page table in the hierarchy. Some hypervisor implementations
    may not support these flags. On such implementations, all page table
    accesses performed by the hypervisor are done by using write-back
    cache attributes. This affects, in particular, *accessed* and
    *dirty* bits written to the page table entries. If the guest sets
    the PAT, PWT, or PCD bits within non-leaf page table entries, an
    “unsupported feature" message may be generated when a virtual
    processor accesses a page that is mapped by that page table.

-   The CR0.CD (cache disable) bit may not be supported in some
    hypervisor implementations. On such implementations, the CR0.CD bit
    must be set to 0. Any attempt by the guest to set this flag through
    a MOV to CR0 instruction will be ignored. Attempts to set this bit
    programmatically through HvSetVpRegisters will result in an error.

-   The PAT (page address type) MSR is a per-VP register. However, when
    all the virtual processors in a partition set the PAT MSR to the
    same value, the new effect becomes a partition-wide effect.

-   For reasons of security and isolation, the INVD instruction will be
    virtualized to act like a WBINVD instruction.

-   Some hypervisor implementations may use internal write protection of
    guest page tables to lazily flush MMU mappings from internal data
    structures (for example, shadow page tables). This is
    architecturally invisible to the guest because writes to these
    tables will be handled transparently by the hypervisor. However,
    writes performed to the underlying SPA pages by other partitions or
    by devices (that is, through DMA) may not trigger the appropriate
    TLB flush.

-   Internally, the hypervisor may use *shadow page tables* that
    translate GVAs to SPAs. In such implementations, these shadow page
    tables appear to software as large TLBs. However, several
    differences may be observable. First, shadow page tables can be
    shared between two virtual processors, whereas traditional TLBs are
    per-processor structures and are independent. This sharing may be
    visible because a page access by one virtual processor can fill a
    shadow page table entry that is subsequently used by another
    virtual processor.

    1.  ### <span id="_Toc110172794" class="anchor"><span id="_Toc127596774" class="anchor"><span id="_Toc127786395" class="anchor"><span id="_Toc127786711" class="anchor"><span id="_Toc127787027" class="anchor"><span id="_Toc127877623" class="anchor"><span id="_Toc128289694" class="anchor"><span id="_Toc128290087" class="anchor"><span id="_Toc130189769" class="anchor"><span id="_Toc130200985" class="anchor"><span id="_Toc130201301" class="anchor"><span id="_Toc130201622" class="anchor"><span id="_Toc131936709" class="anchor"><span id="_Toc133901173" class="anchor"><span id="_Toc137461047" class="anchor"><span id="_Toc139096562" class="anchor"><span id="_Toc139188485" class="anchor"><span id="_Toc139191348" class="anchor"><span id="_Toc140490399" class="anchor"><span id="_Toc140571302" class="anchor"><span id="_Toc141257575" class="anchor"><span id="_Toc141257902" class="anchor"><span id="_Toc141267430" class="anchor"><span id="_Toc141522448" class="anchor"><span id="_Toc141529536" class="anchor"><span id="_Toc141529853" class="anchor"><span id="_Toc141851460" class="anchor"><span id="_Toc141852394" class="anchor"><span id="_Toc141887938" class="anchor"><span id="_Toc141889778" class="anchor"><span id="_Toc141893447" class="anchor"><span id="_Toc142113300" class="anchor"><span id="_Toc142114328" class="anchor"><span id="_Toc142729545" class="anchor"><span id="_Toc142730829" class="anchor"><span id="_Toc142731202" class="anchor"><span id="_Toc142998569" class="anchor"><span id="_Toc143063661" class="anchor"><span id="_Toc143509771" class="anchor"><span id="_Toc143510218" class="anchor"><span id="_Toc144026250" class="anchor"><span id="_Toc144026581" class="anchor"><span id="_Toc144276224" class="anchor"><span id="_Toc144276568" class="anchor"><span id="_Toc144280156" class="anchor"><span id="_Toc144280502" class="anchor"><span id="_Toc144540717" class="anchor"><span id="_Toc144554599" class="anchor"><span id="_Toc144722221" class="anchor"><span id="_Toc145503683" class="anchor"><span id="_Toc145512125" class="anchor"><span id="_Toc145513148" class="anchor"><span id="_Toc145513532" class="anchor"><span id="_Toc222907305" class="anchor"><span id="_Toc342652946" class="anchor"><span id="_Toc439864109" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Legacy TLB Management Operations

The x64 architecture provides several ways to manage the processor’s
TLBs. The following mechanisms are virtualized by the hypervisor:

-   The INVLPG instruction invalidates the translation for a single page
    from the processor’s TLB. If the specified virtual address was
    originally mapped as a 4‑K page, the translation for this page is
    removed from the TLB. If the specified virtual address was
    originally mapped as a “large page" (either 2 MB or 4 MB, depending
    on the MMU mode), the translation for the entire large page is
    removed from the TLB. The INVLPG instruction flushes both global and
    non-global translations. Global translations are defined as those
    which have the “global" bit set within the page table entry.

-   The MOV to CR3 instruction and task switches that modify CR3
    invalidate translations for all non-global pages within the
    processor’s TLB.

-   A MOV to CR4 instruction that modifies the CR4.PGE (global
    page enable) bit, the CR4.PSE (page size extensions) bit, or CR4.PAE
    (page address extensions) bit invalidates all translations (global
    and non-global) within the processor’s TLB.

Note that all of these invalidation operations affect only one
processor. To invalidate translations on other processors, software must
use a software-based “TLB shoot-down" mechanism (typically implemented
by using inter-process interrupts).

### <span id="_Toc110172795" class="anchor"><span id="_Toc127596775" class="anchor"><span id="_Toc127786396" class="anchor"><span id="_Toc127786712" class="anchor"><span id="_Toc127787028" class="anchor"><span id="_Toc127877624" class="anchor"><span id="_Toc128289695" class="anchor"><span id="_Toc128290088" class="anchor"><span id="_Toc130189770" class="anchor"><span id="_Toc130200986" class="anchor"><span id="_Toc130201302" class="anchor"><span id="_Toc130201623" class="anchor"><span id="_Toc131936710" class="anchor"><span id="_Toc133901174" class="anchor"><span id="_Toc137461048" class="anchor"><span id="_Toc139096563" class="anchor"><span id="_Toc139188486" class="anchor"><span id="_Toc139191349" class="anchor"><span id="_Toc140490400" class="anchor"><span id="_Toc140571303" class="anchor"><span id="_Toc141257576" class="anchor"><span id="_Toc141257903" class="anchor"><span id="_Toc141267431" class="anchor"><span id="_Toc141522449" class="anchor"><span id="_Toc141529537" class="anchor"><span id="_Toc141529854" class="anchor"><span id="_Toc141851461" class="anchor"><span id="_Toc141852395" class="anchor"><span id="_Toc141887939" class="anchor"><span id="_Toc141889779" class="anchor"><span id="_Toc141893448" class="anchor"><span id="_Toc142113301" class="anchor"><span id="_Toc142114329" class="anchor"><span id="_Toc142729546" class="anchor"><span id="_Toc142730830" class="anchor"><span id="_Toc142731203" class="anchor"><span id="_Toc142998570" class="anchor"><span id="_Toc143063662" class="anchor"><span id="_Toc143509772" class="anchor"><span id="_Toc143510219" class="anchor"><span id="_Toc144026251" class="anchor"><span id="_Toc144026582" class="anchor"><span id="_Toc144276225" class="anchor"><span id="_Toc144276569" class="anchor"><span id="_Toc144280157" class="anchor"><span id="_Toc144280503" class="anchor"><span id="_Toc144540718" class="anchor"><span id="_Toc144554600" class="anchor"><span id="_Toc144722222" class="anchor"><span id="_Toc145503684" class="anchor"><span id="_Toc145512126" class="anchor"><span id="_Toc145513149" class="anchor"><span id="_Toc145513533" class="anchor"><span id="_Toc222907306" class="anchor"><span id="_Toc342652947" class="anchor"><span id="_Toc439864110" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Virtual TLB Enhancements

In addition to supporting the legacy TLB management mechanisms described
earlier, the hypervisor also supports a set of enhancements that enable
a guest to manage the virtual TLB more efficiently.

These enhanced operations can be used interchangeably with legacy TLB
management operations. On some systems (those with sufficient
virtualization support in hardware), the legacy TLB management
instructions may be faster for local or remote (cross-processor) TLB
invalidation. Guests who are interested in optimal performance should
use the CPUID leaf 0x40000004 to determine which behaviors to implement
using hypercalls:

-   *UseHypercallForAddressSpaceSwitch*: If this flag is set, the caller
    should assume that it’s faster to use HvSwitchAddressSpace to switch
    between address spaces. If this flag is clear, a MOV to CR3
    instruction is recommended.

-   *UseHypercallForLocalFlush*: If this flag is set, the caller should
    assume that it’s faster to use hypercalls (as opposed to INVLPG or
    MOV to CR3) to flush one or more pages from the virtual TLB.

-   *UseHypercallForRemoteFlush*: If this flag is set, the caller should
    assume that it’s faster to use hypercalls (as opposed to using
    guest-generated inter-processor interrupts) to flush one or more
    pages from the virtual TLB.

    1.  ### <span id="_Toc342652948" class="anchor"><span id="_Ref109488506" class="anchor"><span id="_Toc110172796" class="anchor"><span id="_Ref119464406" class="anchor"><span id="_Toc127596776" class="anchor"><span id="_Toc127786397" class="anchor"><span id="_Toc127786713" class="anchor"><span id="_Toc127787029" class="anchor"><span id="_Toc127877625" class="anchor"><span id="_Toc128289696" class="anchor"><span id="_Toc128290089" class="anchor"><span id="_Toc130189771" class="anchor"><span id="_Toc130200987" class="anchor"><span id="_Toc130201303" class="anchor"><span id="_Toc130201624" class="anchor"><span id="_Toc131936711" class="anchor"><span id="_Toc133901175" class="anchor"><span id="_Toc137461049" class="anchor"><span id="_Toc139096564" class="anchor"><span id="_Toc139188487" class="anchor"><span id="_Toc139191350" class="anchor"><span id="_Toc140490401" class="anchor"><span id="_Toc140571304" class="anchor"><span id="_Toc141257577" class="anchor"><span id="_Toc141257904" class="anchor"><span id="_Toc141267432" class="anchor"><span id="_Toc141522450" class="anchor"><span id="_Toc141529538" class="anchor"><span id="_Toc141529855" class="anchor"><span id="_Toc141851462" class="anchor"><span id="_Toc141852396" class="anchor"><span id="_Toc141887940" class="anchor"><span id="_Toc141889780" class="anchor"><span id="_Toc141893449" class="anchor"><span id="_Toc142113302" class="anchor"><span id="_Toc142114330" class="anchor"><span id="_Toc142729547" class="anchor"><span id="_Toc142730831" class="anchor"><span id="_Toc142731204" class="anchor"><span id="_Toc142998571" class="anchor"><span id="_Toc143063663" class="anchor"><span id="_Toc143509773" class="anchor"><span id="_Toc143510220" class="anchor"><span id="_Toc144026252" class="anchor"><span id="_Toc144026583" class="anchor"><span id="_Toc144276226" class="anchor"><span id="_Toc144276570" class="anchor"><span id="_Toc144280158" class="anchor"><span id="_Toc144280504" class="anchor"><span id="_Toc144540719" class="anchor"><span id="_Toc144554601" class="anchor"><span id="_Toc144722223" class="anchor"><span id="_Toc145503685" class="anchor"><span id="_Toc145512127" class="anchor"><span id="_Toc145513150" class="anchor"><span id="_Toc145513534" class="anchor"><span id="_Toc222907307" class="anchor"><span id="_Toc342652949" class="anchor"><span id="_Toc439864111" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Restrictions on TLB Flushes

When a virtual processor generates an intercept—especially those
associated with memory accesses, software running within the parent may
want to complete the intercepted instruction in software. This
instruction completion logic will need to emulate the address
translation normally performed by the processor’s MMU. If a TLB flush
request is executed on another virtual processor during instruction
completion, incorrect behavior can result. For example, the second
virtual processor could clear the dirty bit within the guest’s page
table and then request a TLB flush. If the instruction completion
software modifies the contents of this page after the TLB flush request
has been completed, the operating system running within the partition
will not be notified of the page modification, and data corruption can
occur.

To prevent this situation, the hypervisor provides a way to inhibit TLB
flush hypercalls until intercept processing is complete. When a memory
intercept message is generated by the hypervisor, the “TLB Flush
Inhibit" bit (TlbFlushInhibit) will consequently be set. Any attempt to
flush the TLB with a hypercall will place the caller’s virtual processor
in a suspended state. The instruction pointer will not be incremented
past the instruction that invoked the hypercall. After the memory
intercept routine performs instruction completion, it should clear the
TlbFlushInhibit bit of the HvRegisterInterceptSuspend register. This
resumes virtual processors that were suspended when they attempted to
flush the TLB while the bit was set. Since the instruction pointer has
not been incremented, the flush hypercall will automatically be
re-executed. If the TlbFlushInhibit bit is clear, the hypercall will
complete the flush normally.

1.  <span id="_Toc110172797" class="anchor"><span id="_Toc127596777" class="anchor"><span id="_Toc127786398" class="anchor"><span id="_Toc127786714" class="anchor"><span id="_Toc127787030" class="anchor"><span id="_Toc127877626" class="anchor"><span id="_Toc128289697" class="anchor"><span id="_Toc128290090" class="anchor"><span id="_Toc130189772" class="anchor"><span id="_Toc130200988" class="anchor"><span id="_Toc130201304" class="anchor"><span id="_Toc130201625" class="anchor"><span id="_Toc131936712" class="anchor"><span id="_Toc133901176" class="anchor"><span id="_Toc137461050" class="anchor"><span id="_Toc139096565" class="anchor"><span id="_Toc139188488" class="anchor"><span id="_Toc139191351" class="anchor"><span id="_Toc140490402" class="anchor"><span id="_Toc140571305" class="anchor"><span id="_Toc141257578" class="anchor"><span id="_Toc141257905" class="anchor"><span id="_Toc141267433" class="anchor"><span id="_Toc141522451" class="anchor"><span id="_Toc141529539" class="anchor"><span id="_Toc141529856" class="anchor"><span id="_Toc141851463" class="anchor"><span id="_Toc141852397" class="anchor"><span id="_Toc141887941" class="anchor"><span id="_Toc141889781" class="anchor"><span id="_Toc141893450" class="anchor"><span id="_Toc142113303" class="anchor"><span id="_Toc142114331" class="anchor"><span id="_Toc142729548" class="anchor"><span id="_Toc142730832" class="anchor"><span id="_Toc142731205" class="anchor"><span id="_Toc142998572" class="anchor"><span id="_Toc143063664" class="anchor"><span id="_Toc143509774" class="anchor"><span id="_Toc143510221" class="anchor"><span id="_Toc144026253" class="anchor"><span id="_Toc144026584" class="anchor"><span id="_Toc144276227" class="anchor"><span id="_Toc144276571" class="anchor"><span id="_Toc144280159" class="anchor"><span id="_Toc144280505" class="anchor"><span id="_Toc144540720" class="anchor"><span id="_Toc144554603" class="anchor"><span id="_Toc144722224" class="anchor"><span id="_Toc145503686" class="anchor"><span id="_Toc145512128" class="anchor"><span id="_Toc145513151" class="anchor"><span id="_Toc145513535" class="anchor"><span id="_Toc222907308" class="anchor"><span id="_Toc342652950" class="anchor"><span id="_Toc439864112" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Memory Cache Control Overview
    ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

    1.  ### <span id="_Toc110172798" class="anchor"><span id="_Toc127596778" class="anchor"><span id="_Toc127786399" class="anchor"><span id="_Toc127786715" class="anchor"><span id="_Toc127787031" class="anchor"><span id="_Toc127877627" class="anchor"><span id="_Toc128289698" class="anchor"><span id="_Toc128290091" class="anchor"><span id="_Toc130189773" class="anchor"><span id="_Toc130200989" class="anchor"><span id="_Toc130201305" class="anchor"><span id="_Toc130201626" class="anchor"><span id="_Toc131936713" class="anchor"><span id="_Toc133901177" class="anchor"><span id="_Toc137461051" class="anchor"><span id="_Toc139096566" class="anchor"><span id="_Toc139188489" class="anchor"><span id="_Toc139191352" class="anchor"><span id="_Toc140490403" class="anchor"><span id="_Toc140571306" class="anchor"><span id="_Toc141257579" class="anchor"><span id="_Toc141257906" class="anchor"><span id="_Toc141267434" class="anchor"><span id="_Toc141522452" class="anchor"><span id="_Toc141529540" class="anchor"><span id="_Toc141529857" class="anchor"><span id="_Toc141851464" class="anchor"><span id="_Toc141852398" class="anchor"><span id="_Toc141887942" class="anchor"><span id="_Toc141889782" class="anchor"><span id="_Toc141893451" class="anchor"><span id="_Toc142113304" class="anchor"><span id="_Toc142114332" class="anchor"><span id="_Toc142729549" class="anchor"><span id="_Toc142730833" class="anchor"><span id="_Toc142731206" class="anchor"><span id="_Toc142998573" class="anchor"><span id="_Toc143063665" class="anchor"><span id="_Toc143509775" class="anchor"><span id="_Toc143510222" class="anchor"><span id="_Toc144026254" class="anchor"><span id="_Toc144026585" class="anchor"><span id="_Toc144276228" class="anchor"><span id="_Toc144276572" class="anchor"><span id="_Toc144280160" class="anchor"><span id="_Toc144280506" class="anchor"><span id="_Toc144540721" class="anchor"><span id="_Toc144554604" class="anchor"><span id="_Toc144722225" class="anchor"><span id="_Toc145503687" class="anchor"><span id="_Toc145512129" class="anchor"><span id="_Toc145513152" class="anchor"><span id="_Toc145513536" class="anchor"><span id="_Toc222907309" class="anchor"><span id="_Toc342652951" class="anchor"><span id="_Toc439864113" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Cacheability Settings

The hypervisor supports guest-defined cacheability settings for pages
mapped within the guest’s GVA space. For a detailed description of
available cacheability settings and their meanings, refer to the Intel
or AMD documentation.

When a virtual processor accesses a page through its GVA space, the
hypervisor honors the cache attribute bits (PAT, PWT, and PCD) within
the guest page table entry used to map the page. These three bits are
used as an index into the partition’s PAT (page address type) register
to look up the final cacheability setting for the page.

Pages accessed directly through the GPA space (for example, when paging
is disabled because CR0.PG is cleared) use a cacheability defined by the
MTRRs. If the hypervisor implementation doesn’t support virtual MTRRs,
WB cacheability is assumed.

### <span id="_Toc110172800" class="anchor"><span id="_Toc127596779" class="anchor"><span id="_Toc127786400" class="anchor"><span id="_Toc127786716" class="anchor"><span id="_Toc127787032" class="anchor"><span id="_Toc127877628" class="anchor"><span id="_Toc128289699" class="anchor"><span id="_Toc128290092" class="anchor"><span id="_Toc130189774" class="anchor"><span id="_Toc130200990" class="anchor"><span id="_Toc130201306" class="anchor"><span id="_Toc130201627" class="anchor"><span id="_Toc131936714" class="anchor"><span id="_Toc133901178" class="anchor"><span id="_Toc137461052" class="anchor"><span id="_Toc139096567" class="anchor"><span id="_Toc139188490" class="anchor"><span id="_Toc139191353" class="anchor"><span id="_Toc140490404" class="anchor"><span id="_Toc140571307" class="anchor"><span id="_Toc141257580" class="anchor"><span id="_Toc141257907" class="anchor"><span id="_Toc141267435" class="anchor"><span id="_Toc141522453" class="anchor"><span id="_Toc141529541" class="anchor"><span id="_Toc141529858" class="anchor"><span id="_Toc141851465" class="anchor"><span id="_Toc141852399" class="anchor"><span id="_Toc141887943" class="anchor"><span id="_Toc141889783" class="anchor"><span id="_Toc141893452" class="anchor"><span id="_Toc142113305" class="anchor"><span id="_Toc142114333" class="anchor"><span id="_Toc142729550" class="anchor"><span id="_Toc142730834" class="anchor"><span id="_Toc142731207" class="anchor"><span id="_Toc142998574" class="anchor"><span id="_Toc143063666" class="anchor"><span id="_Toc143509776" class="anchor"><span id="_Toc143510223" class="anchor"><span id="_Toc144026255" class="anchor"><span id="_Toc144026586" class="anchor"><span id="_Toc144276229" class="anchor"><span id="_Toc144276573" class="anchor"><span id="_Toc144280161" class="anchor"><span id="_Toc144280507" class="anchor"><span id="_Toc144540722" class="anchor"><span id="_Toc144554605" class="anchor"><span id="_Toc144722226" class="anchor"><span id="_Toc145503688" class="anchor"><span id="_Toc145512130" class="anchor"><span id="_Toc145513153" class="anchor"><span id="_Toc145513537" class="anchor"><span id="_Toc222907310" class="anchor"><span id="_Toc342652952" class="anchor"><span id="_Toc439864114" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Mixing Cache Types between a Partition and the Hypervisor

Guests should be aware that some pages within its GPA space may be
accessed by the hypervisor. The following list, while not exhaustive,
provides several examples:

-   A page that contains input or output parameters for a hypercall

-   All overlay pages including the hypercall page, SynIC SIEF and SIM
    pages, and stats pages

The hypervisor always performs accesses to hypercall parameters and
overlay pages by using the WB cacheability setting.

1.  <span id="_Toc110172802" class="anchor"><span id="_Toc127596780" class="anchor"><span id="_Toc127786401" class="anchor"><span id="_Toc127786717" class="anchor"><span id="_Toc127787033" class="anchor"><span id="_Toc127877629" class="anchor"><span id="_Toc128289700" class="anchor"><span id="_Toc128290093" class="anchor"><span id="_Toc130189775" class="anchor"><span id="_Toc130200991" class="anchor"><span id="_Toc130201307" class="anchor"><span id="_Toc130201628" class="anchor"><span id="_Toc131936715" class="anchor"><span id="_Toc133901179" class="anchor"><span id="_Toc137461053" class="anchor"><span id="_Toc139096568" class="anchor"><span id="_Toc139188491" class="anchor"><span id="_Toc139191354" class="anchor"><span id="_Toc140490405" class="anchor"><span id="_Toc140571308" class="anchor"><span id="_Toc141257581" class="anchor"><span id="_Toc141257908" class="anchor"><span id="_Toc141267436" class="anchor"><span id="_Toc141522454" class="anchor"><span id="_Toc141529542" class="anchor"><span id="_Toc141529859" class="anchor"><span id="_Toc141851466" class="anchor"><span id="_Toc141852400" class="anchor"><span id="_Toc141887944" class="anchor"><span id="_Toc141889784" class="anchor"><span id="_Toc141893453" class="anchor"><span id="_Toc142113306" class="anchor"><span id="_Toc142114334" class="anchor"><span id="_Toc142729551" class="anchor"><span id="_Toc142730835" class="anchor"><span id="_Toc142731208" class="anchor"><span id="_Toc142998575" class="anchor"><span id="_Toc143063667" class="anchor"><span id="_Toc143509777" class="anchor"><span id="_Toc143510224" class="anchor"><span id="_Toc144026256" class="anchor"><span id="_Toc144026587" class="anchor"><span id="_Toc144276230" class="anchor"><span id="_Toc144276574" class="anchor"><span id="_Toc144280162" class="anchor"><span id="_Toc144280508" class="anchor"><span id="_Toc144540723" class="anchor"><span id="_Toc144554606" class="anchor"><span id="_Toc144722227" class="anchor"><span id="_Toc145503689" class="anchor"><span id="_Toc145512131" class="anchor"><span id="_Toc145513154" class="anchor"><span id="_Toc145513538" class="anchor"><span id="_Toc222907311" class="anchor"><span id="_Toc342652953" class="anchor"><span id="_Toc439864115" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Virtual MMU Data Types
    --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

    1.  ### <span id="_Toc110172803" class="anchor"><span id="_Toc127596781" class="anchor"><span id="_Toc127786402" class="anchor"><span id="_Toc127786718" class="anchor"><span id="_Toc127787034" class="anchor"><span id="_Toc127877630" class="anchor"><span id="_Toc128289701" class="anchor"><span id="_Toc128290094" class="anchor"><span id="_Toc130189776" class="anchor"><span id="_Toc130200992" class="anchor"><span id="_Toc130201308" class="anchor"><span id="_Toc130201629" class="anchor"><span id="_Toc131936716" class="anchor"><span id="_Toc133901180" class="anchor"><span id="_Toc137461054" class="anchor"><span id="_Toc139096569" class="anchor"><span id="_Toc139188492" class="anchor"><span id="_Toc139191355" class="anchor"><span id="_Toc140490406" class="anchor"><span id="_Toc140571309" class="anchor"><span id="_Toc141257582" class="anchor"><span id="_Toc141257909" class="anchor"><span id="_Toc141267437" class="anchor"><span id="_Toc141522455" class="anchor"><span id="_Toc141529543" class="anchor"><span id="_Toc141529860" class="anchor"><span id="_Toc141851467" class="anchor"><span id="_Toc141852401" class="anchor"><span id="_Toc141887945" class="anchor"><span id="_Toc141889785" class="anchor"><span id="_Toc141893454" class="anchor"><span id="_Toc142113307" class="anchor"><span id="_Toc142114335" class="anchor"><span id="_Toc142729552" class="anchor"><span id="_Toc142730836" class="anchor"><span id="_Toc142731209" class="anchor"><span id="_Toc142998576" class="anchor"><span id="_Toc143063668" class="anchor"><span id="_Toc143509778" class="anchor"><span id="_Toc143510225" class="anchor"><span id="_Toc144026257" class="anchor"><span id="_Toc144026588" class="anchor"><span id="_Toc144276231" class="anchor"><span id="_Toc144276575" class="anchor"><span id="_Toc144280163" class="anchor"><span id="_Toc144280509" class="anchor"><span id="_Toc144540724" class="anchor"><span id="_Toc144554607" class="anchor"><span id="_Toc144722228" class="anchor"><span id="_Toc145503690" class="anchor"><span id="_Toc145512132" class="anchor"><span id="_Toc145513155" class="anchor"><span id="_Toc145513539" class="anchor"><span id="_Toc222907312" class="anchor"><span id="_Toc342652954" class="anchor"><span id="_Toc439864116" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Virtual Address Spaces

The hypervisor introduces the concept of a virtual address space. The
guest uses virtual address spaces to define the mapping between guest
virtual addresses (GVAs) and guest physical addresses (GPAs). The guest
OS can decide how and where to use virtual address spaces. In most
(including Microsoft Windows^®^), a different virtual address space is
used for each process.

Virtual address spaces are identified by a caller-defined 64-bit ID
value. On x64 implementations of the hypervisor, this value is the same
as the value within the virtual processor’s CR3 register, which points
to the guest’s page table structures.

typedef UINT64 HV\_ADDRESS\_SPACE\_ID;

### <span id="_Toc110172804" class="anchor"><span id="_Toc127596782" class="anchor"><span id="_Toc127786403" class="anchor"><span id="_Toc127786719" class="anchor"><span id="_Toc127787035" class="anchor"><span id="_Toc127877631" class="anchor"><span id="_Toc128289702" class="anchor"><span id="_Toc128290095" class="anchor"><span id="_Toc130189777" class="anchor"><span id="_Toc130200993" class="anchor"><span id="_Toc130201309" class="anchor"><span id="_Toc130201630" class="anchor"><span id="_Toc131936717" class="anchor"><span id="_Toc133901181" class="anchor"><span id="_Toc137461055" class="anchor"><span id="_Toc139096570" class="anchor"><span id="_Toc139188493" class="anchor"><span id="_Toc139191356" class="anchor"><span id="_Toc140490407" class="anchor"><span id="_Toc140571310" class="anchor"><span id="_Toc141257583" class="anchor"><span id="_Toc141257910" class="anchor"><span id="_Toc141267438" class="anchor"><span id="_Toc141522456" class="anchor"><span id="_Toc141529544" class="anchor"><span id="_Toc141529861" class="anchor"><span id="_Toc141851468" class="anchor"><span id="_Toc141852402" class="anchor"><span id="_Toc141887946" class="anchor"><span id="_Toc141889786" class="anchor"><span id="_Toc141893455" class="anchor"><span id="_Toc142113308" class="anchor"><span id="_Toc142114336" class="anchor"><span id="_Toc142729553" class="anchor"><span id="_Toc142730837" class="anchor"><span id="_Toc142731210" class="anchor"><span id="_Toc142998577" class="anchor"><span id="_Toc143063669" class="anchor"><span id="_Toc143509779" class="anchor"><span id="_Toc143510226" class="anchor"><span id="_Toc144026258" class="anchor"><span id="_Toc144026589" class="anchor"><span id="_Toc144276232" class="anchor"><span id="_Toc144276576" class="anchor"><span id="_Toc144280164" class="anchor"><span id="_Toc144280510" class="anchor"><span id="_Toc144540725" class="anchor"><span id="_Toc144554608" class="anchor"><span id="_Toc144722229" class="anchor"><span id="_Toc145503691" class="anchor"><span id="_Toc145512133" class="anchor"><span id="_Toc145513156" class="anchor"><span id="_Toc145513540" class="anchor"><span id="_Toc222907313" class="anchor"><span id="_Toc342652955" class="anchor"><span id="_Toc439864117" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Virtual Address Flush Flags

The hypervisor provides hypercalls that allow the guest to flush (that
is, invalidate) entire virtual address spaces or portions of these
address spaces. Behavior of the flush operation can be modified by using
a set of flags, defined as follows:

typedef UINT32 HV\_FLUSH\_FLAGS;

\#define HV\_FLUSH\_ALL\_PROCESSORS 0x00000001

\#define HV\_FLUSH\_ALL\_VIRTUAL\_ADDRESS\_SPACES 0x00000002

\#define HV\_FLUSH\_NON\_GLOBAL\_MAPPINGS\_ONLY 0x00000004

### <span id="_Toc127596783" class="anchor"><span id="_Toc127786404" class="anchor"><span id="_Toc127786720" class="anchor"><span id="_Toc127787036" class="anchor"><span id="_Toc127877632" class="anchor"><span id="_Toc128289703" class="anchor"><span id="_Toc128290096" class="anchor"><span id="_Toc130189778" class="anchor"><span id="_Toc130200994" class="anchor"><span id="_Toc130201310" class="anchor"><span id="_Toc130201631" class="anchor"><span id="_Toc131936718" class="anchor"><span id="_Toc133901182" class="anchor"><span id="_Toc137461056" class="anchor"><span id="_Toc139096571" class="anchor"><span id="_Toc139188494" class="anchor"><span id="_Toc139191357" class="anchor"><span id="_Toc140490408" class="anchor"><span id="_Toc140571311" class="anchor"><span id="_Toc141257584" class="anchor"><span id="_Toc141257911" class="anchor"><span id="_Toc141267439" class="anchor"><span id="_Toc141522457" class="anchor"><span id="_Toc141529545" class="anchor"><span id="_Toc141529862" class="anchor"><span id="_Toc141851469" class="anchor"><span id="_Toc141852403" class="anchor"><span id="_Toc141887947" class="anchor"><span id="_Toc141889787" class="anchor"><span id="_Toc141893456" class="anchor"><span id="_Toc142113309" class="anchor"><span id="_Toc142114337" class="anchor"><span id="_Toc142729554" class="anchor"><span id="_Toc142730838" class="anchor"><span id="_Toc142731211" class="anchor"><span id="_Toc142998578" class="anchor"><span id="_Toc143063670" class="anchor"><span id="_Toc143509780" class="anchor"><span id="_Toc143510227" class="anchor"><span id="_Toc144026259" class="anchor"><span id="_Toc144026590" class="anchor"><span id="_Toc144276233" class="anchor"><span id="_Toc144276577" class="anchor"><span id="_Toc144280165" class="anchor"><span id="_Toc144280511" class="anchor"><span id="_Toc144540726" class="anchor"><span id="_Toc144554609" class="anchor"><span id="_Ref144555353" class="anchor"><span id="_Toc144722230" class="anchor"><span id="_Toc145503692" class="anchor"><span id="_Toc145512134" class="anchor"><span id="_Toc145513157" class="anchor"><span id="_Toc145513541" class="anchor"><span id="_Toc222907314" class="anchor"><span id="_Toc342652956" class="anchor"><span id="_Toc110172805" class="anchor"><span id="_Toc439864118" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Cache Types

Several structures include cache type fields. The following encodings
are defined:

typedef enum

{

HvCacheTypeX64Uncached = 0,

HvCacheTypeX64WriteCombining = 1,

HvCacheTypeX64WriteThrough = 4,

HvCacheTypeX64WriteProtected = 5,

HvCacheTypeX64WriteBack = 6

} HV\_CACHE\_TYPE;

### <span id="_Toc127596784" class="anchor"><span id="_Toc127786405" class="anchor"><span id="_Toc127786721" class="anchor"><span id="_Toc127787037" class="anchor"><span id="_Toc127877633" class="anchor"><span id="_Toc128289704" class="anchor"><span id="_Toc128290097" class="anchor"><span id="_Toc130189779" class="anchor"><span id="_Toc130200995" class="anchor"><span id="_Toc130201311" class="anchor"><span id="_Toc130201632" class="anchor"><span id="_Toc131936719" class="anchor"><span id="_Toc133901183" class="anchor"><span id="_Toc137461057" class="anchor"><span id="_Toc139096572" class="anchor"><span id="_Toc139188495" class="anchor"><span id="_Toc139191358" class="anchor"><span id="_Toc140490409" class="anchor"><span id="_Toc140571312" class="anchor"><span id="_Toc141257585" class="anchor"><span id="_Toc141257912" class="anchor"><span id="_Toc141267440" class="anchor"><span id="_Toc141522458" class="anchor"><span id="_Toc141529546" class="anchor"><span id="_Toc141529863" class="anchor"><span id="_Toc141851470" class="anchor"><span id="_Toc141852404" class="anchor"><span id="_Toc141887948" class="anchor"><span id="_Toc141889788" class="anchor"><span id="_Toc141893457" class="anchor"><span id="_Toc142113310" class="anchor"><span id="_Toc142114338" class="anchor"><span id="_Toc142729555" class="anchor"><span id="_Toc142730839" class="anchor"><span id="_Toc142731212" class="anchor"><span id="_Toc142998579" class="anchor"><span id="_Toc143063671" class="anchor"><span id="_Toc143509781" class="anchor"><span id="_Toc143510228" class="anchor"><span id="_Toc144026260" class="anchor"><span id="_Toc144026591" class="anchor"><span id="_Toc144276234" class="anchor"><span id="_Toc144276578" class="anchor"><span id="_Toc144280166" class="anchor"><span id="_Toc144280512" class="anchor"><span id="_Toc144540727" class="anchor"><span id="_Toc144554610" class="anchor"><span id="_Toc144722231" class="anchor"><span id="_Toc145503693" class="anchor"><span id="_Toc145512135" class="anchor"><span id="_Toc145513158" class="anchor"><span id="_Toc145513542" class="anchor"><span id="_Toc222907315" class="anchor"><span id="_Toc342652957" class="anchor"><span id="_Toc439864119" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Virtual Address Translation Types

The call HvTranslateVirtualAddress takes a collection of input control
flags and returns a result code and a collection of output flags. The
input control flags are defined as follows:

typedef UINT64 HV\_TRANSLATE\_GVA\_CONTROL\_FLAGS;

\#define HV\_TRANSLATE\_GVA\_VALIDATE\_READ 0x0001

\#define HV\_TRANSLATE\_GVA\_VALIDATE\_WRITE 0x0002

\#define HV\_TRANSLATE\_GVA\_VALIDATE\_EXECUTE 0x0004

\#define HV\_TRANSLATE\_GVA\_PRIVILEGE\_EXEMPT 0x0008

\#define HV\_TRANSLATE\_GVA\_SET\_PAGE\_TABLE\_BITS 0x0010

\#define HV\_TRANSLATE\_GVA\_TLB\_FLUSH\_INHIBIT 0x0020

The returned result code is defined as follows:

typedef enum

{

HvTranslateGvaSuccess = 0,

// Translation failures

HvTranslateGvaPageNotPresent = 1,

HvTranslateGvaPrivilegeViolation = 2,

HvTranslateGvaInvalidPageTableFlags = 3,

// GPA access failures

HvTranslateGvaGpaUnmapped = 4,

HvTranslateGvaGpaNoReadAccess = 5,

HvTranslateGvaGpaNoWriteAccess = 6,

HvTranslateGvaGpaIllegalOverlayAccess = 7

} HV\_TRANSLATE\_GVA\_RESULT\_CODE;

typedef enum HV\_TRANSLATE\_GVA\_RESULT\_CODE

\*PHV\_TRANSLATE\_GVA\_RESULT\_CODE;

typedef struct

{

HV\_TRANSLATE\_GVA\_RESULT\_CODE ResultCode;

UINT32 CacheType:8;

UINT32 OverlayPage:1;

UINT32 Reserved3:23;

} HV\_TRANSLATE\_GVA\_RESULT;

### <span id="_Toc127596785" class="anchor"><span id="_Toc127786406" class="anchor"><span id="_Toc127786722" class="anchor"><span id="_Toc127787038" class="anchor"><span id="_Toc127877634" class="anchor"><span id="_Toc128289705" class="anchor"><span id="_Toc128290098" class="anchor"><span id="_Toc130189780" class="anchor"><span id="_Toc130200996" class="anchor"><span id="_Toc130201312" class="anchor"><span id="_Toc130201633" class="anchor"><span id="_Toc131936720" class="anchor"><span id="_Toc133901184" class="anchor"><span id="_Toc137461058" class="anchor"><span id="_Toc139096573" class="anchor"><span id="_Toc139188496" class="anchor"><span id="_Toc139191359" class="anchor"><span id="_Toc140490410" class="anchor"><span id="_Toc140571313" class="anchor"><span id="_Toc141257586" class="anchor"><span id="_Toc141257913" class="anchor"><span id="_Toc141267441" class="anchor"><span id="_Toc141522459" class="anchor"><span id="_Toc141529547" class="anchor"><span id="_Toc141529864" class="anchor"><span id="_Toc141851471" class="anchor"><span id="_Toc141852405" class="anchor"><span id="_Toc141887949" class="anchor"><span id="_Toc141889789" class="anchor"><span id="_Toc141893458" class="anchor"><span id="_Toc142113311" class="anchor"><span id="_Toc142114339" class="anchor"><span id="_Toc142729556" class="anchor"><span id="_Toc142730840" class="anchor"><span id="_Toc142731213" class="anchor"><span id="_Toc142998580" class="anchor"><span id="_Toc143063672" class="anchor"><span id="_Toc143509782" class="anchor"><span id="_Toc143510229" class="anchor"><span id="_Toc144026261" class="anchor"><span id="_Toc144026592" class="anchor"><span id="_Toc144276235" class="anchor"><span id="_Toc144276579" class="anchor"><span id="_Toc144280167" class="anchor"><span id="_Toc144280513" class="anchor"><span id="_Toc144540728" class="anchor"><span id="_Toc144554611" class="anchor"><span id="_Toc144722232" class="anchor"><span id="_Toc145503694" class="anchor"><span id="_Toc145512136" class="anchor"><span id="_Toc145513159" class="anchor"><span id="_Toc145513543" class="anchor"><span id="_Toc222907316" class="anchor"><span id="_Toc342652958" class="anchor"><span id="_Toc439864120" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Gpa Access Types

The calls HvReadGpa and HvWriteGpa take a collection of input control
flags and return a result code. The input control flags are defined as
follows:

typedef union

{

> typedef struct
>
> {
>
> UINT8 CacheType:8; // Cache type for access
>
> UINT8 Reserved;
>
> UINT16 ReservedZ0;
>
> UINT32 ReservedZ1;
>
> };

} HV\_ACCESS\_GPA\_CONTROL\_FLAGS;

The return result code is defined as follows:

typedef enum

{

HvAccessGpaSuccess = 0,

// GPA access failures

HvAccessGpaUnmapped = 1,

HvAccessGpaReadIntercept = 2,

HvAccessGpaWriteIntercept = 3,

HvAccessGpaIllegalOverlayAccess = 4

} HV\_ACCESS\_GPA\_RESULT\_CODE;

typedef struct

{

HV\_ACCESS\_GPA\_RESULT\_CODE ResultCode;

UINT32 Reserved;

} HV\_ACCESS\_GPA\_RESULT;

typedef HV\_ACCESS\_GPA\_RESULT \*PHV\_ACCESS\_GPA\_RESULT;

1.  <span id="_Toc127596786" class="anchor"><span id="_Toc127786407" class="anchor"><span id="_Toc127786723" class="anchor"><span id="_Toc127787039" class="anchor"><span id="_Toc127877635" class="anchor"><span id="_Toc128289706" class="anchor"><span id="_Toc128290099" class="anchor"><span id="_Toc130189781" class="anchor"><span id="_Toc130200997" class="anchor"><span id="_Toc130201313" class="anchor"><span id="_Toc130201634" class="anchor"><span id="_Toc131936721" class="anchor"><span id="_Toc133901185" class="anchor"><span id="_Toc137461059" class="anchor"><span id="_Toc139096574" class="anchor"><span id="_Toc139188497" class="anchor"><span id="_Toc139191360" class="anchor"><span id="_Toc140490411" class="anchor"><span id="_Toc140571314" class="anchor"><span id="_Toc141257587" class="anchor"><span id="_Toc141257914" class="anchor"><span id="_Toc141267442" class="anchor"><span id="_Toc141522460" class="anchor"><span id="_Toc141529548" class="anchor"><span id="_Toc141529865" class="anchor"><span id="_Toc141851472" class="anchor"><span id="_Toc141852406" class="anchor"><span id="_Toc141887950" class="anchor"><span id="_Toc141889790" class="anchor"><span id="_Toc141893459" class="anchor"><span id="_Toc142113312" class="anchor"><span id="_Toc142114340" class="anchor"><span id="_Toc142729557" class="anchor"><span id="_Toc142730841" class="anchor"><span id="_Toc142731214" class="anchor"><span id="_Toc142998581" class="anchor"><span id="_Toc143063673" class="anchor"><span id="_Toc143509783" class="anchor"><span id="_Toc143510230" class="anchor"><span id="_Toc144026262" class="anchor"><span id="_Toc144026593" class="anchor"><span id="_Toc144276236" class="anchor"><span id="_Toc144276580" class="anchor"><span id="_Toc144280168" class="anchor"><span id="_Toc144280514" class="anchor"><span id="_Toc144540729" class="anchor"><span id="_Toc144554612" class="anchor"><span id="_Toc144722233" class="anchor"><span id="_Toc145503695" class="anchor"><span id="_Toc145512137" class="anchor"><span id="_Toc145513160" class="anchor"><span id="_Toc145513544" class="anchor"><span id="_Toc222907317" class="anchor"><span id="_Toc342652959" class="anchor"><span id="_Toc439864121" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Virtual MMU Interfaces
    ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

    1.  ### <span id="_Toc106181513" class="anchor"><span id="_Toc106422559" class="anchor"><span id="_Toc106525955" class="anchor"><span id="_Toc106181514" class="anchor"><span id="_Toc106422560" class="anchor"><span id="_Toc106525956" class="anchor"><span id="_Toc106181516" class="anchor"><span id="_Toc106422562" class="anchor"><span id="_Toc106525958" class="anchor"><span id="_Toc106181517" class="anchor"><span id="_Toc106422563" class="anchor"><span id="_Toc106525959" class="anchor"><span id="_Toc106181518" class="anchor"><span id="_Toc106422564" class="anchor"><span id="_Toc106525960" class="anchor"><span id="_Toc106181521" class="anchor"><span id="_Toc106422567" class="anchor"><span id="_Toc106525963" class="anchor"><span id="_Toc106181527" class="anchor"><span id="_Toc106422573" class="anchor"><span id="_Toc106525969" class="anchor"><span id="_Toc110172806" class="anchor"><span id="_Toc127596787" class="anchor"><span id="_Toc127786408" class="anchor"><span id="_Toc127786724" class="anchor"><span id="_Toc127787040" class="anchor"><span id="_Toc127877636" class="anchor"><span id="_Toc128289707" class="anchor"><span id="_Toc128290100" class="anchor"><span id="_Toc130189782" class="anchor"><span id="_Toc130200998" class="anchor"><span id="_Toc130201314" class="anchor"><span id="_Toc130201635" class="anchor"><span id="_Toc131936722" class="anchor"><span id="_Toc133901186" class="anchor"><span id="_Toc137461060" class="anchor"><span id="_Toc139096575" class="anchor"><span id="_Toc139188498" class="anchor"><span id="_Toc139191361" class="anchor"><span id="_Ref140489035" class="anchor"><span id="_Toc140490412" class="anchor"><span id="_Toc140571315" class="anchor"><span id="_Toc141257588" class="anchor"><span id="_Toc141257915" class="anchor"><span id="_Toc141267443" class="anchor"><span id="_Toc141522461" class="anchor"><span id="_Toc141529549" class="anchor"><span id="_Toc141529866" class="anchor"><span id="_Toc141851473" class="anchor"><span id="_Toc141852407" class="anchor"><span id="_Toc141887951" class="anchor"><span id="_Toc141889791" class="anchor"><span id="_Toc141893460" class="anchor"><span id="_Toc142113313" class="anchor"><span id="_Toc142114341" class="anchor"><span id="_Toc142729558" class="anchor"><span id="_Toc142730842" class="anchor"><span id="_Toc142731215" class="anchor"><span id="_Toc142998582" class="anchor"><span id="_Toc143063674" class="anchor"><span id="_Toc143509784" class="anchor"><span id="_Toc143510231" class="anchor"><span id="_Toc144026263" class="anchor"><span id="_Toc144026594" class="anchor"><span id="_Toc144276237" class="anchor"><span id="_Toc144276581" class="anchor"><span id="_Toc144280169" class="anchor"><span id="_Toc144280515" class="anchor"><span id="_Toc144540730" class="anchor"><span id="_Toc144554613" class="anchor"><span id="_Toc144722234" class="anchor"><span id="_Toc145503696" class="anchor"><span id="_Toc145512138" class="anchor"><span id="_Toc145513161" class="anchor"><span id="_Toc145513545" class="anchor"><span id="_Toc222907318" class="anchor"><span id="_Toc342652960" class="anchor"><span id="_Toc439864122" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>HvSwitchVirtualAddressSpace

The HvSwitchVirtualAddressSpace hypercall switches the calling virtual
processor’s virtual address space.

##### Wrapper Interface

HV\_STATUS

HvSwitchVirtualAddressSpace(

\_\_in HV\_ADDRESS\_SPACE\_ID AddressSpace

);

##### Native Interface

  HvSwitchVirtualAddressSpace \[fast\]
  -------------------------------------- ------------------------
  Input Parameters
  0

##### Description

For x64 implementations of the hypervisor, this call also updates the
CR3 register. However, unlike a MOV to CR3 instruction, this hypercall
does not have the side-effect of flushing the virtual processor’s TLB.

This hypercall, unlike most, operates implicitly in the context of the
calling partition and virtual processor.

Input Parameters

*AddressSpace* specifies a new address space ID (a new CR3 value).

Output Parameters

None.

Restrictions

None.

Return Values

  Status code                      Error condition
  -------------------------------- ----------------------------------------------------------------------------------------------------------------
  HV\_STATUS\_INVALID\_PARAMETER   The specified address space ID is not a valid CR3 value (for restrictions, see earlier in this specification).
                                   One or more reserved bits in the specified address space ID (as defined by the x64 architecture) were set.

### <span id="_Toc342652964" class="anchor"><span id="_Toc110172807" class="anchor"><span id="_Toc127596788" class="anchor"><span id="_Toc127786409" class="anchor"><span id="_Toc127786725" class="anchor"><span id="_Toc127787041" class="anchor"><span id="_Toc127877637" class="anchor"><span id="_Toc128289708" class="anchor"><span id="_Toc128290101" class="anchor"><span id="_Toc130189783" class="anchor"><span id="_Toc130200999" class="anchor"><span id="_Toc130201315" class="anchor"><span id="_Toc130201636" class="anchor"><span id="_Toc131936723" class="anchor"><span id="_Toc133901187" class="anchor"><span id="_Toc137461061" class="anchor"><span id="_Toc139096576" class="anchor"><span id="_Toc139188499" class="anchor"><span id="_Toc139191362" class="anchor"><span id="_Ref140489050" class="anchor"><span id="_Toc140490413" class="anchor"><span id="_Toc140571316" class="anchor"><span id="_Toc141257589" class="anchor"><span id="_Toc141257916" class="anchor"><span id="_Toc141267444" class="anchor"><span id="_Toc141522462" class="anchor"><span id="_Toc141529550" class="anchor"><span id="_Toc141529867" class="anchor"><span id="_Toc141851474" class="anchor"><span id="_Toc141852408" class="anchor"><span id="_Toc141887952" class="anchor"><span id="_Toc141889792" class="anchor"><span id="_Toc141893461" class="anchor"><span id="_Toc142113314" class="anchor"><span id="_Toc142114342" class="anchor"><span id="_Toc142729559" class="anchor"><span id="_Toc142730843" class="anchor"><span id="_Toc142731216" class="anchor"><span id="_Toc142998583" class="anchor"><span id="_Toc143063675" class="anchor"><span id="_Toc143509785" class="anchor"><span id="_Toc143510232" class="anchor"><span id="_Toc144026264" class="anchor"><span id="_Toc144026595" class="anchor"><span id="_Toc144276238" class="anchor"><span id="_Toc144276582" class="anchor"><span id="_Toc144280170" class="anchor"><span id="_Toc144280516" class="anchor"><span id="_Toc144540731" class="anchor"><span id="_Toc144554614" class="anchor"><span id="_Toc144722235" class="anchor"><span id="_Toc145503697" class="anchor"><span id="_Toc145512139" class="anchor"><span id="_Toc145513162" class="anchor"><span id="_Toc145513546" class="anchor"><span id="_Toc222907319" class="anchor"><span id="_Toc342652965" class="anchor"><span id="_Toc439864123" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>HvFlushVirtualAddressSpace

The HvFlushVirtualAddressSpace hypercall invalidates all virtual TLB
entries that belong to a specified address space.

##### Wrapper Interface

HV\_STATUS

HvFlushVirtualAddressSpace(

\_\_in HV\_ADDRESS\_SPACE\_ID AddressSpace,

\_\_in HV\_FLUSH\_FLAGS Flags,

\_\_in UINT64 ProcessorMask

);

##### \
Native Interface

  HvFlushVirtualAddressSpace
  ---------------------------- -------------------------
  Input Parameters
  0
  8
  16

##### Description

The virtual TLB invalidation operation acts on one or more processors.

If the guest has knowledge about which processors may need to be
flushed, it can specify a processor mask. Each bit in the mask
corresponds to a virtual processor index. For example, a mask of
0x0000000000000051 indicates that the hypervisor should flush only the
TLB of virtual processors 0, 4, and 6. A virtual processor can determine
its index by reading from MSR HV\_X64\_MSR\_VP\_INDEX.

***NOTE***

Future versions of the hypervisor may support more than 64 virtual
processors per partition. In that case, a new field will be added to the
flags value that allows the caller to define the “processor bank" to
which the processor mask applies.

The following flags can be used to modify the behavior of the flush:

-   *HV\_FLUSH\_ALL\_PROCESSORS* indicates that the operation should
    apply to all virtual processors within the partition. If this flag
    is set, the *ProcessorMask* parameter is ignored.

-   *HV\_FLUSH\_ALL\_VIRTUAL\_ADDRESS\_SPACES* indicates that the
    operation should apply to all virtual address spaces. If this flag
    is set, the *AddressSpace* parameter is ignored.

-   *HV\_FLUSH\_NON\_GLOBAL\_MAPPINGS\_ONLY* indicates that the
    hypervisor is required only to flush page mappings that were not
    mapped as “global" (that is, the x64 “G" bit was set in the page
    table entry). Global entries may be (but are not required to be)
    left unflushed by the hypervisor.

All other flags are reserved and must be set to zero.

This call guarantees that by the time control returns back to the
caller, the observable effects of all flushes on the specified virtual
processors have occurred.

If a target virtual processor’s TLB requires flushing and that virtual
processor’s TLB is currently “locked", the caller’s virtual processor is
suspended. When the caller’s virtual processor is “unsuspended", the
hypercall will be reissued. For more information on TLB locking, see
section 15.1.4.

Input Parameters

*AddressSpace* specifies an address space ID (a CR3 value).

*Flags* specifies a set of flag bits that modify the operation of the
flush.

*ProcessorMask* specifies a processor mask indicating which processors
should be affected by the flush operation.

Output Parameters

None.

Restrictions

None.

Return Values

  Status code                      Error condition
  -------------------------------- ----------------------------------------------------------------------------------------------------------------------------
  HV\_STATUS\_INVALID\_PARAMETER   The specified address space ID is not a valid CR3 value and the "flush all virtual address spaces" flag was not specified.
                                   One or more reserved bits in the specified address space ID (as defined by the x64 architecture) were set.
                                   One or more reserved bits within the flags register are set.
                                   All of the bits in the processor bit mask are set to zero, and the "flush all processors" flag was not specified.

### <span id="_Toc106181531" class="anchor"><span id="_Toc106422577" class="anchor"><span id="_Toc106525973" class="anchor"><span id="_Toc106181533" class="anchor"><span id="_Toc106422579" class="anchor"><span id="_Toc106525975" class="anchor"><span id="_Toc110172808" class="anchor"><span id="_Toc127596789" class="anchor"><span id="_Toc127786410" class="anchor"><span id="_Toc127786726" class="anchor"><span id="_Toc127787042" class="anchor"><span id="_Toc127877638" class="anchor"><span id="_Toc128289709" class="anchor"><span id="_Toc128290102" class="anchor"><span id="_Toc130189784" class="anchor"><span id="_Toc130201000" class="anchor"><span id="_Toc130201316" class="anchor"><span id="_Toc130201637" class="anchor"><span id="_Toc131936724" class="anchor"><span id="_Toc133901188" class="anchor"><span id="_Toc137461062" class="anchor"><span id="_Toc139096577" class="anchor"><span id="_Toc139188500" class="anchor"><span id="_Toc139191363" class="anchor"><span id="_Ref140489066" class="anchor"><span id="_Toc140490414" class="anchor"><span id="_Toc140571317" class="anchor"><span id="_Toc141257590" class="anchor"><span id="_Toc141257917" class="anchor"><span id="_Toc141267445" class="anchor"><span id="_Toc141522463" class="anchor"><span id="_Toc141529551" class="anchor"><span id="_Toc141529868" class="anchor"><span id="_Toc141851475" class="anchor"><span id="_Toc141852409" class="anchor"><span id="_Toc141887953" class="anchor"><span id="_Toc141889793" class="anchor"><span id="_Toc141893462" class="anchor"><span id="_Toc142113315" class="anchor"><span id="_Toc142114343" class="anchor"><span id="_Toc142729560" class="anchor"><span id="_Toc142730844" class="anchor"><span id="_Toc142731217" class="anchor"><span id="_Toc142998584" class="anchor"><span id="_Toc143063676" class="anchor"><span id="_Toc143509786" class="anchor"><span id="_Toc143510233" class="anchor"><span id="_Toc144026265" class="anchor"><span id="_Toc144026596" class="anchor"><span id="_Toc144276239" class="anchor"><span id="_Toc144276583" class="anchor"><span id="_Toc144280171" class="anchor"><span id="_Toc144280517" class="anchor"><span id="_Toc144540732" class="anchor"><span id="_Toc144554615" class="anchor"><span id="_Toc144722236" class="anchor"><span id="_Toc145503698" class="anchor"><span id="_Toc145512140" class="anchor"><span id="_Toc145513163" class="anchor"><span id="_Toc145513547" class="anchor"><span id="_Toc222907320" class="anchor"><span id="_Toc342652969" class="anchor"><span id="_Toc439864124" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>HvFlushVirtualAddressList

The HvFlushVirtualAddressList hypercall invalidates portions of the
virtual TLB that belong to a specified address space.

##### Wrapper Interface

HV\_STATUS

HvFlushVirtualAddressList(

\_\_in HV\_ADDRESS\_SPACE\_ID AddressSpace,

\_\_in HV\_FLUSH\_FLAGS Flags,

\_\_in UINT64 ProcessorMask,

\_\_inout PUINT32 GvaCount,

\_\_in\_ecount(GvaCount)

PCHV\_GVA GvaRangeList

);

##### Native Interface

  HvFlushVirtualAddressList \[rep\]
  ----------------------------------- -------------------------
  Input Parameter Header
  0
  8
  16
  Input List Element
  0

##### Description

The virtual TLB invalidation operation acts on one or more processors.

If the guest has knowledge about which processors may need to be
flushed, it can specify a processor mask. Each bit in the mask
corresponds to a virtual processor index. For example, a mask of
0x0000000000000051 indicates that the hypervisor should flush only the
TLB of virtual processors 0, 4 and 6.

The following flags can be used to modify the behavior of the flush:

-   *HV\_FLUSH\_ALL\_PROCESSORS* indicates that the operation should
    apply to all virtual processors within the partition. If this flag
    is set, the *ProcessorMask* parameter is ignored.

-   *HV\_FLUSH\_ALL\_VIRTUAL\_ADDRESS\_SPACES* indicates that the
    operation should apply to all virtual address spaces. If this flag
    is set, the *AddressSpace* parameter is ignored.

-   *HV\_FLUSH\_NON\_GLOBAL\_MAPPINGS\_ONLY* does not make sense for
    this call and is treated as an invalid option.

All other flags are reserved and must be set to zero.

This call takes a list of GVA ranges. Each range has a base GVA. Because
flushes are performed with page granularity, the bottom 12 bits of the
GVA can be used to define a range length. These bits encode the number
of additional pages (beyond the initial page) within the range. This
allows each entry to encode a range of 1 to 4096 pages.

A GVA that falls within a “large page" mapping (2MB or 4MB) will cause
the entire large page to be flushed from the virtual TLB.

This call guarantees that by the time control returns back to the
caller, the observable effects of all flushes on the specified virtual
processors have occurred.

Invalid GVAs (those that specify addresses beyond the end of the
partition’s GVA space) are ignored.

If a target virtual processor’s TLB requires flushing and that virtual
processor is inhibiting TLB flushes, the caller’s virtual processor is
suspended. When TLB flushes are no longer inhibited, the virtual
processor is “unsuspended" and the hypercall will be reissued. For more
information on TLB flush inhibit, see section 15.1.4.

Input Parameters

*AddressSpace* specifies an address space ID (a CR3 value).

*Flags* specifies a set of flag bits that modify the operation of the
flush.

*ProcessorMask* specifies a processor mask indicating which processors
should be affected by the flush operation.

*GvaRange* specifies a guest virtual address range.

Output Parameters

None.

Restrictions

None.

Return Values

  Status code                      Error condition
  -------------------------------- ----------------------------------------------------------------------------------------------------------------------------
  HV\_STATUS\_INVALID\_PARAMETER   The specified address space ID is not a valid CR3 value and the "flush all virtual address spaces" flag was not specified.
                                   One or more reserved bits in the specified address space ID (as defined by the x64 architecture) were set.
                                   One or more reserved bits within the flags register are set.
                                   All of the bits in the processor bit mask are set to zero, and the "flush all processors" flag was not specified.

### <span id="_Toc127596790" class="anchor"><span id="_Toc127786411" class="anchor"><span id="_Toc127786727" class="anchor"><span id="_Toc127787043" class="anchor"><span id="_Toc127877639" class="anchor"><span id="_Toc128289710" class="anchor"><span id="_Toc128290103" class="anchor"><span id="_Toc130189785" class="anchor"><span id="_Toc130201001" class="anchor"><span id="_Toc130201317" class="anchor"><span id="_Toc130201638" class="anchor"><span id="_Toc131936725" class="anchor"><span id="_Toc133901189" class="anchor"><span id="_Toc137461063" class="anchor"><span id="_Toc139096578" class="anchor"><span id="_Toc139188501" class="anchor"><span id="_Toc139191364" class="anchor"><span id="_Toc140490415" class="anchor"><span id="_Toc140571318" class="anchor"><span id="_Toc141257591" class="anchor"><span id="_Toc141257918" class="anchor"><span id="_Toc141267446" class="anchor"><span id="_Toc141522464" class="anchor"><span id="_Toc141529552" class="anchor"><span id="_Toc141529869" class="anchor"><span id="_Toc141851476" class="anchor"><span id="_Toc141852410" class="anchor"><span id="_Toc141887954" class="anchor"><span id="_Toc141889794" class="anchor"><span id="_Toc141893463" class="anchor"><span id="_Toc142113316" class="anchor"><span id="_Toc142114344" class="anchor"><span id="_Toc142729561" class="anchor"><span id="_Toc142730845" class="anchor"><span id="_Toc142731218" class="anchor"><span id="_Toc142998585" class="anchor"><span id="_Toc143063677" class="anchor"><span id="_Toc143509787" class="anchor"><span id="_Toc143510234" class="anchor"><span id="_Toc144026266" class="anchor"><span id="_Toc144026597" class="anchor"><span id="_Toc144276240" class="anchor"><span id="_Toc144276584" class="anchor"><span id="_Toc144280172" class="anchor"><span id="_Toc144280518" class="anchor"><span id="_Toc144540733" class="anchor"><span id="_Toc144554616" class="anchor"><span id="_Toc144722237" class="anchor"><span id="_Toc145503699" class="anchor"><span id="_Toc145512141" class="anchor"><span id="_Toc145513164" class="anchor"><span id="_Toc145513548" class="anchor"><span id="_Toc222907321" class="anchor"><span id="_Toc342652973" class="anchor"><span id="_Ref106528067" class="anchor"><span id="_Ref106528331" class="anchor"><span id="_Ref106528353" class="anchor"><span id="_Toc439864125" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>HvTranslateVirtualAddress

The HvTranslateVirtualAddress hypercall attempts to translate a
specified GVA page number into a GPA page number.

##### Wrapper Interface

HV\_STATUS

HvTranslateVirtualAddress(

\_\_in HV\_PARTITION\_ID PartitionId,

\_\_in HV\_VP\_INDEX VpIndex,

\_\_in HV\_TRANSLATE\_GVA\_CONTROL\_FLAGS ControlFlags,

\_\_in HV\_GVA\_PAGE\_NUMBER GvaPage,

\_\_out PHV\_TRANSLATE\_GVA\_RESULT TranslationResult,

\_\_out PHV\_GPA\_PAGE\_NUMBER GpaPage

);

##### Native Interface

  HvTranslateVirtualAddress
  --------------------------- ----------------------------- -------------------
  Input Parameters
  0
  8
  16
  24
  Output Parameters
  0
  8

##### Description

The translation considers the current modes and state of the specified
virtual processor as well as the guest page tables.

The caller must specify whether the intended access is to read, write or
execute by setting the appropriate control flags. Combinations of these
access types are possible. Several other translation options are also
available.

-   *HV\_TRANSLATE\_GVA\_PRIVILEGE\_EXEMPT*: Indicates that the access
    should be performed as though the processor was running at a
    privilege level zero rather than the current privilege level.

-   *HV\_TRANSLATE\_GVA\_SET\_PAGE\_TABLE\_BITS*: Indicates that the
    routine should set the dirty and accessed bits within the guest’s
    page tables if appropriate for the access type. The dirty bit will
    only be set if *HV\_TRANSLATE\_GVA\_VALIDATE\_WRITE* is
    also specified. If the caller has requested that accessed and dirty
    bits be set as part of the table walk, these bits are set as the
    walk occurs. If a walk is aborted, the accessed and dirty bits that
    were already set are not restored to their previous values.

-   *HV\_TRANSLATE\_GVA\_LOCK\_TLB*: Indicates that the
    *TlbFlushInhibit* flag in the virtual processor’s
    HvRegisterInterceptSuspend register should be set as a consequence
    of a successful return. This prevents other virtual processors
    associated with the target partition from flushing the TLB of the
    specified virtual processor until after the *TlbFlushInhibit* flag
    is cleared. See section 15.1.4 for more information.

If paging is disabled in the virtual processor (that is, CR0.PG is
clear), then no page tables are consulted, and translation success is
guaranteed.

If paging is enabled in the virtual processor (that is, CR0.PG is set),
then a page table walk is performed. The call uses the current state of
the virtual processor to determine whether to perform a two-level,
three-level, or four-level page table walk.

During the page table walk, a number of conditions can arise that cause
the walk to be terminated.A table entry is marked “not present" or the
GVA is beyond the range permitted for the paging mode. In this case,
*HvTranslateGvaPageNotPresent* is returned.

A privilege violation is detected based on the access type (read, write,
execute) or on the current privilege level. In this case,
*HvTranslateGvaPrivilegeViolation* is returned.

A reserved bit is set within a table entry. In this case,
*HvTranslateGvaInvalidPageTableFlags* is returned.

A page table walk can also be terminated if one of the guest’s page
table pages cannot be accessed. This can occur in one of the following
situations: The GPA is unmapped. In this case,
*HvTranslateGvaGpaUnmapped* is returned.

The GPA mapping’s access rights indicate that the page is not readable.
In this case, *HvTranslateGvaGpaNoReadAccess* or
*HvTranslateGvaGpaNoWriteAccess* is returned.

The access targets an overlay page that doesn’t allow reads or writes.
In this case, *HvTranslateGvaGpaIllegalOverlayAccess* is returned.

If any of these GPA access failures are reported, the *GpaPage* output
parameter is used to indicate which GPA page could not be accessed.

If no translation error occurs, *HvTranslateGvaSuccess* is returned. In
this case, the *GpaPage* output parameter is used to report the
resulting translation, and the associated *CacheType* and *OverlayPage*
fields are set appropriately. The *CacheType* field indicates the
effective cache type used by the virtual processor to access the
translated virtual address. The *OverlayPage* field indicates whether
the translated GPA accesses an overlay page owned by the hypervisor.
Callers can use this information to determine whether memory accesses
performed by the virtual processor would have accessed a mapped GPA page
or an overlay page.

If the caller has requested that accessed and dirty bits be set as part
of the table walk, then these bits are set as the walk occurs. If a walk
is aborted, then the accessed and dirty bits that were already set are
not restored to their previous values.

The reported cache type considers all of the state of the virtual
processor including the current virtual PAT register settings and (if
supported by the hypervisor implementation) the value of the MTRR MSRs
and CR0.CD.

If the call returns HV\_STATUS\_SUCCESS, the output parameter
*TranslationResult* is valid. The caller must consult the result code
and results flags to determine whether the *GpaPage* parameter is valid.

Input Parameters

*PartitionId* specifies a partition.

*VpIndex* specifies a virtual processor index.

*ControlFlags* specifies a set of flag bits that modify the behavior of
the translation.

*GvaPage* specifies a guest virtual address page number.

Output Parameters

*TranslationResult* specifies information about the translation
including the result code and flags.

GpaPage specifies the translated GPA (if the result code is
HvTranslateGvaSuccess) or the address of a GPA access failure (if the
result code is HvTranslateGvaGpaUnmapped, HvTranslateGvaGpaNoReadAccess,
HvTranslateGvaGpaNoWriteAccess, or
HvTranslateGvaGpaIllegalOverlayAccess). For other result codes, this
return parameter is invalid.

Restrictions

-   The partition specified by *PartitionId* must be in the
    “active" state.

-   The caller must be the parent of the partition specified by
    *PartitionId*.

Return Values

  Status code                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                Error condition
  -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  HV\_STATUS\_ACCESS\_DENIED                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 The caller is not the parent of the specified partition.
  HV\_STATUS\_INVALID\_PARTITION\_ID                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         The specified partition ID is invalid.
  HV\_STATUS\_INVALID\_VP\_INDEX                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             The specified VP index does not reference a virtual processor within the specified partition.
  HV\_STATUS\_INVALID\_PARAMETER                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             All three of the control flags HV\_TRANSLATE\_GVA\_VALIDATE\_READ, HV\_TRANSLATE\_GVA\_VALIDATE\_WRITE, and HV\_TRANSLATE\_GVA\_VALIDATE\_EXECUTE are cleared. At least one of these must be set.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             One or more reserved bits in the specified control flags are set.
  HV\_STATUS\_INVALID\_PARTITION\_STATE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      The specified partition is not in the “active" state.
  <span id="_Toc127596791" class="anchor"><span id="_Toc127786412" class="anchor"><span id="_Toc127786728" class="anchor"><span id="_Toc127787044" class="anchor"><span id="_Toc127877640" class="anchor"><span id="_Toc128289711" class="anchor"><span id="_Toc128290104" class="anchor"><span id="_Toc130189786" class="anchor"><span id="_Toc130201002" class="anchor"><span id="_Toc130201318" class="anchor"><span id="_Toc130201639" class="anchor"><span id="_Toc131936726" class="anchor"><span id="_Toc133901190" class="anchor"><span id="_Toc137461064" class="anchor"><span id="_Toc139096579" class="anchor"><span id="_Toc139188502" class="anchor"><span id="_Toc139191365" class="anchor"><span id="_Toc140490416" class="anchor"><span id="_Toc140571319" class="anchor"><span id="_Toc141257592" class="anchor"><span id="_Toc141257919" class="anchor"><span id="_Toc141267447" class="anchor"><span id="_Toc141522465" class="anchor"><span id="_Toc141529553" class="anchor"><span id="_Toc141529870" class="anchor"><span id="_Toc141851477" class="anchor"><span id="_Toc141852411" class="anchor"><span id="_Toc141887955" class="anchor"><span id="_Toc141889795" class="anchor"><span id="_Toc141893464" class="anchor"><span id="_Toc142113317" class="anchor"><span id="_Toc142114345" class="anchor"><span id="_Toc142729562" class="anchor"><span id="_Toc142730846" class="anchor"><span id="_Toc142731219" class="anchor"><span id="_Toc142998586" class="anchor"><span id="_Toc143063678" class="anchor"><span id="_Toc143509788" class="anchor"><span id="_Toc143510235" class="anchor"><span id="_Toc144026267" class="anchor"><span id="_Toc144026598" class="anchor"><span id="_Toc144276241" class="anchor"><span id="_Toc144276585" class="anchor"><span id="_Toc144280173" class="anchor"><span id="_Toc144280519" class="anchor"><span id="_Toc144540734" class="anchor"><span id="_Toc144554617" class="anchor"><span id="_Toc144722238" class="anchor"><span id="_Toc145503700" class="anchor"><span id="_Toc145512142" class="anchor"><span id="_Toc145513165" class="anchor"><span id="_Toc145513549" class="anchor"><span id="_Toc222907322" class="anchor"><span id="_Toc342652977" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>HV\_STATUS\_INVALID\_VP\_STATE   A virtual processor is not in the correct state for the performance of the indicated operation.

### <span id="_Toc439858115" class="anchor"><span id="_Toc439864126" class="anchor"></span></span>

##### 

<span id="_Toc437513405" class="anchor"></span>

<span id="_Toc437513416" class="anchor"></span>

##### 

  ------------------------------------------------- -- --
  <span id="_Toc437513420" class="anchor"></span>
  ------------------------------------------------- -- --

##### 

-   -   -   -   -   

  ------------------------------------------------- --
                                                    

                                                    

                                                    

  <span id="_Toc437513484" class="anchor"></span>   
                                                    
  <span id="_Toc437513485" class="anchor"></span>   
                                                    
  <span id="_Toc437513486" class="anchor"></span>   
                                                    
  <span id="_Toc437513487" class="anchor"></span>   

  <span id="_Toc437513490" class="anchor"></span>   

  <span id="_Toc437513493" class="anchor"></span>   

  <span id="_Toc437513496" class="anchor"></span>   

  <span id="_Toc437513499" class="anchor"></span>   

                                                    
  ------------------------------------------------- --

### <span id="_Toc127596792" class="anchor"><span id="_Toc127786413" class="anchor"><span id="_Toc127786729" class="anchor"><span id="_Toc127787045" class="anchor"><span id="_Toc127877641" class="anchor"><span id="_Toc128289712" class="anchor"><span id="_Toc128290105" class="anchor"><span id="_Toc130189787" class="anchor"><span id="_Toc130201003" class="anchor"><span id="_Toc130201319" class="anchor"><span id="_Toc130201640" class="anchor"><span id="_Toc131936727" class="anchor"><span id="_Toc133901191" class="anchor"><span id="_Toc137461065" class="anchor"><span id="_Toc139096580" class="anchor"><span id="_Toc139188503" class="anchor"><span id="_Toc139191366" class="anchor"><span id="_Toc140490417" class="anchor"><span id="_Toc140571320" class="anchor"><span id="_Toc141257593" class="anchor"><span id="_Toc141257920" class="anchor"><span id="_Toc141267448" class="anchor"><span id="_Toc141522466" class="anchor"><span id="_Toc141529554" class="anchor"><span id="_Toc141529871" class="anchor"><span id="_Toc141851478" class="anchor"><span id="_Toc141852412" class="anchor"><span id="_Toc141887956" class="anchor"><span id="_Toc141889796" class="anchor"><span id="_Toc141893465" class="anchor"><span id="_Toc142113318" class="anchor"><span id="_Toc142114346" class="anchor"><span id="_Toc142729563" class="anchor"><span id="_Toc142730847" class="anchor"><span id="_Toc142731220" class="anchor"><span id="_Toc142998587" class="anchor"><span id="_Toc143063679" class="anchor"><span id="_Toc143509789" class="anchor"><span id="_Toc143510236" class="anchor"><span id="_Toc144026268" class="anchor"><span id="_Toc144026599" class="anchor"><span id="_Toc144276242" class="anchor"><span id="_Toc144276586" class="anchor"><span id="_Toc144280174" class="anchor"><span id="_Toc144280520" class="anchor"><span id="_Toc144540735" class="anchor"><span id="_Toc144554618" class="anchor"><span id="_Toc144722239" class="anchor"><span id="_Toc145503701" class="anchor"><span id="_Toc145512143" class="anchor"><span id="_Toc145513166" class="anchor"><span id="_Toc145513550" class="anchor"><span id="_Toc222907323" class="anchor"><span id="_Toc342652981" class="anchor"><span id="_Toc439858116" class="anchor"><span id="_Toc439864127" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>

##### 

<span id="_Toc437513508" class="anchor"></span>

<span id="_Toc437513519" class="anchor"></span>

##### 

  ------------------------------------------------- -- --
  <span id="_Toc437513523" class="anchor"></span>
  ------------------------------------------------- -- --

##### 

-   -   

  ------------------------------------------------- --
                                                    

                                                    

                                                    

  <span id="_Toc437513587" class="anchor"></span>   
                                                    
  <span id="_Toc437513588" class="anchor"></span>   
                                                    
  <span id="_Toc437513589" class="anchor"></span>   
                                                    
  <span id="_Toc437513590" class="anchor"></span>   

  <span id="_Toc437513593" class="anchor"></span>   

  <span id="_Toc437513596" class="anchor"></span>   

  <span id="_Toc437513599" class="anchor"></span>   

  <span id="_Toc437513602" class="anchor"></span>   

                                                    
  ------------------------------------------------- --

1.  <span id="_Toc127596793" class="anchor"><span id="_Toc127786414" class="anchor"><span id="_Toc127786730" class="anchor"><span id="_Toc127787046" class="anchor"><span id="_Toc127877642" class="anchor"><span id="_Toc128289713" class="anchor"><span id="_Toc128290106" class="anchor"><span id="_Toc130189788" class="anchor"><span id="_Toc130201004" class="anchor"><span id="_Toc130201320" class="anchor"><span id="_Toc130201641" class="anchor"><span id="_Toc131936728" class="anchor"><span id="_Toc133901192" class="anchor"><span id="_Toc137461066" class="anchor"><span id="_Toc139096581" class="anchor"><span id="_Toc139188504" class="anchor"><span id="_Toc139191367" class="anchor"><span id="_Toc140490418" class="anchor"><span id="_Toc140571321" class="anchor"><span id="_Toc141257594" class="anchor"><span id="_Toc141257921" class="anchor"><span id="_Toc141267449" class="anchor"><span id="_Toc141522467" class="anchor"><span id="_Toc141529555" class="anchor"><span id="_Toc141529872" class="anchor"><span id="_Toc141851479" class="anchor"><span id="_Toc141852413" class="anchor"><span id="_Toc141887957" class="anchor"><span id="_Toc141889797" class="anchor"><span id="_Toc141893466" class="anchor"><span id="_Toc142113319" class="anchor"><span id="_Toc142114347" class="anchor"><span id="_Toc142729564" class="anchor"><span id="_Toc142730848" class="anchor"><span id="_Toc142731221" class="anchor"><span id="_Toc142998588" class="anchor"><span id="_Toc143063680" class="anchor"><span id="_Toc143509790" class="anchor"><span id="_Toc143510237" class="anchor"><span id="_Toc144026269" class="anchor"><span id="_Toc144026600" class="anchor"><span id="_Toc144276243" class="anchor"><span id="_Toc144276587" class="anchor"><span id="_Toc144280175" class="anchor"><span id="_Toc144280521" class="anchor"><span id="_Toc144540736" class="anchor"><span id="_Toc144554619" class="anchor"><span id="_Toc144722240" class="anchor"><span id="_Toc145503702" class="anchor"><span id="_Toc145512144" class="anchor"><span id="_Toc145513167" class="anchor"><span id="_Toc145513551" class="anchor"><span id="_Toc222907324" class="anchor"><span id="_Toc342652985" class="anchor"><span id="_Toc439864128" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Virtual Interrupt Control
    ==================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================

    1.  <span id="_Toc107686596" class="anchor"><span id="_Toc110172810" class="anchor"><span id="_Toc127596794" class="anchor"><span id="_Toc127786415" class="anchor"><span id="_Toc127786731" class="anchor"><span id="_Toc127787047" class="anchor"><span id="_Toc127877643" class="anchor"><span id="_Toc128289714" class="anchor"><span id="_Toc128290107" class="anchor"><span id="_Toc130189789" class="anchor"><span id="_Toc130201005" class="anchor"><span id="_Toc130201321" class="anchor"><span id="_Toc130201642" class="anchor"><span id="_Toc131936729" class="anchor"><span id="_Toc133901193" class="anchor"><span id="_Toc137461067" class="anchor"><span id="_Toc139096582" class="anchor"><span id="_Toc139188505" class="anchor"><span id="_Toc139191368" class="anchor"><span id="_Toc140490419" class="anchor"><span id="_Toc140571322" class="anchor"><span id="_Toc141257595" class="anchor"><span id="_Toc141257922" class="anchor"><span id="_Toc141267450" class="anchor"><span id="_Toc141522468" class="anchor"><span id="_Toc141529556" class="anchor"><span id="_Toc141529873" class="anchor"><span id="_Toc141851480" class="anchor"><span id="_Toc141852414" class="anchor"><span id="_Toc141887958" class="anchor"><span id="_Toc141889798" class="anchor"><span id="_Toc141893467" class="anchor"><span id="_Toc142113320" class="anchor"><span id="_Toc142114348" class="anchor"><span id="_Toc142729565" class="anchor"><span id="_Toc142730849" class="anchor"><span id="_Toc142731222" class="anchor"><span id="_Toc142998589" class="anchor"><span id="_Toc143063681" class="anchor"><span id="_Toc143509791" class="anchor"><span id="_Toc143510238" class="anchor"><span id="_Toc144026270" class="anchor"><span id="_Toc144026601" class="anchor"><span id="_Toc144276244" class="anchor"><span id="_Toc144276588" class="anchor"><span id="_Toc144280176" class="anchor"><span id="_Toc144280522" class="anchor"><span id="_Toc144540737" class="anchor"><span id="_Toc144554620" class="anchor"><span id="_Toc144722241" class="anchor"><span id="_Toc145503703" class="anchor"><span id="_Toc145512145" class="anchor"><span id="_Toc145513168" class="anchor"><span id="_Toc145513552" class="anchor"><span id="_Toc222907325" class="anchor"><span id="_Toc342652986" class="anchor"><span id="_Toc439864129" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Overview
        -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

The hypervisor virtualizes interrupt delivery to virtual processors.
This is done through the use of a synthetic interrupt controller (SynIC)
which is an extension of a virtualized local APIC; that is, each virtual
processor has a local APIC instance with the SynIC extensions. These
extensions provide a simple inter-partition communication mechanism
which is described in the following chapter.

Interrupts delivered to a partition fall into two categories: external
and internal. External interrupts originate from other partitions or
devices, and internal interrupts originate from within the partition
itself.

External interrupts are generated in the following situations:

-   A physical hardware device generates a hardware interrupt (in which
    case the interrupt is reflected to the root partition).

-   A parent partition calls asserts a virtual interrupt (typically in
    the process of emulating a hardware device).

-   The hypervisor delivers a message (for example, due to an intercept)
    to a partition.

-   Another partition posts a message.

-   Another partition signals an event.

Internal interrupts are generated in the following situations:

-   A virtual processor accesses the APIC interrupt command
    register (ICR).

-   A synthetic timer expires.

    1.  <span id="_Toc107686598" class="anchor"><span id="_Toc110172811" class="anchor"><span id="_Toc127596795" class="anchor"><span id="_Toc127786416" class="anchor"><span id="_Toc127786732" class="anchor"><span id="_Toc127787048" class="anchor"><span id="_Toc127877644" class="anchor"><span id="_Toc128289715" class="anchor"><span id="_Toc128290108" class="anchor"><span id="_Toc130189790" class="anchor"><span id="_Toc130201006" class="anchor"><span id="_Toc130201322" class="anchor"><span id="_Toc130201643" class="anchor"><span id="_Toc131936730" class="anchor"><span id="_Toc133901194" class="anchor"><span id="_Toc137461068" class="anchor"><span id="_Toc139096583" class="anchor"><span id="_Toc139188506" class="anchor"><span id="_Toc139191369" class="anchor"><span id="_Toc140490421" class="anchor"><span id="_Toc140571323" class="anchor"><span id="_Toc141257596" class="anchor"><span id="_Toc141257923" class="anchor"><span id="_Toc141267451" class="anchor"><span id="_Toc141522469" class="anchor"><span id="_Toc141529557" class="anchor"><span id="_Toc141529874" class="anchor"><span id="_Toc141851481" class="anchor"><span id="_Toc141852415" class="anchor"><span id="_Toc141887959" class="anchor"><span id="_Toc141889799" class="anchor"><span id="_Toc141893468" class="anchor"><span id="_Toc142113321" class="anchor"><span id="_Toc142114349" class="anchor"><span id="_Toc142729566" class="anchor"><span id="_Toc142730850" class="anchor"><span id="_Toc142731223" class="anchor"><span id="_Toc142998590" class="anchor"><span id="_Toc143063682" class="anchor"><span id="_Toc143509792" class="anchor"><span id="_Toc143510239" class="anchor"><span id="_Toc144026271" class="anchor"><span id="_Toc144026602" class="anchor"><span id="_Toc144276245" class="anchor"><span id="_Toc144276589" class="anchor"><span id="_Toc144280177" class="anchor"><span id="_Toc144280523" class="anchor"><span id="_Toc144540738" class="anchor"><span id="_Toc144554621" class="anchor"><span id="_Toc144722242" class="anchor"><span id="_Toc145503704" class="anchor"><span id="_Toc145512146" class="anchor"><span id="_Toc145513169" class="anchor"><span id="_Toc145513553" class="anchor"><span id="_Toc222907326" class="anchor"><span id="_Toc342652987" class="anchor"><span id="_Toc439864130" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Local APIC
        -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

The SynIC is a superset of a local APIC. The interface to this APIC is
given by a set of 32-bit memory mapped registers. This local APIC
(including the behavior of the memory mapped registers) is generally
compatible with the local APIC on P4/Xeon systems as described in
Intel’s documentation.

### <span id="_Toc127596796" class="anchor"><span id="_Toc127786417" class="anchor"><span id="_Toc127786733" class="anchor"><span id="_Toc127787049" class="anchor"><span id="_Toc127877645" class="anchor"><span id="_Toc128289716" class="anchor"><span id="_Toc128290109" class="anchor"><span id="_Toc130189791" class="anchor"><span id="_Toc130201007" class="anchor"><span id="_Toc130201323" class="anchor"><span id="_Toc130201644" class="anchor"><span id="_Toc131936731" class="anchor"><span id="_Toc133901195" class="anchor"><span id="_Toc137461069" class="anchor"><span id="_Toc139096584" class="anchor"><span id="_Toc139188507" class="anchor"><span id="_Toc139191370" class="anchor"><span id="_Toc140490422" class="anchor"><span id="_Toc140571324" class="anchor"><span id="_Toc141257597" class="anchor"><span id="_Toc141257924" class="anchor"><span id="_Toc141267452" class="anchor"><span id="_Toc141522470" class="anchor"><span id="_Toc141529558" class="anchor"><span id="_Toc141529875" class="anchor"><span id="_Toc141851482" class="anchor"><span id="_Toc141852416" class="anchor"><span id="_Toc141887960" class="anchor"><span id="_Toc141889800" class="anchor"><span id="_Toc141893469" class="anchor"><span id="_Toc142113322" class="anchor"><span id="_Toc142114350" class="anchor"><span id="_Toc142729567" class="anchor"><span id="_Toc142730851" class="anchor"><span id="_Toc142731224" class="anchor"><span id="_Toc142998591" class="anchor"><span id="_Toc143063683" class="anchor"><span id="_Toc143509793" class="anchor"><span id="_Toc143510240" class="anchor"><span id="_Toc144026272" class="anchor"><span id="_Toc144026603" class="anchor"><span id="_Toc144276246" class="anchor"><span id="_Toc144276590" class="anchor"><span id="_Toc144280178" class="anchor"><span id="_Toc144280524" class="anchor"><span id="_Toc144540739" class="anchor"><span id="_Toc144554622" class="anchor"><span id="_Toc144722243" class="anchor"><span id="_Toc145503705" class="anchor"><span id="_Toc145512147" class="anchor"><span id="_Toc145513170" class="anchor"><span id="_Toc145513554" class="anchor"><span id="_Toc222907327" class="anchor"><span id="_Toc342652988" class="anchor"><span id="_Toc439864131" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Local APIC Virtualization

The hypervisor’s local APIC virtualization may deviate from physical
APIC operation in the following minor ways:

-   On physical systems, the IA32\_APIC\_BASE MSR can be different for
    each processor in the system. The hypervisor may require that this
    MSR contains the same value for all virtual processors within
    a partition. As such, this MSR may be treated as a
    partition-wide value. If a virtual processor modifies this register,
    the value may effectively propagate to all virtual processors within
    the partition.

-   The IA32\_APIC\_BASE MSR defines a “global enable" bit for enabling
    or disabling the APIC. The virtualized APIC may always be enabled.
    If so, this bit will always be set to 1.

-   The hypervisor’s local APIC may not be able to generate virtual SMIs
    (system management interrupts).

-   The hypervisor may allow accesses only to the APIC’s memory-mapped
    registers to be performed by one of the instructions in
    section 16.2.2. Furthermore, it may allow only accesses that are
    four bytes in size and aligned to four-byte boundaries. In such
    cases, if an unsupported access is attempted, the virtual processor
    will be suspended, and an unsupported feature error message will be
    delivered to the partition’s parent.

-   If multiple virtual processors within a partition are assigned
    identical APIC IDs, behavior of targeted interrupt delivery is
    boundedly undefined. That is, the hypervisor is free to deliver the
    interrupt to just one virtual processor, all virtual processors with
    the specified APIC ID, or no virtual processors. This situation is
    considered a guest programming error.

-   Some of the memory mapped APIC registers may be accessed by way of
    virtual MSRs.

The remaining parts of this section describe only those aspects of SynIC
functionality that are extensions of the local APIC.

### <span id="_Ref111186124" class="anchor"><span id="_Toc127596797" class="anchor"><span id="_Toc127786418" class="anchor"><span id="_Toc127786734" class="anchor"><span id="_Toc127787050" class="anchor"><span id="_Toc127877646" class="anchor"><span id="_Toc128289717" class="anchor"><span id="_Toc128290110" class="anchor"><span id="_Toc130189792" class="anchor"><span id="_Toc130201008" class="anchor"><span id="_Toc130201324" class="anchor"><span id="_Toc130201645" class="anchor"><span id="_Toc131936732" class="anchor"><span id="_Toc133901196" class="anchor"><span id="_Toc137461070" class="anchor"><span id="_Toc139096585" class="anchor"><span id="_Toc139188508" class="anchor"><span id="_Toc139191371" class="anchor"><span id="_Toc140490423" class="anchor"><span id="_Toc140571325" class="anchor"><span id="_Toc141257598" class="anchor"><span id="_Toc141257925" class="anchor"><span id="_Toc141267453" class="anchor"><span id="_Toc141522471" class="anchor"><span id="_Toc141529559" class="anchor"><span id="_Toc141529876" class="anchor"><span id="_Toc141851483" class="anchor"><span id="_Toc141852417" class="anchor"><span id="_Toc141887961" class="anchor"><span id="_Toc141889801" class="anchor"><span id="_Toc141893470" class="anchor"><span id="_Toc142113323" class="anchor"><span id="_Toc142114351" class="anchor"><span id="_Toc142729568" class="anchor"><span id="_Toc142730852" class="anchor"><span id="_Toc142731225" class="anchor"><span id="_Toc142998592" class="anchor"><span id="_Toc143063684" class="anchor"><span id="_Toc143509794" class="anchor"><span id="_Toc143510241" class="anchor"><span id="_Toc144026273" class="anchor"><span id="_Toc144026604" class="anchor"><span id="_Toc144276247" class="anchor"><span id="_Toc144276591" class="anchor"><span id="_Toc144280179" class="anchor"><span id="_Toc144280525" class="anchor"><span id="_Toc144540740" class="anchor"><span id="_Toc144554623" class="anchor"><span id="_Toc144722244" class="anchor"><span id="_Toc145503706" class="anchor"><span id="_Toc145512148" class="anchor"><span id="_Toc145513171" class="anchor"><span id="_Toc145513555" class="anchor"><span id="_Toc222907328" class="anchor"><span id="_Toc342652989" class="anchor"><span id="_Toc110172812" class="anchor"><span id="_Toc439864132" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Local APIC Memory-mapped Accesses

The hypervisor emulates accesses to memory-mapped registers within the
virtualized local APIC. However, only certain instruction forms are
supported, and use of other forms will result in \#GP. Compatible guests
should access only the local APIC registers by using the following
instruction forms:

  Opcode   Instruction       Notes
  -------- ----------------- ---------------------------------
  89 /r    MOV m32,r32       m32 must be 4-byte aligned.
  8B /r    MOV r32,m32       m32 must be 4-byte aligned.
  A1       MOV EAX,moffs32   moffs32 must be 4-byte aligned.
  A3       MOV moffs32,EAX   moffs32 must be 4-byte aligned.
  C7 /0    MOV m32,imm32     m32 must be 4-byte aligned.
  FF /6    PUSH m32          m32 must be 4-byte aligned.

### <span id="_Toc127596798" class="anchor"><span id="_Toc127786419" class="anchor"><span id="_Toc127786735" class="anchor"><span id="_Toc127787051" class="anchor"><span id="_Toc127877647" class="anchor"><span id="_Toc128289718" class="anchor"><span id="_Toc128290111" class="anchor"><span id="_Toc130189793" class="anchor"><span id="_Toc130201009" class="anchor"><span id="_Toc130201325" class="anchor"><span id="_Toc130201646" class="anchor"><span id="_Toc131936733" class="anchor"><span id="_Toc133901197" class="anchor"><span id="_Toc137461071" class="anchor"><span id="_Toc139096586" class="anchor"><span id="_Toc139188509" class="anchor"><span id="_Toc139191372" class="anchor"><span id="_Toc140490424" class="anchor"><span id="_Toc140571326" class="anchor"><span id="_Toc141257599" class="anchor"><span id="_Toc141257926" class="anchor"><span id="_Toc141267454" class="anchor"><span id="_Toc141522472" class="anchor"><span id="_Toc141529560" class="anchor"><span id="_Toc141529877" class="anchor"><span id="_Toc141851484" class="anchor"><span id="_Toc141852418" class="anchor"><span id="_Toc141887962" class="anchor"><span id="_Toc141889802" class="anchor"><span id="_Toc141893471" class="anchor"><span id="_Toc142113324" class="anchor"><span id="_Toc142114352" class="anchor"><span id="_Toc142729569" class="anchor"><span id="_Toc142730853" class="anchor"><span id="_Toc142731226" class="anchor"><span id="_Toc142998593" class="anchor"><span id="_Toc143063685" class="anchor"><span id="_Toc143509795" class="anchor"><span id="_Toc143510242" class="anchor"><span id="_Toc144026274" class="anchor"><span id="_Toc144026605" class="anchor"><span id="_Toc144276248" class="anchor"><span id="_Toc144276592" class="anchor"><span id="_Toc144280180" class="anchor"><span id="_Toc144280526" class="anchor"><span id="_Toc144540741" class="anchor"><span id="_Toc144554624" class="anchor"><span id="_Toc144722245" class="anchor"><span id="_Toc145503707" class="anchor"><span id="_Toc145512149" class="anchor"><span id="_Toc145513172" class="anchor"><span id="_Toc145513556" class="anchor"><span id="_Ref159056175" class="anchor"><span id="_Ref159056190" class="anchor"><span id="_Ref159056204" class="anchor"><span id="_Toc222907329" class="anchor"><span id="_Toc342652990" class="anchor"><span id="_Ref108710576" class="anchor"><span id="_Toc110172830" class="anchor"><span id="_Toc439864133" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Local APIC MSR Accesses

The hypervisor provides accelerated MSR access to high usage memory
mapped APIC registers. These are the TPR, EOI, and the ICR registers.
The ICR low and ICR high registers are combined into one MSR.

  MSR Address   Register Name       Function
  ------------- ------------------- ----------------------------------------
  0x40000070    HV\_X64\_MSR\_EOI   Accesses the APIC EOI
  0x40000071    HV\_X64\_MSR\_ICR   Accesses the APIC ICR-high and ICR-low
  0x40000072    HV\_X64\_MSR\_TPR   Access the APIC TPR

For performance reasons, the guest operating system should follow the
hypervisor recommendation for the usage of the APIC MSRs (see section
3.4)

#### <span id="_Toc127596799" class="anchor"><span id="_Toc127786420" class="anchor"><span id="_Toc127786736" class="anchor"><span id="_Toc127787052" class="anchor"><span id="_Toc127877648" class="anchor"><span id="_Toc128289719" class="anchor"><span id="_Toc128290112" class="anchor"><span id="_Toc130189794" class="anchor"><span id="_Toc130201010" class="anchor"><span id="_Toc130201326" class="anchor"><span id="_Toc130201647" class="anchor"><span id="_Toc131936734" class="anchor"><span id="_Toc133901198" class="anchor"><span id="_Toc137461072" class="anchor"><span id="_Toc139096587" class="anchor"><span id="_Toc139188510" class="anchor"><span id="_Toc139191373" class="anchor"><span id="_Toc140490425" class="anchor"><span id="_Toc140571327" class="anchor"><span id="_Toc141257600" class="anchor"><span id="_Toc141257927" class="anchor"><span id="_Toc141267455" class="anchor"><span id="_Toc141522473" class="anchor"><span id="_Toc141529561" class="anchor"><span id="_Toc141529878" class="anchor"><span id="_Toc141851485" class="anchor"><span id="_Toc141852419" class="anchor"><span id="_Toc141887963" class="anchor"><span id="_Toc141889803" class="anchor"><span id="_Toc141893472" class="anchor"><span id="_Toc142113325" class="anchor"><span id="_Toc142114353" class="anchor"><span id="_Toc142729570" class="anchor"><span id="_Toc142730854" class="anchor"><span id="_Toc142731227" class="anchor"><span id="_Toc142998594" class="anchor"><span id="_Toc143063686" class="anchor"><span id="_Toc143509796" class="anchor"><span id="_Toc143510243" class="anchor"><span id="_Toc144026275" class="anchor"><span id="_Toc144026606" class="anchor"><span id="_Toc144276249" class="anchor"><span id="_Toc144276593" class="anchor"><span id="_Toc144280181" class="anchor"><span id="_Toc144280527" class="anchor"><span id="_Toc144540742" class="anchor"><span id="_Toc144554625" class="anchor"><span id="_Toc144722246" class="anchor"><span id="_Toc145503708" class="anchor"><span id="_Toc145512150" class="anchor"><span id="_Toc145513173" class="anchor"><span id="_Toc145513557" class="anchor"><span id="_Toc222907330" class="anchor"><span id="_Toc342652991" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>EOI Register

  63:32     31:0
  --------- -----------
  Ignored   EOI value

  Bits    Description                        Attributes
  ------- ---------------------------------- ------------
  63:32   RsvdZ (reserved, should be zero)   Write
  31:0    EOI value                          Write

This is a write-only register, and it sets a value into the APIC EOI
register. Attempts to read from this register will result in a \#GP
fault.

#### <span id="_Toc127596800" class="anchor"><span id="_Toc127786421" class="anchor"><span id="_Toc127786737" class="anchor"><span id="_Toc127787053" class="anchor"><span id="_Toc127877649" class="anchor"><span id="_Toc128289720" class="anchor"><span id="_Toc128290113" class="anchor"><span id="_Toc130189795" class="anchor"><span id="_Toc130201011" class="anchor"><span id="_Toc130201327" class="anchor"><span id="_Toc130201648" class="anchor"><span id="_Toc131936735" class="anchor"><span id="_Toc133901199" class="anchor"><span id="_Toc137461073" class="anchor"><span id="_Toc139096588" class="anchor"><span id="_Toc139188511" class="anchor"><span id="_Toc139191374" class="anchor"><span id="_Toc140490426" class="anchor"><span id="_Toc140571328" class="anchor"><span id="_Toc141257601" class="anchor"><span id="_Toc141257928" class="anchor"><span id="_Toc141267456" class="anchor"><span id="_Toc141522474" class="anchor"><span id="_Toc141529562" class="anchor"><span id="_Toc141529879" class="anchor"><span id="_Toc141851486" class="anchor"><span id="_Toc141852420" class="anchor"><span id="_Toc141887964" class="anchor"><span id="_Toc141889804" class="anchor"><span id="_Toc141893473" class="anchor"><span id="_Toc142113326" class="anchor"><span id="_Toc142114354" class="anchor"><span id="_Toc142729571" class="anchor"><span id="_Toc142730855" class="anchor"><span id="_Toc142731228" class="anchor"><span id="_Toc142998595" class="anchor"><span id="_Toc143063687" class="anchor"><span id="_Toc143509797" class="anchor"><span id="_Toc143510244" class="anchor"><span id="_Toc144026276" class="anchor"><span id="_Toc144026607" class="anchor"><span id="_Toc144276250" class="anchor"><span id="_Toc144276594" class="anchor"><span id="_Toc144280182" class="anchor"><span id="_Toc144280528" class="anchor"><span id="_Toc144540743" class="anchor"><span id="_Toc144554626" class="anchor"><span id="_Toc144722247" class="anchor"><span id="_Toc145503709" class="anchor"><span id="_Toc145512151" class="anchor"><span id="_Toc145513174" class="anchor"><span id="_Toc145513558" class="anchor"><span id="_Toc222907331" class="anchor"><span id="_Toc342652992" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>ICR Register

  63:32      31:0
  ---------- ---------
  ICR high   ICR low

  Bits    Description      Attributes
  ------- ---------------- ------------
  63:32   ICR high value   Read/write
  31:0    ICR low value    Read/write

The values of ICR high and ICR low are read from or written into the
corresponding APIC ICR high and low registers.

#### <span id="_Toc127596801" class="anchor"><span id="_Toc127786422" class="anchor"><span id="_Toc127786738" class="anchor"><span id="_Toc127787054" class="anchor"><span id="_Toc127877650" class="anchor"><span id="_Toc128289721" class="anchor"><span id="_Toc128290114" class="anchor"><span id="_Toc130189796" class="anchor"><span id="_Toc130201012" class="anchor"><span id="_Toc130201328" class="anchor"><span id="_Toc130201649" class="anchor"><span id="_Toc131936736" class="anchor"><span id="_Toc133901200" class="anchor"><span id="_Toc137461074" class="anchor"><span id="_Toc139096589" class="anchor"><span id="_Toc139188512" class="anchor"><span id="_Toc139191375" class="anchor"><span id="_Toc140490427" class="anchor"><span id="_Toc140571329" class="anchor"><span id="_Toc141257602" class="anchor"><span id="_Toc141257929" class="anchor"><span id="_Toc141267457" class="anchor"><span id="_Toc141522475" class="anchor"><span id="_Toc141529563" class="anchor"><span id="_Toc141529880" class="anchor"><span id="_Toc141851487" class="anchor"><span id="_Toc141852421" class="anchor"><span id="_Toc141887965" class="anchor"><span id="_Toc141889805" class="anchor"><span id="_Toc141893474" class="anchor"><span id="_Toc142113327" class="anchor"><span id="_Toc142114355" class="anchor"><span id="_Toc142729572" class="anchor"><span id="_Toc142730856" class="anchor"><span id="_Toc142731229" class="anchor"><span id="_Toc142998596" class="anchor"><span id="_Toc143063688" class="anchor"><span id="_Toc143509798" class="anchor"><span id="_Toc143510245" class="anchor"><span id="_Toc144026277" class="anchor"><span id="_Toc144026608" class="anchor"><span id="_Toc144276251" class="anchor"><span id="_Toc144276595" class="anchor"><span id="_Toc144280183" class="anchor"><span id="_Toc144280529" class="anchor"><span id="_Toc144540744" class="anchor"><span id="_Toc144554627" class="anchor"><span id="_Toc144722248" class="anchor"><span id="_Toc145503710" class="anchor"><span id="_Toc145512152" class="anchor"><span id="_Toc145513175" class="anchor"><span id="_Toc145513559" class="anchor"><span id="_Toc222907332" class="anchor"><span id="_Toc342652993" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>TPR Register

  63:8    7:0
  ------- -----------
  RsvdZ   TPR value

  Bits   Description                        Attributes
  ------ ---------------------------------- ------------
  63:8   RsvdZ (reserved, should be zero)   Read/write
  7:0    TPR value                          Read/write

The value of the APIC TPR register is read or written.

***NOTE***

This MSR is intended to accelerate access to the TPR in 32-bit mode
guest partitions. 64-bit mode guest partitions should set the TPR by way
of CR8.

1.  <span id="_Toc127596802" class="anchor"><span id="_Toc127786423" class="anchor"><span id="_Toc127786739" class="anchor"><span id="_Toc127787055" class="anchor"><span id="_Toc127877651" class="anchor"><span id="_Toc128289722" class="anchor"><span id="_Toc128290115" class="anchor"><span id="_Toc130189797" class="anchor"><span id="_Toc130201013" class="anchor"><span id="_Toc130201329" class="anchor"><span id="_Toc130201650" class="anchor"><span id="_Toc131936737" class="anchor"><span id="_Toc133901201" class="anchor"><span id="_Toc137461075" class="anchor"><span id="_Toc139096590" class="anchor"><span id="_Toc139188513" class="anchor"><span id="_Toc139191376" class="anchor"><span id="_Toc140490428" class="anchor"><span id="_Toc140571330" class="anchor"><span id="_Toc141257603" class="anchor"><span id="_Toc141257930" class="anchor"><span id="_Toc141267458" class="anchor"><span id="_Toc141522476" class="anchor"><span id="_Toc141529564" class="anchor"><span id="_Toc141529881" class="anchor"><span id="_Toc141851488" class="anchor"><span id="_Toc141852422" class="anchor"><span id="_Toc141887966" class="anchor"><span id="_Toc141889806" class="anchor"><span id="_Toc141893475" class="anchor"><span id="_Toc142113328" class="anchor"><span id="_Toc142114356" class="anchor"><span id="_Toc142729573" class="anchor"><span id="_Toc142730857" class="anchor"><span id="_Toc142731230" class="anchor"><span id="_Toc142998597" class="anchor"><span id="_Toc143063689" class="anchor"><span id="_Toc143509799" class="anchor"><span id="_Toc143510246" class="anchor"><span id="_Toc144026278" class="anchor"><span id="_Toc144026609" class="anchor"><span id="_Toc144276252" class="anchor"><span id="_Toc144276596" class="anchor"><span id="_Toc144280184" class="anchor"><span id="_Toc144280530" class="anchor"><span id="_Toc144540745" class="anchor"><span id="_Toc144554628" class="anchor"><span id="_Toc144722249" class="anchor"><span id="_Toc145503711" class="anchor"><span id="_Toc145512153" class="anchor"><span id="_Toc145513176" class="anchor"><span id="_Toc145513560" class="anchor"><span id="_Toc222907333" class="anchor"><span id="_Toc342652994" class="anchor"><span id="_Toc439864134" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Virtual Interrupts
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

    1.  ### <span id="_Toc127596803" class="anchor"><span id="_Toc127786424" class="anchor"><span id="_Toc127786740" class="anchor"><span id="_Toc127787056" class="anchor"><span id="_Toc127877652" class="anchor"><span id="_Toc128289723" class="anchor"><span id="_Toc128290116" class="anchor"><span id="_Toc130189798" class="anchor"><span id="_Toc130201014" class="anchor"><span id="_Toc130201330" class="anchor"><span id="_Toc130201651" class="anchor"><span id="_Toc131936738" class="anchor"><span id="_Toc133901202" class="anchor"><span id="_Toc137461076" class="anchor"><span id="_Toc139096591" class="anchor"><span id="_Toc139188514" class="anchor"><span id="_Toc139191377" class="anchor"><span id="_Toc140490429" class="anchor"><span id="_Toc140571331" class="anchor"><span id="_Toc141257604" class="anchor"><span id="_Toc141257931" class="anchor"><span id="_Toc141267459" class="anchor"><span id="_Toc141522477" class="anchor"><span id="_Toc141529565" class="anchor"><span id="_Toc141529882" class="anchor"><span id="_Toc141851489" class="anchor"><span id="_Toc141852423" class="anchor"><span id="_Toc141887967" class="anchor"><span id="_Toc141889807" class="anchor"><span id="_Toc141893476" class="anchor"><span id="_Toc142113329" class="anchor"><span id="_Toc142114357" class="anchor"><span id="_Toc142729574" class="anchor"><span id="_Toc142730858" class="anchor"><span id="_Toc142731231" class="anchor"><span id="_Toc142998598" class="anchor"><span id="_Toc143063690" class="anchor"><span id="_Toc143509800" class="anchor"><span id="_Toc143510247" class="anchor"><span id="_Toc144026279" class="anchor"><span id="_Toc144026610" class="anchor"><span id="_Toc144276253" class="anchor"><span id="_Toc144276597" class="anchor"><span id="_Toc144280185" class="anchor"><span id="_Toc144280531" class="anchor"><span id="_Toc144540746" class="anchor"><span id="_Toc144554629" class="anchor"><span id="_Toc144722250" class="anchor"><span id="_Toc145503712" class="anchor"><span id="_Toc145512154" class="anchor"><span id="_Toc145513177" class="anchor"><span id="_Toc145513561" class="anchor"><span id="_Toc222907334" class="anchor"><span id="_Toc342652995" class="anchor"><span id="_Toc439864135" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Virtual Interrupt Overview

The hypervisor provides interfaces that allow a partition to send
virtual interrupts to specified virtual processors. This is useful for
emulating an IOAPIC or a legacy 8259 PIC (programmable interrupt
controller).

### <span id="_Toc127596804" class="anchor"><span id="_Toc127786425" class="anchor"><span id="_Toc127786741" class="anchor"><span id="_Toc127787057" class="anchor"><span id="_Toc127877653" class="anchor"><span id="_Toc128289724" class="anchor"><span id="_Toc128290117" class="anchor"><span id="_Toc130189799" class="anchor"><span id="_Toc130201015" class="anchor"><span id="_Toc130201331" class="anchor"><span id="_Toc130201652" class="anchor"><span id="_Toc131936739" class="anchor"><span id="_Toc133901203" class="anchor"><span id="_Toc137461077" class="anchor"><span id="_Toc139096592" class="anchor"><span id="_Toc139188515" class="anchor"><span id="_Toc139191378" class="anchor"><span id="_Toc140490430" class="anchor"><span id="_Toc140571332" class="anchor"><span id="_Toc141257605" class="anchor"><span id="_Toc141257932" class="anchor"><span id="_Toc141267460" class="anchor"><span id="_Toc141522478" class="anchor"><span id="_Toc141529566" class="anchor"><span id="_Toc141529883" class="anchor"><span id="_Toc141851490" class="anchor"><span id="_Toc141852424" class="anchor"><span id="_Toc141887968" class="anchor"><span id="_Toc141889808" class="anchor"><span id="_Toc141893477" class="anchor"><span id="_Toc142113330" class="anchor"><span id="_Toc142114358" class="anchor"><span id="_Toc142729575" class="anchor"><span id="_Toc142730859" class="anchor"><span id="_Toc142731232" class="anchor"><span id="_Toc142998599" class="anchor"><span id="_Toc143063691" class="anchor"><span id="_Toc143509801" class="anchor"><span id="_Toc143510248" class="anchor"><span id="_Toc144026280" class="anchor"><span id="_Toc144026611" class="anchor"><span id="_Toc144276254" class="anchor"><span id="_Toc144276598" class="anchor"><span id="_Toc144280186" class="anchor"><span id="_Toc144280532" class="anchor"><span id="_Toc144540747" class="anchor"><span id="_Toc144554630" class="anchor"><span id="_Toc144722251" class="anchor"><span id="_Toc145503713" class="anchor"><span id="_Toc145512155" class="anchor"><span id="_Toc145513178" class="anchor"><span id="_Toc145513562" class="anchor"><span id="_Toc222907335" class="anchor"><span id="_Toc342652996" class="anchor"><span id="_Toc439864136" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Virtual Interrupt Types

To send a virtual interrupt, software (typically running within the
parent partition) must call HvAssertVirtualInterrupt and specify a
virtual processor within the target partition. It must also specify the
interrupt type that determines the behavior:*HvX64InterruptTypeNmi*
generates a non-maskable interrupt on the specified processor.

*HvX64InterruptTypeSmi* generates a system management interrupt on the
specified processor.

*HvX64InterruptTypeInit* generates an INIT interrupt on the specified
processor.

*HvX64InterruptTypeSipi* generates a start inter-processor interrupt. If
the target processor is in wait-for-SIPI state, it causes the target
processor to begin executing in real mode at an address determined by
the SIPI vector as specified by the x64 architecture.

*HvX64InterruptTypeFixed* generates a fixed interrupt latched into the
local APIC’s interrupt request register (IRR). A fixed interrupt can be
edge-triggered or level-triggered. Withdrawing an edge-triggered
interrupt does not clear the corresponding bit in the IRR. Withdrawing a
level-triggered interrupt clears the corresponding bit in the IRR.

*HvX64InterruptTypeLowestPriority* is like a fixed interrupt except that
it is delivered only to the lowest-priority destination virtual
processor.

*HvX64InterruptTypeExtInt* generates a fixed level-triggered interrupt.
The behavior is the same as with *HvX64InterruptTypeFixed,* with the
following exceptions:

-   It is always directed at the boot processor, and

-   It can be used when the APIC is software disabled.

Regardless of whether the APIC is enabled or not, the PPR (process
priority register) is not used in determining whether the interrupt will
be serviced. This type is also special in that it is always directed at
the boot processor. It also requires the use of a separate hypercall,
HvClearVirtualInterrupt, to clear an acknowledged interrupt before
subsequent interrupts of this type can be asserted.

### <span id="_Toc127596805" class="anchor"><span id="_Toc127786426" class="anchor"><span id="_Toc127786742" class="anchor"><span id="_Toc127787058" class="anchor"><span id="_Toc127877654" class="anchor"><span id="_Toc128289725" class="anchor"><span id="_Toc128290118" class="anchor"><span id="_Toc130189800" class="anchor"><span id="_Toc130201016" class="anchor"><span id="_Toc130201332" class="anchor"><span id="_Toc130201653" class="anchor"><span id="_Toc131936740" class="anchor"><span id="_Toc133901204" class="anchor"><span id="_Toc137461078" class="anchor"><span id="_Toc139096593" class="anchor"><span id="_Toc139188516" class="anchor"><span id="_Toc139191379" class="anchor"><span id="_Toc140490431" class="anchor"><span id="_Toc140571333" class="anchor"><span id="_Toc141257606" class="anchor"><span id="_Toc141257933" class="anchor"><span id="_Toc141267461" class="anchor"><span id="_Toc141522479" class="anchor"><span id="_Toc141529567" class="anchor"><span id="_Toc141529884" class="anchor"><span id="_Toc141851491" class="anchor"><span id="_Toc141852425" class="anchor"><span id="_Toc141887969" class="anchor"><span id="_Toc141889809" class="anchor"><span id="_Toc141893478" class="anchor"><span id="_Toc142113331" class="anchor"><span id="_Toc142114359" class="anchor"><span id="_Toc142729576" class="anchor"><span id="_Toc142730860" class="anchor"><span id="_Toc142731233" class="anchor"><span id="_Toc142998600" class="anchor"><span id="_Toc143063692" class="anchor"><span id="_Toc143509802" class="anchor"><span id="_Toc143510249" class="anchor"><span id="_Toc144026281" class="anchor"><span id="_Toc144026612" class="anchor"><span id="_Toc144276255" class="anchor"><span id="_Toc144276599" class="anchor"><span id="_Toc144280187" class="anchor"><span id="_Toc144280533" class="anchor"><span id="_Toc144540748" class="anchor"><span id="_Toc144554631" class="anchor"><span id="_Toc144722252" class="anchor"><span id="_Toc145503714" class="anchor"><span id="_Toc145512156" class="anchor"><span id="_Toc145513179" class="anchor"><span id="_Toc145513563" class="anchor"><span id="_Toc222907336" class="anchor"><span id="_Toc342652997" class="anchor"><span id="_Toc439864137" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Trigger Types

Virtual interrupts are either edge-triggered or level-triggered.
Edge-triggered interrupts are latched upon assertion and cannot be
withdrawn. Level-triggered interrupts are not latched and can
potentially be withdrawn by deasserting. The following table indicates,
for each interrupt type, what the implicit interrupt trigger type is and
whether a vector should be specified with the virtual interrupt.

  Interrupt type    Vector applicable?   Trigger type
  ----------------- -------------------- ---------------
  NMI               No                   Edge
  INIT              No                   Edge
  SIPI              Yes                  Edge
  Fixed             Yes                  Edge or Level
  Lowest Priority   Yes                  Edge or Level
  ExtINT            Yes                  Level
  SMI               Yes                  Edge

Sometime after a virtual interrupt is asserted, it may be acknowledged
by the virtual processor. Until then, level-triggered virtual interrupts
can be deasserted by calling HvAssertVirtualInterrupt with vector
HV\_INTERRUPT\_VECTOR\_NONE or it can be re-asserted by calling
HvAssertVirtualInterrupt. Deasserting an edge-triggered interrupt is
unnecessary and has no effect.

### <span id="_Toc127596806" class="anchor"><span id="_Toc127786427" class="anchor"><span id="_Toc127786743" class="anchor"><span id="_Toc127787059" class="anchor"><span id="_Toc127877656" class="anchor"><span id="_Toc128289727" class="anchor"><span id="_Toc128290120" class="anchor"><span id="_Toc130189801" class="anchor"><span id="_Toc130201017" class="anchor"><span id="_Toc130201333" class="anchor"><span id="_Toc130201654" class="anchor"><span id="_Toc131936741" class="anchor"><span id="_Toc133901205" class="anchor"><span id="_Toc137461079" class="anchor"><span id="_Toc139096594" class="anchor"><span id="_Toc139188517" class="anchor"><span id="_Toc139191380" class="anchor"><span id="_Toc140490432" class="anchor"><span id="_Toc140571334" class="anchor"><span id="_Toc141257607" class="anchor"><span id="_Toc141257934" class="anchor"><span id="_Toc141267462" class="anchor"><span id="_Toc141522480" class="anchor"><span id="_Toc141529568" class="anchor"><span id="_Toc141529885" class="anchor"><span id="_Toc141851492" class="anchor"><span id="_Toc141852426" class="anchor"><span id="_Toc141887970" class="anchor"><span id="_Toc141889810" class="anchor"><span id="_Toc141893479" class="anchor"><span id="_Toc142113332" class="anchor"><span id="_Toc142114360" class="anchor"><span id="_Toc142729577" class="anchor"><span id="_Toc142730861" class="anchor"><span id="_Toc142731234" class="anchor"><span id="_Toc142998601" class="anchor"><span id="_Toc143063693" class="anchor"><span id="_Toc143509803" class="anchor"><span id="_Toc143510250" class="anchor"><span id="_Toc144026282" class="anchor"><span id="_Toc144026613" class="anchor"><span id="_Toc144276256" class="anchor"><span id="_Toc144276600" class="anchor"><span id="_Toc144280188" class="anchor"><span id="_Toc144280534" class="anchor"><span id="_Toc144540749" class="anchor"><span id="_Toc144554632" class="anchor"><span id="_Toc144722253" class="anchor"><span id="_Toc145503715" class="anchor"><span id="_Toc145512157" class="anchor"><span id="_Toc145513180" class="anchor"><span id="_Toc145513564" class="anchor"><span id="_Ref176086455" class="anchor"><span id="_Toc222907337" class="anchor"><span id="_Toc342652998" class="anchor"><span id="_Toc110172831" class="anchor"><span id="_Toc439864138" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>EOI Intercepts

An intercept is defined for processor events (specifically, memory
accesses) that indicate the EOI (end of interrupt) for a level-triggered
fixed interrupt. An EOI intercept is the expected (eventual) response by
the child to a parent asserting a level triggered interrupt using the
HvAssertVirtualInterrupt hypercall. The intercept is delivered at the
instruction boundary following the instruction that issued the EOI.

For performance reasons, it is desirable to reduce the number of EOI
intercepts. Most EOI intercepts can be eliminated and done lazily if the
guest OS leaves a marker when it performs an EOI. However, there are two
cases for which EOI intercepts are strictly necessary.

A level triggered interrupt is EOI’ed, since the hypervisor needs to
either EOI the physical APIC (in case of the root partition) or send an
EOI message (in case of a non-root partition) when the guest performs an
EOI.

A lower priority interrupt is pending, since the hypervisor needs to
re-evaluate interrupts when the guest performs an EOI.

For more information on intercepts, see section 9.1.1.

#### <span id="_Toc222907338" class="anchor"><span id="_Toc342652999" class="anchor"></span></span>VP Assist Page Register

The hypervisor provides a virtual VP assist page per virtual processor
which is overlaid on the guest GPA space. The OS has read/write access
to the virtual VP assist page. It specifies the location of the overlay
page (in GPA space) by writing to the Virtual VP Assist MSR
(0x40000073). The format of the Virtual VP Assist Page MSR is as
follows:

  63:12                                 11:1    0
  ------------------------------------- ------- --------
  Virtual VP Assist Page Base Address   RsvdP   Enable

##### EOI Assist

One field in the virtual VP assist page is the EOI Assist field. The EOI
Assist field resides at offset 0 of the overlay page and is DWORD sized.
The format of the EOI assist field is as follows:

  31:1               0
  ------------------ -----------------
  Reserved to Zero   No EOI Required

The OS performs an EOI by atomically writing zero to the EOI Assist
field of the virtual VP assist page and checking whether the “No EOI
required" field was previously zero. If it was, the OS must write to the
HV\_X64\_APIC\_EOI MSR thereby triggering an intercept into the
hypervisor. The following code is recommended to perform an EOI:

lea rcx, \[VirtualApicAssistVa\]

btr \[rcx\], 0

jc NoEoiRequired

mov ecx, HV\_X64\_APIC\_EOI

wrmsr

NoEoiRequired:

The hypervisor sets the “No EOI required" bit when it injects a virtual
interrupt if the following conditions are satisfied:

-   The virtual interrupt is edge-triggered, and

-   There are no lower priority interrupts pending

If, at a later time, a lower priority interrupt is requested, the
hypervisor clears the “No EOI required" such that a subsequent EOI
causes an intercept.

In case of nested interrupts, the EOI intercept is avoided only for the
highest priority interrupt. This is necessary since no count is
maintained for the number of EOIs performed by the OS. Therefore only
the first EOI can be avoided and since the first EOI clears the “No EOI
Required" bit, the next EOI generates an intercept. However nested
interrupts are rare, so this is not a problem in the common case.

Note that devices and/or the I/O APIC (physical or synthetic) need not
be notified of an EOI for an edge-triggered interrupt – the hypervisor
intercepts such EOIs only to update the virtual APIC state. In some
cases, the virtual APIC state can be lazily updated – in such cases, the
“NoEoiRequired" bit is set by the hypervisor indicating to the guest
that an EOI intercept is not necessary. At a later instant, the
hypervisor can derive the state of the local APIC depending on the
current value of the “NoEoiRequired" bit.

Enabling and disabling this enlightenment can be done at any time
independently of the interrupt activity and the APIC state at that
moment. While the enlightenment is enabled, conventional EOIs can still
be performed irrespective of the “No EOI required" value but they will
not realize the performance benefit of the enlightenment.

<span id="_Toc437513619" class="anchor"></span>

1.  <span id="_Toc127596807" class="anchor"><span id="_Toc127786428" class="anchor"><span id="_Toc127786744" class="anchor"><span id="_Toc127787060" class="anchor"><span id="_Toc127877657" class="anchor"><span id="_Toc128289728" class="anchor"><span id="_Toc128290121" class="anchor"><span id="_Toc130189802" class="anchor"><span id="_Toc130201018" class="anchor"><span id="_Toc130201334" class="anchor"><span id="_Toc130201655" class="anchor"><span id="_Toc131936742" class="anchor"><span id="_Toc133901206" class="anchor"><span id="_Toc137461080" class="anchor"><span id="_Toc139096595" class="anchor"><span id="_Toc139188518" class="anchor"><span id="_Toc139191381" class="anchor"><span id="_Toc140490433" class="anchor"><span id="_Toc140571335" class="anchor"><span id="_Toc141257608" class="anchor"><span id="_Toc141257935" class="anchor"><span id="_Toc141267463" class="anchor"><span id="_Toc141522481" class="anchor"><span id="_Toc141529569" class="anchor"><span id="_Toc141529886" class="anchor"><span id="_Toc141851493" class="anchor"><span id="_Toc141852427" class="anchor"><span id="_Toc141887971" class="anchor"><span id="_Toc141889811" class="anchor"><span id="_Toc141893480" class="anchor"><span id="_Toc142113333" class="anchor"><span id="_Toc142114361" class="anchor"><span id="_Toc142729578" class="anchor"><span id="_Toc142730862" class="anchor"><span id="_Toc142731235" class="anchor"><span id="_Toc142998602" class="anchor"><span id="_Toc143063694" class="anchor"><span id="_Toc143509804" class="anchor"><span id="_Toc143510251" class="anchor"><span id="_Toc144026283" class="anchor"><span id="_Toc144026614" class="anchor"><span id="_Toc144276257" class="anchor"><span id="_Toc144276601" class="anchor"><span id="_Toc144280189" class="anchor"><span id="_Toc144280535" class="anchor"><span id="_Toc144540750" class="anchor"><span id="_Toc144554633" class="anchor"><span id="_Toc144722254" class="anchor"><span id="_Toc145503716" class="anchor"><span id="_Toc145512158" class="anchor"><span id="_Toc145513181" class="anchor"><span id="_Toc145513565" class="anchor"><span id="_Toc222907339" class="anchor"><span id="_Toc342653000" class="anchor"><span id="_Toc439864139" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Virtual Interrupt Data Types
    ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

    1.  ### <span id="_Toc110172832" class="anchor"><span id="_Toc127596808" class="anchor"><span id="_Toc127786429" class="anchor"><span id="_Toc127786745" class="anchor"><span id="_Toc127787061" class="anchor"><span id="_Toc127877658" class="anchor"><span id="_Toc128289729" class="anchor"><span id="_Toc128290122" class="anchor"><span id="_Toc130189803" class="anchor"><span id="_Toc130201019" class="anchor"><span id="_Toc130201335" class="anchor"><span id="_Toc130201656" class="anchor"><span id="_Toc131936743" class="anchor"><span id="_Toc133901207" class="anchor"><span id="_Toc137461081" class="anchor"><span id="_Toc139096596" class="anchor"><span id="_Toc139188519" class="anchor"><span id="_Toc139191382" class="anchor"><span id="_Toc140490434" class="anchor"><span id="_Toc140571336" class="anchor"><span id="_Toc141257609" class="anchor"><span id="_Toc141257936" class="anchor"><span id="_Toc141267464" class="anchor"><span id="_Toc141522482" class="anchor"><span id="_Toc141529570" class="anchor"><span id="_Toc141529887" class="anchor"><span id="_Toc141851494" class="anchor"><span id="_Toc141852428" class="anchor"><span id="_Toc141887972" class="anchor"><span id="_Toc141889812" class="anchor"><span id="_Toc141893481" class="anchor"><span id="_Toc142113334" class="anchor"><span id="_Toc142114362" class="anchor"><span id="_Toc142729579" class="anchor"><span id="_Toc142730863" class="anchor"><span id="_Toc142731236" class="anchor"><span id="_Toc142998603" class="anchor"><span id="_Toc143063695" class="anchor"><span id="_Toc143509805" class="anchor"><span id="_Toc143510252" class="anchor"><span id="_Toc144026284" class="anchor"><span id="_Toc144026615" class="anchor"><span id="_Toc144276258" class="anchor"><span id="_Toc144276602" class="anchor"><span id="_Toc144280190" class="anchor"><span id="_Toc144280536" class="anchor"><span id="_Toc144540751" class="anchor"><span id="_Toc144554634" class="anchor"><span id="_Toc144722255" class="anchor"><span id="_Toc145503717" class="anchor"><span id="_Toc145512159" class="anchor"><span id="_Toc145513182" class="anchor"><span id="_Toc145513566" class="anchor"><span id="_Toc222907340" class="anchor"><span id="_Toc342653001" class="anchor"><span id="_Toc439864140" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Interrupt Types

Several virtual interrupt types are supported.

typedef enum

{

HvX64InterruptTypeFixed = 0x0000,

HvX64InterruptTypeLowestPriority = 0x0001,

HvX64InterruptTypeNmi = 0x0004,

HvX64InterruptTypeInit = 0x0005,

HvX64InterruptTypeSipi = 0x0006,

HvX64InterruptTypeExtInt = 0x0007

} HV\_INTERRUPT\_TYPE;

### <span id="_Toc127596809" class="anchor"><span id="_Toc127786430" class="anchor"><span id="_Toc127786746" class="anchor"><span id="_Toc127787062" class="anchor"><span id="_Toc127877659" class="anchor"><span id="_Toc128289730" class="anchor"><span id="_Toc128290123" class="anchor"><span id="_Toc130189804" class="anchor"><span id="_Toc130201020" class="anchor"><span id="_Toc130201336" class="anchor"><span id="_Toc130201657" class="anchor"><span id="_Toc131936744" class="anchor"><span id="_Toc133901208" class="anchor"><span id="_Toc137461082" class="anchor"><span id="_Toc139096597" class="anchor"><span id="_Toc139188520" class="anchor"><span id="_Toc139191383" class="anchor"><span id="_Toc140490435" class="anchor"><span id="_Toc140571337" class="anchor"><span id="_Toc141257610" class="anchor"><span id="_Toc141257937" class="anchor"><span id="_Toc141267465" class="anchor"><span id="_Toc141522483" class="anchor"><span id="_Toc141529571" class="anchor"><span id="_Toc141529888" class="anchor"><span id="_Toc141851495" class="anchor"><span id="_Toc141852429" class="anchor"><span id="_Toc141887973" class="anchor"><span id="_Toc141889813" class="anchor"><span id="_Toc141893482" class="anchor"><span id="_Toc142113335" class="anchor"><span id="_Toc142114363" class="anchor"><span id="_Toc142729580" class="anchor"><span id="_Toc142730864" class="anchor"><span id="_Toc142731237" class="anchor"><span id="_Toc142998604" class="anchor"><span id="_Toc143063696" class="anchor"><span id="_Toc143509806" class="anchor"><span id="_Toc143510253" class="anchor"><span id="_Toc144026285" class="anchor"><span id="_Toc144026616" class="anchor"><span id="_Toc144276259" class="anchor"><span id="_Toc144276603" class="anchor"><span id="_Toc144280191" class="anchor"><span id="_Toc144280537" class="anchor"><span id="_Toc144540752" class="anchor"><span id="_Toc144554635" class="anchor"><span id="_Toc144722256" class="anchor"><span id="_Toc145503718" class="anchor"><span id="_Toc145512160" class="anchor"><span id="_Toc145513183" class="anchor"><span id="_Toc145513567" class="anchor"><span id="_Toc222907341" class="anchor"><span id="_Toc342653002" class="anchor"><span id="_Toc110172833" class="anchor"><span id="_Toc439864141" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Interrupt Control

The interrupt control specifies the type of the virtual interrupt, its
destination mode and whether the virtual interrupt is edge or level
triggered.

typedef struct

{

HV\_INTERRUPT\_TYPE InterruptType;

UINT32 LevelTriggered:1;

UINT32 LogicalDestinationMode:1;

UINT32 Reserved:30;

} HV\_INTERRUPT\_CONTROL;

### <span id="_Toc127596810" class="anchor"><span id="_Toc127786431" class="anchor"><span id="_Toc127786747" class="anchor"><span id="_Toc127787063" class="anchor"><span id="_Toc127877660" class="anchor"><span id="_Toc128289731" class="anchor"><span id="_Toc128290124" class="anchor"><span id="_Toc130189805" class="anchor"><span id="_Toc130201021" class="anchor"><span id="_Toc130201337" class="anchor"><span id="_Toc130201658" class="anchor"><span id="_Toc131936745" class="anchor"><span id="_Toc133901209" class="anchor"><span id="_Toc137461083" class="anchor"><span id="_Toc139096598" class="anchor"><span id="_Toc139188521" class="anchor"><span id="_Toc139191384" class="anchor"><span id="_Toc140490436" class="anchor"><span id="_Toc140571338" class="anchor"><span id="_Toc141257611" class="anchor"><span id="_Toc141257938" class="anchor"><span id="_Toc141267466" class="anchor"><span id="_Toc141522484" class="anchor"><span id="_Toc141529572" class="anchor"><span id="_Toc141529889" class="anchor"><span id="_Toc141851496" class="anchor"><span id="_Toc141852430" class="anchor"><span id="_Toc141887974" class="anchor"><span id="_Toc141889814" class="anchor"><span id="_Toc141893483" class="anchor"><span id="_Toc142113336" class="anchor"><span id="_Toc142114364" class="anchor"><span id="_Toc142729581" class="anchor"><span id="_Toc142730865" class="anchor"><span id="_Toc142731238" class="anchor"><span id="_Toc142998605" class="anchor"><span id="_Toc143063697" class="anchor"><span id="_Toc143509807" class="anchor"><span id="_Toc143510254" class="anchor"><span id="_Toc144026286" class="anchor"><span id="_Toc144026617" class="anchor"><span id="_Toc144276260" class="anchor"><span id="_Toc144276604" class="anchor"><span id="_Toc144280192" class="anchor"><span id="_Toc144280538" class="anchor"><span id="_Toc144540753" class="anchor"><span id="_Toc144554636" class="anchor"><span id="_Toc144722257" class="anchor"><span id="_Toc145503719" class="anchor"><span id="_Toc145512161" class="anchor"><span id="_Toc145513184" class="anchor"><span id="_Toc145513568" class="anchor"><span id="_Toc222907342" class="anchor"><span id="_Toc342653003" class="anchor"><span id="_Toc439864142" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Interrupt Vectors

Interrupt vectors are represented by a 32-bit value. A special value is
used to indicate “no interrupt vector" and is used by calls that
indicate whether a previous interrupt was acknowledged.

typedef UINT32 HV\_INTERRUPT\_VECTOR;

typedef HV\_INTERRUPT\_VECTOR \*PHV\_INTERRUPT\_VECTOR;

\#define HV\_INTERRUPT\_VECTOR\_NONE 0xFFFFFFFF

1.  <span id="_Toc110172837" class="anchor"><span id="_Toc127596811" class="anchor"><span id="_Toc127786432" class="anchor"><span id="_Toc127786748" class="anchor"><span id="_Toc127787064" class="anchor"><span id="_Toc127877661" class="anchor"><span id="_Toc128289732" class="anchor"><span id="_Toc128290125" class="anchor"><span id="_Toc130189806" class="anchor"><span id="_Toc130201022" class="anchor"><span id="_Toc130201338" class="anchor"><span id="_Toc130201659" class="anchor"><span id="_Toc131936746" class="anchor"><span id="_Toc133901210" class="anchor"><span id="_Toc137461084" class="anchor"><span id="_Toc139096599" class="anchor"><span id="_Toc139188522" class="anchor"><span id="_Toc139191385" class="anchor"><span id="_Toc140490437" class="anchor"><span id="_Toc140571339" class="anchor"><span id="_Toc141257612" class="anchor"><span id="_Toc141257939" class="anchor"><span id="_Toc141267467" class="anchor"><span id="_Toc141522485" class="anchor"><span id="_Toc141529573" class="anchor"><span id="_Toc141529890" class="anchor"><span id="_Toc141851497" class="anchor"><span id="_Toc141852431" class="anchor"><span id="_Toc141887975" class="anchor"><span id="_Toc141889815" class="anchor"><span id="_Toc141893484" class="anchor"><span id="_Toc142113337" class="anchor"><span id="_Toc142114365" class="anchor"><span id="_Toc142729582" class="anchor"><span id="_Toc142730866" class="anchor"><span id="_Toc142731239" class="anchor"><span id="_Toc142998606" class="anchor"><span id="_Toc143063698" class="anchor"><span id="_Toc143509808" class="anchor"><span id="_Toc143510255" class="anchor"><span id="_Toc144026287" class="anchor"><span id="_Toc144026618" class="anchor"><span id="_Toc144276261" class="anchor"><span id="_Toc144276605" class="anchor"><span id="_Toc144280193" class="anchor"><span id="_Toc144280539" class="anchor"><span id="_Toc144540754" class="anchor"><span id="_Toc144554637" class="anchor"><span id="_Toc144722258" class="anchor"><span id="_Toc145503720" class="anchor"><span id="_Toc145512162" class="anchor"><span id="_Toc145513185" class="anchor"><span id="_Toc145513569" class="anchor"><span id="_Toc222907343" class="anchor"><span id="_Toc342653004" class="anchor"><span id="_Toc439858132" class="anchor"><span id="_Toc439864143" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>
    ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

    1.  ### <span id="_Toc110172838" class="anchor"><span id="_Toc127596812" class="anchor"><span id="_Toc127786433" class="anchor"><span id="_Toc127786749" class="anchor"><span id="_Toc127787065" class="anchor"><span id="_Toc127877662" class="anchor"><span id="_Toc128289733" class="anchor"><span id="_Toc128290126" class="anchor"><span id="_Toc130189807" class="anchor"><span id="_Toc130201023" class="anchor"><span id="_Toc130201339" class="anchor"><span id="_Toc130201660" class="anchor"><span id="_Toc131936747" class="anchor"><span id="_Toc133901211" class="anchor"><span id="_Toc137461085" class="anchor"><span id="_Toc139096600" class="anchor"><span id="_Toc139188523" class="anchor"><span id="_Toc139191386" class="anchor"><span id="_Toc140490438" class="anchor"><span id="_Toc140571340" class="anchor"><span id="_Toc141257613" class="anchor"><span id="_Toc141257940" class="anchor"><span id="_Toc141267468" class="anchor"><span id="_Toc141522486" class="anchor"><span id="_Toc141529574" class="anchor"><span id="_Toc141529891" class="anchor"><span id="_Toc141851498" class="anchor"><span id="_Toc141852432" class="anchor"><span id="_Toc141887976" class="anchor"><span id="_Toc141889816" class="anchor"><span id="_Toc141893485" class="anchor"><span id="_Toc142113338" class="anchor"><span id="_Toc142114366" class="anchor"><span id="_Toc142729583" class="anchor"><span id="_Toc142730867" class="anchor"><span id="_Toc142731240" class="anchor"><span id="_Toc142998607" class="anchor"><span id="_Toc143063699" class="anchor"><span id="_Toc143509809" class="anchor"><span id="_Toc143510256" class="anchor"><span id="_Toc144026288" class="anchor"><span id="_Toc144026619" class="anchor"><span id="_Toc144276262" class="anchor"><span id="_Toc144276606" class="anchor"><span id="_Toc144280194" class="anchor"><span id="_Toc144280540" class="anchor"><span id="_Toc144540755" class="anchor"><span id="_Toc144554638" class="anchor"><span id="_Toc144722259" class="anchor"><span id="_Toc145503721" class="anchor"><span id="_Toc145512163" class="anchor"><span id="_Toc145513186" class="anchor"><span id="_Toc145513570" class="anchor"><span id="_Toc222907344" class="anchor"><span id="_Toc342653005" class="anchor"><span id="_Toc439858133" class="anchor"><span id="_Toc439864144" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>

##### 

##### 

  -- -- --
  -- -- --

##### 

-   -   

  -- --
     
     
     
     
     
     
     
     
     
     
  -- --

### <span id="_Toc127877663" class="anchor"><span id="_Toc128289734" class="anchor"><span id="_Toc128290127" class="anchor"><span id="_Toc128478932" class="anchor"><span id="_Toc127877671" class="anchor"><span id="_Toc128289742" class="anchor"><span id="_Toc128290135" class="anchor"><span id="_Toc128478940" class="anchor"><span id="_Toc127877672" class="anchor"><span id="_Toc128289743" class="anchor"><span id="_Toc128290136" class="anchor"><span id="_Toc128478941" class="anchor"><span id="_Toc127877673" class="anchor"><span id="_Toc128289744" class="anchor"><span id="_Toc128290137" class="anchor"><span id="_Toc128478942" class="anchor"><span id="_Toc127877676" class="anchor"><span id="_Toc128289747" class="anchor"><span id="_Toc128290140" class="anchor"><span id="_Toc128478945" class="anchor"><span id="_Toc127877700" class="anchor"><span id="_Toc128289771" class="anchor"><span id="_Toc128290164" class="anchor"><span id="_Toc128478969" class="anchor"><span id="_Toc127877726" class="anchor"><span id="_Toc128289797" class="anchor"><span id="_Toc128290190" class="anchor"><span id="_Toc128478995" class="anchor"><span id="_Toc127877729" class="anchor"><span id="_Toc128289800" class="anchor"><span id="_Toc128290193" class="anchor"><span id="_Toc128478998" class="anchor"><span id="_Toc127877732" class="anchor"><span id="_Toc128289803" class="anchor"><span id="_Toc128290196" class="anchor"><span id="_Toc128479001" class="anchor"><span id="_Toc127596814" class="anchor"><span id="_Toc127786435" class="anchor"><span id="_Toc127786751" class="anchor"><span id="_Toc127787067" class="anchor"><span id="_Toc127877741" class="anchor"><span id="_Toc128289812" class="anchor"><span id="_Toc128290205" class="anchor"><span id="_Toc130189808" class="anchor"><span id="_Toc130201024" class="anchor"><span id="_Toc130201340" class="anchor"><span id="_Toc130201661" class="anchor"><span id="_Toc131936748" class="anchor"><span id="_Toc133901212" class="anchor"><span id="_Toc137461086" class="anchor"><span id="_Toc139096601" class="anchor"><span id="_Toc139188524" class="anchor"><span id="_Toc139191387" class="anchor"><span id="_Toc140490439" class="anchor"><span id="_Toc140571341" class="anchor"><span id="_Toc141257614" class="anchor"><span id="_Toc141257941" class="anchor"><span id="_Toc141267469" class="anchor"><span id="_Toc141522487" class="anchor"><span id="_Toc141529575" class="anchor"><span id="_Toc141529892" class="anchor"><span id="_Toc141851499" class="anchor"><span id="_Toc141852433" class="anchor"><span id="_Toc141887977" class="anchor"><span id="_Toc141889817" class="anchor"><span id="_Toc141893486" class="anchor"><span id="_Toc142113339" class="anchor"><span id="_Toc142114367" class="anchor"><span id="_Toc142729584" class="anchor"><span id="_Toc142730868" class="anchor"><span id="_Toc142731241" class="anchor"><span id="_Toc142998608" class="anchor"><span id="_Toc143063700" class="anchor"><span id="_Toc143509810" class="anchor"><span id="_Toc143510257" class="anchor"><span id="_Toc144026289" class="anchor"><span id="_Toc144026620" class="anchor"><span id="_Toc144276263" class="anchor"><span id="_Toc144276607" class="anchor"><span id="_Toc144280195" class="anchor"><span id="_Toc144280541" class="anchor"><span id="_Toc144540756" class="anchor"><span id="_Toc144554639" class="anchor"><span id="_Toc144722260" class="anchor"><span id="_Toc145503722" class="anchor"><span id="_Toc145512164" class="anchor"><span id="_Toc145513187" class="anchor"><span id="_Toc145513571" class="anchor"><span id="_Toc222907345" class="anchor"><span id="_Toc342653009" class="anchor"><span id="_Toc439858134" class="anchor"><span id="_Toc439864145" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>

##### 

##### 

  -- --
  -- --

##### 

-   -   

  -- --
     
     
     
  -- --

1.  <span id="_Toc127596815" class="anchor"><span id="_Toc127786436" class="anchor"><span id="_Toc127786752" class="anchor"><span id="_Toc127787068" class="anchor"><span id="_Toc127877742" class="anchor"><span id="_Toc128289813" class="anchor"><span id="_Toc128290206" class="anchor"><span id="_Ref128558136" class="anchor"><span id="_Ref128558193" class="anchor"><span id="_Ref128558250" class="anchor"><span id="_Ref128558281" class="anchor"><span id="_Ref128558307" class="anchor"><span id="_Toc130189809" class="anchor"><span id="_Toc130201025" class="anchor"><span id="_Toc130201341" class="anchor"><span id="_Toc130201662" class="anchor"><span id="_Ref130717436" class="anchor"><span id="_Ref130719633" class="anchor"><span id="_Ref130880760" class="anchor"><span id="_Toc131936749" class="anchor"><span id="_Toc133901213" class="anchor"><span id="_Toc137461087" class="anchor"><span id="_Toc139096602" class="anchor"><span id="_Toc139188525" class="anchor"><span id="_Toc139191388" class="anchor"><span id="_Toc140490440" class="anchor"><span id="_Toc140571342" class="anchor"><span id="_Toc141257615" class="anchor"><span id="_Toc141257942" class="anchor"><span id="_Toc141267470" class="anchor"><span id="_Toc141522488" class="anchor"><span id="_Toc141529576" class="anchor"><span id="_Toc141529893" class="anchor"><span id="_Toc141851500" class="anchor"><span id="_Toc141852434" class="anchor"><span id="_Toc141887978" class="anchor"><span id="_Toc141889818" class="anchor"><span id="_Toc141893487" class="anchor"><span id="_Toc142113340" class="anchor"><span id="_Toc142114368" class="anchor"><span id="_Toc142729585" class="anchor"><span id="_Toc142730869" class="anchor"><span id="_Toc142731242" class="anchor"><span id="_Toc142998609" class="anchor"><span id="_Toc143063701" class="anchor"><span id="_Toc143509811" class="anchor"><span id="_Toc143510258" class="anchor"><span id="_Toc144026290" class="anchor"><span id="_Toc144026621" class="anchor"><span id="_Toc144276264" class="anchor"><span id="_Toc144276608" class="anchor"><span id="_Toc144280196" class="anchor"><span id="_Toc144280542" class="anchor"><span id="_Toc144540757" class="anchor"><span id="_Toc144554640" class="anchor"><span id="_Toc144722261" class="anchor"><span id="_Toc145503723" class="anchor"><span id="_Toc145512165" class="anchor"><span id="_Toc145513188" class="anchor"><span id="_Toc145513572" class="anchor"><span id="_Ref147203754" class="anchor"><span id="_Ref147203960" class="anchor"><span id="_Ref190088650" class="anchor"><span id="_Toc222907346" class="anchor"><span id="_Toc342653013" class="anchor"><span id="_Toc439864146" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Inter-Partition Communication
    ===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================

    1.  <span id="_Toc127596816" class="anchor"><span id="_Toc127786437" class="anchor"><span id="_Toc127786753" class="anchor"><span id="_Toc127787069" class="anchor"><span id="_Toc127877743" class="anchor"><span id="_Toc128289814" class="anchor"><span id="_Toc128290207" class="anchor"><span id="_Toc130189810" class="anchor"><span id="_Toc130201026" class="anchor"><span id="_Toc130201342" class="anchor"><span id="_Toc130201663" class="anchor"><span id="_Toc131936750" class="anchor"><span id="_Toc133901214" class="anchor"><span id="_Toc137461088" class="anchor"><span id="_Toc139096603" class="anchor"><span id="_Toc139188526" class="anchor"><span id="_Toc139191389" class="anchor"><span id="_Toc140490441" class="anchor"><span id="_Toc140571343" class="anchor"><span id="_Toc141257616" class="anchor"><span id="_Toc141257943" class="anchor"><span id="_Toc141267471" class="anchor"><span id="_Toc141522489" class="anchor"><span id="_Toc141529577" class="anchor"><span id="_Toc141529894" class="anchor"><span id="_Toc141851501" class="anchor"><span id="_Toc141852435" class="anchor"><span id="_Toc141887979" class="anchor"><span id="_Toc141889819" class="anchor"><span id="_Toc141893488" class="anchor"><span id="_Toc142113341" class="anchor"><span id="_Toc142114369" class="anchor"><span id="_Toc142729586" class="anchor"><span id="_Toc142730870" class="anchor"><span id="_Toc142731243" class="anchor"><span id="_Toc142998610" class="anchor"><span id="_Toc143063702" class="anchor"><span id="_Toc143509812" class="anchor"><span id="_Toc143510259" class="anchor"><span id="_Toc144026291" class="anchor"><span id="_Toc144026622" class="anchor"><span id="_Toc144276265" class="anchor"><span id="_Toc144276609" class="anchor"><span id="_Toc144280197" class="anchor"><span id="_Toc144280543" class="anchor"><span id="_Toc144540758" class="anchor"><span id="_Toc144554641" class="anchor"><span id="_Toc144722262" class="anchor"><span id="_Toc145503724" class="anchor"><span id="_Toc145512166" class="anchor"><span id="_Toc145513189" class="anchor"><span id="_Toc145513573" class="anchor"><span id="_Toc222907347" class="anchor"><span id="_Toc342653014" class="anchor"><span id="_Toc439864147" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Overview
        -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

The hypervisor provides two simple mechanisms for one partition to
communicate with another: messages and events. In both cases,
notification is signaled by using the SynIC (synthetic interrupt
controller).

<span id="_Toc127596817" class="anchor"><span id="_Toc127786438" class="anchor"><span id="_Toc127786754" class="anchor"><span id="_Toc127787070" class="anchor"><span id="_Toc127877744" class="anchor"><span id="_Toc128289815" class="anchor"><span id="_Toc128290208" class="anchor"><span id="_Toc130189811" class="anchor"><span id="_Toc130201027" class="anchor"><span id="_Toc130201343" class="anchor"><span id="_Toc130201664" class="anchor"><span id="_Toc131936751" class="anchor"><span id="_Toc133901215" class="anchor"><span id="_Toc137461089" class="anchor"><span id="_Toc139096604" class="anchor"><span id="_Toc139188527" class="anchor"><span id="_Toc139191390" class="anchor"><span id="_Toc140490442" class="anchor"><span id="_Toc140571344" class="anchor"><span id="_Toc141257617" class="anchor"><span id="_Toc141257944" class="anchor"><span id="_Toc141267472" class="anchor"><span id="_Toc141522490" class="anchor"><span id="_Toc141529578" class="anchor"><span id="_Toc141529895" class="anchor"><span id="_Toc141851502" class="anchor"><span id="_Toc141852436" class="anchor"><span id="_Toc141887980" class="anchor"><span id="_Toc141889820" class="anchor"><span id="_Toc141893489" class="anchor"><span id="_Toc142113342" class="anchor"><span id="_Toc142114370" class="anchor"><span id="_Toc142729587" class="anchor"><span id="_Toc142730871" class="anchor"><span id="_Toc142731244" class="anchor"><span id="_Toc142998611" class="anchor"><span id="_Toc143063703" class="anchor"><span id="_Toc143509813" class="anchor"><span id="_Toc143510260" class="anchor"><span id="_Toc144026292" class="anchor"><span id="_Toc144026623" class="anchor"><span id="_Toc144276266" class="anchor"><span id="_Toc144276610" class="anchor"><span id="_Toc144280198" class="anchor"><span id="_Toc144280544" class="anchor"><span id="_Toc144540759" class="anchor"><span id="_Toc144554642" class="anchor"><span id="_Toc144722263" class="anchor"><span id="_Toc145503725" class="anchor"><span id="_Toc145512167" class="anchor"><span id="_Toc145513190" class="anchor"><span id="_Toc145513574" class="anchor"><span id="_Toc222907348" class="anchor"><span id="_Toc342653015" class="anchor"><span id="_Toc439864148" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>SynIC Messages
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

The hypervisor provides a simple inter-partition communication facility
that allows one partition to send a parameterized message to another
partition. (Because the message is sent asynchronously, it is said to be
*posted*.) The destination partition may be notified of the arrival of
this message through an interrupt.

### <span id="_Toc127596818" class="anchor"><span id="_Toc127786439" class="anchor"><span id="_Toc127786755" class="anchor"><span id="_Toc127787071" class="anchor"><span id="_Toc127877745" class="anchor"><span id="_Toc128289816" class="anchor"><span id="_Toc128290209" class="anchor"><span id="_Toc130189812" class="anchor"><span id="_Toc130201028" class="anchor"><span id="_Toc130201344" class="anchor"><span id="_Toc130201665" class="anchor"><span id="_Toc131936752" class="anchor"><span id="_Toc133901216" class="anchor"><span id="_Toc137461090" class="anchor"><span id="_Toc139096605" class="anchor"><span id="_Toc139188528" class="anchor"><span id="_Toc139191391" class="anchor"><span id="_Toc140490443" class="anchor"><span id="_Toc140571345" class="anchor"><span id="_Toc141257618" class="anchor"><span id="_Toc141257945" class="anchor"><span id="_Toc141267473" class="anchor"><span id="_Toc141522491" class="anchor"><span id="_Toc141529579" class="anchor"><span id="_Toc141529896" class="anchor"><span id="_Toc141851503" class="anchor"><span id="_Toc141852437" class="anchor"><span id="_Toc141887981" class="anchor"><span id="_Toc141889821" class="anchor"><span id="_Toc141893490" class="anchor"><span id="_Toc142113343" class="anchor"><span id="_Toc142114371" class="anchor"><span id="_Toc142729588" class="anchor"><span id="_Toc142730872" class="anchor"><span id="_Toc142731245" class="anchor"><span id="_Toc142998612" class="anchor"><span id="_Toc143063704" class="anchor"><span id="_Toc143509814" class="anchor"><span id="_Toc143510261" class="anchor"><span id="_Toc144026293" class="anchor"><span id="_Toc144026624" class="anchor"><span id="_Toc144276267" class="anchor"><span id="_Toc144276611" class="anchor"><span id="_Toc144280199" class="anchor"><span id="_Toc144280545" class="anchor"><span id="_Toc144540760" class="anchor"><span id="_Toc144554643" class="anchor"><span id="_Toc144722264" class="anchor"><span id="_Toc145503726" class="anchor"><span id="_Toc145512168" class="anchor"><span id="_Toc145513191" class="anchor"><span id="_Toc145513575" class="anchor"><span id="_Toc222907349" class="anchor"><span id="_Toc342653016" class="anchor"><span id="_Toc439864149" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Message Buffers

A *message buffer* is used internally to the hypervisor to store a
message until it is delivered to the recipient. The hypervisor maintains
several sets of message buffers:

**Guest message buffers**: The hypervisor maintains a set of guest
message buffers for each port. These buffers are used for messages sent
explicitly from one partition to another by a guest. When a port is
created, the hypervisor will allocate sixteen (16) message buffers from
the port owner’s memory pool (see section 1.1.1). These message buffers
are returned to the memory pool when the port is deleted (see section
1.1.1).

**Timer message buffers**: The hypervisor maintains four timer message
buffers for each virtual processor (one per synthetic interrupt timer).
They are allocated when a virtual processor is created. For more
information about timers, see chapter 18, and for a detailed description
of timer messages, see section 19.3.

**Intercept message buffers**: The hypervisor maintains one intercept
message buffer for each virtual processor. It is used for intercepts.
The intercept message buffer is allocated when the virtual processor is
created.

**Event log message buffers**: The hypervisor maintains one event log
message buffer for each event log group. It is used to notify the root
partition when one or more event log buffers are full. For details about
event logging, see chapter 1.

### <span id="_Toc342653017" class="anchor"><span id="_Toc127596819" class="anchor"><span id="_Toc127786440" class="anchor"><span id="_Toc127786756" class="anchor"><span id="_Toc127787072" class="anchor"><span id="_Toc127877746" class="anchor"><span id="_Toc128289817" class="anchor"><span id="_Toc128290210" class="anchor"><span id="_Toc130189813" class="anchor"><span id="_Toc130201029" class="anchor"><span id="_Toc130201345" class="anchor"><span id="_Toc130201666" class="anchor"><span id="_Toc131936753" class="anchor"><span id="_Toc133901217" class="anchor"><span id="_Toc137461091" class="anchor"><span id="_Toc139096606" class="anchor"><span id="_Toc139188529" class="anchor"><span id="_Toc139191392" class="anchor"><span id="_Toc140490444" class="anchor"><span id="_Toc140571346" class="anchor"><span id="_Toc141257619" class="anchor"><span id="_Toc141257946" class="anchor"><span id="_Toc141267474" class="anchor"><span id="_Toc141522492" class="anchor"><span id="_Toc141529580" class="anchor"><span id="_Toc141529897" class="anchor"><span id="_Toc141851504" class="anchor"><span id="_Toc141852438" class="anchor"><span id="_Toc141887982" class="anchor"><span id="_Toc141889822" class="anchor"><span id="_Toc141893491" class="anchor"><span id="_Toc142113344" class="anchor"><span id="_Toc142114372" class="anchor"><span id="_Toc142729589" class="anchor"><span id="_Toc142730873" class="anchor"><span id="_Toc142731246" class="anchor"><span id="_Toc142998613" class="anchor"><span id="_Toc143063705" class="anchor"><span id="_Toc143509815" class="anchor"><span id="_Toc143510262" class="anchor"><span id="_Toc144026294" class="anchor"><span id="_Toc144026625" class="anchor"><span id="_Toc144276268" class="anchor"><span id="_Toc144276612" class="anchor"><span id="_Toc144280200" class="anchor"><span id="_Toc144280546" class="anchor"><span id="_Toc144540761" class="anchor"><span id="_Toc144554644" class="anchor"><span id="_Toc144722265" class="anchor"><span id="_Toc145503727" class="anchor"><span id="_Toc145512169" class="anchor"><span id="_Toc145513192" class="anchor"><span id="_Toc145513576" class="anchor"><span id="_Toc222907350" class="anchor"><span id="_Toc342653018" class="anchor"><span id="_Toc439864150" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Message Buffer Queues

For each partition and each virtual processor in the partition, the
hypervisor maintains one queue of message buffers for each SINTx
(synthetic interrupt source) in the virtual processor’s SynIC. All
message queues of a virtual processor are empty upon creation or reset
of the virtual processor.

### <span id="_Toc131936754" class="anchor"><span id="_Toc133901218" class="anchor"><span id="_Toc137461092" class="anchor"><span id="_Toc139096607" class="anchor"><span id="_Toc139188530" class="anchor"><span id="_Toc139191393" class="anchor"><span id="_Toc140490445" class="anchor"><span id="_Toc140571347" class="anchor"><span id="_Toc141257620" class="anchor"><span id="_Toc141257947" class="anchor"><span id="_Toc141267475" class="anchor"><span id="_Toc141522493" class="anchor"><span id="_Toc141529581" class="anchor"><span id="_Toc141529898" class="anchor"><span id="_Toc141851505" class="anchor"><span id="_Toc141852439" class="anchor"><span id="_Toc141887983" class="anchor"><span id="_Toc141889823" class="anchor"><span id="_Toc141893492" class="anchor"><span id="_Toc142113345" class="anchor"><span id="_Toc142114373" class="anchor"><span id="_Toc142729590" class="anchor"><span id="_Toc142730874" class="anchor"><span id="_Toc142731247" class="anchor"><span id="_Toc142998614" class="anchor"><span id="_Toc143063706" class="anchor"><span id="_Toc143509816" class="anchor"><span id="_Toc143510263" class="anchor"><span id="_Toc144026295" class="anchor"><span id="_Toc144026626" class="anchor"><span id="_Toc144276269" class="anchor"><span id="_Toc144276613" class="anchor"><span id="_Toc144280201" class="anchor"><span id="_Toc144280547" class="anchor"><span id="_Toc144540762" class="anchor"><span id="_Toc144554645" class="anchor"><span id="_Toc144722266" class="anchor"><span id="_Toc145503728" class="anchor"><span id="_Toc145512170" class="anchor"><span id="_Toc145513193" class="anchor"><span id="_Toc145513577" class="anchor"><span id="_Toc222907351" class="anchor"><span id="_Toc342653019" class="anchor"><span id="_Toc439864151" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Reliability and Sequencing of Guest Message Buffers

Messages successfully posted by a guest have been queued for delivery by
the hypervisor. Actual delivery and reception by the target partition is
dependent upon its correct operation. Partitions may disable delivery of
messages to particular virtual processors by either disabling its SynIC
(see section 17.6.1) or disabling the SIMP (see section 17.6.3).

Breaking a connection (see HvDisconnectPort, section 1.1.1) will not
affect undelivered (queued) messages. Deletion of the target port (see
HvDeletePort, section 1.1.1) will always free all of the port’s message
buffers, whether they are available or contain undelivered (queued)
messages.

Messages arrive in the order in which they have been successfully
posted. If the receiving port is associated with a specific virtual
processor, then messages will arrive in the same order in which they
were posted. If the receiving port is associated with HV\_ANY\_VP, then
messages are not guaranteed to arrive in any particular order.

### <span id="_Ref126340915" class="anchor"><span id="_Toc127596820" class="anchor"><span id="_Toc127786441" class="anchor"><span id="_Toc127786757" class="anchor"><span id="_Toc127787073" class="anchor"><span id="_Toc127877747" class="anchor"><span id="_Toc128289818" class="anchor"><span id="_Toc128290211" class="anchor"><span id="_Toc130189814" class="anchor"><span id="_Toc130201030" class="anchor"><span id="_Toc130201346" class="anchor"><span id="_Toc130201667" class="anchor"><span id="_Toc131936755" class="anchor"><span id="_Toc133901219" class="anchor"><span id="_Toc137461093" class="anchor"><span id="_Toc139096608" class="anchor"><span id="_Toc139188531" class="anchor"><span id="_Toc139191394" class="anchor"><span id="_Toc140490446" class="anchor"><span id="_Toc140571348" class="anchor"><span id="_Toc141257621" class="anchor"><span id="_Toc141257948" class="anchor"><span id="_Toc141267476" class="anchor"><span id="_Toc141522494" class="anchor"><span id="_Toc141529582" class="anchor"><span id="_Toc141529899" class="anchor"><span id="_Toc141851506" class="anchor"><span id="_Toc141852440" class="anchor"><span id="_Toc141887984" class="anchor"><span id="_Toc141889824" class="anchor"><span id="_Toc141893493" class="anchor"><span id="_Toc142113346" class="anchor"><span id="_Toc142114374" class="anchor"><span id="_Toc142729591" class="anchor"><span id="_Toc142730875" class="anchor"><span id="_Toc142731248" class="anchor"><span id="_Toc142998615" class="anchor"><span id="_Toc143063707" class="anchor"><span id="_Toc143509817" class="anchor"><span id="_Toc143510264" class="anchor"><span id="_Toc144026296" class="anchor"><span id="_Toc144026627" class="anchor"><span id="_Toc144276270" class="anchor"><span id="_Toc144276614" class="anchor"><span id="_Toc144280202" class="anchor"><span id="_Toc144280548" class="anchor"><span id="_Toc144540763" class="anchor"><span id="_Toc144554646" class="anchor"><span id="_Toc144722267" class="anchor"><span id="_Toc145503729" class="anchor"><span id="_Toc145512171" class="anchor"><span id="_Toc145513194" class="anchor"><span id="_Toc145513578" class="anchor"><span id="_Toc222907352" class="anchor"><span id="_Toc342653020" class="anchor"><span id="_Toc439864152" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Messages

When a message is sent, the hypervisor selects a free message buffer.
The set of available message buffers depends on the event that triggered
the sending of the message.

The hypervisor marks the message buffer “in use" and fills in the
message header with the message type, payload size, and information
about the sender. Finally, it fills in the message payload. The contents
of the payload depend on the event that triggered the message. This
document specifies the payloads of all messages generated by the
hypervisor. The payload for messages sent by calling HvPostMessage must
be defined by the caller.

The hypervisor then appends the message buffer to a receiving message
queue. The receiving message queue depends on the event that triggered
the sending of the message. For all message types, SINTx is either
implicit (in the case of intercept messages), explicit (in the case of
timer messages) or specified by a port ID (in the case of guest
messages). The target virtual processor is either explicitly specified
or chosen by the hypervisor when the message is enqueued. Virtual
processors whose SynIC or SIM page (see section 17.7) is disabled will
not be considered as potential targets. If no targets are available, the
hypervisor terminates the operation and returns an error to the caller.

The hypervisor then determines whether the specified SINTx message slot
within the SIM page for the target virtual processor is empty. (See
section 17.7 for a description of the SIM page.) If the message type in
the message slot is equal to HvMessageTypeNone (that is, zero), the
message slot is assumed to be empty. In this case, the hypervisor
dequeues the message buffer and copies its contents to the message slot
within the SIM page. The hypervisor may copy only the number of payload
bytes associated with the message. The hypervisor also attempts to
generate an edge-triggered interrupt for the specified SINTx. If the
APIC is software disabled or the SINTx is masked, the interrupt is lost.
The arrival of this interrupt notifies the guest that a new message has
arrived. If the SIM page is disabled or the message slot within the SIM
page is not empty, the message remains queued, and no interrupt is
generated.

As with any fixed-priority interrupt, the interrupt is not acknowledged
by the virtual processor until the PPR (process priority register) is
less than the vector specified in the SINTx register and interrupts are
not masked by the virtual processor (rFLAGS\[IF\] is set to 1).

Multiple message buffers with the same SINTx can be queued to a virtual
processor. In this case, the hypervisor will deliver the first message
(that is, write it to the SIM page) and leave the others queued until
one of three events occur:

-   Another message buffer is queued.

-   The guest indicates the “end of interrupt" by writing to the APIC’s
    EOI register.

-   The guest indicates the “end of message" by writing to the SynIC’s
    EOM register.

In all three cases, the hypervisor will scan one or more message buffer
queues and attempt to deliver additional messages. The hypervisor also
attempts to generate an edge-triggered interrupt, indicating that a new
message has arrived.

If a queued message cannot be delivered because the corresponding SIM
entry is still in use, the hypervisor will attempt to deliver it again
after an unspecified time (typically on the order of milliseconds). To
avoid this potential latency, software should mark the SIM entry as
unused before indicating an EOI or EOM.

### <span id="_Toc127596821" class="anchor"><span id="_Toc127786442" class="anchor"><span id="_Toc127786758" class="anchor"><span id="_Toc127787074" class="anchor"><span id="_Toc127877748" class="anchor"><span id="_Toc128289819" class="anchor"><span id="_Toc128290212" class="anchor"><span id="_Toc130189815" class="anchor"><span id="_Toc130201031" class="anchor"><span id="_Toc130201347" class="anchor"><span id="_Toc130201668" class="anchor"><span id="_Toc131936756" class="anchor"><span id="_Toc133901220" class="anchor"><span id="_Toc137461094" class="anchor"><span id="_Toc139096609" class="anchor"><span id="_Toc139188532" class="anchor"><span id="_Toc139191395" class="anchor"><span id="_Toc140490447" class="anchor"><span id="_Toc140571349" class="anchor"><span id="_Toc141257622" class="anchor"><span id="_Toc141257949" class="anchor"><span id="_Toc141267477" class="anchor"><span id="_Toc141522495" class="anchor"><span id="_Toc141529583" class="anchor"><span id="_Toc141529900" class="anchor"><span id="_Toc141851507" class="anchor"><span id="_Toc141852441" class="anchor"><span id="_Toc141887985" class="anchor"><span id="_Toc141889825" class="anchor"><span id="_Toc141893494" class="anchor"><span id="_Toc142113347" class="anchor"><span id="_Toc142114375" class="anchor"><span id="_Toc142729592" class="anchor"><span id="_Toc142730876" class="anchor"><span id="_Toc142731249" class="anchor"><span id="_Toc142998616" class="anchor"><span id="_Toc143063708" class="anchor"><span id="_Toc143509818" class="anchor"><span id="_Toc143510265" class="anchor"><span id="_Toc144026297" class="anchor"><span id="_Toc144026628" class="anchor"><span id="_Toc144276271" class="anchor"><span id="_Toc144276615" class="anchor"><span id="_Toc144280203" class="anchor"><span id="_Toc144280549" class="anchor"><span id="_Toc144540764" class="anchor"><span id="_Toc144554647" class="anchor"><span id="_Toc144722268" class="anchor"><span id="_Toc145503730" class="anchor"><span id="_Toc145512172" class="anchor"><span id="_Toc145513195" class="anchor"><span id="_Toc145513579" class="anchor"><span id="_Toc222907353" class="anchor"><span id="_Toc342653021" class="anchor"><span id="_Toc439864153" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Recommended Message Handling

The SynIC message delivery mechanism is designed to accommodate
efficient delivery and receipt of messages within a target partition. It
is recommended that the message handling ISR (interrupt service routine)
within the target partition perform the following steps:

-   Examine the message that was deposited into the SIM message slot.

-   Copy the contents of the message to another location and set the
    message type within the message slot to HvMessageTypeNone.

-   Indicate the end of interrupt for the vector by writing to the
    APIC’s EOI register.

-   Perform any actions implied by the message.

    1.  ### <span id="_Toc342653022" class="anchor"><span id="_Toc127596822" class="anchor"><span id="_Toc127786443" class="anchor"><span id="_Toc127786759" class="anchor"><span id="_Toc127787075" class="anchor"><span id="_Toc127877749" class="anchor"><span id="_Toc128289820" class="anchor"><span id="_Toc128290213" class="anchor"><span id="_Toc130189816" class="anchor"><span id="_Toc130201032" class="anchor"><span id="_Toc130201348" class="anchor"><span id="_Toc130201669" class="anchor"><span id="_Toc131936757" class="anchor"><span id="_Toc133901221" class="anchor"><span id="_Toc137461095" class="anchor"><span id="_Toc139096610" class="anchor"><span id="_Toc139188533" class="anchor"><span id="_Toc139191396" class="anchor"><span id="_Toc140490448" class="anchor"><span id="_Toc140571350" class="anchor"><span id="_Toc141257623" class="anchor"><span id="_Toc141257950" class="anchor"><span id="_Toc141267478" class="anchor"><span id="_Toc141522496" class="anchor"><span id="_Toc141529584" class="anchor"><span id="_Toc141529901" class="anchor"><span id="_Toc141851508" class="anchor"><span id="_Toc141852442" class="anchor"><span id="_Toc141887986" class="anchor"><span id="_Toc141889826" class="anchor"><span id="_Toc141893495" class="anchor"><span id="_Toc142113348" class="anchor"><span id="_Toc142114376" class="anchor"><span id="_Toc142729593" class="anchor"><span id="_Toc142730877" class="anchor"><span id="_Toc142731250" class="anchor"><span id="_Toc142998617" class="anchor"><span id="_Toc143063709" class="anchor"><span id="_Toc143509819" class="anchor"><span id="_Toc143510266" class="anchor"><span id="_Toc144026298" class="anchor"><span id="_Toc144026629" class="anchor"><span id="_Toc144276272" class="anchor"><span id="_Toc144276616" class="anchor"><span id="_Toc144280204" class="anchor"><span id="_Toc144280550" class="anchor"><span id="_Toc144540765" class="anchor"><span id="_Toc144554648" class="anchor"><span id="_Toc144722269" class="anchor"><span id="_Toc145503731" class="anchor"><span id="_Toc145512173" class="anchor"><span id="_Toc145513196" class="anchor"><span id="_Toc145513580" class="anchor"><span id="_Toc222907354" class="anchor"><span id="_Toc342653023" class="anchor"><span id="_Toc439864154" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Message Sources

The classes of events that can trigger the sending of a message are as
follows:

-   **Intercepts:** Any intercept in a virtual processor will cause a
    message to be sent. The message buffer used is the intercept message
    buffer of the virtual processor that caused the intercept. The
    receiving message queue belongs to SINT0 of a virtual processor that
    the hypervisor selects non-deterministically from among the virtual
    processors of the parent partition. The message payload describes
    the event that caused the intercept. If the intercept message buffer
    is already queued when an intercept occurs, it is removed from the
    queue, overwritten, and placed back on the queue. This should occur
    only if the software running in the parent partition clears the
    “suspended for intercept" register before receiving the
    intercept message. This situation is considered a programming error.

-   **Timers:** The timer mechanism defined in chapter 18 will cause
    messages to be sent. Associated with each virtual processor are four
    dedicated timer message buffers, one for each timer. The receiving
    message queue belongs to SINTx of the virtual processor whose timer
    triggered the sending of the message. Timer messages are defined in
    section 19.3.

-   **Guest messages:** The hypervisor supports message passing as an
    inter-partition communication mechanism between guests. The
    interfaces defined in this section allow one guest to send messages
    to another guest. The message buffers used for messages of this
    class are taken from the receiver’s per-port pool of guest
    message buffers.

-   **Event log buffers:** The hypervisor will send a message when an
    event log buffer has been filled.

    1.  <span id="_Toc342653024" class="anchor"><span id="_Toc127596823" class="anchor"><span id="_Toc127786444" class="anchor"><span id="_Toc127786760" class="anchor"><span id="_Toc127787076" class="anchor"><span id="_Toc127877750" class="anchor"><span id="_Toc128289821" class="anchor"><span id="_Toc128290214" class="anchor"><span id="_Toc130189817" class="anchor"><span id="_Toc130201033" class="anchor"><span id="_Toc130201349" class="anchor"><span id="_Toc130201670" class="anchor"><span id="_Toc131936758" class="anchor"><span id="_Toc133901222" class="anchor"><span id="_Toc137461096" class="anchor"><span id="_Toc139096611" class="anchor"><span id="_Toc139188534" class="anchor"><span id="_Toc139191397" class="anchor"><span id="_Toc140490449" class="anchor"><span id="_Toc140571351" class="anchor"><span id="_Toc141257624" class="anchor"><span id="_Toc141257951" class="anchor"><span id="_Toc141267479" class="anchor"><span id="_Toc141522497" class="anchor"><span id="_Toc141529585" class="anchor"><span id="_Toc141529902" class="anchor"><span id="_Toc141851509" class="anchor"><span id="_Toc141852443" class="anchor"><span id="_Toc141887987" class="anchor"><span id="_Toc141889827" class="anchor"><span id="_Toc141893496" class="anchor"><span id="_Toc142113349" class="anchor"><span id="_Toc142114377" class="anchor"><span id="_Toc142729594" class="anchor"><span id="_Toc142730878" class="anchor"><span id="_Toc142731251" class="anchor"><span id="_Toc142998618" class="anchor"><span id="_Toc143063710" class="anchor"><span id="_Toc143509820" class="anchor"><span id="_Toc143510267" class="anchor"><span id="_Toc144026299" class="anchor"><span id="_Toc144026630" class="anchor"><span id="_Toc144276273" class="anchor"><span id="_Toc144276617" class="anchor"><span id="_Toc144280205" class="anchor"><span id="_Toc144280551" class="anchor"><span id="_Toc144540766" class="anchor"><span id="_Toc144554649" class="anchor"><span id="_Toc144722270" class="anchor"><span id="_Toc145503732" class="anchor"><span id="_Toc145512174" class="anchor"><span id="_Toc145513197" class="anchor"><span id="_Toc145513581" class="anchor"><span id="_Toc222907355" class="anchor"><span id="_Toc342653025" class="anchor"><span id="_Toc439864155" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>SynIC Event Flags
        ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

In addition to messages, the SynIC supports a second type of
cross-partition notification mechanism called *event flags*. Event flags
may be set explicitly using the HvSignalEvent hypercall or implicitly by
the hypervisor as a consequence of the monitored notification facility.

### <span id="_Toc127596824" class="anchor"><span id="_Toc127786445" class="anchor"><span id="_Toc127786761" class="anchor"><span id="_Toc127787077" class="anchor"><span id="_Toc127877751" class="anchor"><span id="_Toc128289822" class="anchor"><span id="_Toc128290215" class="anchor"><span id="_Toc130189818" class="anchor"><span id="_Toc130201034" class="anchor"><span id="_Toc130201350" class="anchor"><span id="_Toc130201671" class="anchor"><span id="_Toc131936759" class="anchor"><span id="_Toc133901223" class="anchor"><span id="_Toc137461097" class="anchor"><span id="_Toc139096612" class="anchor"><span id="_Toc139188535" class="anchor"><span id="_Toc139191398" class="anchor"><span id="_Toc140490450" class="anchor"><span id="_Toc140571352" class="anchor"><span id="_Toc141257625" class="anchor"><span id="_Toc141257952" class="anchor"><span id="_Toc141267480" class="anchor"><span id="_Toc141522498" class="anchor"><span id="_Toc141529586" class="anchor"><span id="_Toc141529903" class="anchor"><span id="_Toc141851510" class="anchor"><span id="_Toc141852444" class="anchor"><span id="_Toc141887988" class="anchor"><span id="_Toc141889828" class="anchor"><span id="_Toc141893497" class="anchor"><span id="_Toc142113350" class="anchor"><span id="_Toc142114378" class="anchor"><span id="_Toc142729595" class="anchor"><span id="_Toc142730879" class="anchor"><span id="_Toc142731252" class="anchor"><span id="_Toc142998619" class="anchor"><span id="_Toc143063711" class="anchor"><span id="_Toc143509821" class="anchor"><span id="_Toc143510268" class="anchor"><span id="_Toc144026300" class="anchor"><span id="_Toc144026631" class="anchor"><span id="_Toc144276274" class="anchor"><span id="_Toc144276618" class="anchor"><span id="_Toc144280206" class="anchor"><span id="_Toc144280552" class="anchor"><span id="_Toc144540767" class="anchor"><span id="_Toc144554650" class="anchor"><span id="_Toc144722271" class="anchor"><span id="_Toc145503733" class="anchor"><span id="_Toc145512175" class="anchor"><span id="_Toc145513198" class="anchor"><span id="_Toc145513582" class="anchor"><span id="_Toc222907356" class="anchor"><span id="_Toc342653026" class="anchor"><span id="_Toc439864156" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Event Flag Delivery

When a partition calls HvSignalEvent, it specifies an event flag number.
The hypervisor responds by atomically setting a bit within the receiving
virtual processor’s SIEF page. (See section 17.7 for a detailed
description of the SIEF page.) Virtual processors whose SynIC or SIEF
page is disabled will not be considered as potential targets. If no
targets are available, the hypervisor terminates the operation and
returns an error to the caller.

If the event flag was previously cleared, the hypervisor attempts to
notify the receiving partition that the flag is now set by generating an
edge-triggered interrupt. The target virtual processor, along with the
target SINTx, is specified as part of a port’s creation. (See the
following for information about ports.) If the SINTx is masked,
HvSignalEvent returns HV\_STATUS\_INVALID\_SYNIC\_STATE.

As with any fixed-priority external interrupt, the interrupt is not
acknowledged by the virtual processor until the process priority
register (PPR) is less than the vector specified in the SINTx register
and interrupts are not masked by the virtual processor (rFLAGS\[IF\] is
set to 1).

### <span id="_Toc127596825" class="anchor"><span id="_Toc127786446" class="anchor"><span id="_Toc127786762" class="anchor"><span id="_Toc127787078" class="anchor"><span id="_Toc127877752" class="anchor"><span id="_Toc128289823" class="anchor"><span id="_Toc128290216" class="anchor"><span id="_Toc130189819" class="anchor"><span id="_Toc130201035" class="anchor"><span id="_Toc130201351" class="anchor"><span id="_Toc130201672" class="anchor"><span id="_Toc131936760" class="anchor"><span id="_Toc133901224" class="anchor"><span id="_Toc137461098" class="anchor"><span id="_Toc139096613" class="anchor"><span id="_Toc139188536" class="anchor"><span id="_Toc139191399" class="anchor"><span id="_Toc140490451" class="anchor"><span id="_Toc140571353" class="anchor"><span id="_Toc141257626" class="anchor"><span id="_Toc141257953" class="anchor"><span id="_Toc141267481" class="anchor"><span id="_Toc141522499" class="anchor"><span id="_Toc141529587" class="anchor"><span id="_Toc141529904" class="anchor"><span id="_Toc141851511" class="anchor"><span id="_Toc141852445" class="anchor"><span id="_Toc141887989" class="anchor"><span id="_Toc141889829" class="anchor"><span id="_Toc141893498" class="anchor"><span id="_Toc142113351" class="anchor"><span id="_Toc142114379" class="anchor"><span id="_Toc142729596" class="anchor"><span id="_Toc142730880" class="anchor"><span id="_Toc142731253" class="anchor"><span id="_Toc142998620" class="anchor"><span id="_Toc143063712" class="anchor"><span id="_Toc143509822" class="anchor"><span id="_Toc143510269" class="anchor"><span id="_Toc144026301" class="anchor"><span id="_Toc144026632" class="anchor"><span id="_Toc144276275" class="anchor"><span id="_Toc144276619" class="anchor"><span id="_Toc144280207" class="anchor"><span id="_Toc144280553" class="anchor"><span id="_Toc144540768" class="anchor"><span id="_Toc144554651" class="anchor"><span id="_Toc144722272" class="anchor"><span id="_Toc145503734" class="anchor"><span id="_Toc145512176" class="anchor"><span id="_Toc145513199" class="anchor"><span id="_Toc145513583" class="anchor"><span id="_Toc222907357" class="anchor"><span id="_Toc342653027" class="anchor"><span id="_Toc439864157" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Recommended Event Flag Handling

It is recommended that the event flag interrupt service routine (ISR)
within the target partition perform the following steps:

-   Examine the event flags and determine which ones, if any, are set.

-   Clear one or more event flags by using a locked (atomic) operation
    such as LOCK AND or LOCK CMPXCHG.

-   Indicate the end of interrupt for the vector by writing to the
    APIC’s EOI register.

-   Perform any actions implied by the event flags that were set.

    1.  ### <span id="_Toc342653028" class="anchor"><span id="_Toc127596826" class="anchor"><span id="_Toc127786447" class="anchor"><span id="_Toc127786763" class="anchor"><span id="_Toc127787079" class="anchor"><span id="_Toc127877753" class="anchor"><span id="_Toc128289824" class="anchor"><span id="_Toc128290217" class="anchor"><span id="_Toc130189820" class="anchor"><span id="_Toc130201036" class="anchor"><span id="_Toc130201352" class="anchor"><span id="_Toc130201673" class="anchor"><span id="_Toc131936761" class="anchor"><span id="_Toc133901225" class="anchor"><span id="_Toc137461099" class="anchor"><span id="_Toc139096614" class="anchor"><span id="_Toc139188537" class="anchor"><span id="_Toc139191400" class="anchor"><span id="_Toc140490452" class="anchor"><span id="_Toc140571354" class="anchor"><span id="_Toc141257627" class="anchor"><span id="_Toc141257954" class="anchor"><span id="_Toc141267482" class="anchor"><span id="_Toc141522500" class="anchor"><span id="_Toc141529588" class="anchor"><span id="_Toc141529905" class="anchor"><span id="_Toc141851512" class="anchor"><span id="_Toc141852446" class="anchor"><span id="_Toc141887990" class="anchor"><span id="_Toc141889830" class="anchor"><span id="_Toc141893499" class="anchor"><span id="_Toc142113352" class="anchor"><span id="_Toc142114380" class="anchor"><span id="_Toc142729597" class="anchor"><span id="_Toc142730881" class="anchor"><span id="_Toc142731254" class="anchor"><span id="_Toc142998621" class="anchor"><span id="_Toc143063713" class="anchor"><span id="_Toc143509823" class="anchor"><span id="_Toc143510270" class="anchor"><span id="_Toc144026302" class="anchor"><span id="_Toc144026633" class="anchor"><span id="_Toc144276276" class="anchor"><span id="_Toc144276620" class="anchor"><span id="_Toc144280208" class="anchor"><span id="_Toc144280554" class="anchor"><span id="_Toc144540769" class="anchor"><span id="_Toc144554652" class="anchor"><span id="_Toc144722273" class="anchor"><span id="_Toc145503735" class="anchor"><span id="_Toc145512177" class="anchor"><span id="_Toc145513200" class="anchor"><span id="_Toc145513584" class="anchor"><span id="_Toc222907358" class="anchor"><span id="_Toc342653029" class="anchor"><span id="_Toc439864158" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Event Flags versus Messages

Event flags are lighter-weight than messages and are therefore lower
overhead. Furthermore, event flags do not require any buffer allocation
or queuing within the hypervisor, so HvSignalEvent will never fail due
to insufficient resources.

<span id="_Toc127596827" class="anchor"><span id="_Toc127786448" class="anchor"><span id="_Toc127786764" class="anchor"><span id="_Toc127787080" class="anchor"><span id="_Toc127877754" class="anchor"><span id="_Toc128289825" class="anchor"><span id="_Toc128290218" class="anchor"><span id="_Toc130189821" class="anchor"><span id="_Toc130201037" class="anchor"><span id="_Toc130201353" class="anchor"><span id="_Toc130201674" class="anchor"><span id="_Toc131936762" class="anchor"><span id="_Toc133901226" class="anchor"><span id="_Toc137461100" class="anchor"><span id="_Toc139096615" class="anchor"><span id="_Toc139188538" class="anchor"><span id="_Toc139191401" class="anchor"><span id="_Toc140490453" class="anchor"><span id="_Toc140571355" class="anchor"><span id="_Toc141257628" class="anchor"><span id="_Toc141257955" class="anchor"><span id="_Toc141267483" class="anchor"><span id="_Toc141522501" class="anchor"><span id="_Toc141529589" class="anchor"><span id="_Toc141529906" class="anchor"><span id="_Toc141851513" class="anchor"><span id="_Toc141852447" class="anchor"><span id="_Toc141887991" class="anchor"><span id="_Toc141889831" class="anchor"><span id="_Toc141893500" class="anchor"><span id="_Toc142113353" class="anchor"><span id="_Toc142114381" class="anchor"><span id="_Toc142729598" class="anchor"><span id="_Toc142730882" class="anchor"><span id="_Toc142731255" class="anchor"><span id="_Toc142998622" class="anchor"><span id="_Toc143063714" class="anchor"><span id="_Toc143509824" class="anchor"><span id="_Toc143510271" class="anchor"><span id="_Toc144026303" class="anchor"><span id="_Toc144026634" class="anchor"><span id="_Toc144276277" class="anchor"><span id="_Toc144276621" class="anchor"><span id="_Toc144280209" class="anchor"><span id="_Toc144280555" class="anchor"><span id="_Toc144540770" class="anchor"><span id="_Toc144554653" class="anchor"><span id="_Toc144722274" class="anchor"><span id="_Toc145503736" class="anchor"><span id="_Toc145512178" class="anchor"><span id="_Toc145513201" class="anchor"><span id="_Toc145513585" class="anchor"><span id="_Toc222907359" class="anchor"><span id="_Toc342653030" class="anchor"><span id="_Toc439864159" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Ports and Connections
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

A message or event sent from one guest to another must be sent through a
pre-allocated *connection.* A connection, in turn, must be associated
with a destination *port*.

A port is allocated from the receiver’s memory pool and specifies which
virtual processor and SINTx to target. Event ports have a “base flag
number" and “flag count" that allow the caller to specify a range of
valid event flags for that port.

Connections are allocated from the sender’s memory pool. When a
connection is created, it must be associated with a valid port. This
binding creates a simple, one-way communication channel. If a port is
subsequently deleted, its connection, while it remains, becomes useless.

<span id="_Toc222907360" class="anchor"><span id="_Toc342653031" class="anchor"><span id="_Toc439864160" class="anchor"></span></span></span>Monitored Notifications
--------------------------------------------------------------------------------------------------------------------------------------------------------------------

The monitored notification facility (MNF) introduces the concept of
shared triggers between two communicating partitions. MNF uses a port
(in the recipient partition) and a connection (in the originating
partition) to establish a hypervisor-monitored, unidirectional
notification channel. A monitor port-and-connection pair alone isn’t
enough to form the said notification channel. It needs in addition to be
associated with an event connection through the monitored notification
parameters in the monitored notification page

When the channel is created, a monitored notification is established in
an overlay page that includes the following:

-   A trigger,

-   A latency hint

-   A set of input parameters appropriate for the
    HvSignalEvent hypercall.

After the monitor page is established, the hypervisor periodically
examines the trigger at a rate subject to the latency hint to determine
if a notification is warranted. If so, the hypervisor invokes the
HvSignalEvent hypercall internally on behalf of the originating guest.
The behavior is the same as if the originating guest had invoked the
HvSignalEvent directly.

### <span id="_Toc222907361" class="anchor"><span id="_Toc342653032" class="anchor"><span id="_Toc439864161" class="anchor"></span></span></span>Monitored Notification Trigger

The trigger can be directly accessed by guests without hypervisor
intervention. It is set or cleared by the inter-partition communication
code running in the communicating guests. The trigger must be placed in
memory that is shared by the two communicating partitions and the
hypervisor.

### <span id="_Toc222907362" class="anchor"><span id="_Toc342653033" class="anchor"><span id="_Toc439864162" class="anchor"></span></span></span>Monitored Notification Latency Hint

The latency hint specifies an approximate wait period between hypervisor
examinations of the trigger. It is expressed in 100 nanosecond units.
The hypervisor can override the specified latency value if making it
somewhat smaller or larger is more efficient. The hypervisor can also
override the specified latency value if it exceeds minimum or maximum
values.

### <span id="_Toc222907363" class="anchor"><span id="_Toc342653034" class="anchor"><span id="_Toc439864163" class="anchor"></span></span></span>Monitored Notification Parameters

Each MNF trigger is defined by a set of input parameters compatible with
those accepted by an HvSignalEvent hypercall. These parameters include
an event flag number and a connection ID. If the internal invocation of
the HvSignalEvent hypercall fails, the error is discarded and the
invocation is treated as a NOP.

### <span id="_Toc222907364" class="anchor"><span id="_Toc342653035" class="anchor"><span id="_Toc439864164" class="anchor"></span></span></span>Monitored Notification Page

Monitored notifications are collected into monitor overlay pages that
can be created or deleted only from a parent partition. The parent
partition creates a monitor-page port in the recipient and specifies the
GPA of the recipient’s associated monitor page. The parent subsequently
creates a connection to that the monitor page port in the originator and
specifies the GPA of the originator’s associated monitor page. While
each of these two GPAs is partition-specific, the underlying physical
page is a common page that is managed by the hypervisor. Changes to the
page are visible from both partitions as well as the hypervisor.

<span id="_Toc127596828" class="anchor"><span id="_Toc127786449" class="anchor"><span id="_Toc127786765" class="anchor"><span id="_Toc127787081" class="anchor"><span id="_Toc127877755" class="anchor"><span id="_Toc128289826" class="anchor"><span id="_Toc128290219" class="anchor"><span id="_Toc130189822" class="anchor"><span id="_Toc130201038" class="anchor"><span id="_Toc130201354" class="anchor"><span id="_Toc130201675" class="anchor"><span id="_Toc131936763" class="anchor"><span id="_Toc133901227" class="anchor"><span id="_Toc137461101" class="anchor"><span id="_Toc139096616" class="anchor"><span id="_Toc139188539" class="anchor"><span id="_Toc139191402" class="anchor"><span id="_Toc140490454" class="anchor"><span id="_Toc140571356" class="anchor"><span id="_Toc141257629" class="anchor"><span id="_Toc141257956" class="anchor"><span id="_Toc141267484" class="anchor"><span id="_Toc141522502" class="anchor"><span id="_Toc141529590" class="anchor"><span id="_Toc141529907" class="anchor"><span id="_Toc141851514" class="anchor"><span id="_Toc141852448" class="anchor"><span id="_Toc141887992" class="anchor"><span id="_Toc141889832" class="anchor"><span id="_Toc141893501" class="anchor"><span id="_Toc142113354" class="anchor"><span id="_Toc142114382" class="anchor"><span id="_Toc142729599" class="anchor"><span id="_Toc142730883" class="anchor"><span id="_Toc142731256" class="anchor"><span id="_Toc142998623" class="anchor"><span id="_Toc143063715" class="anchor"><span id="_Toc143509825" class="anchor"><span id="_Toc143510272" class="anchor"><span id="_Toc144026304" class="anchor"><span id="_Toc144026635" class="anchor"><span id="_Toc144276278" class="anchor"><span id="_Toc144276622" class="anchor"><span id="_Toc144280210" class="anchor"><span id="_Toc144280556" class="anchor"><span id="_Toc144540771" class="anchor"><span id="_Toc144554654" class="anchor"><span id="_Toc144722275" class="anchor"><span id="_Toc145503737" class="anchor"><span id="_Toc145512179" class="anchor"><span id="_Toc145513202" class="anchor"><span id="_Toc145513586" class="anchor"><span id="_Ref159056278" class="anchor"><span id="_Ref159056301" class="anchor"><span id="_Toc222907365" class="anchor"><span id="_Toc342653036" class="anchor"><span id="_Toc439864165" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>SynIC MSRs
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

In addition to the memory-mapped registers defined for a local APIC, the
following model-specific registers (MSRs) are defined in the SynIC. Each
virtual processor has its own copy of these registers, so they can be
programmed independently.

  MSR Address   Register Name   Function
  ------------- --------------- ---------------------------------
  0x40000080    SCONTROL        SynIC Control
  0x40000081    SVERSION        SynIC Version
  0x40000082    SIEFP           Interrupt Event Flags Page
  0x40000083    SIMP            Interrupt Message Page
  0x40000084    EOM             End of message
  0x40000090    SINT0           Interrupt source 0 (hypervisor)
  0x40000091    SINT1           Interrupt source 1
  0x40000092    SINT2           Interrupt source 2
  0x40000093    SINT3           Interrupt source 3
  0x40000094    SINT4           Interrupt source 4
  0x40000095    SINT5           Interrupt source 5
  0x40000096    SINT6           Interrupt source 6
  0x40000097    SINT7           Interrupt source 7
  0x40000098    SINT8           Interrupt source 8
  0x40000099    SINT9           Interrupt source 9
  0x4000009A    SINT10          Interrupt source 10
  0x4000009B    SINT11          Interrupt source 11
  0x4000009C    SINT12          Interrupt source 12
  0x4000009D    SINT13          Interrupt source 13
  0x4000009E    SINT14          Interrupt source 14
  0x4000009F    SINT15          Interrupt source 15

### <span id="_Ref130720833" class="anchor"><span id="_Toc131936764" class="anchor"><span id="_Toc133901228" class="anchor"><span id="_Toc137461102" class="anchor"><span id="_Toc139096617" class="anchor"><span id="_Toc139188540" class="anchor"><span id="_Toc139191403" class="anchor"><span id="_Toc140490455" class="anchor"><span id="_Toc140571357" class="anchor"><span id="_Toc141257630" class="anchor"><span id="_Toc141257957" class="anchor"><span id="_Toc141267485" class="anchor"><span id="_Toc141522503" class="anchor"><span id="_Toc141529591" class="anchor"><span id="_Toc141529908" class="anchor"><span id="_Toc141851515" class="anchor"><span id="_Toc141852449" class="anchor"><span id="_Toc141887993" class="anchor"><span id="_Toc141889833" class="anchor"><span id="_Toc141893502" class="anchor"><span id="_Toc142113355" class="anchor"><span id="_Toc142114383" class="anchor"><span id="_Toc142729600" class="anchor"><span id="_Toc142730884" class="anchor"><span id="_Toc142731257" class="anchor"><span id="_Toc142998624" class="anchor"><span id="_Toc143063716" class="anchor"><span id="_Toc143509826" class="anchor"><span id="_Toc143510273" class="anchor"><span id="_Toc144026305" class="anchor"><span id="_Toc144026636" class="anchor"><span id="_Toc144276279" class="anchor"><span id="_Toc144276623" class="anchor"><span id="_Toc144280211" class="anchor"><span id="_Toc144280557" class="anchor"><span id="_Toc144540772" class="anchor"><span id="_Toc144554655" class="anchor"><span id="_Toc144722276" class="anchor"><span id="_Toc145503738" class="anchor"><span id="_Toc145512180" class="anchor"><span id="_Toc145513203" class="anchor"><span id="_Toc145513587" class="anchor"><span id="_Toc222907366" class="anchor"><span id="_Toc342653037" class="anchor"><span id="_Toc127596829" class="anchor"><span id="_Toc127786450" class="anchor"><span id="_Toc127786766" class="anchor"><span id="_Toc127787082" class="anchor"><span id="_Toc127877756" class="anchor"><span id="_Toc128289827" class="anchor"><span id="_Toc128290220" class="anchor"><span id="_Toc130189823" class="anchor"><span id="_Toc130201039" class="anchor"><span id="_Toc130201355" class="anchor"><span id="_Toc130201676" class="anchor"><span id="_Toc439864166" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>SCONTROL Register

  63:1    0
  ------- --------
  RsvdP   Enable

This register is used to control SynIC behavior of the virtual
processor.

  -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  Bits   Description                                                                                                                                                                                                                                               Attributes
  ------ --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ------------
  63:1   RsvdP (value must be preserved)                                                                                                                                                                                                                           Read/write

  0      Enable                                                                                                                                                                                                                                                    Read/write
                                                                                                                                                                                                                                                                   
         When set, this virtual processor will allow message queuing and event flag notifications to be posted to its SynIC (see chapter 17 for details). When clear, message queuing and event flag notifications cannot be directed to this virtual processor.   
  -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

At virtual processor creation time and upon processor reset, the value
of this SCONTROL (SynIC control register) is 0x0000000000000000. Thus,
message queuing and event flag notifications will be disabled.\
<span id="_Toc131936765" class="anchor"><span id="_Toc133901229"
class="anchor"><span id="_Toc137461103" class="anchor"><span
id="_Toc139096618" class="anchor"><span id="_Toc139188541"
class="anchor"><span id="_Toc139191404" class="anchor"><span
id="_Toc140490456" class="anchor"><span id="_Toc140571358"
class="anchor"><span id="_Toc141257631" class="anchor"><span
id="_Toc141257958" class="anchor"><span id="_Toc141267486"
class="anchor"><span id="_Toc141522504" class="anchor"><span
id="_Toc141529592" class="anchor"><span id="_Toc141529909"
class="anchor"><span id="_Toc141851516" class="anchor"><span
id="_Toc141852450" class="anchor"><span id="_Toc141887994"
class="anchor"><span id="_Toc141889834" class="anchor"><span
id="_Toc141893503" class="anchor"><span id="_Toc142113356"
class="anchor"><span id="_Toc142114384" class="anchor"><span
id="_Toc142729601" class="anchor"><span id="_Toc142730885"
class="anchor"><span id="_Toc142731258" class="anchor"><span
id="_Toc142998625" class="anchor"><span id="_Toc143063717"
class="anchor"><span id="_Toc143509827" class="anchor"><span
id="_Toc143510274" class="anchor"><span id="_Toc144026306"
class="anchor"><span id="_Toc144026637" class="anchor"><span
id="_Toc144276280" class="anchor"><span id="_Toc144276624"
class="anchor"><span id="_Toc144280212" class="anchor"><span
id="_Toc144280558" class="anchor"><span id="_Toc144540773"
class="anchor"><span id="_Toc144554656" class="anchor"><span
id="_Toc144722277" class="anchor"><span id="_Toc145503739"
class="anchor"><span id="_Toc145512181" class="anchor"><span
id="_Toc145513204" class="anchor"><span id="_Toc145513588"
class="anchor"><span id="_Ref159056349" class="anchor"><span
id="_Toc222907367"
class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>SVERSION
Register

  63:32   31:0
  ------- ----------------------------
  Rsvd    SynIC Version (0x00000001)

This is a read-only register, and it returns the version number of the
SynIC. For the first version of the hypervisor, the value is 0x00000001.
Attempts to write to this register result in a \#GP fault.

### <span id="_Toc127596830" class="anchor"><span id="_Toc127786451" class="anchor"><span id="_Toc127786767" class="anchor"><span id="_Toc127787083" class="anchor"><span id="_Toc127877757" class="anchor"><span id="_Toc128289828" class="anchor"><span id="_Toc128290221" class="anchor"><span id="_Toc130189824" class="anchor"><span id="_Toc130201040" class="anchor"><span id="_Toc130201356" class="anchor"><span id="_Toc130201677" class="anchor"><span id="_Toc131936766" class="anchor"><span id="_Toc133901230" class="anchor"><span id="_Toc137461104" class="anchor"><span id="_Toc139096619" class="anchor"><span id="_Toc139188542" class="anchor"><span id="_Toc139191405" class="anchor"><span id="_Toc140490457" class="anchor"><span id="_Toc140571359" class="anchor"><span id="_Toc141257632" class="anchor"><span id="_Toc141257959" class="anchor"><span id="_Toc141267487" class="anchor"><span id="_Toc141522505" class="anchor"><span id="_Toc141529593" class="anchor"><span id="_Toc141529910" class="anchor"><span id="_Toc141851517" class="anchor"><span id="_Toc141852451" class="anchor"><span id="_Toc141887995" class="anchor"><span id="_Toc141889835" class="anchor"><span id="_Toc141893504" class="anchor"><span id="_Toc142113357" class="anchor"><span id="_Toc142114385" class="anchor"><span id="_Toc142729602" class="anchor"><span id="_Toc142730886" class="anchor"><span id="_Toc142731259" class="anchor"><span id="_Toc142998626" class="anchor"><span id="_Toc143063718" class="anchor"><span id="_Toc143509828" class="anchor"><span id="_Toc143510275" class="anchor"><span id="_Toc144026307" class="anchor"><span id="_Toc144026638" class="anchor"><span id="_Toc144276281" class="anchor"><span id="_Toc144276625" class="anchor"><span id="_Toc144280213" class="anchor"><span id="_Toc144280559" class="anchor"><span id="_Toc144540774" class="anchor"><span id="_Toc144554657" class="anchor"><span id="_Toc144722278" class="anchor"><span id="_Toc145503740" class="anchor"><span id="_Toc145512182" class="anchor"><span id="_Toc145513205" class="anchor"><span id="_Toc145513589" class="anchor"><span id="_Ref159056326" class="anchor"><span id="_Toc222907368" class="anchor"><span id="_Toc342653038" class="anchor"><span id="_Toc439864167" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>SIEFP Register

  63:12                11:1    0
  -------------------- ------- --------
  SIEFP Base Address   RsvdP   Enable

  -----------------------------------------------------------
  Bits    Description                            Attributes
  ------- -------------------------------------- ------------
  63:12   Base address (in GPA space) of SIEFP   Read/write
                                                 
          (low 12 bits assumed to be zero)       

  11:1    RsvdP (value should be preserved)      Read/write

  0       SIEFP enable                           Read/write
  -----------------------------------------------------------

At virtual processor creation time and upon processor reset, the value
of this SIEFP (synthetic interrupt event flags page) register is
0x0000000000000000. Thus, the SIEFP is disabled by default. The guest
must enable it by setting bit 0. If the specified base address is beyond
the end of the partition’s GPA space, the SIEFP page will not be
accessible to the guest. When modifying the register, guests should
preserve the value of the reserved bits (1 through 11) for future
compatibility.

### <span id="_Toc127596831" class="anchor"><span id="_Toc127786452" class="anchor"><span id="_Toc127786768" class="anchor"><span id="_Toc127787084" class="anchor"><span id="_Toc127877758" class="anchor"><span id="_Toc128289829" class="anchor"><span id="_Toc128290222" class="anchor"><span id="_Toc130189825" class="anchor"><span id="_Toc130201041" class="anchor"><span id="_Toc130201357" class="anchor"><span id="_Toc130201678" class="anchor"><span id="_Toc131936767" class="anchor"><span id="_Toc133901231" class="anchor"><span id="_Toc137461105" class="anchor"><span id="_Toc139096620" class="anchor"><span id="_Toc139188543" class="anchor"><span id="_Toc139191406" class="anchor"><span id="_Toc140490458" class="anchor"><span id="_Toc140571360" class="anchor"><span id="_Toc141257633" class="anchor"><span id="_Toc141257960" class="anchor"><span id="_Toc141267488" class="anchor"><span id="_Toc141522506" class="anchor"><span id="_Toc141529594" class="anchor"><span id="_Toc141529911" class="anchor"><span id="_Toc141851518" class="anchor"><span id="_Toc141852452" class="anchor"><span id="_Toc141887996" class="anchor"><span id="_Toc141889836" class="anchor"><span id="_Toc141893505" class="anchor"><span id="_Toc142113358" class="anchor"><span id="_Toc142114386" class="anchor"><span id="_Toc142729603" class="anchor"><span id="_Toc142730887" class="anchor"><span id="_Toc142731260" class="anchor"><span id="_Toc142998627" class="anchor"><span id="_Toc143063719" class="anchor"><span id="_Toc143509829" class="anchor"><span id="_Toc143510276" class="anchor"><span id="_Toc144026308" class="anchor"><span id="_Toc144026639" class="anchor"><span id="_Toc144276282" class="anchor"><span id="_Toc144276626" class="anchor"><span id="_Toc144280214" class="anchor"><span id="_Toc144280560" class="anchor"><span id="_Toc144540775" class="anchor"><span id="_Toc144554658" class="anchor"><span id="_Toc144722279" class="anchor"><span id="_Toc145503741" class="anchor"><span id="_Toc145512183" class="anchor"><span id="_Toc145513206" class="anchor"><span id="_Toc145513590" class="anchor"><span id="_Ref148357309" class="anchor"><span id="_Ref159056369" class="anchor"><span id="_Toc222907369" class="anchor"><span id="_Toc342653039" class="anchor"><span id="_Toc439864168" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>SIMP Register

  63:12               11:1    0
  ------------------- ------- --------
  SIMP Base Address   RsvdP   Enable

  ----------------------------------------------------------
  Bits    Description                           Attributes
  ------- ------------------------------------- ------------
  63:12   Base address (in GPA space) of SIMP   Read/write
                                                
          (low 12 bits assumed to be zero)      

  11:1    RsvdP (value should be preserved)     Read/write

  0       SIMP enable                           Read/write
  ----------------------------------------------------------

At virtual processor creation time and upon processor reset, the value
of this SIMP (synthetic interrupt message page) register is
0x0000000000000000. Thus, the SIMP is disabled by default. The guest
must enable it by setting bit 0. If the specified base address is beyond
the end of the partition’s GPA space, the SIMP page will not be
accessible to the guest. When modifying the register, guests should
preserve the value of the reserved bits (1 through 11) for future
compatibility.

### <span id="_Toc127596832" class="anchor"><span id="_Toc127786453" class="anchor"><span id="_Toc127786769" class="anchor"><span id="_Toc127787085" class="anchor"><span id="_Toc127877759" class="anchor"><span id="_Toc128289830" class="anchor"><span id="_Toc128290223" class="anchor"><span id="_Toc130189826" class="anchor"><span id="_Toc130201042" class="anchor"><span id="_Toc130201358" class="anchor"><span id="_Toc130201679" class="anchor"><span id="_Toc131936768" class="anchor"><span id="_Toc133901232" class="anchor"><span id="_Toc137461106" class="anchor"><span id="_Toc139096621" class="anchor"><span id="_Toc139188544" class="anchor"><span id="_Toc139191407" class="anchor"><span id="_Toc140490459" class="anchor"><span id="_Toc140571361" class="anchor"><span id="_Toc141257634" class="anchor"><span id="_Toc141257961" class="anchor"><span id="_Toc141267489" class="anchor"><span id="_Toc141522507" class="anchor"><span id="_Toc141529595" class="anchor"><span id="_Toc141529912" class="anchor"><span id="_Toc141851519" class="anchor"><span id="_Toc141852453" class="anchor"><span id="_Toc141887997" class="anchor"><span id="_Toc141889837" class="anchor"><span id="_Toc141893506" class="anchor"><span id="_Toc142113359" class="anchor"><span id="_Toc142114387" class="anchor"><span id="_Toc142729604" class="anchor"><span id="_Toc142730888" class="anchor"><span id="_Toc142731261" class="anchor"><span id="_Toc142998628" class="anchor"><span id="_Toc143063720" class="anchor"><span id="_Toc143509830" class="anchor"><span id="_Toc143510277" class="anchor"><span id="_Toc144026309" class="anchor"><span id="_Toc144026640" class="anchor"><span id="_Toc144276283" class="anchor"><span id="_Toc144276627" class="anchor"><span id="_Toc144280215" class="anchor"><span id="_Toc144280561" class="anchor"><span id="_Toc144540776" class="anchor"><span id="_Toc144554659" class="anchor"><span id="_Toc144722280" class="anchor"><span id="_Toc145503742" class="anchor"><span id="_Toc145512184" class="anchor"><span id="_Toc145513207" class="anchor"><span id="_Toc145513591" class="anchor"><span id="_Ref159056394" class="anchor"><span id="_Ref159056420" class="anchor"><span id="_Ref159056430" class="anchor"><span id="_Ref159056438" class="anchor"><span id="_Ref159056449" class="anchor"><span id="_Ref159056464" class="anchor"><span id="_Ref159056474" class="anchor"><span id="_Ref159056483" class="anchor"><span id="_Ref159056495" class="anchor"><span id="_Ref159056505" class="anchor"><span id="_Ref159056514" class="anchor"><span id="_Ref159056523" class="anchor"><span id="_Ref159056532" class="anchor"><span id="_Ref159056540" class="anchor"><span id="_Ref159056551" class="anchor"><span id="_Ref159056560" class="anchor"><span id="_Toc222907370" class="anchor"><span id="_Toc342653040" class="anchor"><span id="_Toc439864169" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>SINTx Registers

  63:18   17        16     15:8    7:0
  ------- --------- ------ ------- --------
  RsvdP   AutoEOI   Mask   RsvdP   Vector

  -----------------------------------------------------------------------------------------
  Bits    Description                                                          Attributes
  ------- -------------------------------------------------------------------- ------------
  63:18   RsvdP (value should be preserved)                                    Read/write

  17      AutoEOI                                                              Read/write
                                                                               
          Set if an implicit EOI should be performed upon interrupt delivery   

  16      Set if the SINT is masked                                            Read/write

  15:8    RsvdP (value should be preserved)                                    Read/write

  7:0     Vector                                                               Read/write
  -----------------------------------------------------------------------------------------

At virtual processor creation time, the default value of all SINTx
(synthetic interrupt source) registers is 0x0000000000010000. Thus, all
synthetic interrupt sources are masked by default. The guest must unmask
them by programming an appropriate vector and clearing bit 16.

The AutoEOI flag indicates that an implicit EOI should be performed by
the hypervisor when an interrupt is delivered to the virtual processor.
In addition, the hypervisor will automatically clear the corresponding
flag in the “in service register" (ISR) of the virtual APIC. If the
guest enables this behavior, then it must not perform an EOI in its
interrupt service routine.

The AutoEOI flag can be turned on at any time, though the guest must
perform an explicit EOI on an in-flight interrupt The timing
consideration makes it difficult to know whether a particular interrupt
needs EOI or not, so it is recommended that once SINT is unmasked, its
settings are not changed.

Likewise, the AutoEOI flag can be turned off at any time, though the
same concerns about in-flight interrupts apply

Valid values for v*ector* are 16-255 inclusive. Specifying an invalid
vector number results in \#GP.

### <span id="_Toc127596833" class="anchor"><span id="_Toc127786454" class="anchor"><span id="_Toc127786770" class="anchor"><span id="_Toc127787086" class="anchor"><span id="_Toc127877760" class="anchor"><span id="_Toc128289831" class="anchor"><span id="_Toc128290224" class="anchor"><span id="_Toc130189827" class="anchor"><span id="_Toc130201043" class="anchor"><span id="_Toc130201359" class="anchor"><span id="_Toc130201680" class="anchor"><span id="_Toc131936769" class="anchor"><span id="_Toc133901233" class="anchor"><span id="_Toc137461107" class="anchor"><span id="_Toc139096622" class="anchor"><span id="_Toc139188545" class="anchor"><span id="_Toc139191408" class="anchor"><span id="_Toc140490460" class="anchor"><span id="_Toc140571362" class="anchor"><span id="_Toc141257635" class="anchor"><span id="_Toc141257962" class="anchor"><span id="_Toc141267490" class="anchor"><span id="_Toc141522508" class="anchor"><span id="_Toc141529596" class="anchor"><span id="_Toc141529913" class="anchor"><span id="_Toc141851520" class="anchor"><span id="_Toc141852454" class="anchor"><span id="_Toc141887998" class="anchor"><span id="_Toc141889838" class="anchor"><span id="_Toc141893507" class="anchor"><span id="_Toc142113360" class="anchor"><span id="_Toc142114388" class="anchor"><span id="_Toc142729605" class="anchor"><span id="_Toc142730889" class="anchor"><span id="_Toc142731262" class="anchor"><span id="_Toc142998629" class="anchor"><span id="_Toc143063721" class="anchor"><span id="_Toc143509831" class="anchor"><span id="_Toc143510278" class="anchor"><span id="_Toc144026310" class="anchor"><span id="_Toc144026641" class="anchor"><span id="_Toc144276284" class="anchor"><span id="_Toc144276628" class="anchor"><span id="_Toc144280216" class="anchor"><span id="_Toc144280562" class="anchor"><span id="_Toc144540777" class="anchor"><span id="_Toc144554660" class="anchor"><span id="_Toc144722281" class="anchor"><span id="_Toc145503743" class="anchor"><span id="_Toc145512185" class="anchor"><span id="_Toc145513208" class="anchor"><span id="_Toc145513592" class="anchor"><span id="_Ref159056381" class="anchor"><span id="_Toc222907371" class="anchor"><span id="_Toc342653041" class="anchor"><span id="_Toc439864170" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>EOM Register

  63:0
  -------
  RsvdZ

  Bits   Description                           Attributes
  ------ ------------------------------------- --------------------
  63:0   RsvdZ (value should be set to zero)   Write-only trigger

A write to the end of message (EOM) register by the guest causes the
hypervisor to scan the internal message buffer queue(s) associated with
the virtual processor. If a message buffer queue contains a queued
message buffer, the hypervisor attempts to deliver the message. Message
delivery succeeds if the SIM page is enabled and the message slot
corresponding to the SINTx is empty (that is, the message type in the
header is set to HvMessageTypeNone). If a message is successfully
delivered, its corresponding internal message buffer is dequeued and
marked free. If the corresponding SINTx is not masked, an edge-triggered
interrupt is delivered (that is, the corresponding bit in the IRR is
set).

This register can be used by guests to “poll" for messages. It can also
be used as a way to drain the message queue for a SINTx that has been
disabled (that is, masked).

If the message queues are all empty, a write to the EOM register is a
no-op.

Reads from the EOM register always returns zeros.

<span id="_Ref123701109" class="anchor"><span id="_Toc127596834" class="anchor"><span id="_Toc127786455" class="anchor"><span id="_Toc127786771" class="anchor"><span id="_Toc127787087" class="anchor"><span id="_Toc127877761" class="anchor"><span id="_Toc128289832" class="anchor"><span id="_Toc128290225" class="anchor"><span id="_Toc130189828" class="anchor"><span id="_Toc130201044" class="anchor"><span id="_Toc130201360" class="anchor"><span id="_Toc130201681" class="anchor"><span id="_Toc131936770" class="anchor"><span id="_Toc133901234" class="anchor"><span id="_Toc137461108" class="anchor"><span id="_Toc139096623" class="anchor"><span id="_Toc139188546" class="anchor"><span id="_Toc139191409" class="anchor"><span id="_Toc140490461" class="anchor"><span id="_Toc140571363" class="anchor"><span id="_Toc141257636" class="anchor"><span id="_Toc141257963" class="anchor"><span id="_Toc141267491" class="anchor"><span id="_Toc141522509" class="anchor"><span id="_Toc141529597" class="anchor"><span id="_Toc141529914" class="anchor"><span id="_Toc141851521" class="anchor"><span id="_Toc141852455" class="anchor"><span id="_Toc141887999" class="anchor"><span id="_Toc141889839" class="anchor"><span id="_Toc141893508" class="anchor"><span id="_Toc142113361" class="anchor"><span id="_Toc142114389" class="anchor"><span id="_Toc142729606" class="anchor"><span id="_Toc142730890" class="anchor"><span id="_Toc142731263" class="anchor"><span id="_Toc142998630" class="anchor"><span id="_Toc143063722" class="anchor"><span id="_Toc143509832" class="anchor"><span id="_Toc143510279" class="anchor"><span id="_Toc144026311" class="anchor"><span id="_Toc144026642" class="anchor"><span id="_Toc144276285" class="anchor"><span id="_Toc144276629" class="anchor"><span id="_Toc144280217" class="anchor"><span id="_Toc144280563" class="anchor"><span id="_Toc144540778" class="anchor"><span id="_Toc144554661" class="anchor"><span id="_Toc144722282" class="anchor"><span id="_Toc145503744" class="anchor"><span id="_Toc145512186" class="anchor"><span id="_Toc145513209" class="anchor"><span id="_Toc145513593" class="anchor"><span id="_Toc222907372" class="anchor"><span id="_Toc342653042" class="anchor"><span id="_Toc439864171" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>SIM and SIEF Pages
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

The SynIC defines two pages that extend the functionality of a
traditional APIC. The pages for these two addresses are specified by the
SIEFP register and the SIMP register (see earlier in this specification
for these register formats).

The SIEF and SIM pages are implemented as GPA overlay pages. For a
description of overlay pages, see section 8.1.3.

The addresses of the SIEF and SIM pages should be unique for each
virtual processor. Programming these pages to overlap other instances of
the SIEF or SIM pages or any other overlay page (for example, the
hypercall page) will result in undefined behavior.

The hypervisor may implement the SIEF and SIM pages so that a SIEF or
SIM instance associated with a virtual processor is not accessible to
other virtual processors. In such implementations, an access by one
virtual processor to another virtual processor’s SIEF or SIM page will
result in a \#MC fault. It is highly recommended that guests avoid
performing such accesses.

Read and write accesses by a virtual processor to the SIEF and SIM pages
behave like read and write accesses to RAM. However, the hypervisor’s
SynIC implementation also writes to these pages in response to certain
events.

Upon virtual processor creation and reset, the SIEF and SIM pages are
cleared to zero.

The SIEF page consists of a 16-element array of 256-byte event flags
(see the following for an explanation of event flags). Each array
element corresponds to a single synthetic interrupt source (SINTx).

The SIM page consists of a 16-element array of 256-byte messages (see
the following HV\_MESSAGE data structure). Each array element (also
known as a *message slot*) corresponds to a single synthetic interrupt
source (SINTx). A message slot is said to be “empty" if the message type
of the message in the slot is equal to HvMessageTypeNone.

1.  <span id="_Toc127596835" class="anchor"><span id="_Toc127786456" class="anchor"><span id="_Toc127786772" class="anchor"><span id="_Toc127787088" class="anchor"><span id="_Toc127877762" class="anchor"><span id="_Toc128289833" class="anchor"><span id="_Toc128290226" class="anchor"><span id="_Toc130189829" class="anchor"><span id="_Toc130201045" class="anchor"><span id="_Toc130201361" class="anchor"><span id="_Toc130201682" class="anchor"><span id="_Toc131936771" class="anchor"><span id="_Toc133901235" class="anchor"><span id="_Toc137461109" class="anchor"><span id="_Toc139096624" class="anchor"><span id="_Toc139188547" class="anchor"><span id="_Toc139191410" class="anchor"><span id="_Toc140490462" class="anchor"><span id="_Toc140571364" class="anchor"><span id="_Toc141257637" class="anchor"><span id="_Toc141257964" class="anchor"><span id="_Toc141267492" class="anchor"><span id="_Toc141522510" class="anchor"><span id="_Toc141529598" class="anchor"><span id="_Toc141529915" class="anchor"><span id="_Toc141851522" class="anchor"><span id="_Toc141852456" class="anchor"><span id="_Toc141888000" class="anchor"><span id="_Toc141889840" class="anchor"><span id="_Toc141893509" class="anchor"><span id="_Toc142113362" class="anchor"><span id="_Toc142114390" class="anchor"><span id="_Toc142729607" class="anchor"><span id="_Toc142730891" class="anchor"><span id="_Toc142731264" class="anchor"><span id="_Toc142998631" class="anchor"><span id="_Toc143063723" class="anchor"><span id="_Toc143509833" class="anchor"><span id="_Toc143510280" class="anchor"><span id="_Toc144026312" class="anchor"><span id="_Toc144026643" class="anchor"><span id="_Toc144276286" class="anchor"><span id="_Toc144276630" class="anchor"><span id="_Toc144280218" class="anchor"><span id="_Toc144280564" class="anchor"><span id="_Toc144540779" class="anchor"><span id="_Toc144554662" class="anchor"><span id="_Toc144722283" class="anchor"><span id="_Toc145503745" class="anchor"><span id="_Toc145512187" class="anchor"><span id="_Toc145513210" class="anchor"><span id="_Toc145513594" class="anchor"><span id="_Toc222907373" class="anchor"><span id="_Toc342653043" class="anchor"><span id="_Toc439864172" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Inter-Partition Communication Data Types
    ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

    1.  ### <span id="_Toc127596836" class="anchor"><span id="_Toc127786457" class="anchor"><span id="_Toc127786773" class="anchor"><span id="_Toc127787089" class="anchor"><span id="_Toc127877763" class="anchor"><span id="_Toc128289834" class="anchor"><span id="_Toc128290227" class="anchor"><span id="_Toc130189830" class="anchor"><span id="_Toc130201046" class="anchor"><span id="_Toc130201362" class="anchor"><span id="_Toc130201683" class="anchor"><span id="_Toc131936772" class="anchor"><span id="_Toc133901236" class="anchor"><span id="_Toc137461110" class="anchor"><span id="_Toc139096625" class="anchor"><span id="_Toc139188548" class="anchor"><span id="_Toc139191411" class="anchor"><span id="_Toc140490463" class="anchor"><span id="_Toc140571365" class="anchor"><span id="_Toc141257638" class="anchor"><span id="_Toc141257965" class="anchor"><span id="_Toc141267493" class="anchor"><span id="_Toc141522511" class="anchor"><span id="_Toc141529599" class="anchor"><span id="_Toc141529916" class="anchor"><span id="_Toc141851523" class="anchor"><span id="_Toc141852457" class="anchor"><span id="_Toc141888001" class="anchor"><span id="_Toc141889841" class="anchor"><span id="_Toc141893510" class="anchor"><span id="_Toc142113363" class="anchor"><span id="_Toc142114391" class="anchor"><span id="_Toc142729608" class="anchor"><span id="_Toc142730892" class="anchor"><span id="_Toc142731265" class="anchor"><span id="_Toc142998632" class="anchor"><span id="_Toc143063724" class="anchor"><span id="_Toc143509834" class="anchor"><span id="_Toc143510281" class="anchor"><span id="_Toc144026313" class="anchor"><span id="_Toc144026644" class="anchor"><span id="_Toc144276287" class="anchor"><span id="_Toc144276631" class="anchor"><span id="_Toc144280219" class="anchor"><span id="_Toc144280565" class="anchor"><span id="_Toc144540780" class="anchor"><span id="_Toc144554663" class="anchor"><span id="_Toc144722284" class="anchor"><span id="_Toc145503746" class="anchor"><span id="_Toc145512188" class="anchor"><span id="_Toc145513211" class="anchor"><span id="_Toc145513595" class="anchor"><span id="_Toc222907374" class="anchor"><span id="_Toc342653044" class="anchor"><span id="_Toc439864173" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Synthetic Interrupt Sources

The SynIC supports 16 synthetic interrupt sources.

\#define HV\_SYNIC\_SINT\_COUNT 16

typedef UINT32 HV\_SYNIC\_SINT\_INDEX;

### <span id="_Toc127596837" class="anchor"><span id="_Toc127786458" class="anchor"><span id="_Toc127786774" class="anchor"><span id="_Toc127787090" class="anchor"><span id="_Toc127877764" class="anchor"><span id="_Toc128289835" class="anchor"><span id="_Toc128290228" class="anchor"><span id="_Toc130189831" class="anchor"><span id="_Toc130201047" class="anchor"><span id="_Toc130201363" class="anchor"><span id="_Toc130201684" class="anchor"><span id="_Toc131936773" class="anchor"><span id="_Toc133901237" class="anchor"><span id="_Toc137461111" class="anchor"><span id="_Toc139096626" class="anchor"><span id="_Toc139188549" class="anchor"><span id="_Toc139191412" class="anchor"><span id="_Toc140490464" class="anchor"><span id="_Toc140571366" class="anchor"><span id="_Toc141257639" class="anchor"><span id="_Toc141257966" class="anchor"><span id="_Toc141267494" class="anchor"><span id="_Toc141522512" class="anchor"><span id="_Toc141529600" class="anchor"><span id="_Toc141529917" class="anchor"><span id="_Toc141851524" class="anchor"><span id="_Toc141852458" class="anchor"><span id="_Toc141888002" class="anchor"><span id="_Toc141889842" class="anchor"><span id="_Toc141893511" class="anchor"><span id="_Toc142113364" class="anchor"><span id="_Toc142114392" class="anchor"><span id="_Toc142729609" class="anchor"><span id="_Toc142730893" class="anchor"><span id="_Toc142731266" class="anchor"><span id="_Toc142998633" class="anchor"><span id="_Toc143063725" class="anchor"><span id="_Toc143509835" class="anchor"><span id="_Toc143510282" class="anchor"><span id="_Toc144026314" class="anchor"><span id="_Toc144026645" class="anchor"><span id="_Toc144276288" class="anchor"><span id="_Toc144276632" class="anchor"><span id="_Toc144280220" class="anchor"><span id="_Toc144280566" class="anchor"><span id="_Toc144540781" class="anchor"><span id="_Toc144554664" class="anchor"><span id="_Toc144722285" class="anchor"><span id="_Toc145503747" class="anchor"><span id="_Toc145512189" class="anchor"><span id="_Toc145513212" class="anchor"><span id="_Toc145513596" class="anchor"><span id="_Ref146968356" class="anchor"><span id="_Toc222907375" class="anchor"><span id="_Toc342653045" class="anchor"><span id="_Toc439864174" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>SynIC Message Types

SynIC messages encode the message type as a 32-bit number.

typedef enum

{

HvMessageTypeNone = 0x00000000,

// Memory access messages

HvMessageTypeUnmappedGpa = 0x80000000,

HvMessageTypeGpaIntercept = 0x80000001,

// Timer notifications

HvMessageTimerExpired = 0x80000010,

// Error messages

HvMessageTypeInvalidVpRegisterValue = 0x80000020,

HvMessageTypeUnrecoverableException = 0x80000021,

HvMessageTypeUnsupportedFeature = 0x80000022,

HvMessageTypeTlbPageSizeMismatch = 0x80000023,

// Trace buffer messages

HvMessageTypeEventLogBuffersComplete = 0x80000040,

// Hypercall intercept.

HvMessageTypeHypercallIntercept = 0x80000050,

// Platform-specific processor intercept messages

HvMessageTypeX64IoPortIntercept = 0x80010000,

HvMessageTypeMsrIntercept = 0x80010001,

HvMessageTypeX64CpuidIntercept = 0x80010002,

HvMessageTypeExceptionIntercept = 0x80010003,

HvMessageTypeX64ApicEoi = 0x80010004,

HvMessageTypeX64LegacyFpError = 0x80010005,

HvMessageTypeRegisterIntercept = 0x80010006,

} HV\_MESSAGE\_TYPE;

\#define HV\_MESSAGE\_TYPE\_HYPERVISOR\_MASK 0x80000000

Any message type that has the high bit set is reserved for use by the
hypervisor. Guest-initiated messages cannot send messages with a
hypervisor message type.

For a complete list of messages sent by the hypervisor, see section
19.2.

### <span id="_Toc130189832" class="anchor"><span id="_Toc130201048" class="anchor"><span id="_Toc130201364" class="anchor"><span id="_Toc130201685" class="anchor"><span id="_Toc131936774" class="anchor"><span id="_Toc133901238" class="anchor"><span id="_Toc137461112" class="anchor"><span id="_Toc139096627" class="anchor"><span id="_Toc139188550" class="anchor"><span id="_Toc139191413" class="anchor"><span id="_Toc140490465" class="anchor"><span id="_Toc140571367" class="anchor"><span id="_Toc141257640" class="anchor"><span id="_Toc141257967" class="anchor"><span id="_Toc141267495" class="anchor"><span id="_Toc141522513" class="anchor"><span id="_Toc141529601" class="anchor"><span id="_Toc141529918" class="anchor"><span id="_Toc141851525" class="anchor"><span id="_Toc141852459" class="anchor"><span id="_Toc141888003" class="anchor"><span id="_Toc141889843" class="anchor"><span id="_Toc141893512" class="anchor"><span id="_Toc142113365" class="anchor"><span id="_Toc142114393" class="anchor"><span id="_Toc142729610" class="anchor"><span id="_Toc142730894" class="anchor"><span id="_Toc142731267" class="anchor"><span id="_Toc142998634" class="anchor"><span id="_Toc143063726" class="anchor"><span id="_Toc143509836" class="anchor"><span id="_Toc143510283" class="anchor"><span id="_Toc144026315" class="anchor"><span id="_Toc144026646" class="anchor"><span id="_Toc144276289" class="anchor"><span id="_Toc144276633" class="anchor"><span id="_Toc144280221" class="anchor"><span id="_Toc144280567" class="anchor"><span id="_Toc144540782" class="anchor"><span id="_Toc144554665" class="anchor"><span id="_Toc144722286" class="anchor"><span id="_Toc145503748" class="anchor"><span id="_Toc145512190" class="anchor"><span id="_Toc145513213" class="anchor"><span id="_Toc145513597" class="anchor"><span id="_Toc222907376" class="anchor"><span id="_Toc342653046" class="anchor"><span id="_Toc127596838" class="anchor"><span id="_Toc127786459" class="anchor"><span id="_Toc127786775" class="anchor"><span id="_Toc127787091" class="anchor"><span id="_Toc127877765" class="anchor"><span id="_Toc128289836" class="anchor"><span id="_Toc128290229" class="anchor"><span id="_Toc439864175" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>SynIC Message Flags

  7:1     0
  ------- ----------------
  RsvdZ   MessagePending

  Bits   Description                           Meaning
  ------ ------------------------------------- -------------------------------------------------------
  7:1    RsvdP (value should be set to zero)   Reserved
  0      MessagePending                        One or more messages are pending in the message queue

The *MessagePending* flag indicates whether or not there are any
messages pending in the message queue of the synthetic interrupt source.
If there are, then an “end of message" must be performed by the guest
after emptying the message slot. This allows for opportunistic writes to
the EOM MSR (only when required). Note that this flag may be set by the
hypervisor upon message delivery or at any time afterwards. The flag
should be tested after the message slot has been emptied and if set,
then there are one or more pending messages and the “end of message"
should be performed.

typedef struct

{

UINT8 MessagePending:1;

UINT8 Reserved:7;

} HV\_MESSAGE\_FLAGS;

### <span id="_Toc342653047" class="anchor"><span id="_Toc130189833" class="anchor"><span id="_Toc130201049" class="anchor"><span id="_Toc130201365" class="anchor"><span id="_Toc130201686" class="anchor"><span id="_Toc131936775" class="anchor"><span id="_Toc133901239" class="anchor"><span id="_Toc137461113" class="anchor"><span id="_Toc139096628" class="anchor"><span id="_Toc139188551" class="anchor"><span id="_Toc139191414" class="anchor"><span id="_Toc140490466" class="anchor"><span id="_Toc140571368" class="anchor"><span id="_Toc141257641" class="anchor"><span id="_Toc141257968" class="anchor"><span id="_Toc141267496" class="anchor"><span id="_Toc141522514" class="anchor"><span id="_Toc141529602" class="anchor"><span id="_Toc141529919" class="anchor"><span id="_Toc141851526" class="anchor"><span id="_Toc141852460" class="anchor"><span id="_Toc141888004" class="anchor"><span id="_Toc141889844" class="anchor"><span id="_Toc141893513" class="anchor"><span id="_Toc142113366" class="anchor"><span id="_Toc142114394" class="anchor"><span id="_Toc142729611" class="anchor"><span id="_Toc142730895" class="anchor"><span id="_Toc142731268" class="anchor"><span id="_Toc142998635" class="anchor"><span id="_Toc143063727" class="anchor"><span id="_Toc143509837" class="anchor"><span id="_Toc143510284" class="anchor"><span id="_Toc144026316" class="anchor"><span id="_Toc144026647" class="anchor"><span id="_Toc144276290" class="anchor"><span id="_Toc144276634" class="anchor"><span id="_Toc144280222" class="anchor"><span id="_Toc144280568" class="anchor"><span id="_Toc144540783" class="anchor"><span id="_Toc144554666" class="anchor"><span id="_Toc144722287" class="anchor"><span id="_Ref144731939" class="anchor"><span id="_Toc145503749" class="anchor"><span id="_Toc145512191" class="anchor"><span id="_Toc145513214" class="anchor"><span id="_Toc145513598" class="anchor"><span id="_Toc222907377" class="anchor"><span id="_Toc342653048" class="anchor"><span id="_Toc439864176" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>SynIC Message Format

SynIC messages are of fixed size composed of a message header (which
includes the message type and information about where the message
originated) followed by the payload. Messages that are sent in response
to HvPostMessage contain the port ID. Intercept messages contain the
partition ID of the partition whose virtual processor generated the
intercept. Timer intercepts do not have an origination ID (that is, the
specified ID is zero).

\#define HV\_MESSAGE\_SIZE 256

\#define HV\_MESSAGE\_MAX\_PAYLOAD\_BYTE\_COUNT 240

\#define HV\_MESSAGE\_MAX\_PAYLOAD\_QWORD\_COUNT 30

typedef struct

{

HV\_MESSAGE\_TYPE MessageType;

UINT16 Reserved;

HV\_MESSAGE\_FLAGS MessageFlags;

UINT8 PayloadSize;

union

{

UINT64 OriginationId;

HV\_PARTITION\_ID Sender;

HV\_PORT\_ID Port;

};

} HV\_MESSAGE\_HEADER;

typedef struct

{

HV\_MESSAGE\_HEADER Header;

UINT64 Payload\[HV\_MESSAGE\_MAX\_PAYLOAD\_QWORD\_COUNT\];

} HV\_MESSAGE;

For a detailed description of the messages sent by the hypervisor, see
chapter 19.

### <span id="_Toc127596839" class="anchor"><span id="_Toc127786460" class="anchor"><span id="_Toc127786776" class="anchor"><span id="_Toc127787092" class="anchor"><span id="_Toc127877766" class="anchor"><span id="_Toc128289837" class="anchor"><span id="_Toc128290230" class="anchor"><span id="_Toc130189834" class="anchor"><span id="_Toc130201050" class="anchor"><span id="_Toc130201366" class="anchor"><span id="_Toc130201687" class="anchor"><span id="_Toc131936776" class="anchor"><span id="_Toc133901240" class="anchor"><span id="_Toc137461114" class="anchor"><span id="_Toc139096629" class="anchor"><span id="_Toc139188552" class="anchor"><span id="_Toc139191415" class="anchor"><span id="_Toc140490467" class="anchor"><span id="_Toc140571369" class="anchor"><span id="_Toc141257642" class="anchor"><span id="_Toc141257969" class="anchor"><span id="_Toc141267497" class="anchor"><span id="_Toc141522515" class="anchor"><span id="_Toc141529603" class="anchor"><span id="_Toc141529920" class="anchor"><span id="_Toc141851527" class="anchor"><span id="_Toc141852461" class="anchor"><span id="_Toc141888005" class="anchor"><span id="_Toc141889845" class="anchor"><span id="_Toc141893514" class="anchor"><span id="_Toc142113367" class="anchor"><span id="_Toc142114395" class="anchor"><span id="_Toc142729612" class="anchor"><span id="_Toc142730896" class="anchor"><span id="_Toc142731269" class="anchor"><span id="_Toc142998636" class="anchor"><span id="_Toc143063728" class="anchor"><span id="_Toc143509838" class="anchor"><span id="_Toc143510285" class="anchor"><span id="_Toc144026317" class="anchor"><span id="_Toc144026648" class="anchor"><span id="_Toc144276291" class="anchor"><span id="_Toc144276635" class="anchor"><span id="_Toc144280223" class="anchor"><span id="_Toc144280569" class="anchor"><span id="_Toc144540784" class="anchor"><span id="_Toc144554667" class="anchor"><span id="_Toc144722288" class="anchor"><span id="_Toc145503750" class="anchor"><span id="_Toc145512192" class="anchor"><span id="_Toc145513215" class="anchor"><span id="_Toc145513599" class="anchor"><span id="_Toc222907378" class="anchor"><span id="_Toc342653049" class="anchor"><span id="_Toc439864177" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>SynIC Event Flags

SynIC event flags are fixed-size bitwise arrays. They are numbered such
that the first byte of the array contains flags 0 through 7 (0 being the
least significant bit) and the second byte of the array contains flags 8
through 15 (8 being the least significant bit), and so on.

\#define HV\_EVENT\_FLAGS\_COUNT (256 \* 8)

\#define HV\_EVENT\_FLAGS\_BYTE\_COUNT 256

typedef struct

{

UINT8 Flags\[HV\_EVENT\_FLAGS\_BYTE\_COUNT\];

} HV\_SYNIC\_EVENT\_FLAGS;

### <span id="_Toc127596840" class="anchor"><span id="_Toc127786461" class="anchor"><span id="_Toc127786777" class="anchor"><span id="_Toc127787093" class="anchor"><span id="_Toc127877767" class="anchor"><span id="_Toc128289838" class="anchor"><span id="_Toc128290231" class="anchor"><span id="_Toc130189835" class="anchor"><span id="_Toc130201051" class="anchor"><span id="_Toc130201367" class="anchor"><span id="_Toc130201688" class="anchor"><span id="_Toc131936777" class="anchor"><span id="_Toc133901241" class="anchor"><span id="_Toc137461115" class="anchor"><span id="_Toc139096630" class="anchor"><span id="_Toc139188553" class="anchor"><span id="_Toc139191416" class="anchor"><span id="_Toc140490468" class="anchor"><span id="_Toc140571370" class="anchor"><span id="_Toc141257643" class="anchor"><span id="_Toc141257970" class="anchor"><span id="_Toc141267498" class="anchor"><span id="_Toc141522516" class="anchor"><span id="_Toc141529604" class="anchor"><span id="_Toc141529921" class="anchor"><span id="_Toc141851528" class="anchor"><span id="_Toc141852462" class="anchor"><span id="_Toc141888006" class="anchor"><span id="_Toc141889846" class="anchor"><span id="_Toc141893515" class="anchor"><span id="_Toc142113368" class="anchor"><span id="_Toc142114396" class="anchor"><span id="_Toc142729613" class="anchor"><span id="_Toc142730897" class="anchor"><span id="_Toc142731270" class="anchor"><span id="_Toc142998637" class="anchor"><span id="_Toc143063729" class="anchor"><span id="_Toc143509839" class="anchor"><span id="_Toc143510286" class="anchor"><span id="_Toc144026318" class="anchor"><span id="_Toc144026649" class="anchor"><span id="_Toc144276292" class="anchor"><span id="_Toc144276636" class="anchor"><span id="_Toc144280224" class="anchor"><span id="_Toc144280570" class="anchor"><span id="_Toc144540785" class="anchor"><span id="_Toc144554668" class="anchor"><span id="_Toc144722289" class="anchor"><span id="_Toc145503751" class="anchor"><span id="_Toc145512193" class="anchor"><span id="_Toc145513216" class="anchor"><span id="_Toc145513600" class="anchor"><span id="_Toc222907379" class="anchor"><span id="_Toc342653050" class="anchor"><span id="_Toc439864178" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Ports

Destination ports are identified by 32-bit IDs. The high 8 bits of the
ID are reserved and must be zero. All port IDs are unique within a
partition.

typedef union

{

UINT32 AsUint32;

struct

{

UINT32 Id:24;

UINT32 Reserved:8;

};

} HV\_PORT\_ID;

Three types of ports are supported: message ports, event ports, and
monitor ports. Message ports are valid for use with the HvPostMessage
hypercall. Event ports are valid for use with the HvSignalEvent
hypercall. Monitor ports are valid for use with monitor pages that are
monitored by the hypervisor and result in HvSignalEvent-based
notifications when appropriate.

enum HV\_PORT\_TYPE

{

HvPortTypeMessage = 1,

HvPortTypeEvent = 2,

HvPortTypeMonitor = 3

};

When a port is created, the following information is specified.

typedef struct

{

HV\_PORT\_TYPE PortType;

UINT32 ReservedZ;

union

{

struct

{

HV\_SYNIC\_SINT\_INDEX TargetSint;

HV\_VP\_INDEX TargetVp;

UINT64 ReservedZ;

} MessagePortInfo;

struct

{

HV\_SYNIC\_SINT\_INDEX TargetSint;

HV\_VP\_INDEX TargetVp;

UINT16 BaseFlagNumber;

UINT16 FlagCount;

UINT32 ReservedZ;

} EventPortInfo;

struct

{

HV\_GPA MonitorAddress;

UINT64 ReservedZ;

} MonitorPortInfo;

};

} HV\_PORT\_INFO;

### <span id="_Ref131009122" class="anchor"><span id="_Toc131936778" class="anchor"><span id="_Toc133901242" class="anchor"><span id="_Toc137461116" class="anchor"><span id="_Toc139096631" class="anchor"><span id="_Toc139188554" class="anchor"><span id="_Toc139191417" class="anchor"><span id="_Toc140490469" class="anchor"><span id="_Toc140571371" class="anchor"><span id="_Toc141257644" class="anchor"><span id="_Toc141257971" class="anchor"><span id="_Toc141267499" class="anchor"><span id="_Toc141522517" class="anchor"><span id="_Toc141529605" class="anchor"><span id="_Toc141529922" class="anchor"><span id="_Toc141851529" class="anchor"><span id="_Toc141852463" class="anchor"><span id="_Toc141888007" class="anchor"><span id="_Toc141889847" class="anchor"><span id="_Toc141893516" class="anchor"><span id="_Toc142113369" class="anchor"><span id="_Toc142114397" class="anchor"><span id="_Toc142729614" class="anchor"><span id="_Toc142730898" class="anchor"><span id="_Toc142731271" class="anchor"><span id="_Toc142998638" class="anchor"><span id="_Toc143063730" class="anchor"><span id="_Toc143509840" class="anchor"><span id="_Toc143510287" class="anchor"><span id="_Toc144026319" class="anchor"><span id="_Toc144026650" class="anchor"><span id="_Toc144276293" class="anchor"><span id="_Toc144276637" class="anchor"><span id="_Toc144280225" class="anchor"><span id="_Toc144280571" class="anchor"><span id="_Toc144540786" class="anchor"><span id="_Toc144554669" class="anchor"><span id="_Toc144722290" class="anchor"><span id="_Toc145503752" class="anchor"><span id="_Toc145512194" class="anchor"><span id="_Toc145513217" class="anchor"><span id="_Toc145513601" class="anchor"><span id="_Toc222907380" class="anchor"><span id="_Toc342653051" class="anchor"><span id="_Toc127596841" class="anchor"><span id="_Toc127786462" class="anchor"><span id="_Toc127786778" class="anchor"><span id="_Toc127787094" class="anchor"><span id="_Toc127877768" class="anchor"><span id="_Toc128289839" class="anchor"><span id="_Toc128290232" class="anchor"><span id="_Toc130189836" class="anchor"><span id="_Toc130201052" class="anchor"><span id="_Toc130201368" class="anchor"><span id="_Toc130201689" class="anchor"><span id="_Toc439864179" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Port Properties

Port properties provide a generic way to set or obtain certain
characteristics of a port. Properties are identified by a 32-bit code.
The associated property value is 64 bits in size.

typedef UINT64 HV\_PORT\_PROPERTY;

typedef HV\_PORT\_PROPERTY \*PHV\_PORT\_PROPERTY;

typedef enum

{

HvPortPropertyPostCount = 0x00000000,

HvPortPropertyPreferredTargetVp = 0x00000001,

HvPortPropertyMonitorAddress = 0x00000002,

HvPortPropertyUseRingBuffer = 0x00000003,

HvPortPropertyTargetVp = 0x00000004,

} HV\_PORT\_PROPERTY\_CODE;

1.  

  -----------------------------------------------------------------------------------------------------------
  1.     1.  
  ------ ----------------------------------------------------------------------------------------------------
  1.     1.  

  1.     1.  

  1.     1.  <span id="_Toc436731835" class="anchor"><span id="_Toc437513669" class="anchor"></span></span>
         
         

  1.     1.  <span id="_Toc436731838" class="anchor"><span id="_Toc437513672" class="anchor"></span></span>
         
         
  -----------------------------------------------------------------------------------------------------------

### <span id="_Toc342653052" class="anchor"><span id="_Toc131936779" class="anchor"><span id="_Toc133901243" class="anchor"><span id="_Toc137461117" class="anchor"><span id="_Toc139096632" class="anchor"><span id="_Toc139188555" class="anchor"><span id="_Toc139191418" class="anchor"><span id="_Toc140490470" class="anchor"><span id="_Toc140571372" class="anchor"><span id="_Toc141257645" class="anchor"><span id="_Toc141257972" class="anchor"><span id="_Toc141267500" class="anchor"><span id="_Toc141522518" class="anchor"><span id="_Toc141529606" class="anchor"><span id="_Toc141529923" class="anchor"><span id="_Toc141851530" class="anchor"><span id="_Toc141852464" class="anchor"><span id="_Toc141888008" class="anchor"><span id="_Toc141889848" class="anchor"><span id="_Toc141893517" class="anchor"><span id="_Toc142113370" class="anchor"><span id="_Toc142114398" class="anchor"><span id="_Toc142729615" class="anchor"><span id="_Toc142730899" class="anchor"><span id="_Toc142731272" class="anchor"><span id="_Toc142998639" class="anchor"><span id="_Toc143063731" class="anchor"><span id="_Toc143509841" class="anchor"><span id="_Toc143510288" class="anchor"><span id="_Toc144026320" class="anchor"><span id="_Toc144026651" class="anchor"><span id="_Toc144276294" class="anchor"><span id="_Toc144276638" class="anchor"><span id="_Toc144280226" class="anchor"><span id="_Toc144280572" class="anchor"><span id="_Toc144540787" class="anchor"><span id="_Toc144554670" class="anchor"><span id="_Toc144722291" class="anchor"><span id="_Toc145503753" class="anchor"><span id="_Toc145512195" class="anchor"><span id="_Toc145513218" class="anchor"><span id="_Toc145513602" class="anchor"><span id="_Toc222907381" class="anchor"><span id="_Toc342653053" class="anchor"><span id="_Toc439864180" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Connections

Connections are identified by 32-bit IDs. The high 8 bits are reserved
and must be zero. All connection IDs are unique within a partition.

typedef union

{

UINT32 AsUint32;

struct

{

UINT32 Id:24;

UINT32 Reserved:8;

};

} HV\_CONNECTION\_ID;

The hypervisor does not ascribe special meaning to any connection IDs.

### <span id="_Toc222907382" class="anchor"><span id="_Toc342653054" class="anchor"><span id="_Toc439864181" class="anchor"></span></span></span>Connection Information

The following structure contains the information that must be specified
when creating a connection:

typedef struct

{

HV\_PORT\_TYPE PortType;

UINT32 ReservedZ;

union

{

struct

{

UINT64 ReservedZ;

} MessageConnectionInfo;

struct

{

UINT64 ReservedZ;

} EventConnectionInfo;

struct

{

HV\_GPA MonitorAddress;

} MonitorConnectionInfo;

};

} HV\_CONNECTION\_INFO, \*PHV\_CONNECTION\_INFO;

#### <span id="_Ref157856031" class="anchor"><span id="_Toc222907383" class="anchor"><span id="_Toc342653055" class="anchor"></span></span></span>Monitored Notification Trigger Group

The monitored notification triggers group structure defines 32 triggers
per group. The structure has the following format:

typedef struct

{

UINT64 AsUINT64;

struct

{

UINT32 Pending;

UINT32 Armed;

};

} HV\_MONITOR\_TRIGGER\_GROUP, \*PHV\_MONITOR\_TRIGGER\_GROUP;

The 32 triggers are represented by two related arrays of bits: *Pending*
and *Armed*. Setting a trigger bit to 1in the *Pending* array indicates
to the hypervisor that the related notification should eventually
generate a signal event. The corresponding bit in the *Armed* array
should be set to 0 whenever the matching *Pending* bit is modified. The
*Armed* bit is used to ensure that a notification is deferred by at
least the latency specified for the notification. *Both of these bits
must be updated atomically.*<span id="_Ref157856092"
class="anchor"></span>

#### <span id="_Ref158103950" class="anchor"><span id="_Toc222907384" class="anchor"><span id="_Toc342653056" class="anchor"></span></span></span>Monitored Notification Parameters

Each trigger has a set of associated notification parameters that are
used by the hypervisor as inputs to the implicit HvSignalEvent hypercall
that the hypervisor invokes when appropriate. The parameter structure
has the following format:

typedef struct

{

HV\_CONNECTION\_ID ConnectionId;

UINT16 FlagNumber;

UINT16 ReservedZ;

} HV\_MONITOR\_PARAMETER, \*PHV\_MONITOR\_PARAMETER;

When the hypervisor detects that a monitored notification is pending, it
signals the event by making an internal call to the HvSignalEvent
hypercall and passing it the *ConnectionID* and *FlagNumber* members. If
signaling an event causes an error, the error is discarded; that is, the
internal HvSignalEvent call becomes a NOP.

### <span id="_Toc222907385" class="anchor"><span id="_Toc342653057" class="anchor"><span id="_Toc439864182" class="anchor"></span></span></span>Monitored Notification Page

Monitored notifications are defined in a *MNF overlay page*, which
supports four sets of monitored notification trigger groups. Each
individual 32-bit group can be enabled independently using the following
structure:

typedef union

{

UINT32 AsUINT32;

struct

{

UINT32 GroupEnable:4;

UINT32 MonitorDisabled:1;

UINT32 ReservedZ:27;

};

} HV\_MONITOR\_TRIGGER\_STATE, \*PHV\_MONITOR\_TRIGGER\_STATE;

GroupEnable and MonitorDisabled are described below.

The MNF overlay page has the following format:

typedef struct

{

HV\_MONITOR\_TRIGGER\_STATE TriggerState;

UINT32 Reserved1;

HV\_MONITOR\_TRIGGER\_GROUP TriggerGroup\[4\];

UINT8 Reserved2\[536\];

UINT16 Latency\[4\]\[32\];

UINT8 Reserved3\[256\];

HV\_MONITOR\_PARAMETER Parameter\[4\]\[32\];

UINT8 Reserved4\[1984\];

} HV\_MONITOR\_PAGE, \*PHV\_MONITOR\_PAGE;

typedef volatile HV\_MONITOR\_PAGE \*PVHV\_MONITOR\_PAGE;

*TriggerState* contains the *GroupEnable* and *MonitorDisabled* flags.
The *GroupEnable* flags are an array of 4 bits, each associated with a
trigger group. If *GroupEnable\[n\]* is set to one, the corresponding
*TriggerGroup\[n\]* is enabled. Although the *GroupEnable* flags can be
changed at any time, they are intended to be semi-static and are
typically used to drain pending notifications during a save or restore
process. The hypervisor inspects the group enable flags at varying
rates. If they are all disabled (set to zero), the hypervisor might
significantly reduce its inspection rate. The hypervisor inspects all of
the enabled monitored notifications approximately at the lowest latency
value specified for the monitors of each group.

The *MonitorDisabled* flag is set when the hypervisor is temporarily not
monitoring the monitor page. If the caller observes this condition, it
may trigger the read of the page by calling the HVSignalEvent hypercall.

*TriggerGroup* is an array of four trigger group structures. For
details, see section 17.8.9.1.

*Latency* is a hint; suggesting how often the hypervisor should inspect
the monitored notifications. The hypervisor might adjust it to be
smaller or larger than this value if doing so is either more efficient
or to conform to implementation-specific limitations. Latency is
specified in 100-nanosecond units.

*Parameter* is an array of notification parameters, one per trigger. The
hypervisor can monitor up to 128 notifications in groups of 32. For
details, see section 17.8.9.2 .

The *Reservedn* bits are reserved for use by the hypervisor. Changing
their value is boundedly undefined.

1.  <span id="_Toc130189837" class="anchor"><span id="_Toc130201053" class="anchor"><span id="_Toc130201369" class="anchor"><span id="_Toc130201690" class="anchor"><span id="_Toc131936780" class="anchor"><span id="_Toc133901244" class="anchor"><span id="_Toc137461118" class="anchor"><span id="_Toc139096633" class="anchor"><span id="_Toc139188556" class="anchor"><span id="_Toc139191419" class="anchor"><span id="_Toc140490471" class="anchor"><span id="_Toc140571373" class="anchor"><span id="_Toc141257646" class="anchor"><span id="_Toc141257973" class="anchor"><span id="_Toc141267501" class="anchor"><span id="_Toc141522519" class="anchor"><span id="_Toc141529607" class="anchor"><span id="_Toc141529924" class="anchor"><span id="_Toc141851531" class="anchor"><span id="_Toc141852465" class="anchor"><span id="_Toc141888009" class="anchor"><span id="_Toc141889849" class="anchor"><span id="_Toc141893518" class="anchor"><span id="_Toc142113371" class="anchor"><span id="_Toc142114399" class="anchor"><span id="_Toc142729616" class="anchor"><span id="_Toc142730900" class="anchor"><span id="_Toc142731273" class="anchor"><span id="_Toc142998640" class="anchor"><span id="_Toc143063732" class="anchor"><span id="_Toc143509842" class="anchor"><span id="_Toc143510289" class="anchor"><span id="_Toc144026321" class="anchor"><span id="_Toc144026652" class="anchor"><span id="_Toc144276295" class="anchor"><span id="_Toc144276639" class="anchor"><span id="_Toc144280227" class="anchor"><span id="_Toc144280573" class="anchor"><span id="_Toc144540788" class="anchor"><span id="_Toc144554671" class="anchor"><span id="_Toc144722292" class="anchor"><span id="_Toc145503754" class="anchor"><span id="_Toc145512196" class="anchor"><span id="_Toc145513219" class="anchor"><span id="_Toc145513603" class="anchor"><span id="_Toc222907386" class="anchor"><span id="_Toc342653058" class="anchor"><span id="_Toc439864183" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Inter-Partition Communication Interfaces
    ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

    1.  ### <span id="_Toc127596843" class="anchor"><span id="_Toc127786464" class="anchor"><span id="_Toc127786780" class="anchor"><span id="_Toc127787096" class="anchor"><span id="_Toc127877770" class="anchor"><span id="_Toc128289840" class="anchor"><span id="_Toc128290233" class="anchor"><span id="_Toc130189838" class="anchor"><span id="_Toc130201054" class="anchor"><span id="_Toc130201370" class="anchor"><span id="_Toc130201691" class="anchor"><span id="_Ref130203169" class="anchor"><span id="_Ref130718560" class="anchor"><span id="_Toc131936781" class="anchor"><span id="_Toc133901245" class="anchor"><span id="_Ref136333564" class="anchor"><span id="_Toc137461119" class="anchor"><span id="_Toc139096634" class="anchor"><span id="_Toc139188557" class="anchor"><span id="_Toc139191420" class="anchor"><span id="_Toc140490472" class="anchor"><span id="_Toc140571374" class="anchor"><span id="_Toc141257647" class="anchor"><span id="_Toc141257974" class="anchor"><span id="_Toc141267502" class="anchor"><span id="_Toc141522520" class="anchor"><span id="_Toc141529608" class="anchor"><span id="_Toc141529925" class="anchor"><span id="_Toc141851532" class="anchor"><span id="_Toc141852466" class="anchor"><span id="_Toc141888010" class="anchor"><span id="_Toc141889850" class="anchor"><span id="_Toc141893519" class="anchor"><span id="_Toc142113372" class="anchor"><span id="_Toc142114400" class="anchor"><span id="_Toc142729617" class="anchor"><span id="_Toc142730901" class="anchor"><span id="_Toc142731274" class="anchor"><span id="_Toc142998641" class="anchor"><span id="_Toc143063733" class="anchor"><span id="_Toc143509843" class="anchor"><span id="_Toc143510290" class="anchor"><span id="_Toc144026322" class="anchor"><span id="_Toc144026653" class="anchor"><span id="_Toc144276296" class="anchor"><span id="_Toc144276640" class="anchor"><span id="_Toc144280228" class="anchor"><span id="_Toc144280574" class="anchor"><span id="_Toc144540789" class="anchor"><span id="_Toc144554672" class="anchor"><span id="_Toc144722293" class="anchor"><span id="_Toc145503755" class="anchor"><span id="_Toc145512197" class="anchor"><span id="_Toc145513220" class="anchor"><span id="_Toc145513604" class="anchor"><span id="_Toc222907387" class="anchor"><span id="_Toc342653059" class="anchor"><span id="_Toc439858173" class="anchor"><span id="_Toc110172841" class="anchor"><span id="_Toc439864184" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>

##### 

<span id="_Toc437513681" class="anchor"></span>

<span id="_Toc437513689" class="anchor"></span>

##### 

  ------------------------------------------------- ------------------------------------------------- --
  <span id="_Toc437513693" class="anchor"></span>
  ------------------------------------------------- ------------------------------------------------- --

##### 

  -- -- --
        
     
  -- -- --

<span id="_Toc437513739" class="anchor"></span>

<span id="_Toc437513743" class="anchor"></span>

  -- -- -- --
        
        
  -- -- -- --

  -- -- --
     
     
  -- -- --

-   -   -   

  ------------------------------------------------- --
                                                    
                                                    
  <span id="_Toc437513798" class="anchor"></span>   
  <span id="_Toc437513801" class="anchor"></span>   
                                                    
  <span id="_Toc437513807" class="anchor"></span>   
                                                    
  <span id="_Toc437513814" class="anchor"></span>   
  <span id="_Toc437513817" class="anchor"></span>   
  <span id="_Toc437513820" class="anchor"></span>   
  <span id="_Toc437513823" class="anchor"></span>   
  <span id="_Toc437513826" class="anchor"></span>   
                                                    
                                                    
  <span id="_Toc437513835" class="anchor"></span>   
                                                    
                                                    
  ------------------------------------------------- --

### <span id="_Toc127596844" class="anchor"><span id="_Toc127786465" class="anchor"><span id="_Toc127786781" class="anchor"><span id="_Toc127787097" class="anchor"><span id="_Toc127877771" class="anchor"><span id="_Toc128289841" class="anchor"><span id="_Toc128290234" class="anchor"><span id="_Toc130189839" class="anchor"><span id="_Toc130201055" class="anchor"><span id="_Toc130201371" class="anchor"><span id="_Toc130201692" class="anchor"><span id="_Ref130718533" class="anchor"><span id="_Ref130720618" class="anchor"><span id="_Toc131936782" class="anchor"><span id="_Toc133901246" class="anchor"><span id="_Toc137461120" class="anchor"><span id="_Toc139096635" class="anchor"><span id="_Toc139188558" class="anchor"><span id="_Toc139191421" class="anchor"><span id="_Toc140490473" class="anchor"><span id="_Toc140571375" class="anchor"><span id="_Toc141257648" class="anchor"><span id="_Toc141257975" class="anchor"><span id="_Toc141267503" class="anchor"><span id="_Toc141522521" class="anchor"><span id="_Toc141529609" class="anchor"><span id="_Toc141529926" class="anchor"><span id="_Toc141851533" class="anchor"><span id="_Toc141852467" class="anchor"><span id="_Toc141888011" class="anchor"><span id="_Toc141889851" class="anchor"><span id="_Toc141893520" class="anchor"><span id="_Toc142113373" class="anchor"><span id="_Toc142114401" class="anchor"><span id="_Toc142729618" class="anchor"><span id="_Toc142730902" class="anchor"><span id="_Toc142731275" class="anchor"><span id="_Toc142998642" class="anchor"><span id="_Toc143063734" class="anchor"><span id="_Toc143509844" class="anchor"><span id="_Toc143510291" class="anchor"><span id="_Toc144026323" class="anchor"><span id="_Toc144026654" class="anchor"><span id="_Toc144276297" class="anchor"><span id="_Toc144276641" class="anchor"><span id="_Toc144280229" class="anchor"><span id="_Toc144280575" class="anchor"><span id="_Toc144540790" class="anchor"><span id="_Toc144554673" class="anchor"><span id="_Toc144722294" class="anchor"><span id="_Toc145503756" class="anchor"><span id="_Toc145512198" class="anchor"><span id="_Toc145513221" class="anchor"><span id="_Toc145513605" class="anchor"><span id="_Toc222907388" class="anchor"><span id="_Toc342653063" class="anchor"><span id="_Toc439858174" class="anchor"><span id="_Toc439864185" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>

##### 

<span id="_Toc437513847" class="anchor"></span>

<span id="_Toc437513853" class="anchor"></span>

##### 

  ------------------------------------------------- -- --
  <span id="_Toc437513857" class="anchor"></span>
  ------------------------------------------------- -- --

##### 

-   -   -   

  -- --
     
     
     
     
  -- --

### <span id="_Toc127596845" class="anchor"><span id="_Toc127786466" class="anchor"><span id="_Toc127786782" class="anchor"><span id="_Toc127787098" class="anchor"><span id="_Toc127877772" class="anchor"><span id="_Toc128289842" class="anchor"><span id="_Toc128290235" class="anchor"><span id="_Toc130189840" class="anchor"><span id="_Toc130201056" class="anchor"><span id="_Toc130201372" class="anchor"><span id="_Toc130201693" class="anchor"><span id="_Toc131936783" class="anchor"><span id="_Toc133901247" class="anchor"><span id="_Toc137461121" class="anchor"><span id="_Toc139096636" class="anchor"><span id="_Toc139188559" class="anchor"><span id="_Toc139191422" class="anchor"><span id="_Toc140490474" class="anchor"><span id="_Toc140571376" class="anchor"><span id="_Toc141257649" class="anchor"><span id="_Toc141257976" class="anchor"><span id="_Toc141267504" class="anchor"><span id="_Toc141522522" class="anchor"><span id="_Toc141529610" class="anchor"><span id="_Toc141529927" class="anchor"><span id="_Toc141851534" class="anchor"><span id="_Toc141852468" class="anchor"><span id="_Toc141888012" class="anchor"><span id="_Toc141889852" class="anchor"><span id="_Toc141893521" class="anchor"><span id="_Toc142113374" class="anchor"><span id="_Toc142114402" class="anchor"><span id="_Toc142729619" class="anchor"><span id="_Toc142730903" class="anchor"><span id="_Toc142731276" class="anchor"><span id="_Toc142998643" class="anchor"><span id="_Toc143063735" class="anchor"><span id="_Toc143509845" class="anchor"><span id="_Toc143510292" class="anchor"><span id="_Toc144026324" class="anchor"><span id="_Toc144026655" class="anchor"><span id="_Toc144276298" class="anchor"><span id="_Toc144276642" class="anchor"><span id="_Toc144280230" class="anchor"><span id="_Toc144280576" class="anchor"><span id="_Toc144540791" class="anchor"><span id="_Toc144554674" class="anchor"><span id="_Toc144722295" class="anchor"><span id="_Toc145503757" class="anchor"><span id="_Toc145512199" class="anchor"><span id="_Toc145513222" class="anchor"><span id="_Toc145513606" class="anchor"><span id="_Toc222907389" class="anchor"><span id="_Toc342653067" class="anchor"><span id="_Toc439858175" class="anchor"><span id="_Toc439864186" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>

##### 

<span id="_Toc437513902" class="anchor"></span>

<span id="_Toc437513906" class="anchor"></span>

<span id="_Toc437513911" class="anchor"></span>

##### 

  ------------------------------------------------- -- ------------------------------------------------- -------------------------------------------------
  <span id="_Toc437513915" class="anchor"></span>
  ------------------------------------------------- -- ------------------------------------------------- -------------------------------------------------

##### 

  <span id="_Toc437513948" class="anchor"></span>   
  ------------------------------------------------- --

<span id="_Toc437513951" class="anchor"></span>

  <span id="_Toc437513953" class="anchor"></span>   
  ------------------------------------------------- --

<span id="_Toc437513956" class="anchor"></span>

  <span id="_Toc437513958" class="anchor"></span>   
  ------------------------------------------------- --

<span id="_Toc437513961" class="anchor"></span>

<span id="_Toc437513963" class="anchor"></span>

-   -   -   

  ------------------------------------------------- --
                                                    
                                                    
  <span id="_Toc437513982" class="anchor"></span>   
  <span id="_Toc437513985" class="anchor"></span>   
                                                    
  <span id="_Toc437513991" class="anchor"></span>   
                                                    
  <span id="_Toc437513997" class="anchor"></span>   
  <span id="_Toc437514000" class="anchor"></span>   
  <span id="_Toc437514003" class="anchor"></span>   
  <span id="_Toc437514006" class="anchor"></span>   
                                                    
                                                    
                                                    
  <span id="_Toc437514018" class="anchor"></span>   
                                                    
                                                    
  ------------------------------------------------- --

### <span id="_Toc131936784" class="anchor"><span id="_Toc133901248" class="anchor"><span id="_Toc137461122" class="anchor"><span id="_Toc139096637" class="anchor"><span id="_Toc139188560" class="anchor"><span id="_Toc139191423" class="anchor"><span id="_Toc140490475" class="anchor"><span id="_Toc140571377" class="anchor"><span id="_Toc141257650" class="anchor"><span id="_Toc141257977" class="anchor"><span id="_Toc141267505" class="anchor"><span id="_Toc141522523" class="anchor"><span id="_Toc141529611" class="anchor"><span id="_Toc141529928" class="anchor"><span id="_Toc141851535" class="anchor"><span id="_Toc141852469" class="anchor"><span id="_Toc141888013" class="anchor"><span id="_Toc141889853" class="anchor"><span id="_Toc141893522" class="anchor"><span id="_Toc142113375" class="anchor"><span id="_Toc142114403" class="anchor"><span id="_Toc142729620" class="anchor"><span id="_Toc142730904" class="anchor"><span id="_Toc142731277" class="anchor"><span id="_Toc142998644" class="anchor"><span id="_Toc143063736" class="anchor"><span id="_Toc143509846" class="anchor"><span id="_Toc143510293" class="anchor"><span id="_Toc144026325" class="anchor"><span id="_Toc144026656" class="anchor"><span id="_Toc144276299" class="anchor"><span id="_Toc144276643" class="anchor"><span id="_Toc144280231" class="anchor"><span id="_Toc144280577" class="anchor"><span id="_Toc144540792" class="anchor"><span id="_Toc144554675" class="anchor"><span id="_Toc144722296" class="anchor"><span id="_Toc145503758" class="anchor"><span id="_Toc145512200" class="anchor"><span id="_Toc145513223" class="anchor"><span id="_Toc145513607" class="anchor"><span id="_Toc222907390" class="anchor"><span id="_Toc342653071" class="anchor"><span id="_Toc439858176" class="anchor"><span id="_Toc127596846" class="anchor"><span id="_Toc127786467" class="anchor"><span id="_Toc127786783" class="anchor"><span id="_Toc127787099" class="anchor"><span id="_Toc127877773" class="anchor"><span id="_Toc128289843" class="anchor"><span id="_Toc128290236" class="anchor"><span id="_Toc130189841" class="anchor"><span id="_Toc130201057" class="anchor"><span id="_Toc130201373" class="anchor"><span id="_Toc130201694" class="anchor"><span id="_Ref130720584" class="anchor"><span id="_Toc439864187" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>

##### 

<span id="_Toc437514030" class="anchor"></span>

<span id="_Toc437514038" class="anchor"></span>

##### 

  ------------------------------------------------- -- --
  <span id="_Toc437514042" class="anchor"></span>
  ------------------------------------------------- -- --

##### 

-   -   -   

  ------------------------------------------------- --
                                                    
  <span id="_Toc437514082" class="anchor"></span>   
                                                    
                                                    
                                                    
  ------------------------------------------------- --

### <span id="_Toc222907391" class="anchor"><span id="_Toc342653075" class="anchor"><span id="_Toc439858177" class="anchor"><span id="_Toc439864188" class="anchor"></span></span></span></span>

##### 

<span id="_Toc437514097" class="anchor"></span>

<span id="_Toc437514106" class="anchor"></span>

##### 

  ------------------------------------------------- -- -------------------------------------------------
  <span id="_Toc437514110" class="anchor"></span>
  ------------------------------------------------- -- -------------------------------------------------

##### 

-   -   -   

  ------------------------------------------------- --
                                                    
  <span id="_Toc437514155" class="anchor"></span>   
                                                    
                                                    
                                                    
  ------------------------------------------------- --

### <span id="_Toc342653079" class="anchor"><span id="_Toc131936785" class="anchor"><span id="_Toc133901249" class="anchor"><span id="_Toc137461123" class="anchor"><span id="_Toc139096638" class="anchor"><span id="_Toc139188561" class="anchor"><span id="_Toc139191424" class="anchor"><span id="_Toc140490476" class="anchor"><span id="_Toc140571378" class="anchor"><span id="_Toc141257651" class="anchor"><span id="_Toc141257978" class="anchor"><span id="_Toc141267506" class="anchor"><span id="_Toc141522524" class="anchor"><span id="_Toc141529612" class="anchor"><span id="_Toc141529929" class="anchor"><span id="_Toc141851536" class="anchor"><span id="_Toc141852470" class="anchor"><span id="_Toc141888014" class="anchor"><span id="_Toc141889854" class="anchor"><span id="_Toc141893523" class="anchor"><span id="_Toc142113376" class="anchor"><span id="_Toc142114404" class="anchor"><span id="_Toc142729621" class="anchor"><span id="_Toc142730905" class="anchor"><span id="_Toc142731278" class="anchor"><span id="_Toc142998645" class="anchor"><span id="_Toc143063737" class="anchor"><span id="_Toc143509847" class="anchor"><span id="_Toc143510294" class="anchor"><span id="_Toc144026326" class="anchor"><span id="_Toc144026657" class="anchor"><span id="_Toc144276300" class="anchor"><span id="_Toc144276644" class="anchor"><span id="_Toc144280232" class="anchor"><span id="_Toc144280578" class="anchor"><span id="_Toc144540793" class="anchor"><span id="_Toc144554676" class="anchor"><span id="_Toc144722297" class="anchor"><span id="_Toc145503759" class="anchor"><span id="_Toc145512201" class="anchor"><span id="_Toc145513224" class="anchor"><span id="_Toc145513608" class="anchor"><span id="_Toc222907392" class="anchor"><span id="_Toc342653080" class="anchor"><span id="_Toc439858178" class="anchor"><span id="_Toc439864189" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>

##### 

<span id="_Toc437514170" class="anchor"></span>

<span id="_Toc437514176" class="anchor"></span>

##### 

  ------------------------------------------------- -- --
  <span id="_Toc437514180" class="anchor"></span>
  ------------------------------------------------- -- --

##### 

-   -   -   

  -- --
     
     
     
     
  -- --

### <span id="_Toc127596847" class="anchor"><span id="_Toc127786468" class="anchor"><span id="_Toc127786784" class="anchor"><span id="_Toc127787100" class="anchor"><span id="_Toc127877774" class="anchor"><span id="_Toc128289844" class="anchor"><span id="_Toc128290237" class="anchor"><span id="_Toc130189842" class="anchor"><span id="_Toc130201058" class="anchor"><span id="_Toc130201374" class="anchor"><span id="_Toc130201695" class="anchor"><span id="_Toc131936786" class="anchor"><span id="_Toc133901250" class="anchor"><span id="_Toc137461124" class="anchor"><span id="_Toc139096639" class="anchor"><span id="_Toc139188562" class="anchor"><span id="_Toc139191425" class="anchor"><span id="_Toc140490477" class="anchor"><span id="_Toc140571379" class="anchor"><span id="_Toc141257652" class="anchor"><span id="_Toc141257979" class="anchor"><span id="_Toc141267507" class="anchor"><span id="_Toc141522525" class="anchor"><span id="_Toc141529613" class="anchor"><span id="_Toc141529930" class="anchor"><span id="_Toc141851537" class="anchor"><span id="_Toc141852471" class="anchor"><span id="_Toc141888015" class="anchor"><span id="_Toc141889855" class="anchor"><span id="_Toc141893524" class="anchor"><span id="_Toc142113377" class="anchor"><span id="_Toc142114405" class="anchor"><span id="_Toc142729622" class="anchor"><span id="_Toc142730906" class="anchor"><span id="_Toc142731279" class="anchor"><span id="_Toc142998646" class="anchor"><span id="_Toc143063738" class="anchor"><span id="_Toc143509848" class="anchor"><span id="_Toc143510295" class="anchor"><span id="_Toc144026327" class="anchor"><span id="_Toc144026658" class="anchor"><span id="_Toc144276301" class="anchor"><span id="_Toc144276645" class="anchor"><span id="_Toc144280233" class="anchor"><span id="_Toc144280579" class="anchor"><span id="_Toc144540794" class="anchor"><span id="_Toc144554677" class="anchor"><span id="_Toc144722298" class="anchor"><span id="_Toc145503760" class="anchor"><span id="_Toc145512202" class="anchor"><span id="_Toc145513225" class="anchor"><span id="_Toc145513609" class="anchor"><span id="_Toc222907393" class="anchor"><span id="_Toc342653084" class="anchor"><span id="_Toc439864190" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>HvPostMessage

The HvPostMessage hypercall attempts to post (that is, send
asynchronously) a message to the specified connection, which has an
associated destination port.

##### Wrapper Interface

HV\_STATUS

HvPostMessage(

\_\_in HV\_CONNECTION\_ID ConnectionId,

\_\_in HV\_MESSAGE\_TYPE MessageType,

\_\_in UINT32 PayloadSize,

\_\_in\_ecount(PayloadSize)

PCVOID Message

);

##### Native Interface

  HvPostMessage
  ------------------ ------------------------- -----------------------
  Input Parameters
  0
  8
  16
  …
  248

##### Description

If the message is successfully posted, then it will be queued for
delivery to a virtual processor within the partition associated with the
port.

For details about message delivery, see section 17.

Input Parameters

*ConnectionId* specifies the ID of the connection created by calling
HvConnectPort.

*MessageType* specifies the message type that will appear within the
message header. The caller can specify any 32-bit message type whose
most significant bit is cleared, with the exception of zero. Message
types with the high bit set are reserved for use by the hypervisor.

*PayloadSize* specifies the number of bytes that are included in the
message.

*Message* specifies the payload of the message—up to 240 bytes total.
Only the first *n* bytes are actually sent to the destination partition,
where *n* is provided in the *PayloadSize* parameter.

Output Parameters

None.

Restrictions

-   The partition that is the target of the connection must be in the
    “active" state.

Return Values

  Status code                           Error condition
  ------------------------------------- -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  HV\_STATUS\_ACCESS\_DENIED            The caller’s partition does not possess the *PostMessages* privilege.
  HV\_STATUS\_INVALID\_CONNECTION\_ID   The specified connection ID is invalid.
  HV\_STATUS\_INVALID\_PORT\_ID         The port associated with the specified connection has been deleted.
                                        The port associated with the specified connection belongs to a partition that is not in the “active" state.
                                        The port associated with the specified connection is not a "message" type port.
  HV\_STATUS\_INVALID\_PARAMETER        The most significant bit of the specified message type is set.
                                        The *MessageType* parameter specifies a value of zero.
                                        The specified payload size exceeds 240 bytes.
  HV\_STATUS\_INSUFFICIENT\_BUFFERS     The port has no available guest message buffers.
  HV\_STATUS\_INVALID\_VP\_INDEX        The target VP no longer exists or there are no available VPs to which the message can be posted.
  HV\_STATUS\_INVALID\_SYNIC\_STATE     The target VP’s SynIC is disabled and cannot accept posted messages. For ports targeted at HV\_ANY\_VP, this indicates that the SynIC of all of the partition’s VPs are disabled.
                                        The target VP’s SIM page is disabled. For ports targeted at HV\_ANY\_VP, this indicates that the SIM page of all of the partition’s VPs are disabled.

### <span id="_Toc130721754" class="anchor"><span id="_Toc130888236" class="anchor"><span id="_Toc130978568" class="anchor"><span id="_Toc131014244" class="anchor"><span id="_Toc131846459" class="anchor"><span id="_Toc131929464" class="anchor"><span id="_Toc131936787" class="anchor"><span id="_Toc130721755" class="anchor"><span id="_Toc130888237" class="anchor"><span id="_Toc130978569" class="anchor"><span id="_Toc131014245" class="anchor"><span id="_Toc131846460" class="anchor"><span id="_Toc131929465" class="anchor"><span id="_Toc131936788" class="anchor"><span id="_Toc130721758" class="anchor"><span id="_Toc130888240" class="anchor"><span id="_Toc130978572" class="anchor"><span id="_Toc131014248" class="anchor"><span id="_Toc131846463" class="anchor"><span id="_Toc131929468" class="anchor"><span id="_Toc131936791" class="anchor"><span id="_Toc130721760" class="anchor"><span id="_Toc130888242" class="anchor"><span id="_Toc130978574" class="anchor"><span id="_Toc131014250" class="anchor"><span id="_Toc131846465" class="anchor"><span id="_Toc131929470" class="anchor"><span id="_Toc131936793" class="anchor"><span id="_Toc130721761" class="anchor"><span id="_Toc130888243" class="anchor"><span id="_Toc130978575" class="anchor"><span id="_Toc131014251" class="anchor"><span id="_Toc131846466" class="anchor"><span id="_Toc131929471" class="anchor"><span id="_Toc131936794" class="anchor"><span id="_Toc130721762" class="anchor"><span id="_Toc130888244" class="anchor"><span id="_Toc130978576" class="anchor"><span id="_Toc131014252" class="anchor"><span id="_Toc131846467" class="anchor"><span id="_Toc131929472" class="anchor"><span id="_Toc131936795" class="anchor"><span id="_Toc130721765" class="anchor"><span id="_Toc130888247" class="anchor"><span id="_Toc130978579" class="anchor"><span id="_Toc131014255" class="anchor"><span id="_Toc131846470" class="anchor"><span id="_Toc131929475" class="anchor"><span id="_Toc131936798" class="anchor"><span id="_Toc130721774" class="anchor"><span id="_Toc130888256" class="anchor"><span id="_Toc130978588" class="anchor"><span id="_Toc131014264" class="anchor"><span id="_Toc131846479" class="anchor"><span id="_Toc131929484" class="anchor"><span id="_Toc131936807" class="anchor"><span id="_Toc130721783" class="anchor"><span id="_Toc130888265" class="anchor"><span id="_Toc130978597" class="anchor"><span id="_Toc131014273" class="anchor"><span id="_Toc131846488" class="anchor"><span id="_Toc131929493" class="anchor"><span id="_Toc131936816" class="anchor"><span id="_Toc127596849" class="anchor"><span id="_Toc127786470" class="anchor"><span id="_Toc127786786" class="anchor"><span id="_Toc127787102" class="anchor"><span id="_Toc127877776" class="anchor"><span id="_Toc128289846" class="anchor"><span id="_Toc128290239" class="anchor"><span id="_Toc130189844" class="anchor"><span id="_Toc130201060" class="anchor"><span id="_Toc130201376" class="anchor"><span id="_Toc130201697" class="anchor"><span id="_Toc131936827" class="anchor"><span id="_Toc133901251" class="anchor"><span id="_Toc137461125" class="anchor"><span id="_Toc139096640" class="anchor"><span id="_Toc139188563" class="anchor"><span id="_Toc139191426" class="anchor"><span id="_Toc140490478" class="anchor"><span id="_Toc140571380" class="anchor"><span id="_Toc141257653" class="anchor"><span id="_Toc141257980" class="anchor"><span id="_Toc141267508" class="anchor"><span id="_Toc141522526" class="anchor"><span id="_Toc141529614" class="anchor"><span id="_Toc141529931" class="anchor"><span id="_Toc141851538" class="anchor"><span id="_Toc141852472" class="anchor"><span id="_Toc141888016" class="anchor"><span id="_Toc141889856" class="anchor"><span id="_Toc141893525" class="anchor"><span id="_Toc142113378" class="anchor"><span id="_Toc142114406" class="anchor"><span id="_Toc142729623" class="anchor"><span id="_Toc142730907" class="anchor"><span id="_Toc142731280" class="anchor"><span id="_Toc142998647" class="anchor"><span id="_Toc143063739" class="anchor"><span id="_Toc143509849" class="anchor"><span id="_Toc143510296" class="anchor"><span id="_Toc144026328" class="anchor"><span id="_Toc144026659" class="anchor"><span id="_Toc144276302" class="anchor"><span id="_Toc144276646" class="anchor"><span id="_Toc144280234" class="anchor"><span id="_Toc144280580" class="anchor"><span id="_Toc144540795" class="anchor"><span id="_Toc144554678" class="anchor"><span id="_Toc144722299" class="anchor"><span id="_Toc145503761" class="anchor"><span id="_Toc145512203" class="anchor"><span id="_Toc145513226" class="anchor"><span id="_Toc145513610" class="anchor"><span id="_Toc222907394" class="anchor"><span id="_Toc342653088" class="anchor"><span id="_Toc439864191" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>HvSignalEvent

The HvSignalEvent hypercall signals an event in a partition that owns
the port associated with the specified connection.

##### Wrapper Interface

HV\_STATUS

HvSignalEvent(

\_\_in HV\_CONNECTION\_ID ConnectionId,

\_\_in UINT16 FlagNumber

);

##### Native Interface

  HvSignalEvent
  ------------------------ -------------------- ------------ -----------
  Input Parameter Header
  0

##### Description

The event is signaled by setting a bit within the SIEF page of one of
the receive partition’s virtual processors.

The caller specifies a relative flag number. The actual SIEF bit number
is calculated by the hypervisor by adding the specified flag number to
the base flag number associated with the port.

Input Parameters

*ConnectionId* specifies the ID of the connection.

*FlagNumber* specifies the relative index of the event flag that the
caller wants to set within the target SIEF area. This number is relative
to the base flag number associated with the port.

Output Parameters

None.

Restrictions

-   The partition that is the target of the connection must be in the
    “active" state.

Return Values

  Status code                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        Error condition
  ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  HV\_STATUS\_ACCESS\_DENIED                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         The caller’s partition does not possess the *SignalEvents* privilege.
  HV\_STATUS\_INVALID\_CONNECTION\_ID                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                The specified connection ID is invalid.
  HV\_STATUS\_INVALID\_PORT\_ID                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      The port associated with the specified connection has been deleted.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     The port associated with the specified connection belongs to a partition that is not in the “active" state.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     The port associated with the specified connection is not an "event" type port.
  HV\_STATUS\_INVALID\_PARAMETER                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     The specified flag number is greater than or equal to the port’s flag count.
  HV\_STATUS\_INVALID\_VP\_INDEX                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     The target VP no longer exists or there are no available VPs to which the message can be posted.
  <span id="_Toc130721795" class="anchor"><span id="_Toc130888277" class="anchor"><span id="_Toc130978609" class="anchor"><span id="_Toc131014285" class="anchor"><span id="_Toc131846500" class="anchor"><span id="_Toc131929505" class="anchor"><span id="_Toc131936828" class="anchor"><span id="_Toc130721796" class="anchor"><span id="_Toc130888278" class="anchor"><span id="_Toc130978610" class="anchor"><span id="_Toc131014286" class="anchor"><span id="_Toc131846501" class="anchor"><span id="_Toc131929506" class="anchor"><span id="_Toc131936829" class="anchor"><span id="_Toc130721803" class="anchor"><span id="_Toc130888285" class="anchor"><span id="_Toc130978617" class="anchor"><span id="_Toc131014293" class="anchor"><span id="_Toc131846508" class="anchor"><span id="_Toc131929513" class="anchor"><span id="_Toc131936836" class="anchor"><span id="_Toc130721804" class="anchor"><span id="_Toc130888286" class="anchor"><span id="_Toc130978618" class="anchor"><span id="_Toc131014294" class="anchor"><span id="_Toc131846509" class="anchor"><span id="_Toc131929514" class="anchor"><span id="_Toc131936837" class="anchor"><span id="_Toc130721805" class="anchor"><span id="_Toc130888287" class="anchor"><span id="_Toc130978619" class="anchor"><span id="_Toc131014295" class="anchor"><span id="_Toc131846510" class="anchor"><span id="_Toc131929515" class="anchor"><span id="_Toc131936838" class="anchor"><span id="_Toc130721808" class="anchor"><span id="_Toc130888290" class="anchor"><span id="_Toc130978622" class="anchor"><span id="_Toc131014298" class="anchor"><span id="_Toc131846513" class="anchor"><span id="_Toc131929518" class="anchor"><span id="_Toc131936841" class="anchor"><span id="_Toc130721826" class="anchor"><span id="_Toc130888308" class="anchor"><span id="_Toc130978640" class="anchor"><span id="_Toc131014316" class="anchor"><span id="_Toc131846531" class="anchor"><span id="_Toc131929536" class="anchor"><span id="_Toc131936859" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>HV\_STATUS\_INVALID\_SYNIC\_STATE   The target VP’s SynIC is disabled and cannot accept signaled events. For ports targeted at HV\_ANY\_VP, this indicates that the SynIC of all of the partition’s VPs are disabled.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     The target VP’s SIEF page is disabled. For ports targeted at HV\_ANY\_VP, this indicates that the SIEF page of all of the partition’s VPs are disabled.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     The target SINTx is masked.

### 

### 

### 

### 

### 

### 

### 

### 

### 

### 

### 

  ### 
  ------ ------ ------ ------
  ### 
  ### 
  ### 

### 

### 

### 

### 

### 

### 

### 

### 

### 

### 

### 

  ###    ### 
  ------ ------
  ###    ### 
  ###    ### 
  ###    ### 
  ###    ### 
  ###    ### 
  ###    ### 
  ###    ### 
  ###    ### 
  ###    ### 

### 

1.  <span id="_Toc127596851" class="anchor"><span id="_Toc127786472" class="anchor"><span id="_Toc127786788" class="anchor"><span id="_Toc127787104" class="anchor"><span id="_Toc127877778" class="anchor"><span id="_Toc128289848" class="anchor"><span id="_Toc128290241" class="anchor"><span id="_Toc130189846" class="anchor"><span id="_Toc130201062" class="anchor"><span id="_Toc130201378" class="anchor"><span id="_Toc130201699" class="anchor"><span id="_Ref130718654" class="anchor"><span id="_Ref130722070" class="anchor"><span id="_Toc131936891" class="anchor"><span id="_Toc133901252" class="anchor"><span id="_Toc137461126" class="anchor"><span id="_Toc139096641" class="anchor"><span id="_Toc139188564" class="anchor"><span id="_Toc139191427" class="anchor"><span id="_Toc140490479" class="anchor"><span id="_Toc140571381" class="anchor"><span id="_Toc141257654" class="anchor"><span id="_Toc141257981" class="anchor"><span id="_Toc141267509" class="anchor"><span id="_Toc141522527" class="anchor"><span id="_Toc141529615" class="anchor"><span id="_Toc141529932" class="anchor"><span id="_Toc141851539" class="anchor"><span id="_Toc141852473" class="anchor"><span id="_Toc141888017" class="anchor"><span id="_Toc141889857" class="anchor"><span id="_Toc141893526" class="anchor"><span id="_Toc142113379" class="anchor"><span id="_Toc142114407" class="anchor"><span id="_Toc142729624" class="anchor"><span id="_Toc142730908" class="anchor"><span id="_Toc142731281" class="anchor"><span id="_Toc142998648" class="anchor"><span id="_Toc143063740" class="anchor"><span id="_Toc143509850" class="anchor"><span id="_Toc143510297" class="anchor"><span id="_Toc144026329" class="anchor"><span id="_Toc144026660" class="anchor"><span id="_Toc144276303" class="anchor"><span id="_Toc144276647" class="anchor"><span id="_Toc144280235" class="anchor"><span id="_Toc144280581" class="anchor"><span id="_Toc144540796" class="anchor"><span id="_Toc144554679" class="anchor"><span id="_Toc144722300" class="anchor"><span id="_Toc145503762" class="anchor"><span id="_Toc145512204" class="anchor"><span id="_Toc145513227" class="anchor"><span id="_Toc145513611" class="anchor"><span id="_Toc222907395" class="anchor"><span id="_Toc342653096" class="anchor"><span id="_Toc439864192" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Timers
    =============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================

    1.  <span id="_Toc110172845" class="anchor"><span id="_Toc127596852" class="anchor"><span id="_Toc127786473" class="anchor"><span id="_Toc127786789" class="anchor"><span id="_Toc127787105" class="anchor"><span id="_Toc127877779" class="anchor"><span id="_Toc128289849" class="anchor"><span id="_Toc128290242" class="anchor"><span id="_Toc130189847" class="anchor"><span id="_Toc130201063" class="anchor"><span id="_Toc130201379" class="anchor"><span id="_Toc130201700" class="anchor"><span id="_Toc131936892" class="anchor"><span id="_Toc133901253" class="anchor"><span id="_Toc137461127" class="anchor"><span id="_Toc139096642" class="anchor"><span id="_Toc139188565" class="anchor"><span id="_Toc139191428" class="anchor"><span id="_Toc140490480" class="anchor"><span id="_Toc140571382" class="anchor"><span id="_Toc141257655" class="anchor"><span id="_Toc141257982" class="anchor"><span id="_Toc141267510" class="anchor"><span id="_Toc141522528" class="anchor"><span id="_Toc141529616" class="anchor"><span id="_Toc141529933" class="anchor"><span id="_Toc141851540" class="anchor"><span id="_Toc141852474" class="anchor"><span id="_Toc141888018" class="anchor"><span id="_Toc141889858" class="anchor"><span id="_Toc141893527" class="anchor"><span id="_Toc142113380" class="anchor"><span id="_Toc142114408" class="anchor"><span id="_Toc142729625" class="anchor"><span id="_Toc142730909" class="anchor"><span id="_Toc142731282" class="anchor"><span id="_Toc142998649" class="anchor"><span id="_Toc143063741" class="anchor"><span id="_Toc143509851" class="anchor"><span id="_Toc143510298" class="anchor"><span id="_Toc144026330" class="anchor"><span id="_Toc144026661" class="anchor"><span id="_Toc144276304" class="anchor"><span id="_Toc144276648" class="anchor"><span id="_Toc144280236" class="anchor"><span id="_Toc144280582" class="anchor"><span id="_Toc144540797" class="anchor"><span id="_Toc144554680" class="anchor"><span id="_Toc144722301" class="anchor"><span id="_Toc145503763" class="anchor"><span id="_Toc145512205" class="anchor"><span id="_Toc145513228" class="anchor"><span id="_Toc145513612" class="anchor"><span id="_Toc222907396" class="anchor"><span id="_Toc342653097" class="anchor"><span id="_Toc439864193" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Overview
        ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

        1.  ### <span id="_Toc110172846" class="anchor"><span id="_Toc127596853" class="anchor"><span id="_Toc127786474" class="anchor"><span id="_Toc127786790" class="anchor"><span id="_Toc127787106" class="anchor"><span id="_Toc127877780" class="anchor"><span id="_Toc128289850" class="anchor"><span id="_Toc128290243" class="anchor"><span id="_Toc130189848" class="anchor"><span id="_Toc130201064" class="anchor"><span id="_Toc130201380" class="anchor"><span id="_Toc130201701" class="anchor"><span id="_Toc131936893" class="anchor"><span id="_Toc133901254" class="anchor"><span id="_Toc137461128" class="anchor"><span id="_Toc139096643" class="anchor"><span id="_Toc139188566" class="anchor"><span id="_Toc139191429" class="anchor"><span id="_Toc140490481" class="anchor"><span id="_Toc140571383" class="anchor"><span id="_Toc141257656" class="anchor"><span id="_Toc141257983" class="anchor"><span id="_Toc141267511" class="anchor"><span id="_Toc141522529" class="anchor"><span id="_Toc141529617" class="anchor"><span id="_Toc141529934" class="anchor"><span id="_Toc141851541" class="anchor"><span id="_Toc141852475" class="anchor"><span id="_Toc141888019" class="anchor"><span id="_Toc141889859" class="anchor"><span id="_Toc141893528" class="anchor"><span id="_Toc142113381" class="anchor"><span id="_Toc142114409" class="anchor"><span id="_Toc142729626" class="anchor"><span id="_Toc142730910" class="anchor"><span id="_Toc142731283" class="anchor"><span id="_Toc142998650" class="anchor"><span id="_Toc143063742" class="anchor"><span id="_Toc143509852" class="anchor"><span id="_Toc143510299" class="anchor"><span id="_Toc144026331" class="anchor"><span id="_Toc144026662" class="anchor"><span id="_Toc144276305" class="anchor"><span id="_Toc144276649" class="anchor"><span id="_Toc144280237" class="anchor"><span id="_Toc144280583" class="anchor"><span id="_Toc144540798" class="anchor"><span id="_Toc144554681" class="anchor"><span id="_Toc144722302" class="anchor"><span id="_Toc145503764" class="anchor"><span id="_Toc145512206" class="anchor"><span id="_Toc145513229" class="anchor"><span id="_Toc145513613" class="anchor"><span id="_Toc222907397" class="anchor"><span id="_Toc342653098" class="anchor"><span id="_Toc439864194" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Timer Services

The hypervisor provides simple timing services. These are based on a
constant-rate reference time source (typically the ACPI timer on x64
systems).

-   The following timer services are provided:A per-partition reference
    time counter.

-   Four synthetic timers per virtual processor. Each synthetic timer is
    a single-shot or periodic timer that delivers a message when
    it expires.

-   One virtual APIC timer per virtual processor.

-   Two timer assists: an emulated periodic timer and a PM Timer assist.

-   A partition reference time enlightenment, based on the host
    platform’s support for an Invariant Time Stamp Counter (iTSC).

    1.  ### <span id="_Toc110172847" class="anchor"><span id="_Toc127596854" class="anchor"><span id="_Toc127786475" class="anchor"><span id="_Toc127786791" class="anchor"><span id="_Toc127787107" class="anchor"><span id="_Toc127877781" class="anchor"><span id="_Toc128289851" class="anchor"><span id="_Toc128290244" class="anchor"><span id="_Toc130189849" class="anchor"><span id="_Toc130201065" class="anchor"><span id="_Toc130201381" class="anchor"><span id="_Toc130201702" class="anchor"><span id="_Toc131936894" class="anchor"><span id="_Toc133901255" class="anchor"><span id="_Toc137461129" class="anchor"><span id="_Toc139096644" class="anchor"><span id="_Toc139188567" class="anchor"><span id="_Toc139191430" class="anchor"><span id="_Toc140490482" class="anchor"><span id="_Toc140571384" class="anchor"><span id="_Toc141257657" class="anchor"><span id="_Toc141257984" class="anchor"><span id="_Toc141267512" class="anchor"><span id="_Toc141522530" class="anchor"><span id="_Toc141529618" class="anchor"><span id="_Toc141529935" class="anchor"><span id="_Toc141851542" class="anchor"><span id="_Toc141852476" class="anchor"><span id="_Toc141888020" class="anchor"><span id="_Toc141889860" class="anchor"><span id="_Toc141893529" class="anchor"><span id="_Toc142113382" class="anchor"><span id="_Toc142114410" class="anchor"><span id="_Toc142729627" class="anchor"><span id="_Toc142730911" class="anchor"><span id="_Toc142731284" class="anchor"><span id="_Toc142998651" class="anchor"><span id="_Toc143063743" class="anchor"><span id="_Toc143509853" class="anchor"><span id="_Toc143510300" class="anchor"><span id="_Toc144026332" class="anchor"><span id="_Toc144026663" class="anchor"><span id="_Toc144276306" class="anchor"><span id="_Toc144276650" class="anchor"><span id="_Toc144280238" class="anchor"><span id="_Toc144280584" class="anchor"><span id="_Toc144540799" class="anchor"><span id="_Toc144554682" class="anchor"><span id="_Toc144722303" class="anchor"><span id="_Toc145503765" class="anchor"><span id="_Toc145512207" class="anchor"><span id="_Toc145513230" class="anchor"><span id="_Toc145513614" class="anchor"><span id="_Toc222907398" class="anchor"><span id="_Toc342653099" class="anchor"><span id="_Toc439864195" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Reference Counter

The hypervisor maintains a per-partition reference time counter. It has
the characteristic that successive accesses to it return strictly
monotonically increasing (time) values as seen by any and all virtual
processors of a partition. Furthermore, the reference counter is rate
constant and unaffected by processor or bus speed transitions or deep
processor power savings states. A partition’s reference time counter is
initialized to zero when the partition is created. The reference counter
for all partitions count at the same rate, but at any time, their
absolute values will typically differ because partitions will have
different creation times.

The reference counter continues to count up as long as at least one
virtual processor is not explicitly suspended.

### <span id="_Toc110172848" class="anchor"><span id="_Toc127596855" class="anchor"><span id="_Toc127786476" class="anchor"><span id="_Toc127786792" class="anchor"><span id="_Toc127787108" class="anchor"><span id="_Toc127877782" class="anchor"><span id="_Toc128289852" class="anchor"><span id="_Toc128290245" class="anchor"><span id="_Toc130189850" class="anchor"><span id="_Toc130201066" class="anchor"><span id="_Toc130201382" class="anchor"><span id="_Toc130201703" class="anchor"><span id="_Toc131936895" class="anchor"><span id="_Toc133901256" class="anchor"><span id="_Toc137461130" class="anchor"><span id="_Toc139096645" class="anchor"><span id="_Toc139188568" class="anchor"><span id="_Toc139191431" class="anchor"><span id="_Toc140490483" class="anchor"><span id="_Toc140571385" class="anchor"><span id="_Toc141257658" class="anchor"><span id="_Toc141257985" class="anchor"><span id="_Toc141267513" class="anchor"><span id="_Toc141522531" class="anchor"><span id="_Toc141529619" class="anchor"><span id="_Toc141529936" class="anchor"><span id="_Toc141851543" class="anchor"><span id="_Toc141852477" class="anchor"><span id="_Toc141888021" class="anchor"><span id="_Toc141889861" class="anchor"><span id="_Toc141893530" class="anchor"><span id="_Toc142113383" class="anchor"><span id="_Toc142114411" class="anchor"><span id="_Toc142729628" class="anchor"><span id="_Toc142730912" class="anchor"><span id="_Toc142731285" class="anchor"><span id="_Toc142998652" class="anchor"><span id="_Toc143063744" class="anchor"><span id="_Toc143509854" class="anchor"><span id="_Toc143510301" class="anchor"><span id="_Toc144026333" class="anchor"><span id="_Toc144026664" class="anchor"><span id="_Toc144276307" class="anchor"><span id="_Toc144276651" class="anchor"><span id="_Toc144280239" class="anchor"><span id="_Toc144280585" class="anchor"><span id="_Toc144540800" class="anchor"><span id="_Toc144554683" class="anchor"><span id="_Toc144722304" class="anchor"><span id="_Toc145503766" class="anchor"><span id="_Toc145512208" class="anchor"><span id="_Toc145513231" class="anchor"><span id="_Toc145513615" class="anchor"><span id="_Toc222907399" class="anchor"><span id="_Toc342653100" class="anchor"><span id="_Toc439864196" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Synthetic Timers

Synthetic timers provide a mechanism for generating an interrupt after
some specified time in the future. Both one-shot and periodic timers are
supported. A synthetic timer sends a message to a specified SynIC SINTx
(synthetic interrupt source) upon expiration.

The hypervisor guarantees that a timer expiration signal will never be
delivered before the expiration time. The signal may arrive any time
after the expiration time.

### <span id="_Ref108706990" class="anchor"><span id="_Toc110172849" class="anchor"><span id="_Toc127596856" class="anchor"><span id="_Toc127786477" class="anchor"><span id="_Toc127786793" class="anchor"><span id="_Toc127787109" class="anchor"><span id="_Toc127877783" class="anchor"><span id="_Toc128289853" class="anchor"><span id="_Toc128290246" class="anchor"><span id="_Toc130189851" class="anchor"><span id="_Toc130201067" class="anchor"><span id="_Toc130201383" class="anchor"><span id="_Toc130201704" class="anchor"><span id="_Toc131936896" class="anchor"><span id="_Toc133901257" class="anchor"><span id="_Toc137461131" class="anchor"><span id="_Toc139096646" class="anchor"><span id="_Toc139188569" class="anchor"><span id="_Toc139191432" class="anchor"><span id="_Toc140490484" class="anchor"><span id="_Toc140571386" class="anchor"><span id="_Toc141257659" class="anchor"><span id="_Toc141257986" class="anchor"><span id="_Toc141267514" class="anchor"><span id="_Toc141522532" class="anchor"><span id="_Toc141529620" class="anchor"><span id="_Toc141529937" class="anchor"><span id="_Toc141851544" class="anchor"><span id="_Toc141852478" class="anchor"><span id="_Toc141888022" class="anchor"><span id="_Toc141889862" class="anchor"><span id="_Toc141893531" class="anchor"><span id="_Toc142113384" class="anchor"><span id="_Toc142114412" class="anchor"><span id="_Toc142729629" class="anchor"><span id="_Toc142730913" class="anchor"><span id="_Toc142731286" class="anchor"><span id="_Toc142998653" class="anchor"><span id="_Toc143063745" class="anchor"><span id="_Toc143509855" class="anchor"><span id="_Toc143510302" class="anchor"><span id="_Toc144026334" class="anchor"><span id="_Toc144026665" class="anchor"><span id="_Toc144276308" class="anchor"><span id="_Toc144276652" class="anchor"><span id="_Toc144280240" class="anchor"><span id="_Toc144280586" class="anchor"><span id="_Toc144540801" class="anchor"><span id="_Toc144554684" class="anchor"><span id="_Toc144722305" class="anchor"><span id="_Toc145503767" class="anchor"><span id="_Toc145512209" class="anchor"><span id="_Toc145513232" class="anchor"><span id="_Toc145513616" class="anchor"><span id="_Toc222907400" class="anchor"><span id="_Toc342653101" class="anchor"><span id="_Toc439864197" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Periodic Timers

The hypervisor attempts to signal periodic timers on a regular basis.

For example, if a timer has a requested period of 1ms, here is the
idealized schedule for timer expiration notifications:

However, if the virtual processor used to signal the expiration is not
available, some of the timer expirations may be delayed. A virtual
processor may be unavailable because it is suspended (for example,
during intercept handling) or because the hypervisor’s scheduler decided
that the virtual processor should not be scheduled on a logical
processor (for example, because another virtual processor is using the
logical processor or the virtual processor has exceeded its quota).

The shaded portions of the following diagram show periods of inactivity
during which a periodic timer expiration signal could not be delivered.
Consequently, the signal is deferred until the virtual processor becomes
available.

If a virtual processor is unavailable for a sufficiently long period of
time, a full timer period may be missed. In this case, the hypervisor
uses one of two techniques. The first technique involves timer period
modulation, in effect shortening the period until the timer “catches
up".

The following diagram shows the period modulation technique.

If a significant number of timer signals have been missed, the
hypervisor may be unable to compensate by using period modulation. In
this case, some timer expiration signals may be skipped completely.

For timers that are marked as *lazy*, the hypervisor uses a second
technique for dealing with the situation in which a virtual processor is
unavailable for a long period of time. In this case, the timer signal is
deferred until this virtual processor is available. If it doesn’t become
available until shortly before the next timer is due to expire, it is
skipped entirely.

The following diagram shows the lazy timer technique.

### <span id="_Toc141851545" class="anchor"><span id="_Toc141852479" class="anchor"><span id="_Ref141883874" class="anchor"><span id="_Ref141883911" class="anchor"><span id="_Toc141888023" class="anchor"><span id="_Toc141889863" class="anchor"><span id="_Toc141893532" class="anchor"><span id="_Toc142113385" class="anchor"><span id="_Toc142114413" class="anchor"><span id="_Toc142729630" class="anchor"><span id="_Toc142730914" class="anchor"><span id="_Toc142731287" class="anchor"><span id="_Toc142998654" class="anchor"><span id="_Toc143063746" class="anchor"><span id="_Toc143509856" class="anchor"><span id="_Toc143510303" class="anchor"><span id="_Toc144026335" class="anchor"><span id="_Toc144026666" class="anchor"><span id="_Toc144276309" class="anchor"><span id="_Toc144276653" class="anchor"><span id="_Toc144280241" class="anchor"><span id="_Toc144280587" class="anchor"><span id="_Toc144540802" class="anchor"><span id="_Toc144554685" class="anchor"><span id="_Toc144722306" class="anchor"><span id="_Toc145503768" class="anchor"><span id="_Toc145512210" class="anchor"><span id="_Toc145513233" class="anchor"><span id="_Toc145513617" class="anchor"><span id="_Toc222907401" class="anchor"><span id="_Toc342653102" class="anchor"><span id="_Toc127596857" class="anchor"><span id="_Toc127786478" class="anchor"><span id="_Toc127786794" class="anchor"><span id="_Toc127787110" class="anchor"><span id="_Toc127877784" class="anchor"><span id="_Toc128289854" class="anchor"><span id="_Toc128290247" class="anchor"><span id="_Toc130189852" class="anchor"><span id="_Toc130201068" class="anchor"><span id="_Toc130201384" class="anchor"><span id="_Toc130201705" class="anchor"><span id="_Toc131936897" class="anchor"><span id="_Toc133901258" class="anchor"><span id="_Toc137461132" class="anchor"><span id="_Toc139096647" class="anchor"><span id="_Toc139188570" class="anchor"><span id="_Toc139191433" class="anchor"><span id="_Toc140490485" class="anchor"><span id="_Toc140571387" class="anchor"><span id="_Toc141257660" class="anchor"><span id="_Toc141257987" class="anchor"><span id="_Toc141267515" class="anchor"><span id="_Toc141522533" class="anchor"><span id="_Toc141529621" class="anchor"><span id="_Toc141529938" class="anchor"><span id="_Toc110172850" class="anchor"><span id="_Toc439864198" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Periodic Timer Assist

The parent partition may enable a periodic timer that is to be applied
to a child partition. A period defines the rate of the interrupts, and a
local APIC destination specifies which virtual processors are to be
interrupted. The local APIC destination is usually defined by the I/O
APIC redirection entry associated with the assisted timer source. The
period is established by the parent partition by programming the
periodic timer assist. Using this timer assist will reduce the cost of
interrupt delivery and an improve interrupt accuracy.

The periodic timer assist is managed using two partition properties,
HvPartitionPropertyEmulatedTimerPeriod and
HvPartitionPropertyEmulatedTimerControl. Both properties default to all
zeroes.

The timer period property specifies the time in 100 nanosecond units and
is defined as follows:

// Timer Period

typedef union

{

UINT64 AsUINT64;

HV\_PICO100\_DURATION Period;

} HV\_EMULATED\_TIMER\_PERIOD, \*PHV\_EMULATED\_TIMER\_PERIOD;

The local APIC destination is encoded in the timer control and is
defined as follows:

// Periodic Timer Control

typedef union

{

UINT64 AsUINT64;

struct

{

UINT32 Vector:8;

UINT32 DeliveryMode:3;

UINT32 LogicalDestinationMode:1;

UINT32 Enabled:1;

UINT32 Reserved:4

UINT32 Reserved1:15;

UINT32 Reserved2:24;

UINT32 Mda[^3]:8;

};

} HV\_EMULATED\_TIMER\_CONTROL, \*PHV\_EMULATED\_TIMER\_CONTROL;

The defined (named) fields of the Periodic Timer Control conform to
those used by the local APIC’s Interrupt Command Register (ICR). When
the timer period property is set to zero, the timer control *Enabled*
flag will be cleared, disabling the timer assist.

Normally, HvPartitionPropertyEmulatedTimerPeriod is set, and then
HvPartitionPropertyEmulatedTimerControl updated to enable the assist. If
those operations are done in the reverse order, the pending timer with
the old timer period will be removed and a new timer with the new period
inserted. Likewise, if the values in
HvPartitionPropertyEmulatedTimerControl are changed without disabling
the timer, the new values will take effect immediately.

The periodic timer assist acts in the same way as the non-lazy periodic
timer described in the previous section, i.e. it will try to “catch up"
if timer ticks are missed.

### <span id="_Toc141851546" class="anchor"><span id="_Toc141852480" class="anchor"><span id="_Ref141884001" class="anchor"><span id="_Toc141888024" class="anchor"><span id="_Toc141889864" class="anchor"><span id="_Toc141893533" class="anchor"><span id="_Toc142113386" class="anchor"><span id="_Toc142114414" class="anchor"><span id="_Ref142384877" class="anchor"><span id="_Toc142729631" class="anchor"><span id="_Toc142730915" class="anchor"><span id="_Toc142731288" class="anchor"><span id="_Toc142998655" class="anchor"><span id="_Toc143063747" class="anchor"><span id="_Toc143509857" class="anchor"><span id="_Toc143510304" class="anchor"><span id="_Toc144026336" class="anchor"><span id="_Toc144026667" class="anchor"><span id="_Toc144276310" class="anchor"><span id="_Toc144276654" class="anchor"><span id="_Toc144280242" class="anchor"><span id="_Toc144280588" class="anchor"><span id="_Toc144540803" class="anchor"><span id="_Toc144554686" class="anchor"><span id="_Toc144722307" class="anchor"><span id="_Toc145503769" class="anchor"><span id="_Toc145512211" class="anchor"><span id="_Toc145513234" class="anchor"><span id="_Toc145513618" class="anchor"><span id="_Ref147656081" class="anchor"><span id="_Toc222907402" class="anchor"><span id="_Toc342653103" class="anchor"><span id="_Toc439864199" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>PM Timer Assist

The parent partition may request the hypervisor to assist the child’s
use of the ACPI PM timer. The parent specifies an I/O port and whether
the child’s ACPI PM Timer is 24- or 32-bits wide. When the child
partition performs an IN from the specified port, the hypervisor will
directly provide the value of the PM timer based upon the partition’s
reference time. The returned ACPI PM Timer value is computed as:

ACPI\_PM\_Timer = Modulus(Partition\_Reference\_Time \* 0.3579545,
2\*\*\[24|32\]);

This assist supports only IN operations on the I/O port (note that INS
is not supported). Attempts to OUT to the port, to IN from any of the
three subsequent I/O ports (that is, ports n+1, n+2 or n+3) or to IN
from any of the three preceding I/O ports (that is, ports n-1, n-2 or
n-3) will follow the rules for I/O port accesses as described in section
11.9.

If both an intercept and the PM timer assist are installed for the same
I/O port, the assist will take precedence for the IN operation. The
hypervisor will generate an intercept message for all OUT operations.\
\
The caller specifies the PM Timer property’s port and whether the value
returned is 24 or 32 bits wide as follows:

// ACPI PM Timer

typedef union

{

UINT64 AsUINT64;

struct

{

UINT64 Port:16;

UINT64 Width24:1;

UINT64 Enabled:1;

UINT64 ReservedZ1:14;

UINT64 ReservedZ2:32;

};

} HV\_PM\_TIMER\_INFO, \*PHV\_PM\_TIMER\_INFO;

*\
Port* is the I/O port that the reference timer assist is to use.

*Width24* indicates the width of the timer data. When set, the data is
24 bits wide. When clear, it is 32 bits wide.

*Enabled* is used to enable or disable the assist.

### <span id="_Toc141851547" class="anchor"><span id="_Toc141852481" class="anchor"><span id="_Toc141888025" class="anchor"><span id="_Toc141889865" class="anchor"><span id="_Toc141893534" class="anchor"><span id="_Toc142113387" class="anchor"><span id="_Toc142114415" class="anchor"><span id="_Toc142729632" class="anchor"><span id="_Toc142730916" class="anchor"><span id="_Toc142731289" class="anchor"><span id="_Toc142998656" class="anchor"><span id="_Toc143063748" class="anchor"><span id="_Toc143509858" class="anchor"><span id="_Toc143510305" class="anchor"><span id="_Toc144026337" class="anchor"><span id="_Toc144026668" class="anchor"><span id="_Toc144276311" class="anchor"><span id="_Toc144276655" class="anchor"><span id="_Toc144280243" class="anchor"><span id="_Toc144280589" class="anchor"><span id="_Toc144540804" class="anchor"><span id="_Toc144554687" class="anchor"><span id="_Toc144722308" class="anchor"><span id="_Toc145503770" class="anchor"><span id="_Toc145512212" class="anchor"><span id="_Toc145513235" class="anchor"><span id="_Toc145513619" class="anchor"><span id="_Toc222907403" class="anchor"><span id="_Toc342653104" class="anchor"><span id="_Toc439864200" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Ordering of Timer Expirations

Synthetic and virtualized timers generate interrupts at or near their
designated expiration time. Due to hardware and other scheduling
interactions, interrupts could potentially be delayed. No ordering may
be assumed between any set of timers.

### <span id="_Toc127596858" class="anchor"><span id="_Toc127786479" class="anchor"><span id="_Toc127786795" class="anchor"><span id="_Toc127787111" class="anchor"><span id="_Toc127877785" class="anchor"><span id="_Toc128289855" class="anchor"><span id="_Toc128290248" class="anchor"><span id="_Toc130189853" class="anchor"><span id="_Toc130201069" class="anchor"><span id="_Toc130201385" class="anchor"><span id="_Toc130201706" class="anchor"><span id="_Toc131936898" class="anchor"><span id="_Toc133901259" class="anchor"><span id="_Toc137461133" class="anchor"><span id="_Toc139096648" class="anchor"><span id="_Toc139188571" class="anchor"><span id="_Toc139191434" class="anchor"><span id="_Toc140490486" class="anchor"><span id="_Toc140571388" class="anchor"><span id="_Toc141257661" class="anchor"><span id="_Toc141257988" class="anchor"><span id="_Toc141267516" class="anchor"><span id="_Toc141522534" class="anchor"><span id="_Toc141529622" class="anchor"><span id="_Toc141529939" class="anchor"><span id="_Toc141851548" class="anchor"><span id="_Toc141852482" class="anchor"><span id="_Toc141888026" class="anchor"><span id="_Toc141889866" class="anchor"><span id="_Toc141893535" class="anchor"><span id="_Toc142113388" class="anchor"><span id="_Toc142114416" class="anchor"><span id="_Toc142729633" class="anchor"><span id="_Toc142730917" class="anchor"><span id="_Toc142731290" class="anchor"><span id="_Toc142998657" class="anchor"><span id="_Toc143063749" class="anchor"><span id="_Toc143509859" class="anchor"><span id="_Toc143510306" class="anchor"><span id="_Toc144026338" class="anchor"><span id="_Toc144026669" class="anchor"><span id="_Toc144276312" class="anchor"><span id="_Toc144276656" class="anchor"><span id="_Toc144280244" class="anchor"><span id="_Toc144280590" class="anchor"><span id="_Toc144540805" class="anchor"><span id="_Toc144554688" class="anchor"><span id="_Toc144722309" class="anchor"><span id="_Toc145503771" class="anchor"><span id="_Toc145512213" class="anchor"><span id="_Toc145513236" class="anchor"><span id="_Toc145513620" class="anchor"><span id="_Toc222907404" class="anchor"><span id="_Toc342653105" class="anchor"><span id="_Toc439864201" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Timer Expiration Messages

For details about timer expiration messages, see section 19.3.

### <span id="_Toc342653106" class="anchor"><span id="_Toc439864202" class="anchor"></span></span>Partition Reference Time Enlightenment

The partition reference time enlightenment presents a reference time
source to which does not require an intercept into the hypervisor. This
enlightenment is available only when the underlying platform provides
support of an invariant processor Time Stamp Counter (TSC), or iTSC. In
such platforms, the processor TSC frequency remains constant
irrespective of changes in the processor’s clock frequency due to the
use of power management states such as ACPI processor performance
states, processor idle sleep states (ACPI C-states), etc.

The partition reference time enlightenment uses a virtual TSC value, an
offset and a multiplier to enable a guest partition to compute the
normalized reference time since partition creation, in 100nS units. The
mechanism also allows a guest partition to atomically compute the
reference time when the guest partition is migrated to a platform with a
different TSC rate, and provides a fall-back mechanism to support
migration to platforms without the constant rate TSC feature.

This facility is not intended to be used a source of wall clock time,
since the reference time computed using this facility will appear to
stop during the time that a guest partition is saved until the
subsequent restore.

<span id="_Toc110172851" class="anchor"><span id="_Toc127596859" class="anchor"><span id="_Toc127786480" class="anchor"><span id="_Toc127786796" class="anchor"><span id="_Toc127787112" class="anchor"><span id="_Toc127877786" class="anchor"><span id="_Toc128289856" class="anchor"><span id="_Toc128290249" class="anchor"><span id="_Toc130189854" class="anchor"><span id="_Toc130201070" class="anchor"><span id="_Toc130201386" class="anchor"><span id="_Toc130201707" class="anchor"><span id="_Toc131936899" class="anchor"><span id="_Toc133901260" class="anchor"><span id="_Toc137461134" class="anchor"><span id="_Toc139096649" class="anchor"><span id="_Toc139188572" class="anchor"><span id="_Toc139191435" class="anchor"><span id="_Toc140490487" class="anchor"><span id="_Toc140571389" class="anchor"><span id="_Toc141257662" class="anchor"><span id="_Toc141257989" class="anchor"><span id="_Toc141267517" class="anchor"><span id="_Toc141522535" class="anchor"><span id="_Toc141529623" class="anchor"><span id="_Toc141529940" class="anchor"><span id="_Toc141851549" class="anchor"><span id="_Toc141852483" class="anchor"><span id="_Toc141888027" class="anchor"><span id="_Toc141889867" class="anchor"><span id="_Toc141893536" class="anchor"><span id="_Toc142113389" class="anchor"><span id="_Toc142114417" class="anchor"><span id="_Toc142729634" class="anchor"><span id="_Toc142730918" class="anchor"><span id="_Toc142731291" class="anchor"><span id="_Toc142998658" class="anchor"><span id="_Toc143063750" class="anchor"><span id="_Toc143509860" class="anchor"><span id="_Toc143510307" class="anchor"><span id="_Toc144026339" class="anchor"><span id="_Toc144026670" class="anchor"><span id="_Toc144276313" class="anchor"><span id="_Toc144276657" class="anchor"><span id="_Toc144280245" class="anchor"><span id="_Toc144280591" class="anchor"><span id="_Toc144540806" class="anchor"><span id="_Toc144554689" class="anchor"><span id="_Toc144722310" class="anchor"><span id="_Toc145503772" class="anchor"><span id="_Toc145512214" class="anchor"><span id="_Toc145513237" class="anchor"><span id="_Toc145513621" class="anchor"><span id="_Ref159056122" class="anchor"><span id="_Toc222907405" class="anchor"><span id="_Toc342653107" class="anchor"><span id="_Toc439864203" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Reference Counter MSR
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

A partition’s reference counter is accessed through a partition-wide
MSR.

  MSR Address   Register Name                    Function
  ------------- -------------------------------- ---------------------------------------
  0x40000020    HV\_X64\_MSR\_TIME\_REF\_COUNT   Time reference count (partition-wide)

### <span id="_Toc110172852" class="anchor"><span id="_Toc127596860" class="anchor"><span id="_Toc127786481" class="anchor"><span id="_Toc127786797" class="anchor"><span id="_Toc127787113" class="anchor"><span id="_Toc127877787" class="anchor"><span id="_Toc128289857" class="anchor"><span id="_Toc128290250" class="anchor"><span id="_Toc130189855" class="anchor"><span id="_Toc130201071" class="anchor"><span id="_Toc130201387" class="anchor"><span id="_Toc130201708" class="anchor"><span id="_Toc131936900" class="anchor"><span id="_Toc133901261" class="anchor"><span id="_Toc137461135" class="anchor"><span id="_Toc139096650" class="anchor"><span id="_Toc139188573" class="anchor"><span id="_Toc139191436" class="anchor"><span id="_Toc140490488" class="anchor"><span id="_Toc140571390" class="anchor"><span id="_Toc141257663" class="anchor"><span id="_Toc141257990" class="anchor"><span id="_Toc141267518" class="anchor"><span id="_Toc141522536" class="anchor"><span id="_Toc141529624" class="anchor"><span id="_Toc141529941" class="anchor"><span id="_Toc141851550" class="anchor"><span id="_Toc141852484" class="anchor"><span id="_Toc141888028" class="anchor"><span id="_Toc141889868" class="anchor"><span id="_Toc141893537" class="anchor"><span id="_Toc142113390" class="anchor"><span id="_Toc142114418" class="anchor"><span id="_Toc142729635" class="anchor"><span id="_Toc142730919" class="anchor"><span id="_Toc142731292" class="anchor"><span id="_Toc142998659" class="anchor"><span id="_Toc143063751" class="anchor"><span id="_Toc143509861" class="anchor"><span id="_Toc143510308" class="anchor"><span id="_Toc144026340" class="anchor"><span id="_Toc144026671" class="anchor"><span id="_Toc144276314" class="anchor"><span id="_Toc144276658" class="anchor"><span id="_Toc144280246" class="anchor"><span id="_Toc144280592" class="anchor"><span id="_Toc144540807" class="anchor"><span id="_Toc144554690" class="anchor"><span id="_Toc144722311" class="anchor"><span id="_Toc145503773" class="anchor"><span id="_Toc145512215" class="anchor"><span id="_Toc145513238" class="anchor"><span id="_Toc145513622" class="anchor"><span id="_Toc222907406" class="anchor"><span id="_Toc342653108" class="anchor"><span id="_Toc439864204" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Reference Counter MSR

  63:0
  -------
  Count

  Bits   Description                                                         Attributes
  ------ ------------------------------------------------------------------- ------------
  63:0   Count—Partition’s reference counter value in 100 nanosecond units   Read-only

When a partition is created, the value of the TIME\_REF\_COUNT MSR is
set to 0x0000000000000000. This value cannot be modified by a virtual
processor. Any attempt to write to it results in a \#GP fault.

<span id="_Toc110172853" class="anchor"><span id="_Toc127596861" class="anchor"><span id="_Toc127786482" class="anchor"><span id="_Toc127786798" class="anchor"><span id="_Toc127787114" class="anchor"><span id="_Toc127877788" class="anchor"><span id="_Toc128289858" class="anchor"><span id="_Toc128290251" class="anchor"><span id="_Toc130189856" class="anchor"><span id="_Toc130201072" class="anchor"><span id="_Toc130201388" class="anchor"><span id="_Toc130201709" class="anchor"><span id="_Toc131936901" class="anchor"><span id="_Toc133901262" class="anchor"><span id="_Toc137461136" class="anchor"><span id="_Toc139096651" class="anchor"><span id="_Toc139188574" class="anchor"><span id="_Toc139191437" class="anchor"><span id="_Toc140490489" class="anchor"><span id="_Toc140571391" class="anchor"><span id="_Toc141257664" class="anchor"><span id="_Toc141257991" class="anchor"><span id="_Toc141267519" class="anchor"><span id="_Toc141522537" class="anchor"><span id="_Toc141529625" class="anchor"><span id="_Toc141529942" class="anchor"><span id="_Toc141851551" class="anchor"><span id="_Toc141852485" class="anchor"><span id="_Toc141888029" class="anchor"><span id="_Toc141889869" class="anchor"><span id="_Toc141893538" class="anchor"><span id="_Toc142113391" class="anchor"><span id="_Toc142114419" class="anchor"><span id="_Toc142729636" class="anchor"><span id="_Toc142730920" class="anchor"><span id="_Toc142731293" class="anchor"><span id="_Toc142998660" class="anchor"><span id="_Toc143063752" class="anchor"><span id="_Toc143509862" class="anchor"><span id="_Toc143510309" class="anchor"><span id="_Toc144026341" class="anchor"><span id="_Toc144026672" class="anchor"><span id="_Toc144276315" class="anchor"><span id="_Toc144276659" class="anchor"><span id="_Toc144280247" class="anchor"><span id="_Toc144280593" class="anchor"><span id="_Toc144540808" class="anchor"><span id="_Toc144554691" class="anchor"><span id="_Toc144722312" class="anchor"><span id="_Toc145503774" class="anchor"><span id="_Toc145512216" class="anchor"><span id="_Toc145513239" class="anchor"><span id="_Toc145513623" class="anchor"><span id="_Toc222907407" class="anchor"><span id="_Toc342653109" class="anchor"><span id="_Toc439864205" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Synthetic Timer MSRs
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

Synthetic timers are configured by using model-specific registers (MSRs)
associated with each virtual processor. Each of the four synthetic
timers has an associated pair of MSRs.

  MSR address   Register name                   Function
  ------------- ------------------------------- -------------------------------------------------
  0x400000B0    HV\_X64\_MSR\_STIMER0\_CONFIG   Configuration register for synthetic timer 0
  0x400000B1    HV\_X64\_MSR\_STIMER0\_COUNT    Expiration time or period for synthetic timer 0
  0x400000B2    HV\_X64\_MSR\_STIMER1\_CONFIG   Configuration register for synthetic timer 1
  0x400000B3    HV\_X64\_MSR\_STIMER1\_COUNT    Expiration time or period for synthetic timer 1
  0x400000B4    HV\_X64\_MSR\_STIMER2\_CONFIG   Configuration register for synthetic timer 2
  0x400000B5    HX\_X64\_MSR\_STIMER2\_COUNT    Expiration time or period for synthetic timer 2
  0x400000B6    HV\_X64\_MSR\_STIMER3\_CONFIG   Configuration register for synthetic timer 3
  0x400000B7    HV\_X64\_MSR\_STIMER3\_COUNT    Expiration time or period for synthetic timer 3

### <span id="_Toc110172854" class="anchor"><span id="_Toc127596862" class="anchor"><span id="_Toc127786483" class="anchor"><span id="_Toc127786799" class="anchor"><span id="_Toc127787115" class="anchor"><span id="_Toc127877789" class="anchor"><span id="_Toc128289859" class="anchor"><span id="_Toc128290252" class="anchor"><span id="_Toc130189857" class="anchor"><span id="_Toc130201073" class="anchor"><span id="_Toc130201389" class="anchor"><span id="_Toc130201710" class="anchor"><span id="_Toc131936902" class="anchor"><span id="_Toc133901263" class="anchor"><span id="_Toc137461137" class="anchor"><span id="_Toc139096652" class="anchor"><span id="_Toc139188575" class="anchor"><span id="_Toc139191438" class="anchor"><span id="_Toc140490490" class="anchor"><span id="_Toc140571392" class="anchor"><span id="_Toc141257665" class="anchor"><span id="_Toc141257992" class="anchor"><span id="_Toc141267520" class="anchor"><span id="_Toc141522538" class="anchor"><span id="_Toc141529626" class="anchor"><span id="_Toc141529943" class="anchor"><span id="_Toc141851552" class="anchor"><span id="_Toc141852486" class="anchor"><span id="_Toc141888030" class="anchor"><span id="_Toc141889870" class="anchor"><span id="_Toc141893539" class="anchor"><span id="_Toc142113392" class="anchor"><span id="_Toc142114420" class="anchor"><span id="_Toc142729637" class="anchor"><span id="_Toc142730921" class="anchor"><span id="_Toc142731294" class="anchor"><span id="_Toc142998661" class="anchor"><span id="_Toc143063753" class="anchor"><span id="_Toc143509863" class="anchor"><span id="_Toc143510310" class="anchor"><span id="_Toc144026342" class="anchor"><span id="_Toc144026673" class="anchor"><span id="_Toc144276316" class="anchor"><span id="_Toc144276660" class="anchor"><span id="_Toc144280248" class="anchor"><span id="_Toc144280594" class="anchor"><span id="_Toc144540809" class="anchor"><span id="_Toc144554692" class="anchor"><span id="_Toc144722313" class="anchor"><span id="_Toc145503775" class="anchor"><span id="_Toc145512217" class="anchor"><span id="_Toc145513240" class="anchor"><span id="_Toc145513624" class="anchor"><span id="_Ref159056669" class="anchor"><span id="_Ref159056689" class="anchor"><span id="_Ref159056707" class="anchor"><span id="_Ref159056726" class="anchor"><span id="_Toc222907408" class="anchor"><span id="_Toc342653110" class="anchor"><span id="_Toc439864206" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Synthetic Timer Configuration Register

  -----------------------------------------------------------
  63:20   19:16   15:4    3        2      1          0
  ------- ------- ------- -------- ------ ---------- --------
  RsvdZ   SINTx   RsvdZ   Auto     Lazy   Periodic   Enable
                                                     
                          Enable                     
  -----------------------------------------------------------

  Bits    Description                                                                                                       Attributes
  ------- ----------------------------------------------------------------------------------------------------------------- ------------
  63:20   RsvdZ (value should be set to zero)                                                                               Read/write
  19:16   SINTx—synthetic interrupt source                                                                                  Read/write
  15:3    RsvdZ (value should be set to zero)                                                                               Read/write
  3       AutoEnable—set if writing the corresponding counter implicitly causes the counter to be enabled, cleared if not   Read/write
  2       Lazy—set if timer is lazy, cleared if not                                                                         Read/write
  1       Periodic—set if timer is periodic, cleared if one-shot                                                            Read/write
  0       Enable—set if timer is enabled                                                                                    Read/write

When a virtual processor is created and reset, the value of all
HV\_X64\_MSR\_STIMERx\_CONFIG (synthetic timer configuration) registers
is set to 0x0000000000000000. Thus, all synthetic timers are disabled by
default.

If *AutoEnable* is set, then writing a non-zero value to the
corresponding count register will cause Enable to be set and activate
the counter. Otherwise, Enable should be set after writing the
corresponding count register in order to activate the counter. For
information about the Count register, see the following section.

When a one-shot timer expires, it is automatically marked as disabled.
Periodic timers remain enabled until explicitly disabled.

If a one-shot is enabled and the specified count is in the past, it will
expire immediately.

It is not permitted to set the SINTx field to zero for an enabled timer.
If attempted, the timer will be marked disabled (that is, bit 0 cleared)
immediately.

Writing the configuration register of a timer that is already enabled
may result in undefined behavior. For example, merely changing a timer
from one-shot to periodic may not produce what is intended. Timers
should always be disabled prior to changing any other properties.

### <span id="_Toc110172855" class="anchor"><span id="_Toc127596863" class="anchor"><span id="_Toc127786484" class="anchor"><span id="_Toc127786800" class="anchor"><span id="_Toc127787116" class="anchor"><span id="_Toc127877790" class="anchor"><span id="_Toc128289860" class="anchor"><span id="_Toc128290253" class="anchor"><span id="_Toc130189858" class="anchor"><span id="_Toc130201074" class="anchor"><span id="_Toc130201390" class="anchor"><span id="_Toc130201711" class="anchor"><span id="_Toc131936903" class="anchor"><span id="_Toc133901264" class="anchor"><span id="_Toc137461138" class="anchor"><span id="_Toc139096653" class="anchor"><span id="_Toc139188576" class="anchor"><span id="_Toc139191439" class="anchor"><span id="_Toc140490491" class="anchor"><span id="_Toc140571393" class="anchor"><span id="_Toc141257666" class="anchor"><span id="_Toc141257993" class="anchor"><span id="_Toc141267521" class="anchor"><span id="_Toc141522539" class="anchor"><span id="_Toc141529627" class="anchor"><span id="_Toc141529944" class="anchor"><span id="_Toc141851553" class="anchor"><span id="_Toc141852487" class="anchor"><span id="_Toc141888031" class="anchor"><span id="_Toc141889871" class="anchor"><span id="_Toc141893540" class="anchor"><span id="_Toc142113393" class="anchor"><span id="_Toc142114421" class="anchor"><span id="_Toc142729638" class="anchor"><span id="_Toc142730922" class="anchor"><span id="_Toc142731295" class="anchor"><span id="_Toc142998662" class="anchor"><span id="_Toc143063754" class="anchor"><span id="_Toc143509864" class="anchor"><span id="_Toc143510311" class="anchor"><span id="_Toc144026343" class="anchor"><span id="_Toc144026674" class="anchor"><span id="_Toc144276317" class="anchor"><span id="_Toc144276661" class="anchor"><span id="_Toc144280249" class="anchor"><span id="_Toc144280595" class="anchor"><span id="_Toc144540810" class="anchor"><span id="_Toc144554693" class="anchor"><span id="_Toc144722314" class="anchor"><span id="_Toc145503776" class="anchor"><span id="_Toc145512218" class="anchor"><span id="_Toc145513241" class="anchor"><span id="_Toc145513625" class="anchor"><span id="_Ref159056680" class="anchor"><span id="_Ref159056698" class="anchor"><span id="_Ref159056717" class="anchor"><span id="_Ref159056736" class="anchor"><span id="_Toc222907409" class="anchor"><span id="_Toc342653111" class="anchor"><span id="_Toc439864207" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Synthetic Timer Count Register

  63:0
  -------
  Count

  Bits   Description                                                               Attributes
  ------ ------------------------------------------------------------------------- ------------
  63:0   Count—expiration time for one-shot timers, duration for periodic timers   Read/write

The value programmed into the Count register is a time value measured in
100 nanosecond units. Writing the value zero to the Count register will
stop the counter, thereby disabling the timer, independent of the
setting of *AutoEnable* in the configuration register.

Note that the Count register is permitted to wrap. Wrapping will have no
effect on the behavior of the timer, regardless of any timer property.

For one-shot timers, it represents the absolute timer expiration time.
The timer expires when the reference counter for the partition is equal
to or greater than the specified count value.

For periodic timers, the count represents the period of the timer. The
first period begins when the synthetic timer is enabled.

<span id="_Toc342653112" class="anchor"><span id="_Ref213065521" class="anchor"><span id="_Toc222907410" class="anchor"><span id="_Ref108576252" class="anchor"><span id="_Ref119464361" class="anchor"><span id="_Ref119464689" class="anchor"><span id="_Ref119464848" class="anchor"><span id="_Toc118467513" class="anchor"><span id="_Toc439864208" class="anchor"></span></span></span></span></span></span></span></span></span>Partition Reference Time Enlightenment
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

The hypervisor provides a partition-wide virtual reference TSC page
which is overlaid on the partition’s GPA space. A partition’s reference
time stamp counter page is accessed through the Reference TSC MSR. A
partition which possesses the AccessPartitionReferenceTsc privilege may
access the reference TSC MSR.

### <span id="_Toc342653113" class="anchor"><span id="_Toc439864209" class="anchor"></span></span>Reference Time Stamp Counter (TSC) Page MSR

A guest wishing to access its reference TSC page must use the following
model-specific register (MSR).

  MSR Address   Register Name                  Function
  ------------- ------------------------------ ---------------------------------------
  0x40000021    HV\_X64\_MSR\_REFERENCE\_TSC   Time reference count (partition-wide)

The format of the Reference TSC MSR is as follows:

  63:12             11:1    0
  ----------------- ------- --------
  GPA Page Number   RsvdP   Enable

  Bits    Description                              Attributes
  ------- ---------------------------------------- ------------
  63:12   GPA Page Number                          Read/write
  11:1    RsvdP (value should be preserved)        Read/write
  0       Enable—set if reference TSC is enabled   Read/write

At the guest partition creation time, the value of the reference TSC MSR
is 0x0000000000000000. Thus, the reference TSC page is disabled by
default. The guest must enable the reference TSC page by setting bit 0.
If the specified base address is beyond the end of the partition’s GPA
space, the reference TSC page will not be accessible to the guest. When
modifying the register, guests should preserve the value of the reserved
bits (1 through 11) for future compatibility.

Restrictions

The caller must possess the AccessPartitionReferenceTsc privilege.

### <span id="_Toc342653114" class="anchor"><span id="_Toc439864210" class="anchor"></span></span>Format of the Reference TSC Page

The reference TSC page is defined using the following structure:

typedef struct \_HV\_REFERENCE\_TSC\_PAGE

{

volatile UINT32 TscSequence;

UINT32 Reserved1;

volatile UINT64 TscScale;

volatile INT64 TscOffset;

UINT64 Reserved2\[509\];

} HV\_REFERENCE\_TSC\_PAGE, \*PHV\_REFERENCE\_TSC\_PAGE;

### <span id="_Toc342653115" class="anchor"><span id="_Toc439864211" class="anchor"></span></span>Partition Reference TSC Mechanism

The partition reference time is computed by the following formula:

ReferenceTime = ((VirtualTsc \* TscScale) &gt;&gt; 64) + TscOffset

The multiplication is a 64 bit multiplication, which results in a 128
bit number which is then shifted 64 times to the right to obtain the
high 64 bits.TscScale

The TscScale value is used to adjust the Virtual TSC value across
migration events to mitigate TSC frequency changes from one platform to
another.TscSequence

The TscSequence value is used to synchronize access to the enlightened
reference time if the scale and/or the offset fields are changed during
save/restore or live migration. This field serves as a sequence number
which is incremented whenever the scale and/or the offset fields are
modified. The valid values of this field range from 0 to 0xFFFFFFFE. A
special value of 0x0 is used to indicate that this facility is no longer
a reliable source of reference time and the VM must fall back to a
different source.Reference TSC during Save/Restore and Migration

To address migration scenarios to physical platforms which do not
support iTSC, the TscSequence field is used. In the event a guest
partition is migrated from an iTSC capable host to a non-iTSC capable
host, the hypervisor sets TscSequence to the special value of 0x0, which
directs the guest operating system to fall back to a different clock
source. The recommended code for computing the partition reference time
using this enlightenment is shown below:

do {

StartSequence = ReferenceTscPage-&gt;TscSequence;

if (StartSequence == 0) {

// 0 means that the Reference TSC enlightenment is not available at the

// moment, and the Reference Time can only be obtained from reading the

// Reference Counter MSR.

ReferenceTime = rdmsr(HV\_X64\_MSR\_TIME\_REF\_COUNT);

return ReferenceTime;

}

Tsc = rdtsc();

Scale = ReferenceTscPage-&gt;TscScale;

Offset = ReferenceTscPage-&gt;TscOffset;

EndSequence = ReferenceTscPage-&gt;TscSequence;

} while (EndSequence != StartSequence);

// The result of the multiplication is treated as a 128-bit value.

ReferenceTime = ((Tsc \* Scale) &gt;&gt; 64) + Offset;

return ReferenceTime;

1.  <span id="_Toc127596864" class="anchor"><span id="_Toc127786485" class="anchor"><span id="_Toc127786801" class="anchor"><span id="_Toc127787117" class="anchor"><span id="_Toc127877791" class="anchor"><span id="_Toc128289861" class="anchor"><span id="_Toc128290254" class="anchor"><span id="_Toc130189859" class="anchor"><span id="_Toc130201075" class="anchor"><span id="_Toc130201391" class="anchor"><span id="_Toc130201712" class="anchor"><span id="_Toc131936904" class="anchor"><span id="_Toc133901265" class="anchor"><span id="_Toc137461139" class="anchor"><span id="_Toc139096654" class="anchor"><span id="_Toc139188577" class="anchor"><span id="_Toc139191440" class="anchor"><span id="_Toc140490492" class="anchor"><span id="_Ref140564241" class="anchor"><span id="_Toc140571394" class="anchor"><span id="_Toc141257667" class="anchor"><span id="_Toc141257994" class="anchor"><span id="_Toc141267522" class="anchor"><span id="_Toc141522540" class="anchor"><span id="_Toc141529628" class="anchor"><span id="_Toc141529945" class="anchor"><span id="_Toc141851554" class="anchor"><span id="_Toc141852488" class="anchor"><span id="_Toc141888032" class="anchor"><span id="_Toc141889872" class="anchor"><span id="_Toc141893541" class="anchor"><span id="_Toc142113394" class="anchor"><span id="_Toc142114422" class="anchor"><span id="_Toc142729639" class="anchor"><span id="_Toc142730923" class="anchor"><span id="_Toc142731296" class="anchor"><span id="_Toc142998663" class="anchor"><span id="_Toc143063755" class="anchor"><span id="_Toc143509865" class="anchor"><span id="_Toc143510312" class="anchor"><span id="_Toc144026344" class="anchor"><span id="_Toc144026675" class="anchor"><span id="_Toc144276318" class="anchor"><span id="_Toc144276662" class="anchor"><span id="_Toc144280250" class="anchor"><span id="_Toc144280596" class="anchor"><span id="_Toc144540811" class="anchor"><span id="_Ref144549384" class="anchor"><span id="_Toc144554694" class="anchor"><span id="_Toc144722315" class="anchor"><span id="_Toc145503777" class="anchor"><span id="_Toc145512219" class="anchor"><span id="_Toc145513242" class="anchor"><span id="_Toc145513626" class="anchor"><span id="_Ref147203700" class="anchor"><span id="_Ref147203734" class="anchor"><span id="_Toc222907412" class="anchor"><span id="_Toc342653116" class="anchor"><span id="_Toc439864212" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Message Formats
    ====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================

    1.  <span id="_Toc110172857" class="anchor"><span id="_Toc127596865" class="anchor"><span id="_Toc127786486" class="anchor"><span id="_Toc127786802" class="anchor"><span id="_Toc127787118" class="anchor"><span id="_Toc127877792" class="anchor"><span id="_Toc128289862" class="anchor"><span id="_Toc128290255" class="anchor"><span id="_Toc130189860" class="anchor"><span id="_Toc130201076" class="anchor"><span id="_Toc130201392" class="anchor"><span id="_Toc130201713" class="anchor"><span id="_Toc131936905" class="anchor"><span id="_Toc133901266" class="anchor"><span id="_Toc137461140" class="anchor"><span id="_Toc139096655" class="anchor"><span id="_Toc139188578" class="anchor"><span id="_Toc139191441" class="anchor"><span id="_Toc140490493" class="anchor"><span id="_Toc140571395" class="anchor"><span id="_Toc141257668" class="anchor"><span id="_Toc141257995" class="anchor"><span id="_Toc141267523" class="anchor"><span id="_Toc141522541" class="anchor"><span id="_Toc141529629" class="anchor"><span id="_Toc141529946" class="anchor"><span id="_Toc141851555" class="anchor"><span id="_Toc141852489" class="anchor"><span id="_Toc141888033" class="anchor"><span id="_Toc141889873" class="anchor"><span id="_Toc141893542" class="anchor"><span id="_Toc142113395" class="anchor"><span id="_Toc142114423" class="anchor"><span id="_Toc142729640" class="anchor"><span id="_Toc142730924" class="anchor"><span id="_Toc142731297" class="anchor"><span id="_Toc142998664" class="anchor"><span id="_Toc143063756" class="anchor"><span id="_Toc143509866" class="anchor"><span id="_Toc143510313" class="anchor"><span id="_Toc144026345" class="anchor"><span id="_Toc144026676" class="anchor"><span id="_Toc144276319" class="anchor"><span id="_Toc144276663" class="anchor"><span id="_Toc144280251" class="anchor"><span id="_Toc144280597" class="anchor"><span id="_Toc144540812" class="anchor"><span id="_Toc144554695" class="anchor"><span id="_Toc144722316" class="anchor"><span id="_Toc145503778" class="anchor"><span id="_Toc145512220" class="anchor"><span id="_Toc145513243" class="anchor"><span id="_Toc145513627" class="anchor"><span id="_Toc222907413" class="anchor"><span id="_Toc342653117" class="anchor"><span id="_Toc439864213" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Overview
        ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

The hypervisor supports a simple message-based inter-partition
communication mechanism. Messages can be sent by the hypervisor to a
partition or can be sent from one partition to another. This section
describes all of the messages sent by the hypervisor.

Each message has a message type, a source partition, and a message
payload. For a complete list of message types, see chapter 17. The
format of the message payload depends on the message type.

The messages sent by the hypervisor fall into the following categories:

-   Memory access messages (unmapped GPA, GPA access violations, and
    so on.)

-   Processor intercepts

-   Error messages

-   Timer notifications

-   <span id="_Ref108577953" class="anchor"><span id="_Toc110172858"
    class="anchor"><span id="_Ref108577643"
    class="anchor"></span></span></span>Event log events

    1.  <span id="_Toc342653118" class="anchor"><span id="_Ref119464792" class="anchor"><span id="_Toc127596866" class="anchor"><span id="_Toc127786487" class="anchor"><span id="_Toc127786803" class="anchor"><span id="_Toc127787119" class="anchor"><span id="_Toc127877793" class="anchor"><span id="_Toc128289863" class="anchor"><span id="_Toc128290256" class="anchor"><span id="_Toc130189861" class="anchor"><span id="_Toc130201077" class="anchor"><span id="_Toc130201393" class="anchor"><span id="_Toc130201714" class="anchor"><span id="_Toc131936906" class="anchor"><span id="_Toc133901267" class="anchor"><span id="_Toc137461141" class="anchor"><span id="_Toc139096656" class="anchor"><span id="_Toc139188579" class="anchor"><span id="_Toc139191442" class="anchor"><span id="_Toc140490494" class="anchor"><span id="_Toc140571396" class="anchor"><span id="_Toc141257669" class="anchor"><span id="_Toc141257996" class="anchor"><span id="_Toc141267524" class="anchor"><span id="_Toc141522542" class="anchor"><span id="_Toc141529630" class="anchor"><span id="_Toc141529947" class="anchor"><span id="_Toc141851556" class="anchor"><span id="_Toc141852490" class="anchor"><span id="_Toc141888034" class="anchor"><span id="_Toc141889874" class="anchor"><span id="_Toc141893543" class="anchor"><span id="_Toc142113396" class="anchor"><span id="_Toc142114424" class="anchor"><span id="_Toc142729641" class="anchor"><span id="_Toc142730925" class="anchor"><span id="_Toc142731298" class="anchor"><span id="_Toc142998665" class="anchor"><span id="_Toc143063757" class="anchor"><span id="_Toc143509867" class="anchor"><span id="_Toc143510314" class="anchor"><span id="_Toc144026346" class="anchor"><span id="_Toc144026677" class="anchor"><span id="_Toc144276320" class="anchor"><span id="_Toc144276664" class="anchor"><span id="_Toc144280252" class="anchor"><span id="_Toc144280598" class="anchor"><span id="_Toc144540813" class="anchor"><span id="_Toc144554696" class="anchor"><span id="_Toc144722317" class="anchor"><span id="_Toc145503779" class="anchor"><span id="_Toc145512221" class="anchor"><span id="_Toc145513244" class="anchor"><span id="_Toc145513628" class="anchor"><span id="_Toc222907414" class="anchor"><span id="_Toc342653119" class="anchor"><span id="_Toc439864214" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Message Data Types
        ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

<span id="_Toc110172860" class="anchor"></span>Intercept messages are
delivered by the SynIC. For a description of SynIC messages, including
the message header layout, see chapter <span id="_Toc145503780"
class="anchor"><span id="_Toc145512222" class="anchor"><span
id="_Toc145513245" class="anchor"><span id="_Toc145513629"
class="anchor"><span id="_Toc127596867" class="anchor"><span
id="_Toc127786488" class="anchor"><span id="_Toc127786804"
class="anchor"><span id="_Toc127787120" class="anchor"><span
id="_Toc127877794" class="anchor"><span id="_Toc128289864"
class="anchor"><span id="_Toc128290257" class="anchor"><span
id="_Toc130189862" class="anchor"><span id="_Toc130201078"
class="anchor"><span id="_Toc130201394" class="anchor"><span
id="_Toc130201715" class="anchor"><span id="_Toc131936907"
class="anchor"><span id="_Toc133901268" class="anchor"><span
id="_Toc137461142" class="anchor"><span id="_Toc139096657"
class="anchor"><span id="_Toc139188580" class="anchor"><span
id="_Toc139191443" class="anchor"><span id="_Toc140490495"
class="anchor"><span id="_Toc140571397" class="anchor"><span
id="_Toc141257670" class="anchor"><span id="_Toc141257997"
class="anchor"><span id="_Toc141267525" class="anchor"><span
id="_Toc141522543" class="anchor"><span id="_Toc141529631"
class="anchor"><span id="_Toc141529948" class="anchor"><span
id="_Toc141851557" class="anchor"><span id="_Toc141852491"
class="anchor"><span id="_Toc141888035" class="anchor"><span
id="_Toc141889875" class="anchor"><span id="_Toc141893544"
class="anchor"><span id="_Toc142113397" class="anchor"><span
id="_Toc142114425" class="anchor"><span id="_Toc142729642"
class="anchor"><span id="_Toc142730926" class="anchor"><span
id="_Toc142731299" class="anchor"><span id="_Toc142998666"
class="anchor"><span id="_Toc143063758" class="anchor"><span
id="_Toc143509868" class="anchor"><span id="_Toc143510315"
class="anchor"><span id="_Toc144026347" class="anchor"><span
id="_Toc144026678" class="anchor"><span id="_Toc144276321"
class="anchor"><span id="_Toc144276665" class="anchor"><span
id="_Toc144280253" class="anchor"><span id="_Toc144280599"
class="anchor"><span id="_Toc144540814" class="anchor"><span
id="_Toc144554697" class="anchor"><span id="_Toc144722318"
class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>17**.**

### <span id="_Toc222907415" class="anchor"><span id="_Toc342653120" class="anchor"><span id="_Toc439864215" class="anchor"></span></span></span>Message Header

Each message begins with a common message header. The significant fields
are the *MessageType*, *PayloadSize* and the *OriginationId* (the source
of the message). It is important to note that the payload size reflects
only the size of the data and does not include the message header. The
message header is described in section 17.8.4.

### <span id="_Toc145503781" class="anchor"><span id="_Toc145512223" class="anchor"><span id="_Toc145513246" class="anchor"><span id="_Toc145513630" class="anchor"><span id="_Toc222907416" class="anchor"><span id="_Toc342653121" class="anchor"><span id="_Toc439864216" class="anchor"></span></span></span></span></span></span></span>Intercept Message Header

All x64 memory access messages and processor intercept messages contain
a common payload header. This header contains information about the
state of the virtual processor at the time of the intercept, making it
easier for the recipient of the message to complete the intercepted
instruction in software.

typedef struct

{

HV\_VP\_INDEX VpIndex;

UINT8 InstructionLength;

HV\_INTERCEPT\_ACCESS\_TYPE\_MASK InterceptAccessType;

HV\_X64\_VP\_EXECUTION\_STATE ExecutionState;

HV\_X64\_SEGMENT\_REGISTER CsSegment;

UINT64 Rip;

UINT64 Rflags;

} HV\_X64\_INTERCEPT\_MESSAGE\_HEADER;

*VpIndex* indicates the index of the virtual processor that generated
the intercept.

*InstructionLength* indicates the byte length of the instruction that
generated the intercept. If the instruction length is unknown, a length
of zero is reported, and the recipient of the message must fetch and
decode the instruction to determine its length. The hypervisor
guarantees that it will fill in the correct instruction length for
CPUID, I/O port, and MSR intercepts.

*InterceptAccessType* indicates the access type (read, write, or
execute) of the event that triggered the intercept.

*ExecutionState* provides miscellaneous information about the virtual
processor’s state at the time the intercept was triggered.

*CsSegment* provides information about the code segment at the time the
intercept was triggered.

*Rip* provides the instruction pointer at the time the intercept was
triggered.

*Rflags* provides the flags register at the time the intercept was
triggered.

### <span id="_Ref108669981" class="anchor"><span id="_Toc110172861" class="anchor"><span id="_Toc127596868" class="anchor"><span id="_Toc127786489" class="anchor"><span id="_Toc127786805" class="anchor"><span id="_Toc127787121" class="anchor"><span id="_Toc127877795" class="anchor"><span id="_Toc128289865" class="anchor"><span id="_Toc128290258" class="anchor"><span id="_Toc130189863" class="anchor"><span id="_Toc130201079" class="anchor"><span id="_Toc130201395" class="anchor"><span id="_Toc130201716" class="anchor"><span id="_Toc131936908" class="anchor"><span id="_Toc133901269" class="anchor"><span id="_Toc137461143" class="anchor"><span id="_Toc139096658" class="anchor"><span id="_Toc139188581" class="anchor"><span id="_Toc139191444" class="anchor"><span id="_Toc140490496" class="anchor"><span id="_Toc140571398" class="anchor"><span id="_Toc141257671" class="anchor"><span id="_Toc141257998" class="anchor"><span id="_Toc141267526" class="anchor"><span id="_Toc141522544" class="anchor"><span id="_Toc141529632" class="anchor"><span id="_Toc141529949" class="anchor"><span id="_Toc141851558" class="anchor"><span id="_Toc141852492" class="anchor"><span id="_Toc141888036" class="anchor"><span id="_Toc141889876" class="anchor"><span id="_Toc141893545" class="anchor"><span id="_Toc142113398" class="anchor"><span id="_Toc142114426" class="anchor"><span id="_Toc142729643" class="anchor"><span id="_Toc142730927" class="anchor"><span id="_Toc142731300" class="anchor"><span id="_Toc142998667" class="anchor"><span id="_Toc143063759" class="anchor"><span id="_Toc143509869" class="anchor"><span id="_Toc143510316" class="anchor"><span id="_Toc144026348" class="anchor"><span id="_Toc144026679" class="anchor"><span id="_Toc144276322" class="anchor"><span id="_Toc144276666" class="anchor"><span id="_Toc144280254" class="anchor"><span id="_Toc144280600" class="anchor"><span id="_Toc144540815" class="anchor"><span id="_Toc144554698" class="anchor"><span id="_Toc144722319" class="anchor"><span id="_Toc145503782" class="anchor"><span id="_Toc145512224" class="anchor"><span id="_Toc145513247" class="anchor"><span id="_Toc145513631" class="anchor"><span id="_Toc222907417" class="anchor"><span id="_Toc342653122" class="anchor"><span id="_Toc439864217" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>VP

The execution state is a collection of flags that specify miscellaneous
states of the virtual processor.

typedef struct

{

UINT16 Cpl:2;

UINT16 Cr0Pe:1;

UINT16 Cr0Am:1;

UINT16 EferLma:1;

UINT16 DebugActive:1;

UINT16 InterruptionPending:1;

UINT16 Reserved:4;

UINT16 Reserved:5;

} HV\_X64\_VP\_EXECUTION\_STATE;

*Cpl* indicates the current privilege level at the time of the
intercept. Real mode has an implied CPL of 0, and v86 has an implied CPL
of 3. In other modes, the CPL is defined by the low-order two bits of
the code segment (CS).

*Cr0Pe* indicates whether the processor is executing within protected
mode.

*Cr0Am* indicates whether alignment must be checked for non-privileged
accesses.

*EferLma* indicates whether the processor is executing within long mode
(64-bit mode).

*DebugActive* indicates that one or more debug registers are marked as
active, so the recipient of the message may need to perform additional
work to correctly emulate the behavior of the debug breakpoint
facilities.

<span id="_Ref108671398" class="anchor"><span id="_Toc110172862"
class="anchor"></span></span>*InterruptionPending* indicates that the
intercept was generated while delivering an interruption. The
interruption is held pending and, unless removed, will be re-delivered
when the virtual processor is resumed. For a description of the *Pending
Interruption* register, see section 10.3.3.

### <span id="_Toc110172863" class="anchor"><span id="_Toc127596869" class="anchor"><span id="_Toc127786490" class="anchor"><span id="_Toc127786806" class="anchor"><span id="_Toc127787122" class="anchor"><span id="_Toc127877796" class="anchor"><span id="_Toc128289866" class="anchor"><span id="_Toc128290259" class="anchor"><span id="_Toc130189864" class="anchor"><span id="_Toc130201080" class="anchor"><span id="_Toc130201396" class="anchor"><span id="_Toc130201717" class="anchor"><span id="_Toc131936909" class="anchor"><span id="_Toc133901270" class="anchor"><span id="_Toc137461144" class="anchor"><span id="_Toc139096659" class="anchor"><span id="_Toc139188582" class="anchor"><span id="_Toc139191445" class="anchor"><span id="_Toc140490497" class="anchor"><span id="_Toc140571399" class="anchor"><span id="_Toc141257672" class="anchor"><span id="_Toc141257999" class="anchor"><span id="_Toc141267527" class="anchor"><span id="_Toc141522545" class="anchor"><span id="_Toc141529633" class="anchor"><span id="_Toc141529950" class="anchor"><span id="_Toc141851559" class="anchor"><span id="_Toc141852493" class="anchor"><span id="_Toc141888037" class="anchor"><span id="_Toc141889877" class="anchor"><span id="_Toc141893546" class="anchor"><span id="_Toc142113399" class="anchor"><span id="_Toc142114427" class="anchor"><span id="_Toc142729644" class="anchor"><span id="_Toc142730928" class="anchor"><span id="_Toc142731301" class="anchor"><span id="_Toc142998668" class="anchor"><span id="_Toc143063760" class="anchor"><span id="_Toc143509870" class="anchor"><span id="_Toc143510317" class="anchor"><span id="_Toc144026349" class="anchor"><span id="_Toc144026680" class="anchor"><span id="_Toc144276323" class="anchor"><span id="_Toc144276667" class="anchor"><span id="_Toc144280255" class="anchor"><span id="_Toc144280601" class="anchor"><span id="_Toc144540816" class="anchor"><span id="_Toc144554699" class="anchor"><span id="_Toc144722320" class="anchor"><span id="_Toc145503783" class="anchor"><span id="_Toc145512225" class="anchor"><span id="_Toc145513248" class="anchor"><span id="_Toc145513632" class="anchor"><span id="_Toc222907418" class="anchor"><span id="_Toc342653123" class="anchor"><span id="_Toc439864218" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> Access Information

On x64 platforms, I/O port access messages include a collection of flags
that provide information about the memory access.

typedef struct

{

UINT8 AccessSize:3;

UINT8 StringOp:1;

UINT8 RepPrefix:1;

UINT8 Reserved:3;

} HV\_X64\_IO\_PORT\_ACCESS\_INFO;

*AccessSize* indicates the size of the access. The following encodings
are used: 001b = 8 bits; 010b = 16 bits; 100b = 32 bits. All other
combinations are reserved.

*StringOp* indicates that the instruction is a string form (INS or
OUTS).

*RepPrefix* indicates that the instruction has a “rep" prefix. This flag
is used only for string operations.

### <span id="_Toc110172864" class="anchor"><span id="_Toc127596870" class="anchor"><span id="_Toc127786491" class="anchor"><span id="_Toc127786807" class="anchor"><span id="_Toc127787123" class="anchor"><span id="_Toc127877797" class="anchor"><span id="_Toc128289867" class="anchor"><span id="_Toc128290260" class="anchor"><span id="_Toc130189865" class="anchor"><span id="_Toc130201081" class="anchor"><span id="_Toc130201397" class="anchor"><span id="_Toc130201718" class="anchor"><span id="_Toc131936910" class="anchor"><span id="_Toc133901271" class="anchor"><span id="_Toc137461145" class="anchor"><span id="_Toc139096660" class="anchor"><span id="_Toc139188583" class="anchor"><span id="_Toc139191446" class="anchor"><span id="_Toc140490498" class="anchor"><span id="_Toc140571400" class="anchor"><span id="_Toc141257673" class="anchor"><span id="_Toc141258000" class="anchor"><span id="_Toc141267528" class="anchor"><span id="_Toc141522546" class="anchor"><span id="_Toc141529634" class="anchor"><span id="_Toc141529951" class="anchor"><span id="_Toc141851560" class="anchor"><span id="_Toc141852494" class="anchor"><span id="_Toc141888038" class="anchor"><span id="_Toc141889878" class="anchor"><span id="_Toc141893547" class="anchor"><span id="_Toc142113400" class="anchor"><span id="_Toc142114428" class="anchor"><span id="_Toc142729645" class="anchor"><span id="_Toc142730929" class="anchor"><span id="_Toc142731302" class="anchor"><span id="_Toc142998669" class="anchor"><span id="_Toc143063761" class="anchor"><span id="_Toc143509871" class="anchor"><span id="_Toc143510318" class="anchor"><span id="_Toc144026350" class="anchor"><span id="_Toc144026681" class="anchor"><span id="_Toc144276324" class="anchor"><span id="_Toc144276668" class="anchor"><span id="_Toc144280256" class="anchor"><span id="_Toc144280602" class="anchor"><span id="_Toc144540817" class="anchor"><span id="_Toc144554700" class="anchor"><span id="_Toc144722321" class="anchor"><span id="_Toc145503784" class="anchor"><span id="_Toc145512226" class="anchor"><span id="_Toc145513249" class="anchor"><span id="_Toc145513633" class="anchor"><span id="_Toc222907419" class="anchor"><span id="_Toc342653124" class="anchor"><span id="_Toc439864219" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Exception Information

On x64 platforms, exception intercept messages include a collection of
flags that provide information about the exception.

typedef struct

{

UINT8 ErrorCodeValid:1;

UINT8 Reserved:7;

} HV\_X64\_EXCEPTION\_INFO;

*ErrorCodeValid* indicates that the error code field in the exception
message is valid.

### <span id="_Toc144554701" class="anchor"><span id="_Toc144722322" class="anchor"><span id="_Toc145503785" class="anchor"><span id="_Toc145512227" class="anchor"><span id="_Toc145513250" class="anchor"><span id="_Toc145513634" class="anchor"><span id="_Toc222907420" class="anchor"><span id="_Toc342653125" class="anchor"><span id="_Ref108580549" class="anchor"><span id="_Toc110172867" class="anchor"><span id="_Toc127596871" class="anchor"><span id="_Toc127786492" class="anchor"><span id="_Toc127786808" class="anchor"><span id="_Toc127787124" class="anchor"><span id="_Toc127877798" class="anchor"><span id="_Toc128289868" class="anchor"><span id="_Toc128290261" class="anchor"><span id="_Toc130189866" class="anchor"><span id="_Toc130201082" class="anchor"><span id="_Toc130201398" class="anchor"><span id="_Toc130201719" class="anchor"><span id="_Toc131936911" class="anchor"><span id="_Toc133901272" class="anchor"><span id="_Toc137461146" class="anchor"><span id="_Toc139096661" class="anchor"><span id="_Toc139188584" class="anchor"><span id="_Toc139191447" class="anchor"><span id="_Toc140490499" class="anchor"><span id="_Toc140571401" class="anchor"><span id="_Toc141257674" class="anchor"><span id="_Toc141258001" class="anchor"><span id="_Toc141267529" class="anchor"><span id="_Toc141522547" class="anchor"><span id="_Toc141529635" class="anchor"><span id="_Toc141529952" class="anchor"><span id="_Toc141851561" class="anchor"><span id="_Toc141852495" class="anchor"><span id="_Toc141888039" class="anchor"><span id="_Toc141889879" class="anchor"><span id="_Toc141893548" class="anchor"><span id="_Toc142113401" class="anchor"><span id="_Toc142114429" class="anchor"><span id="_Toc142729646" class="anchor"><span id="_Toc142730930" class="anchor"><span id="_Toc142731303" class="anchor"><span id="_Toc142998670" class="anchor"><span id="_Toc143063762" class="anchor"><span id="_Toc143509872" class="anchor"><span id="_Toc143510319" class="anchor"><span id="_Toc144026351" class="anchor"><span id="_Toc144026682" class="anchor"><span id="_Toc144276325" class="anchor"><span id="_Toc144276669" class="anchor"><span id="_Toc144280257" class="anchor"><span id="_Toc144280603" class="anchor"><span id="_Toc144540818" class="anchor"><span id="_Toc439864220" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Memory Access Flags

Memory intercept messages include a collection of flags that provide
information about the intercept.

typedef struct

{

UINT8 GvaValid:1;

UINT8 Reserved:7;

} HV\_X64\_MEMORY\_ACCESS\_INFO;

*GvaValid* indicates that the *Gva* field of the memory access message
contains a valid guest virtual address.

<span id="_Toc144554702" class="anchor"><span id="_Toc144722323" class="anchor"><span id="_Toc145503786" class="anchor"><span id="_Toc145512228" class="anchor"><span id="_Toc145513251" class="anchor"><span id="_Toc145513635" class="anchor"><span id="_Toc222907421" class="anchor"><span id="_Toc342653126" class="anchor"><span id="_Toc439858210" class="anchor"><span id="_Toc439864221" class="anchor"></span></span></span></span></span></span></span></span></span></span>
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

  ------------------------------------------------- -- -- -- -- --
  <span id="_Toc437514261" class="anchor"></span>      
                                                             
  <span id="_Toc437514276" class="anchor"></span>      
  <span id="_Toc437514280" class="anchor"></span>      
  <span id="_Toc437514284" class="anchor"></span>      
  <span id="_Toc437514288" class="anchor"></span>      
  <span id="_Toc437514292" class="anchor"></span>            
  <span id="_Toc437514302" class="anchor"></span>      
  <span id="_Toc437514306" class="anchor"></span>      
  <span id="_Toc437514310" class="anchor"></span>      
  <span id="_Toc437514314" class="anchor"></span>      
  <span id="_Toc437514318" class="anchor"></span>      
  <span id="_Toc437514322" class="anchor"></span>      
  <span id="_Toc437514326" class="anchor"></span>      
  <span id="_Toc437514330" class="anchor"></span>      
  <span id="_Toc437514334" class="anchor"></span>      
  <span id="_Toc437514338" class="anchor"></span>      
  <span id="_Toc437514342" class="anchor"></span>      
  ------------------------------------------------- -- -- -- -- --

<span id="_Toc437514346" class="anchor"></span>

1.  ### <span id="_Toc110172868" class="anchor"><span id="_Toc127596872" class="anchor"><span id="_Toc127786493" class="anchor"><span id="_Toc127786809" class="anchor"><span id="_Toc127787125" class="anchor"><span id="_Toc127877799" class="anchor"><span id="_Toc128289869" class="anchor"><span id="_Toc128290262" class="anchor"><span id="_Toc130189867" class="anchor"><span id="_Toc130201083" class="anchor"><span id="_Toc130201399" class="anchor"><span id="_Toc130201720" class="anchor"><span id="_Toc131936912" class="anchor"><span id="_Toc133901273" class="anchor"><span id="_Toc137461147" class="anchor"><span id="_Toc139096662" class="anchor"><span id="_Toc139188585" class="anchor"><span id="_Toc139191448" class="anchor"><span id="_Toc140490500" class="anchor"><span id="_Toc140571402" class="anchor"><span id="_Toc141257675" class="anchor"><span id="_Toc141258002" class="anchor"><span id="_Toc141267530" class="anchor"><span id="_Toc141522548" class="anchor"><span id="_Toc141529636" class="anchor"><span id="_Toc141529953" class="anchor"><span id="_Toc141851562" class="anchor"><span id="_Toc141852496" class="anchor"><span id="_Toc141888040" class="anchor"><span id="_Toc141889880" class="anchor"><span id="_Toc141893549" class="anchor"><span id="_Toc142113402" class="anchor"><span id="_Toc142114430" class="anchor"><span id="_Toc142729647" class="anchor"><span id="_Toc142730931" class="anchor"><span id="_Toc142731304" class="anchor"><span id="_Toc142998671" class="anchor"><span id="_Toc143063763" class="anchor"><span id="_Toc143509873" class="anchor"><span id="_Toc143510320" class="anchor"><span id="_Toc144026352" class="anchor"><span id="_Toc144026683" class="anchor"><span id="_Toc144276326" class="anchor"><span id="_Toc144276670" class="anchor"><span id="_Toc144280258" class="anchor"><span id="_Toc144280604" class="anchor"><span id="_Toc144540819" class="anchor"><span id="_Toc144554703" class="anchor"><span id="_Toc144722324" class="anchor"><span id="_Toc145503787" class="anchor"><span id="_Toc145512229" class="anchor"><span id="_Toc145513252" class="anchor"><span id="_Toc145513636" class="anchor"><span id="_Toc222907422" class="anchor"><span id="_Toc342653127" class="anchor"><span id="_Toc439858211" class="anchor"><span id="_Toc439864222" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>

2.  ### <span id="_Toc110172869" class="anchor"><span id="_Toc127596873" class="anchor"><span id="_Toc127786494" class="anchor"><span id="_Toc127786810" class="anchor"><span id="_Toc127787126" class="anchor"><span id="_Toc127877800" class="anchor"><span id="_Toc128289870" class="anchor"><span id="_Toc128290263" class="anchor"><span id="_Toc130189868" class="anchor"><span id="_Toc130201084" class="anchor"><span id="_Toc130201400" class="anchor"><span id="_Toc130201721" class="anchor"><span id="_Toc131936913" class="anchor"><span id="_Toc133901274" class="anchor"><span id="_Toc137461148" class="anchor"><span id="_Toc139096663" class="anchor"><span id="_Toc139188586" class="anchor"><span id="_Toc139191449" class="anchor"><span id="_Toc140490501" class="anchor"><span id="_Toc140571403" class="anchor"><span id="_Toc141257676" class="anchor"><span id="_Toc141258003" class="anchor"><span id="_Toc141267531" class="anchor"><span id="_Toc141522549" class="anchor"><span id="_Toc141529637" class="anchor"><span id="_Toc141529954" class="anchor"><span id="_Toc141851563" class="anchor"><span id="_Toc141852497" class="anchor"><span id="_Toc141888041" class="anchor"><span id="_Toc141889881" class="anchor"><span id="_Toc141893550" class="anchor"><span id="_Toc142113403" class="anchor"><span id="_Toc142114431" class="anchor"><span id="_Toc142729648" class="anchor"><span id="_Toc142730932" class="anchor"><span id="_Toc142731305" class="anchor"><span id="_Toc142998672" class="anchor"><span id="_Toc143063764" class="anchor"><span id="_Toc143509874" class="anchor"><span id="_Toc143510321" class="anchor"><span id="_Toc144026353" class="anchor"><span id="_Toc144026684" class="anchor"><span id="_Toc144276327" class="anchor"><span id="_Toc144276671" class="anchor"><span id="_Toc144280259" class="anchor"><span id="_Toc144280605" class="anchor"><span id="_Toc144540820" class="anchor"><span id="_Toc144554704" class="anchor"><span id="_Toc144722325" class="anchor"><span id="_Toc145503788" class="anchor"><span id="_Toc145512230" class="anchor"><span id="_Toc145513253" class="anchor"><span id="_Toc145513637" class="anchor"><span id="_Toc222907423" class="anchor"><span id="_Toc342653128" class="anchor"><span id="_Toc439858212" class="anchor"><span id="_Toc439864223" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>

<!-- -->

1.  <span id="_Ref108704550" class="anchor"><span id="_Toc110172871" class="anchor"><span id="_Toc127596874" class="anchor"><span id="_Toc127786495" class="anchor"><span id="_Toc127786811" class="anchor"><span id="_Toc127787127" class="anchor"><span id="_Toc127877801" class="anchor"><span id="_Toc128289871" class="anchor"><span id="_Toc128290264" class="anchor"><span id="_Toc130189869" class="anchor"><span id="_Toc130201085" class="anchor"><span id="_Toc130201401" class="anchor"><span id="_Toc130201722" class="anchor"><span id="_Toc131936914" class="anchor"><span id="_Toc133901275" class="anchor"><span id="_Toc137461149" class="anchor"><span id="_Toc139096664" class="anchor"><span id="_Toc139188587" class="anchor"><span id="_Toc139191450" class="anchor"><span id="_Toc140490502" class="anchor"><span id="_Toc140571404" class="anchor"><span id="_Toc141257677" class="anchor"><span id="_Toc141258004" class="anchor"><span id="_Toc141267532" class="anchor"><span id="_Toc141522550" class="anchor"><span id="_Toc141529638" class="anchor"><span id="_Toc141529955" class="anchor"><span id="_Toc141851564" class="anchor"><span id="_Toc141852498" class="anchor"><span id="_Toc141888042" class="anchor"><span id="_Toc141889882" class="anchor"><span id="_Toc141893551" class="anchor"><span id="_Toc142113404" class="anchor"><span id="_Toc142114432" class="anchor"><span id="_Toc142729649" class="anchor"><span id="_Toc142730933" class="anchor"><span id="_Toc142731306" class="anchor"><span id="_Toc142998673" class="anchor"><span id="_Toc143063765" class="anchor"><span id="_Toc143509875" class="anchor"><span id="_Toc143510322" class="anchor"><span id="_Toc144026354" class="anchor"><span id="_Toc144026685" class="anchor"><span id="_Toc144276328" class="anchor"><span id="_Toc144276672" class="anchor"><span id="_Toc144280260" class="anchor"><span id="_Toc144280606" class="anchor"><span id="_Toc144540821" class="anchor"><span id="_Toc144554705" class="anchor"><span id="_Toc144722326" class="anchor"><span id="_Toc145503789" class="anchor"><span id="_Toc145512231" class="anchor"><span id="_Toc145513254" class="anchor"><span id="_Toc145513638" class="anchor"><span id="_Toc222907424" class="anchor"><span id="_Toc342653129" class="anchor"><span id="_Toc439864224" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Timer Messages
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

    1.  ### <span id="_Toc110172872" class="anchor"><span id="_Toc127596875" class="anchor"><span id="_Toc127786496" class="anchor"><span id="_Toc127786812" class="anchor"><span id="_Toc127787128" class="anchor"><span id="_Toc127877802" class="anchor"><span id="_Toc128289872" class="anchor"><span id="_Toc128290265" class="anchor"><span id="_Toc130189870" class="anchor"><span id="_Toc130201086" class="anchor"><span id="_Toc130201402" class="anchor"><span id="_Toc130201723" class="anchor"><span id="_Toc131936915" class="anchor"><span id="_Toc133901276" class="anchor"><span id="_Toc137461150" class="anchor"><span id="_Toc139096665" class="anchor"><span id="_Toc139188588" class="anchor"><span id="_Toc139191451" class="anchor"><span id="_Toc140490503" class="anchor"><span id="_Toc140571405" class="anchor"><span id="_Toc141257678" class="anchor"><span id="_Toc141258005" class="anchor"><span id="_Toc141267533" class="anchor"><span id="_Toc141522551" class="anchor"><span id="_Toc141529639" class="anchor"><span id="_Toc141529956" class="anchor"><span id="_Toc141851565" class="anchor"><span id="_Toc141852499" class="anchor"><span id="_Toc141888043" class="anchor"><span id="_Toc141889883" class="anchor"><span id="_Toc141893552" class="anchor"><span id="_Toc142113405" class="anchor"><span id="_Toc142114433" class="anchor"><span id="_Toc142729650" class="anchor"><span id="_Toc142730934" class="anchor"><span id="_Toc142731307" class="anchor"><span id="_Toc142998674" class="anchor"><span id="_Toc143063766" class="anchor"><span id="_Toc143509876" class="anchor"><span id="_Toc143510323" class="anchor"><span id="_Toc144026355" class="anchor"><span id="_Toc144026686" class="anchor"><span id="_Toc144276329" class="anchor"><span id="_Toc144276673" class="anchor"><span id="_Toc144280261" class="anchor"><span id="_Toc144280607" class="anchor"><span id="_Toc144540822" class="anchor"><span id="_Toc144554706" class="anchor"><span id="_Toc144722327" class="anchor"><span id="_Toc145503790" class="anchor"><span id="_Toc145512232" class="anchor"><span id="_Toc145513255" class="anchor"><span id="_Toc145513639" class="anchor"><span id="_Toc222907425" class="anchor"><span id="_Toc342653130" class="anchor"><span id="_Toc439864225" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Timer Expiration Message

Timer expiration messages are sent when a timer event fires.

  -----------------------------------------------------------------------------------------
  Message Header             0    MessageType (4 bytes)      Rsvd (3 bytes)   PayloadSize
                                                                              
                                                                              (1 byte)
  -------------------------- ---- -------------------------- ---------------- -------------
                             8    Rsvd (8 bytes)

  Timer Expiration Payload   16   TimerIndex (4 bytes)       Rsvd (4 bytes)

                             24   ExpirationTime (8 bytes)

                             32   DeliveryTime (8 bytes)
  -----------------------------------------------------------------------------------------

*TimerIndex* is the index of the synthetic timer (0 through 3) that
generated the message. This allows a client to configure multiple timers
to use the same interrupt vector and differentiate between their
messages.

*ExpirationTime* is the expected expiration time of the timer measured
in 100-nanosecond units by using the time base of the partition’s
reference time counter. Note that the expiration message may arrive
after the expiration time.

*DeliveryTime* is the time when the message is placed into the
respective message slot of the SIM page. The time is measured in
100-nanosecond units based on the partition’s reference time counter.

<span id="_Toc110172873" class="anchor"><span id="_Toc127596876" class="anchor"><span id="_Toc127786497" class="anchor"><span id="_Toc127786813" class="anchor"><span id="_Toc127787129" class="anchor"><span id="_Toc127877803" class="anchor"><span id="_Toc128289873" class="anchor"><span id="_Toc128290266" class="anchor"><span id="_Toc130189871" class="anchor"><span id="_Toc130201087" class="anchor"><span id="_Toc130201403" class="anchor"><span id="_Toc130201724" class="anchor"><span id="_Toc131936916" class="anchor"><span id="_Toc133901277" class="anchor"><span id="_Toc137461151" class="anchor"><span id="_Toc139096666" class="anchor"><span id="_Toc139188589" class="anchor"><span id="_Toc139191452" class="anchor"><span id="_Toc140490504" class="anchor"><span id="_Toc140571406" class="anchor"><span id="_Toc141257679" class="anchor"><span id="_Toc141258006" class="anchor"><span id="_Toc141267534" class="anchor"><span id="_Toc141522552" class="anchor"><span id="_Toc141529640" class="anchor"><span id="_Toc141529957" class="anchor"><span id="_Toc141851566" class="anchor"><span id="_Toc141852500" class="anchor"><span id="_Toc141888044" class="anchor"><span id="_Toc141889884" class="anchor"><span id="_Toc141893553" class="anchor"><span id="_Toc142113406" class="anchor"><span id="_Toc142114434" class="anchor"><span id="_Toc142729651" class="anchor"><span id="_Toc142730935" class="anchor"><span id="_Toc142731308" class="anchor"><span id="_Toc142998675" class="anchor"><span id="_Toc143063767" class="anchor"><span id="_Toc143509877" class="anchor"><span id="_Toc143510324" class="anchor"><span id="_Toc144026356" class="anchor"><span id="_Toc144026687" class="anchor"><span id="_Toc144276330" class="anchor"><span id="_Toc144276674" class="anchor"><span id="_Toc144280262" class="anchor"><span id="_Toc144280608" class="anchor"><span id="_Toc144540823" class="anchor"><span id="_Toc144554707" class="anchor"><span id="_Toc144722328" class="anchor"><span id="_Toc145503791" class="anchor"><span id="_Toc145512233" class="anchor"><span id="_Toc145513256" class="anchor"><span id="_Toc145513640" class="anchor"><span id="_Toc222907426" class="anchor"><span id="_Toc342653131" class="anchor"><span id="_Toc439864226" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Processor Event Messages
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

Processor event messages are sent in response to certain actions
performed by a virtual processor.

### <span id="_Toc110172875" class="anchor"><span id="_Toc127596877" class="anchor"><span id="_Toc127786498" class="anchor"><span id="_Toc127786814" class="anchor"><span id="_Toc127787130" class="anchor"><span id="_Toc127877804" class="anchor"><span id="_Toc128289874" class="anchor"><span id="_Toc128290267" class="anchor"><span id="_Toc130189872" class="anchor"><span id="_Toc130201088" class="anchor"><span id="_Toc130201404" class="anchor"><span id="_Toc130201725" class="anchor"><span id="_Toc131936917" class="anchor"><span id="_Toc133901278" class="anchor"><span id="_Toc137461152" class="anchor"><span id="_Toc139096667" class="anchor"><span id="_Toc139188590" class="anchor"><span id="_Toc139191453" class="anchor"><span id="_Toc140490505" class="anchor"><span id="_Toc140571407" class="anchor"><span id="_Toc141257680" class="anchor"><span id="_Toc141258007" class="anchor"><span id="_Toc141267535" class="anchor"><span id="_Toc141522553" class="anchor"><span id="_Toc141529641" class="anchor"><span id="_Toc141529958" class="anchor"><span id="_Toc141851567" class="anchor"><span id="_Toc141852501" class="anchor"><span id="_Toc141888045" class="anchor"><span id="_Toc141889885" class="anchor"><span id="_Toc141893554" class="anchor"><span id="_Toc142113407" class="anchor"><span id="_Toc142114435" class="anchor"><span id="_Toc142729652" class="anchor"><span id="_Toc142730936" class="anchor"><span id="_Toc142731309" class="anchor"><span id="_Toc142998676" class="anchor"><span id="_Toc143063768" class="anchor"><span id="_Toc143509878" class="anchor"><span id="_Toc143510325" class="anchor"><span id="_Toc144026357" class="anchor"><span id="_Toc144026688" class="anchor"><span id="_Toc144276331" class="anchor"><span id="_Toc144276675" class="anchor"><span id="_Toc144280263" class="anchor"><span id="_Toc144280609" class="anchor"><span id="_Toc144540824" class="anchor"><span id="_Toc144554708" class="anchor"><span id="_Toc144722329" class="anchor"><span id="_Toc145503792" class="anchor"><span id="_Toc145512234" class="anchor"><span id="_Toc145513257" class="anchor"><span id="_Toc145513641" class="anchor"><span id="_Toc222907427" class="anchor"><span id="_Toc342653132" class="anchor"><span id="_Toc439858216" class="anchor"><span id="_Toc439864227" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>

  ------------------------------------------------- -- -- -- -- --
  <span id="_Toc437514372" class="anchor"></span>      
                                                             
  <span id="_Toc437514386" class="anchor"></span>      
  <span id="_Toc437514390" class="anchor"></span>      
  <span id="_Toc437514394" class="anchor"></span>      
  <span id="_Toc437514398" class="anchor"></span>      
  <span id="_Toc437514402" class="anchor"></span>      
  <span id="_Toc437514406" class="anchor"></span>      
  <span id="_Toc437514410" class="anchor"></span>      
  <span id="_Toc437514414" class="anchor"></span>      
  <span id="_Toc437514418" class="anchor"></span>      
  <span id="_Toc437514422" class="anchor"></span>      
  <span id="_Toc437514426" class="anchor"></span>      
  <span id="_Toc437514430" class="anchor"></span>      
  ------------------------------------------------- -- -- -- -- --

<span id="_Toc437514434" class="anchor"></span>

### <span id="_Toc110172876" class="anchor"><span id="_Toc127596878" class="anchor"><span id="_Toc127786499" class="anchor"><span id="_Toc127786815" class="anchor"><span id="_Toc127787131" class="anchor"><span id="_Toc127877805" class="anchor"><span id="_Toc128289875" class="anchor"><span id="_Toc128290268" class="anchor"><span id="_Toc130189873" class="anchor"><span id="_Toc130201089" class="anchor"><span id="_Toc130201405" class="anchor"><span id="_Toc130201726" class="anchor"><span id="_Toc131936918" class="anchor"><span id="_Toc133901279" class="anchor"><span id="_Toc137461153" class="anchor"><span id="_Toc139096668" class="anchor"><span id="_Toc139188591" class="anchor"><span id="_Toc139191454" class="anchor"><span id="_Toc140490506" class="anchor"><span id="_Toc140571408" class="anchor"><span id="_Toc141257681" class="anchor"><span id="_Toc141258008" class="anchor"><span id="_Toc141267536" class="anchor"><span id="_Toc141522554" class="anchor"><span id="_Toc141529642" class="anchor"><span id="_Toc141529959" class="anchor"><span id="_Toc141851568" class="anchor"><span id="_Toc141852502" class="anchor"><span id="_Toc141888046" class="anchor"><span id="_Toc141889886" class="anchor"><span id="_Toc141893555" class="anchor"><span id="_Toc142113408" class="anchor"><span id="_Toc142114436" class="anchor"><span id="_Toc142729653" class="anchor"><span id="_Toc142730937" class="anchor"><span id="_Toc142731310" class="anchor"><span id="_Toc142998677" class="anchor"><span id="_Toc143063769" class="anchor"><span id="_Toc143509879" class="anchor"><span id="_Toc143510326" class="anchor"><span id="_Toc144026358" class="anchor"><span id="_Toc144026689" class="anchor"><span id="_Toc144276332" class="anchor"><span id="_Toc144276676" class="anchor"><span id="_Toc144280264" class="anchor"><span id="_Toc144280610" class="anchor"><span id="_Toc144540825" class="anchor"><span id="_Toc144554709" class="anchor"><span id="_Toc144722330" class="anchor"><span id="_Toc145503793" class="anchor"><span id="_Toc145512235" class="anchor"><span id="_Toc145513258" class="anchor"><span id="_Toc145513642" class="anchor"><span id="_Toc222907428" class="anchor"><span id="_Toc342653133" class="anchor"><span id="_Toc439858217" class="anchor"><span id="_Toc439864228" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>

  ------------------------------------------------- -- -- -- -- --
  <span id="_Toc437514446" class="anchor"></span>      
                                                             
  <span id="_Toc437514460" class="anchor"></span>      
  <span id="_Toc437514464" class="anchor"></span>      
  <span id="_Toc437514468" class="anchor"></span>      
  <span id="_Toc437514472" class="anchor"></span>      
  <span id="_Toc437514476" class="anchor"></span>         
  <span id="_Toc437514481" class="anchor"></span>      
  <span id="_Toc437514485" class="anchor"></span>      
  ------------------------------------------------- -- -- -- -- --

### <span id="_Toc110172877" class="anchor"><span id="_Toc127596879" class="anchor"><span id="_Toc127786500" class="anchor"><span id="_Toc127786816" class="anchor"><span id="_Toc127787132" class="anchor"><span id="_Toc127877806" class="anchor"><span id="_Toc128289876" class="anchor"><span id="_Toc128290269" class="anchor"><span id="_Toc130189874" class="anchor"><span id="_Toc130201090" class="anchor"><span id="_Toc130201406" class="anchor"><span id="_Toc130201727" class="anchor"><span id="_Toc131936919" class="anchor"><span id="_Toc133901280" class="anchor"><span id="_Toc137461154" class="anchor"><span id="_Toc139096669" class="anchor"><span id="_Toc139188592" class="anchor"><span id="_Toc139191455" class="anchor"><span id="_Toc140490507" class="anchor"><span id="_Toc140571409" class="anchor"><span id="_Toc141257682" class="anchor"><span id="_Toc141258009" class="anchor"><span id="_Toc141267537" class="anchor"><span id="_Toc141522555" class="anchor"><span id="_Toc141529643" class="anchor"><span id="_Toc141529960" class="anchor"><span id="_Toc141851569" class="anchor"><span id="_Toc141852503" class="anchor"><span id="_Toc141888047" class="anchor"><span id="_Toc141889887" class="anchor"><span id="_Toc141893556" class="anchor"><span id="_Toc142113409" class="anchor"><span id="_Toc142114437" class="anchor"><span id="_Toc142729654" class="anchor"><span id="_Toc142730938" class="anchor"><span id="_Toc142731311" class="anchor"><span id="_Toc142998678" class="anchor"><span id="_Toc143063770" class="anchor"><span id="_Toc143509880" class="anchor"><span id="_Toc143510327" class="anchor"><span id="_Toc144026359" class="anchor"><span id="_Toc144026690" class="anchor"><span id="_Toc144276333" class="anchor"><span id="_Toc144276677" class="anchor"><span id="_Toc144280265" class="anchor"><span id="_Toc144280611" class="anchor"><span id="_Toc144540826" class="anchor"><span id="_Toc144554710" class="anchor"><span id="_Toc144722331" class="anchor"><span id="_Toc145503794" class="anchor"><span id="_Toc145512236" class="anchor"><span id="_Toc145513259" class="anchor"><span id="_Toc145513643" class="anchor"><span id="_Toc222907429" class="anchor"><span id="_Toc342653134" class="anchor"><span id="_Toc439858218" class="anchor"><span id="_Toc439864229" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>

  ------------------------------------------------- -- -- -- -- --
  <span id="_Toc437514501" class="anchor"></span>      
                                                             
  <span id="_Toc437514515" class="anchor"></span>      
  <span id="_Toc437514519" class="anchor"></span>      
  <span id="_Toc437514523" class="anchor"></span>      
  <span id="_Toc437514527" class="anchor"></span>      
  <span id="_Toc437514531" class="anchor"></span>            
  <span id="_Toc437514541" class="anchor"></span>      
  <span id="_Toc437514545" class="anchor"></span>      
  <span id="_Toc437514549" class="anchor"></span>      
  <span id="_Toc437514553" class="anchor"></span>      
  <span id="_Toc437514557" class="anchor"></span>      
  <span id="_Toc437514561" class="anchor"></span>      
  <span id="_Toc437514565" class="anchor"></span>      
  <span id="_Toc437514569" class="anchor"></span>      
  <span id="_Toc437514573" class="anchor"></span>      
  <span id="_Toc437514577" class="anchor"></span>      
  ------------------------------------------------- -- -- -- -- --

<span id="_Toc437514581" class="anchor"></span>

### <span id="_Toc110172878" class="anchor"><span id="_Toc127596880" class="anchor"><span id="_Toc127786501" class="anchor"><span id="_Toc127786817" class="anchor"><span id="_Toc127787133" class="anchor"><span id="_Toc127877807" class="anchor"><span id="_Toc128289877" class="anchor"><span id="_Toc128290270" class="anchor"><span id="_Toc130189875" class="anchor"><span id="_Toc130201091" class="anchor"><span id="_Toc130201407" class="anchor"><span id="_Toc130201728" class="anchor"><span id="_Toc131936920" class="anchor"><span id="_Toc133901281" class="anchor"><span id="_Toc137461155" class="anchor"><span id="_Toc139096670" class="anchor"><span id="_Toc139188593" class="anchor"><span id="_Toc139191456" class="anchor"><span id="_Toc140490508" class="anchor"><span id="_Toc140571410" class="anchor"><span id="_Toc141257683" class="anchor"><span id="_Toc141258010" class="anchor"><span id="_Toc141267538" class="anchor"><span id="_Toc141522556" class="anchor"><span id="_Toc141529644" class="anchor"><span id="_Toc141529961" class="anchor"><span id="_Toc141851570" class="anchor"><span id="_Toc141852504" class="anchor"><span id="_Toc141888048" class="anchor"><span id="_Toc141889888" class="anchor"><span id="_Toc141893557" class="anchor"><span id="_Toc142113410" class="anchor"><span id="_Toc142114438" class="anchor"><span id="_Toc142729655" class="anchor"><span id="_Toc142730939" class="anchor"><span id="_Toc142731312" class="anchor"><span id="_Toc142998679" class="anchor"><span id="_Toc143063771" class="anchor"><span id="_Toc143509881" class="anchor"><span id="_Toc143510328" class="anchor"><span id="_Toc144026360" class="anchor"><span id="_Toc144026691" class="anchor"><span id="_Toc144276334" class="anchor"><span id="_Toc144276678" class="anchor"><span id="_Toc144280266" class="anchor"><span id="_Toc144280612" class="anchor"><span id="_Toc144540827" class="anchor"><span id="_Toc144554711" class="anchor"><span id="_Toc144722332" class="anchor"><span id="_Toc145503795" class="anchor"><span id="_Toc145512237" class="anchor"><span id="_Toc145513260" class="anchor"><span id="_Toc145513644" class="anchor"><span id="_Toc222907430" class="anchor"><span id="_Toc342653135" class="anchor"><span id="_Toc439858219" class="anchor"><span id="_Toc439864230" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>

  ------------------------------------------------- -- -- -- -- --
  <span id="_Toc437514600" class="anchor"></span>      
                                                             
  <span id="_Toc437514614" class="anchor"></span>      
  <span id="_Toc437514618" class="anchor"></span>      
  <span id="_Toc437514622" class="anchor"></span>      
  <span id="_Toc437514626" class="anchor"></span>      
  <span id="_Toc437514630" class="anchor"></span>            
  <span id="_Toc437514639" class="anchor"></span>      
  <span id="_Toc437514643" class="anchor"></span>      
  <span id="_Toc437514647" class="anchor"></span>      
  <span id="_Toc437514651" class="anchor"></span>      
  <span id="_Toc437514655" class="anchor"></span>      
  <span id="_Toc437514659" class="anchor"></span>      
  <span id="_Toc437514663" class="anchor"></span>      
  <span id="_Toc437514667" class="anchor"></span>      
  <span id="_Toc437514671" class="anchor"></span>      
  <span id="_Toc437514675" class="anchor"></span>      
  <span id="_Toc437514679" class="anchor"></span>      
  ------------------------------------------------- -- -- -- -- --

### <span id="_Toc144554714" class="anchor"><span id="_Toc144554728" class="anchor"><span id="_Toc144554729" class="anchor"><span id="_Toc127596882" class="anchor"><span id="_Toc127786503" class="anchor"><span id="_Toc127786819" class="anchor"><span id="_Toc127787135" class="anchor"><span id="_Toc127877809" class="anchor"><span id="_Toc128289879" class="anchor"><span id="_Toc128290272" class="anchor"><span id="_Toc130189877" class="anchor"><span id="_Toc130201093" class="anchor"><span id="_Toc130201409" class="anchor"><span id="_Toc130201730" class="anchor"><span id="_Toc131936922" class="anchor"><span id="_Toc133901283" class="anchor"><span id="_Toc137461157" class="anchor"><span id="_Toc139096672" class="anchor"><span id="_Toc139188595" class="anchor"><span id="_Toc139191458" class="anchor"><span id="_Toc140490510" class="anchor"><span id="_Toc140571412" class="anchor"><span id="_Toc141257685" class="anchor"><span id="_Toc141258012" class="anchor"><span id="_Toc141267540" class="anchor"><span id="_Toc141522558" class="anchor"><span id="_Toc141529646" class="anchor"><span id="_Toc141529963" class="anchor"><span id="_Toc141851572" class="anchor"><span id="_Toc141852506" class="anchor"><span id="_Toc141888050" class="anchor"><span id="_Toc141889890" class="anchor"><span id="_Toc141893559" class="anchor"><span id="_Toc142113412" class="anchor"><span id="_Toc142114440" class="anchor"><span id="_Toc142729657" class="anchor"><span id="_Toc142730941" class="anchor"><span id="_Toc142731314" class="anchor"><span id="_Toc142998681" class="anchor"><span id="_Toc143063773" class="anchor"><span id="_Toc143509883" class="anchor"><span id="_Toc143510330" class="anchor"><span id="_Toc144026362" class="anchor"><span id="_Toc144026693" class="anchor"><span id="_Toc144276336" class="anchor"><span id="_Toc144276680" class="anchor"><span id="_Toc144280268" class="anchor"><span id="_Toc144280614" class="anchor"><span id="_Toc144540829" class="anchor"><span id="_Toc144554732" class="anchor"><span id="_Toc144722333" class="anchor"><span id="_Toc145503796" class="anchor"><span id="_Toc145512238" class="anchor"><span id="_Toc145513261" class="anchor"><span id="_Toc145513645" class="anchor"><span id="_Toc222907431" class="anchor"><span id="_Toc342653136" class="anchor"><span id="_Toc439864231" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>APIC EOI Message

An APIC EOI message is delivered by the hypervisor after a virtual
processor executes an instruction that writes to the APIC’s
memory-mapped EOI register or APIC EOI MSR, indicating the “end of
interrupt". This message is generated only for level-triggered fixed or
external interrupts.

  ---------------------------------------------------------------------------------------------
  Message Header     0    MessageType (4 bytes)       Rsvd (3 bytes)              PayloadSize
                                                                                  
                                                                                  (1 byte)
  ------------------ ---- --------------------------- --------------------------- -------------
                     8    SourcePartition (8 bytes)

  APIC EOI Payload   16   VpIndex (4 bytes)           InterruptVector (4 bytes)

                     
  ---------------------------------------------------------------------------------------------

*VpIndex* provides the index of the virtual processor.

*InterruptVector* is the vector of the interrupt that was just EOI’ed.

### <span id="_Toc127596883" class="anchor"><span id="_Toc127786504" class="anchor"><span id="_Toc127786820" class="anchor"><span id="_Toc127787136" class="anchor"><span id="_Toc127877810" class="anchor"><span id="_Toc128289880" class="anchor"><span id="_Toc128290273" class="anchor"><span id="_Toc130189878" class="anchor"><span id="_Toc130201094" class="anchor"><span id="_Toc130201410" class="anchor"><span id="_Toc130201731" class="anchor"><span id="_Toc131936923" class="anchor"><span id="_Toc133901284" class="anchor"><span id="_Toc137461158" class="anchor"><span id="_Toc139096673" class="anchor"><span id="_Toc139188596" class="anchor"><span id="_Toc139191459" class="anchor"><span id="_Toc140490511" class="anchor"><span id="_Toc140571413" class="anchor"><span id="_Toc141257686" class="anchor"><span id="_Toc141258013" class="anchor"><span id="_Toc141267541" class="anchor"><span id="_Toc141522559" class="anchor"><span id="_Toc141529647" class="anchor"><span id="_Toc141529964" class="anchor"><span id="_Toc141851573" class="anchor"><span id="_Toc141852507" class="anchor"><span id="_Toc141888051" class="anchor"><span id="_Toc141889891" class="anchor"><span id="_Toc141893560" class="anchor"><span id="_Toc142113413" class="anchor"><span id="_Toc142114441" class="anchor"><span id="_Toc142729658" class="anchor"><span id="_Toc142730942" class="anchor"><span id="_Toc142731315" class="anchor"><span id="_Toc142998682" class="anchor"><span id="_Toc143063774" class="anchor"><span id="_Toc143509884" class="anchor"><span id="_Toc143510331" class="anchor"><span id="_Toc144026363" class="anchor"><span id="_Toc144026694" class="anchor"><span id="_Toc144276337" class="anchor"><span id="_Toc144276681" class="anchor"><span id="_Toc144280269" class="anchor"><span id="_Toc144280615" class="anchor"><span id="_Toc144540830" class="anchor"><span id="_Toc144554733" class="anchor"><span id="_Toc144722334" class="anchor"><span id="_Toc145503797" class="anchor"><span id="_Toc145512239" class="anchor"><span id="_Toc145513262" class="anchor"><span id="_Toc145513646" class="anchor"><span id="_Toc222907432" class="anchor"><span id="_Toc342653137" class="anchor"><span id="_Toc439864232" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>FERR Asserted Message

A FERR Asserted (legacy floating point support) message is delivered by
the hypervisor after a virtual processor executes an instruction that
generates an unmasked floating point error when CR0.NE is zero and the
IGNNE\# bit (in HvX64RegisterFpControlStatus) is zero.

  -----------------------------------------------------------------------------------
  Message Header      0    MessageType (4 bytes)       Rsvd (3 bytes)   PayloadSize
                                                                        
                                                                        (1 byte)
  ------------------- ---- --------------------------- ---------------- -------------
                      8    SourcePartition (8 bytes)

  Legacy FP Payload   16   VpIndex (4 bytes)           Rsvd (4 bytes)

                      
  -----------------------------------------------------------------------------------

*VpIndex* provides the index of the virtual processor.

### <span id="_Toc127596884" class="anchor"><span id="_Toc127786505" class="anchor"><span id="_Toc127786821" class="anchor"><span id="_Toc127787137" class="anchor"><span id="_Toc127877811" class="anchor"><span id="_Toc128289881" class="anchor"><span id="_Toc128290274" class="anchor"><span id="_Toc130189879" class="anchor"><span id="_Toc130201095" class="anchor"><span id="_Toc130201411" class="anchor"><span id="_Toc130201732" class="anchor"><span id="_Toc131936924" class="anchor"><span id="_Toc133901285" class="anchor"><span id="_Toc137461159" class="anchor"><span id="_Toc139096674" class="anchor"><span id="_Toc139188597" class="anchor"><span id="_Toc139191460" class="anchor"><span id="_Toc140490512" class="anchor"><span id="_Toc140571414" class="anchor"><span id="_Toc141257687" class="anchor"><span id="_Toc141258014" class="anchor"><span id="_Toc141267542" class="anchor"><span id="_Toc141522560" class="anchor"><span id="_Toc141529648" class="anchor"><span id="_Toc141529965" class="anchor"><span id="_Toc141851574" class="anchor"><span id="_Toc141852508" class="anchor"><span id="_Toc141888052" class="anchor"><span id="_Toc141889892" class="anchor"><span id="_Toc141893561" class="anchor"><span id="_Toc142113414" class="anchor"><span id="_Toc142114442" class="anchor"><span id="_Toc142729659" class="anchor"><span id="_Toc142730943" class="anchor"><span id="_Toc142731316" class="anchor"><span id="_Toc142998683" class="anchor"><span id="_Toc143063775" class="anchor"><span id="_Toc143509885" class="anchor"><span id="_Toc143510332" class="anchor"><span id="_Toc144026364" class="anchor"><span id="_Toc144026695" class="anchor"><span id="_Toc144276338" class="anchor"><span id="_Toc144276682" class="anchor"><span id="_Toc144280270" class="anchor"><span id="_Toc144280616" class="anchor"><span id="_Toc144540831" class="anchor"><span id="_Toc144554734" class="anchor"><span id="_Toc144722335" class="anchor"><span id="_Toc145503798" class="anchor"><span id="_Toc145512240" class="anchor"><span id="_Toc145513263" class="anchor"><span id="_Toc145513647" class="anchor"><span id="_Toc222907433" class="anchor"><span id="_Toc342653138" class="anchor"><span id="_Toc439858222" class="anchor"><span id="_Toc439864233" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>

  -- -- -- -- --
        
           
     
  -- -- -- -- --

### <span id="_Toc127596885" class="anchor"><span id="_Toc127786506" class="anchor"><span id="_Toc127786822" class="anchor"><span id="_Toc127787138" class="anchor"><span id="_Toc127877812" class="anchor"><span id="_Toc128289882" class="anchor"><span id="_Toc128290275" class="anchor"><span id="_Toc130189880" class="anchor"><span id="_Toc130201096" class="anchor"><span id="_Toc130201412" class="anchor"><span id="_Toc130201733" class="anchor"><span id="_Toc131936925" class="anchor"><span id="_Toc133901286" class="anchor"><span id="_Toc137461160" class="anchor"><span id="_Toc139096675" class="anchor"><span id="_Toc139188598" class="anchor"><span id="_Toc139191461" class="anchor"><span id="_Toc140490513" class="anchor"><span id="_Toc140571415" class="anchor"><span id="_Toc141257688" class="anchor"><span id="_Toc141258015" class="anchor"><span id="_Toc141267543" class="anchor"><span id="_Toc141522561" class="anchor"><span id="_Toc141529649" class="anchor"><span id="_Toc141529966" class="anchor"><span id="_Toc141851575" class="anchor"><span id="_Toc141852509" class="anchor"><span id="_Toc141888053" class="anchor"><span id="_Toc141889893" class="anchor"><span id="_Toc141893562" class="anchor"><span id="_Toc142113415" class="anchor"><span id="_Toc142114443" class="anchor"><span id="_Toc142729660" class="anchor"><span id="_Toc142730944" class="anchor"><span id="_Toc142731317" class="anchor"><span id="_Toc142998684" class="anchor"><span id="_Toc143063776" class="anchor"><span id="_Toc143509886" class="anchor"><span id="_Toc143510333" class="anchor"><span id="_Toc144026365" class="anchor"><span id="_Toc144026696" class="anchor"><span id="_Toc144276339" class="anchor"><span id="_Toc144276683" class="anchor"><span id="_Toc144280271" class="anchor"><span id="_Toc144280617" class="anchor"><span id="_Toc144540832" class="anchor"><span id="_Toc144554735" class="anchor"><span id="_Toc144722336" class="anchor"><span id="_Toc145503799" class="anchor"><span id="_Toc145512241" class="anchor"><span id="_Toc145513264" class="anchor"><span id="_Toc145513648" class="anchor"><span id="_Toc222907434" class="anchor"><span id="_Toc342653139" class="anchor"><span id="_Toc439858223" class="anchor"><span id="_Toc439864234" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>

  -- -- -- -- -- --
        
              
        
        
        
        
  -- -- -- -- -- --

### <span id="_Toc127596886" class="anchor"><span id="_Toc127786507" class="anchor"><span id="_Toc127786823" class="anchor"><span id="_Toc127787139" class="anchor"><span id="_Toc127877813" class="anchor"><span id="_Toc128289883" class="anchor"><span id="_Toc128290276" class="anchor"><span id="_Toc130189881" class="anchor"><span id="_Toc130201097" class="anchor"><span id="_Toc130201413" class="anchor"><span id="_Toc130201734" class="anchor"><span id="_Toc131936926" class="anchor"><span id="_Toc133901287" class="anchor"><span id="_Toc137461161" class="anchor"><span id="_Toc139096676" class="anchor"><span id="_Toc139188599" class="anchor"><span id="_Toc139191462" class="anchor"><span id="_Toc140490514" class="anchor"><span id="_Toc140571416" class="anchor"><span id="_Toc141257689" class="anchor"><span id="_Toc141258016" class="anchor"><span id="_Toc141267544" class="anchor"><span id="_Toc141522562" class="anchor"><span id="_Toc141529650" class="anchor"><span id="_Toc141529967" class="anchor"><span id="_Toc141851576" class="anchor"><span id="_Toc141852510" class="anchor"><span id="_Toc141888054" class="anchor"><span id="_Toc141889894" class="anchor"><span id="_Toc141893563" class="anchor"><span id="_Toc142113416" class="anchor"><span id="_Toc142114444" class="anchor"><span id="_Toc142729661" class="anchor"><span id="_Toc142730945" class="anchor"><span id="_Toc142731318" class="anchor"><span id="_Toc142998685" class="anchor"><span id="_Toc143063777" class="anchor"><span id="_Toc143509887" class="anchor"><span id="_Toc143510334" class="anchor"><span id="_Toc144026366" class="anchor"><span id="_Toc144026697" class="anchor"><span id="_Toc144276340" class="anchor"><span id="_Toc144276684" class="anchor"><span id="_Toc144280272" class="anchor"><span id="_Toc144280618" class="anchor"><span id="_Toc144540833" class="anchor"><span id="_Toc144554736" class="anchor"><span id="_Toc144722337" class="anchor"><span id="_Toc145503800" class="anchor"><span id="_Toc145512242" class="anchor"><span id="_Toc145513265" class="anchor"><span id="_Toc145513649" class="anchor"><span id="_Toc222907435" class="anchor"><span id="_Toc342653140" class="anchor"><span id="_Toc439858224" class="anchor"><span id="_Toc439864235" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>

  -- -- -- -- --
        
           
        
  -- -- -- -- --

### <span id="_Ref114929063" class="anchor"><span id="_Toc127596887" class="anchor"><span id="_Toc127786508" class="anchor"><span id="_Toc127786824" class="anchor"><span id="_Toc127787140" class="anchor"><span id="_Toc127877814" class="anchor"><span id="_Toc128289884" class="anchor"><span id="_Toc128290277" class="anchor"><span id="_Toc130189882" class="anchor"><span id="_Toc130201098" class="anchor"><span id="_Toc130201414" class="anchor"><span id="_Toc130201735" class="anchor"><span id="_Toc131936927" class="anchor"><span id="_Toc133901288" class="anchor"><span id="_Toc137461162" class="anchor"><span id="_Toc139096677" class="anchor"><span id="_Toc139188600" class="anchor"><span id="_Toc139191463" class="anchor"><span id="_Toc140490515" class="anchor"><span id="_Toc140571417" class="anchor"><span id="_Toc141257690" class="anchor"><span id="_Toc141258017" class="anchor"><span id="_Toc141267545" class="anchor"><span id="_Toc141522563" class="anchor"><span id="_Toc141529651" class="anchor"><span id="_Toc141529968" class="anchor"><span id="_Toc141851577" class="anchor"><span id="_Toc141852511" class="anchor"><span id="_Toc141888055" class="anchor"><span id="_Toc141889895" class="anchor"><span id="_Toc141893564" class="anchor"><span id="_Toc142113417" class="anchor"><span id="_Toc142114445" class="anchor"><span id="_Toc142729662" class="anchor"><span id="_Toc142730946" class="anchor"><span id="_Toc142731319" class="anchor"><span id="_Toc142998686" class="anchor"><span id="_Toc143063778" class="anchor"><span id="_Toc143509888" class="anchor"><span id="_Toc143510335" class="anchor"><span id="_Toc144026367" class="anchor"><span id="_Toc144026698" class="anchor"><span id="_Toc144276341" class="anchor"><span id="_Toc144276685" class="anchor"><span id="_Toc144280273" class="anchor"><span id="_Toc144280619" class="anchor"><span id="_Toc144540834" class="anchor"><span id="_Toc144554737" class="anchor"><span id="_Toc144722338" class="anchor"><span id="_Toc145503801" class="anchor"><span id="_Toc145512243" class="anchor"><span id="_Toc145513266" class="anchor"><span id="_Toc145513650" class="anchor"><span id="_Toc222907436" class="anchor"><span id="_Toc342653141" class="anchor"><span id="_Toc439858225" class="anchor"><span id="_Toc439864236" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>

  -- -- -- -- --
        
           
     
  -- -- -- -- --

<span id="_Toc127596888" class="anchor"><span id="_Toc127786509" class="anchor"><span id="_Toc127786825" class="anchor"><span id="_Toc127787141" class="anchor"><span id="_Toc127877815" class="anchor"><span id="_Toc128289885" class="anchor"><span id="_Toc128290278" class="anchor"><span id="_Toc130189883" class="anchor"><span id="_Toc130201099" class="anchor"><span id="_Toc130201415" class="anchor"><span id="_Toc130201736" class="anchor"><span id="_Ref130880172" class="anchor"><span id="_Toc131936928" class="anchor"><span id="_Toc133901289" class="anchor"><span id="_Toc137461163" class="anchor"><span id="_Toc139096678" class="anchor"><span id="_Toc139188601" class="anchor"><span id="_Toc139191464" class="anchor"><span id="_Toc140490516" class="anchor"><span id="_Toc140571418" class="anchor"><span id="_Toc141257691" class="anchor"><span id="_Toc141258018" class="anchor"><span id="_Toc141267546" class="anchor"><span id="_Toc141522564" class="anchor"><span id="_Toc141529652" class="anchor"><span id="_Toc141529969" class="anchor"><span id="_Toc141851578" class="anchor"><span id="_Toc141852512" class="anchor"><span id="_Toc141888056" class="anchor"><span id="_Toc141889896" class="anchor"><span id="_Toc141893565" class="anchor"><span id="_Toc142113418" class="anchor"><span id="_Toc142114446" class="anchor"><span id="_Toc142729663" class="anchor"><span id="_Toc142730947" class="anchor"><span id="_Toc142731320" class="anchor"><span id="_Toc142998687" class="anchor"><span id="_Toc143063779" class="anchor"><span id="_Toc143509889" class="anchor"><span id="_Toc143510336" class="anchor"><span id="_Toc144026368" class="anchor"><span id="_Toc144026699" class="anchor"><span id="_Toc144276342" class="anchor"><span id="_Toc144276686" class="anchor"><span id="_Toc144280274" class="anchor"><span id="_Toc144280620" class="anchor"><span id="_Toc144540835" class="anchor"><span id="_Toc144554738" class="anchor"><span id="_Toc144722339" class="anchor"><span id="_Toc145503802" class="anchor"><span id="_Toc145512244" class="anchor"><span id="_Toc145513267" class="anchor"><span id="_Toc145513651" class="anchor"><span id="_Toc222907437" class="anchor"><span id="_Toc342653142" class="anchor"><span id="_Toc439864237" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Partition Save and Restore
==================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================

The hypervisor provides a means to store certain state of a partition
and later restore this state. This support allows a caller to resume
execution of the partition at a later time—potentially on a different
piece of hardware.

1.  <span id="_Toc110172883" class="anchor"><span id="_Ref111800250" class="anchor"><span id="_Ref114236342" class="anchor"><span id="_Toc127596889" class="anchor"><span id="_Toc127786510" class="anchor"><span id="_Toc127786826" class="anchor"><span id="_Toc127787142" class="anchor"><span id="_Toc127877816" class="anchor"><span id="_Toc128289886" class="anchor"><span id="_Toc128290279" class="anchor"><span id="_Toc130189884" class="anchor"><span id="_Toc130201100" class="anchor"><span id="_Toc130201416" class="anchor"><span id="_Toc130201737" class="anchor"><span id="_Toc131936929" class="anchor"><span id="_Toc133901290" class="anchor"><span id="_Toc137461164" class="anchor"><span id="_Toc139096679" class="anchor"><span id="_Toc139188602" class="anchor"><span id="_Toc139191465" class="anchor"><span id="_Toc140490517" class="anchor"><span id="_Toc140571419" class="anchor"><span id="_Toc141257692" class="anchor"><span id="_Toc141258019" class="anchor"><span id="_Toc141267547" class="anchor"><span id="_Toc141522565" class="anchor"><span id="_Toc141529653" class="anchor"><span id="_Toc141529970" class="anchor"><span id="_Toc141851579" class="anchor"><span id="_Toc141852513" class="anchor"><span id="_Toc141888057" class="anchor"><span id="_Toc141889897" class="anchor"><span id="_Toc141893566" class="anchor"><span id="_Toc142113419" class="anchor"><span id="_Toc142114447" class="anchor"><span id="_Toc142729664" class="anchor"><span id="_Toc142730948" class="anchor"><span id="_Toc142731321" class="anchor"><span id="_Toc142998688" class="anchor"><span id="_Toc143063780" class="anchor"><span id="_Toc143509890" class="anchor"><span id="_Toc143510337" class="anchor"><span id="_Toc144026369" class="anchor"><span id="_Toc144026700" class="anchor"><span id="_Toc144276343" class="anchor"><span id="_Toc144276687" class="anchor"><span id="_Toc144280275" class="anchor"><span id="_Toc144280621" class="anchor"><span id="_Toc144540836" class="anchor"><span id="_Toc144554739" class="anchor"><span id="_Toc144722340" class="anchor"><span id="_Toc145503803" class="anchor"><span id="_Toc145512245" class="anchor"><span id="_Toc145513268" class="anchor"><span id="_Toc145513652" class="anchor"><span id="_Toc222907438" class="anchor"><span id="_Toc342653143" class="anchor"><span id="_Toc439864238" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Overview
    ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

    1.  ### <span id="_Toc110172884" class="anchor"><span id="_Toc127596890" class="anchor"><span id="_Toc127786511" class="anchor"><span id="_Toc127786827" class="anchor"><span id="_Toc127787143" class="anchor"><span id="_Toc127877817" class="anchor"><span id="_Toc128289887" class="anchor"><span id="_Toc128290280" class="anchor"><span id="_Toc130189885" class="anchor"><span id="_Toc130201101" class="anchor"><span id="_Toc130201417" class="anchor"><span id="_Toc130201738" class="anchor"><span id="_Ref131845613" class="anchor"><span id="_Ref131930115" class="anchor"><span id="_Toc131936930" class="anchor"><span id="_Toc133901291" class="anchor"><span id="_Toc137461165" class="anchor"><span id="_Toc139096680" class="anchor"><span id="_Toc139188603" class="anchor"><span id="_Toc139191466" class="anchor"><span id="_Toc140490518" class="anchor"><span id="_Toc140571420" class="anchor"><span id="_Toc141257693" class="anchor"><span id="_Toc141258020" class="anchor"><span id="_Toc141267548" class="anchor"><span id="_Toc141522566" class="anchor"><span id="_Toc141529654" class="anchor"><span id="_Toc141529971" class="anchor"><span id="_Toc141851580" class="anchor"><span id="_Toc141852514" class="anchor"><span id="_Toc141888058" class="anchor"><span id="_Toc141889898" class="anchor"><span id="_Toc141893567" class="anchor"><span id="_Toc142113420" class="anchor"><span id="_Toc142114448" class="anchor"><span id="_Toc142729665" class="anchor"><span id="_Toc142730949" class="anchor"><span id="_Toc142731322" class="anchor"><span id="_Toc142998689" class="anchor"><span id="_Toc143063781" class="anchor"><span id="_Toc143509891" class="anchor"><span id="_Toc143510338" class="anchor"><span id="_Toc144026370" class="anchor"><span id="_Toc144026701" class="anchor"><span id="_Toc144276344" class="anchor"><span id="_Toc144276688" class="anchor"><span id="_Toc144280276" class="anchor"><span id="_Toc144280622" class="anchor"><span id="_Toc144540837" class="anchor"><span id="_Toc144554740" class="anchor"><span id="_Toc144722341" class="anchor"><span id="_Toc145503804" class="anchor"><span id="_Toc145512246" class="anchor"><span id="_Toc145513269" class="anchor"><span id="_Toc145513653" class="anchor"><span id="_Toc222907439" class="anchor"><span id="_Toc342653144" class="anchor"><span id="_Toc439864239" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Saved State

The hypervisor allows a parent partition to save the state of a child
partition. The *saved state* may be migrated (restored) on another
system or check pointed for a subsequent restart.

All virtual processors must be explicitly suspended before a partition
can be saved.

### <span id="_Ref131845496" class="anchor"><span id="_Toc131936931" class="anchor"><span id="_Toc133901292" class="anchor"><span id="_Toc137461166" class="anchor"><span id="_Toc139096681" class="anchor"><span id="_Toc139188604" class="anchor"><span id="_Toc139191467" class="anchor"><span id="_Toc140490519" class="anchor"><span id="_Toc140571421" class="anchor"><span id="_Toc141257694" class="anchor"><span id="_Toc141258021" class="anchor"><span id="_Toc141267549" class="anchor"><span id="_Toc141522567" class="anchor"><span id="_Toc141529655" class="anchor"><span id="_Toc141529972" class="anchor"><span id="_Toc141851581" class="anchor"><span id="_Toc141852515" class="anchor"><span id="_Toc141888059" class="anchor"><span id="_Toc141889899" class="anchor"><span id="_Toc141893568" class="anchor"><span id="_Toc142113421" class="anchor"><span id="_Toc142114449" class="anchor"><span id="_Toc142729666" class="anchor"><span id="_Toc142730950" class="anchor"><span id="_Toc142731323" class="anchor"><span id="_Toc142998690" class="anchor"><span id="_Toc143063782" class="anchor"><span id="_Toc143509892" class="anchor"><span id="_Toc143510339" class="anchor"><span id="_Toc144026371" class="anchor"><span id="_Toc144026702" class="anchor"><span id="_Toc144276345" class="anchor"><span id="_Toc144276689" class="anchor"><span id="_Toc144280277" class="anchor"><span id="_Toc144280623" class="anchor"><span id="_Toc144540838" class="anchor"><span id="_Toc144554741" class="anchor"><span id="_Toc144722342" class="anchor"><span id="_Toc145503805" class="anchor"><span id="_Toc145512247" class="anchor"><span id="_Toc145513270" class="anchor"><span id="_Toc145513654" class="anchor"><span id="_Toc222907440" class="anchor"><span id="_Toc342653145" class="anchor"><span id="_Toc127596891" class="anchor"><span id="_Toc127786512" class="anchor"><span id="_Toc127786828" class="anchor"><span id="_Toc127787144" class="anchor"><span id="_Toc127877818" class="anchor"><span id="_Toc128289888" class="anchor"><span id="_Toc128290281" class="anchor"><span id="_Toc130189886" class="anchor"><span id="_Toc130201102" class="anchor"><span id="_Toc130201418" class="anchor"><span id="_Toc130201739" class="anchor"><span id="_Toc110172885" class="anchor"><span id="_Toc439864240" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>

In addition to *saved state*, the hypervisor allows a caller to retrieve
*summary state* data for the partition or system. Using this state, the
caller can determine whether a partition’s potential complete saved
state is specifically compatible with respect to the underlying target
hardware and hypervisor implementation.

Summary state consists of a minimal amount of information relating
specifically to hardware and hypervisor compatibility and does not
include most partition-specific context information. Unlike saved state,
summary state can be retrieved without the necessity of suspending all
of the partition’s virtual processors in order to obtain it.

The HvSavePartitionState and HvRestorePartitionState hypercalls are used
to retrieve and subsequently test compatibility using the summary state.
The summary state can be related to the system and, optionally, to a
particular partition on the system. Absence of a partition ID indicates
that system information alone is to be evaluated. Presence of a
partition ID indicates that both system and partition-related
information (for that particular partition) is to be evaluated.

### <span id="_Toc131936932" class="anchor"><span id="_Toc133901293" class="anchor"><span id="_Toc137461167" class="anchor"><span id="_Toc139096682" class="anchor"><span id="_Toc139188605" class="anchor"><span id="_Toc139191468" class="anchor"><span id="_Toc140490520" class="anchor"><span id="_Toc140571422" class="anchor"><span id="_Toc141257695" class="anchor"><span id="_Toc141258022" class="anchor"><span id="_Toc141267550" class="anchor"><span id="_Toc141522568" class="anchor"><span id="_Toc141529656" class="anchor"><span id="_Toc141529973" class="anchor"><span id="_Toc141851582" class="anchor"><span id="_Toc141852516" class="anchor"><span id="_Toc141888060" class="anchor"><span id="_Toc141889900" class="anchor"><span id="_Toc141893569" class="anchor"><span id="_Toc142113422" class="anchor"><span id="_Toc142114450" class="anchor"><span id="_Toc142729667" class="anchor"><span id="_Toc142730951" class="anchor"><span id="_Toc142731324" class="anchor"><span id="_Toc142998691" class="anchor"><span id="_Toc143063783" class="anchor"><span id="_Toc143509893" class="anchor"><span id="_Toc143510340" class="anchor"><span id="_Toc144026372" class="anchor"><span id="_Toc144026703" class="anchor"><span id="_Toc144276346" class="anchor"><span id="_Toc144276690" class="anchor"><span id="_Toc144280278" class="anchor"><span id="_Toc144280624" class="anchor"><span id="_Toc144540839" class="anchor"><span id="_Toc144554742" class="anchor"><span id="_Toc144722343" class="anchor"><span id="_Toc145503806" class="anchor"><span id="_Toc145512248" class="anchor"><span id="_Toc145513271" class="anchor"><span id="_Toc145513655" class="anchor"><span id="_Toc222907441" class="anchor"><span id="_Toc342653146" class="anchor"><span id="_Toc439864241" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Saved State Compatibility and Versioning

The partition and virtual processor state saved from one version of the
hypervisor is not guaranteed to be compatible with future versions of
the hypervisor. Attempts will be made to minimize version
incompatibilities.

Some differences between hardware platforms also introduce saved state
incompatibilities, so it may not be possible to save a partition’s state
on one physical system and restore it on a second physical system with
sufficiently different hardware.

The list of potential incompatibilities is not architecturally defined,
but the following list provides some potential examples of hardware
incompatibilities that may result in an inability to save and restore:

-   Virtual processors that are executing real-mode code on CPUs
    developed by Intel may not be restorable on CPUs developed by AMD.

-   Partitions that are executing on logical processors that support
    various guest-visible features (for example, 3DNow!, SSE3, and
    so on.) may not be restorable on a system whose logical processors
    do not support these features.

    1.  ### <span id="_Toc127596892" class="anchor"><span id="_Toc127786513" class="anchor"><span id="_Toc127786829" class="anchor"><span id="_Toc127787145" class="anchor"><span id="_Toc127877819" class="anchor"><span id="_Toc128289889" class="anchor"><span id="_Toc128290282" class="anchor"><span id="_Toc130189887" class="anchor"><span id="_Toc130201103" class="anchor"><span id="_Toc130201419" class="anchor"><span id="_Toc130201740" class="anchor"><span id="_Toc131936933" class="anchor"><span id="_Toc133901294" class="anchor"><span id="_Toc137461168" class="anchor"><span id="_Toc139096683" class="anchor"><span id="_Toc139188606" class="anchor"><span id="_Toc139191469" class="anchor"><span id="_Toc140490521" class="anchor"><span id="_Toc140571423" class="anchor"><span id="_Toc141257696" class="anchor"><span id="_Toc141258023" class="anchor"><span id="_Toc141267551" class="anchor"><span id="_Toc141522569" class="anchor"><span id="_Toc141529657" class="anchor"><span id="_Toc141529974" class="anchor"><span id="_Toc141851583" class="anchor"><span id="_Toc141852517" class="anchor"><span id="_Toc141888061" class="anchor"><span id="_Toc141889901" class="anchor"><span id="_Toc141893570" class="anchor"><span id="_Toc142113423" class="anchor"><span id="_Toc142114451" class="anchor"><span id="_Toc142729668" class="anchor"><span id="_Toc142730952" class="anchor"><span id="_Toc142731325" class="anchor"><span id="_Toc142998692" class="anchor"><span id="_Toc143063784" class="anchor"><span id="_Toc143509894" class="anchor"><span id="_Toc143510341" class="anchor"><span id="_Toc144026373" class="anchor"><span id="_Toc144026704" class="anchor"><span id="_Toc144276347" class="anchor"><span id="_Toc144276691" class="anchor"><span id="_Toc144280279" class="anchor"><span id="_Toc144280625" class="anchor"><span id="_Toc144540840" class="anchor"><span id="_Toc144554743" class="anchor"><span id="_Toc144722344" class="anchor"><span id="_Toc145503807" class="anchor"><span id="_Toc145512249" class="anchor"><span id="_Toc145513272" class="anchor"><span id="_Toc145513656" class="anchor"><span id="_Toc222907442" class="anchor"><span id="_Toc342653147" class="anchor"><span id="_Toc439864242" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>State That Is Not Saved by the Hypervisor

In general, state that is explicitly managed and set by the parent
partition is not saved by the hypervisor. It is expected that code
running in the parent partition will save and restore this information.

Information that is *not* saved by the hypervisor includes:

-   Partition creation flags

-   Partition properties

-   Scheduling policy settings and affinities

-   Partition ID or parent ID

-   GPA mappings and access rights

-   Contents of pages

-   Intercepts

-   Memory pool balance

-   Ports and connections

-   Partition state

-   Default CPUID return values

-   Partition statistics

-   Monitored notification context

    1.  ### <span id="_Toc131936934" class="anchor"><span id="_Toc133901295" class="anchor"><span id="_Toc137461169" class="anchor"><span id="_Toc139096684" class="anchor"><span id="_Toc139188607" class="anchor"><span id="_Toc139191470" class="anchor"><span id="_Toc140490522" class="anchor"><span id="_Toc140571424" class="anchor"><span id="_Toc141257697" class="anchor"><span id="_Toc141258024" class="anchor"><span id="_Toc141267552" class="anchor"><span id="_Toc141522570" class="anchor"><span id="_Toc141529658" class="anchor"><span id="_Toc141529975" class="anchor"><span id="_Toc141851584" class="anchor"><span id="_Toc141852518" class="anchor"><span id="_Toc141888062" class="anchor"><span id="_Toc141889902" class="anchor"><span id="_Toc141893571" class="anchor"><span id="_Toc142113424" class="anchor"><span id="_Toc142114452" class="anchor"><span id="_Toc142729669" class="anchor"><span id="_Toc142730953" class="anchor"><span id="_Toc142731326" class="anchor"><span id="_Toc142998693" class="anchor"><span id="_Toc143063785" class="anchor"><span id="_Toc143509895" class="anchor"><span id="_Toc143510342" class="anchor"><span id="_Toc144026374" class="anchor"><span id="_Toc144026705" class="anchor"><span id="_Toc144276348" class="anchor"><span id="_Toc144276692" class="anchor"><span id="_Toc144280280" class="anchor"><span id="_Toc144280626" class="anchor"><span id="_Toc144540841" class="anchor"><span id="_Toc144554744" class="anchor"><span id="_Toc144722345" class="anchor"><span id="_Toc145503808" class="anchor"><span id="_Toc145512250" class="anchor"><span id="_Toc145513273" class="anchor"><span id="_Toc145513657" class="anchor"><span id="_Toc222907443" class="anchor"><span id="_Toc342653148" class="anchor"><span id="_Toc439864243" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>State That Is Saved by the Hypervisor

The specific state saved may differ from one hypervisor implementation
to the next. The format of the saved state is purposely not defined.

In general, state that is not explicitly managed and set by the parent
partition and is potentially changed by a guest running within the child
partition is saved.

Partition state that is saved includes:

-   Partition version information

-   Logical processor information (sufficient to determine compatibility
    for restoration)

-   Partition-wide MSR values (for example, hypercall base address)

-   Locations of overlay pages

-   Reference counter

-   Virtual processor state that is saved includes:All virtual processor
    registers

-   Undelivered (queued) messages

-   APIC and SynIC state

-   SIEF and SIM page contents

-   Synthetic and periodic timers

-   Periodic and PM timer assists

    1.  ### <span id="_Toc127596894" class="anchor"><span id="_Toc127786515" class="anchor"><span id="_Toc127786831" class="anchor"><span id="_Toc127787147" class="anchor"><span id="_Toc127877821" class="anchor"><span id="_Toc128289891" class="anchor"><span id="_Toc128290284" class="anchor"><span id="_Toc130189889" class="anchor"><span id="_Toc130201105" class="anchor"><span id="_Toc130201421" class="anchor"><span id="_Toc130201742" class="anchor"><span id="_Toc131936935" class="anchor"><span id="_Toc133901296" class="anchor"><span id="_Toc137461170" class="anchor"><span id="_Toc139096685" class="anchor"><span id="_Toc139188608" class="anchor"><span id="_Toc139191471" class="anchor"><span id="_Toc140490523" class="anchor"><span id="_Toc140571425" class="anchor"><span id="_Toc141257698" class="anchor"><span id="_Toc141258025" class="anchor"><span id="_Toc141267553" class="anchor"><span id="_Toc141522571" class="anchor"><span id="_Toc141529659" class="anchor"><span id="_Toc141529976" class="anchor"><span id="_Toc141851585" class="anchor"><span id="_Toc141852519" class="anchor"><span id="_Toc141888063" class="anchor"><span id="_Toc141889903" class="anchor"><span id="_Toc141893572" class="anchor"><span id="_Toc142113425" class="anchor"><span id="_Toc142114453" class="anchor"><span id="_Toc142729670" class="anchor"><span id="_Toc142730954" class="anchor"><span id="_Toc142731327" class="anchor"><span id="_Toc142998694" class="anchor"><span id="_Toc143063786" class="anchor"><span id="_Toc143509896" class="anchor"><span id="_Toc143510343" class="anchor"><span id="_Toc144026375" class="anchor"><span id="_Toc144026706" class="anchor"><span id="_Toc144276349" class="anchor"><span id="_Toc144276693" class="anchor"><span id="_Toc144280281" class="anchor"><span id="_Toc144280627" class="anchor"><span id="_Toc144540842" class="anchor"><span id="_Toc144554745" class="anchor"><span id="_Toc144722346" class="anchor"><span id="_Toc145503809" class="anchor"><span id="_Toc145512251" class="anchor"><span id="_Toc145513274" class="anchor"><span id="_Toc145513658" class="anchor"><span id="_Toc222907444" class="anchor"><span id="_Toc342653149" class="anchor"><span id="_Toc439858233" class="anchor"><span id="_Toc439864244" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>

    2.  ### <span id="_Ref114236408" class="anchor"><span id="_Toc127596896" class="anchor"><span id="_Toc127786517" class="anchor"><span id="_Toc127786833" class="anchor"><span id="_Toc127787149" class="anchor"><span id="_Toc127877823" class="anchor"><span id="_Toc128289893" class="anchor"><span id="_Toc128290286" class="anchor"><span id="_Toc130189891" class="anchor"><span id="_Toc130201107" class="anchor"><span id="_Toc130201423" class="anchor"><span id="_Toc130201744" class="anchor"><span id="_Toc131936938" class="anchor"><span id="_Toc133901297" class="anchor"><span id="_Toc137461171" class="anchor"><span id="_Toc139096686" class="anchor"><span id="_Toc139188609" class="anchor"><span id="_Toc139191472" class="anchor"><span id="_Toc140490524" class="anchor"><span id="_Toc140571426" class="anchor"><span id="_Toc141257699" class="anchor"><span id="_Toc141258026" class="anchor"><span id="_Toc141267554" class="anchor"><span id="_Toc141522572" class="anchor"><span id="_Toc141529660" class="anchor"><span id="_Toc141529977" class="anchor"><span id="_Toc141851586" class="anchor"><span id="_Toc141852520" class="anchor"><span id="_Toc141888064" class="anchor"><span id="_Toc141889904" class="anchor"><span id="_Toc141893573" class="anchor"><span id="_Toc142113426" class="anchor"><span id="_Toc142114454" class="anchor"><span id="_Toc142729671" class="anchor"><span id="_Toc142730955" class="anchor"><span id="_Toc142731328" class="anchor"><span id="_Toc142998695" class="anchor"><span id="_Toc143063787" class="anchor"><span id="_Toc143509897" class="anchor"><span id="_Toc143510344" class="anchor"><span id="_Toc144026376" class="anchor"><span id="_Toc144026707" class="anchor"><span id="_Toc144276350" class="anchor"><span id="_Toc144276694" class="anchor"><span id="_Toc144280282" class="anchor"><span id="_Toc144280628" class="anchor"><span id="_Toc144540843" class="anchor"><span id="_Toc144554746" class="anchor"><span id="_Toc144722347" class="anchor"><span id="_Toc145503810" class="anchor"><span id="_Toc145512252" class="anchor"><span id="_Toc145513275" class="anchor"><span id="_Toc145513659" class="anchor"><span id="_Toc222907445" class="anchor"><span id="_Toc342653150" class="anchor"><span id="_Toc439858234" class="anchor"><span id="_Toc439864245" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>

-   -   -   1.  ### <span id="_Ref111812773" class="anchor"><span id="_Toc127596897" class="anchor"><span id="_Toc127786518" class="anchor"><span id="_Toc127786834" class="anchor"><span id="_Toc127787150" class="anchor"><span id="_Toc127877824" class="anchor"><span id="_Toc128289894" class="anchor"><span id="_Toc128290287" class="anchor"><span id="_Toc130189892" class="anchor"><span id="_Toc130201108" class="anchor"><span id="_Toc130201424" class="anchor"><span id="_Toc130201745" class="anchor"><span id="_Toc131936939" class="anchor"><span id="_Toc133901298" class="anchor"><span id="_Toc137461172" class="anchor"><span id="_Toc139096687" class="anchor"><span id="_Toc139188610" class="anchor"><span id="_Toc139191473" class="anchor"><span id="_Toc140490525" class="anchor"><span id="_Toc140571427" class="anchor"><span id="_Toc141257700" class="anchor"><span id="_Toc141258027" class="anchor"><span id="_Toc141267555" class="anchor"><span id="_Toc141522573" class="anchor"><span id="_Toc141529661" class="anchor"><span id="_Toc141529978" class="anchor"><span id="_Toc141851587" class="anchor"><span id="_Toc141852521" class="anchor"><span id="_Toc141888065" class="anchor"><span id="_Toc141889905" class="anchor"><span id="_Toc141893574" class="anchor"><span id="_Toc142113427" class="anchor"><span id="_Toc142114455" class="anchor"><span id="_Toc142729672" class="anchor"><span id="_Toc142730956" class="anchor"><span id="_Toc142731329" class="anchor"><span id="_Toc142998696" class="anchor"><span id="_Toc143063788" class="anchor"><span id="_Toc143509898" class="anchor"><span id="_Toc143510345" class="anchor"><span id="_Toc144026377" class="anchor"><span id="_Toc144026708" class="anchor"><span id="_Toc144276351" class="anchor"><span id="_Toc144276695" class="anchor"><span id="_Toc144280283" class="anchor"><span id="_Toc144280629" class="anchor"><span id="_Toc144540844" class="anchor"><span id="_Toc144554747" class="anchor"><span id="_Toc144722348" class="anchor"><span id="_Toc145503811" class="anchor"><span id="_Toc145512253" class="anchor"><span id="_Toc145513276" class="anchor"><span id="_Toc145513660" class="anchor"><span id="_Toc222907446" class="anchor"><span id="_Toc342653151" class="anchor"><span id="_Toc439858235" class="anchor"><span id="_Toc439864246" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>

-   -   -   -   -   -   -   1.  <span id="_Toc127596898" class="anchor"><span id="_Toc127786519" class="anchor"><span id="_Toc127786835" class="anchor"><span id="_Toc127787151" class="anchor"><span id="_Toc127877825" class="anchor"><span id="_Toc128289895" class="anchor"><span id="_Toc128290288" class="anchor"><span id="_Toc130189893" class="anchor"><span id="_Toc130201109" class="anchor"><span id="_Toc130201425" class="anchor"><span id="_Toc130201746" class="anchor"><span id="_Toc131936940" class="anchor"><span id="_Toc133901299" class="anchor"><span id="_Toc137461173" class="anchor"><span id="_Toc139096688" class="anchor"><span id="_Toc139188611" class="anchor"><span id="_Toc139191474" class="anchor"><span id="_Toc140490526" class="anchor"><span id="_Toc140571428" class="anchor"><span id="_Toc141257701" class="anchor"><span id="_Toc141258028" class="anchor"><span id="_Toc141267556" class="anchor"><span id="_Toc141522574" class="anchor"><span id="_Toc141529662" class="anchor"><span id="_Toc141529979" class="anchor"><span id="_Toc141851588" class="anchor"><span id="_Toc141852522" class="anchor"><span id="_Toc141888066" class="anchor"><span id="_Toc141889906" class="anchor"><span id="_Toc141893575" class="anchor"><span id="_Toc142113428" class="anchor"><span id="_Toc142114456" class="anchor"><span id="_Toc142729673" class="anchor"><span id="_Toc142730957" class="anchor"><span id="_Toc142731330" class="anchor"><span id="_Toc142998697" class="anchor"><span id="_Toc143063789" class="anchor"><span id="_Toc143509899" class="anchor"><span id="_Toc143510346" class="anchor"><span id="_Toc144026378" class="anchor"><span id="_Toc144026709" class="anchor"><span id="_Toc144276352" class="anchor"><span id="_Toc144276696" class="anchor"><span id="_Toc144280284" class="anchor"><span id="_Toc144280630" class="anchor"><span id="_Toc144540845" class="anchor"><span id="_Toc144554748" class="anchor"><span id="_Toc144722349" class="anchor"><span id="_Toc145503812" class="anchor"><span id="_Toc145512254" class="anchor"><span id="_Toc145513277" class="anchor"><span id="_Toc145513661" class="anchor"><span id="_Toc222907447" class="anchor"><span id="_Toc342653152" class="anchor"><span id="_Toc439858236" class="anchor"><span id="_Toc439864247" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>
        ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

        1.  ### <span id="_Toc130888389" class="anchor"><span id="_Toc130978722" class="anchor"><span id="_Toc131014398" class="anchor"><span id="_Toc131846614" class="anchor"><span id="_Toc131929618" class="anchor"><span id="_Toc131936941" class="anchor"><span id="_Toc130888391" class="anchor"><span id="_Toc130978724" class="anchor"><span id="_Toc131014400" class="anchor"><span id="_Toc131846616" class="anchor"><span id="_Toc131929620" class="anchor"><span id="_Toc131936943" class="anchor"><span id="_Toc130888398" class="anchor"><span id="_Toc130978731" class="anchor"><span id="_Toc131014407" class="anchor"><span id="_Toc131846623" class="anchor"><span id="_Toc131929627" class="anchor"><span id="_Toc131936950" class="anchor"><span id="_Toc130888399" class="anchor"><span id="_Toc130978732" class="anchor"><span id="_Toc131014408" class="anchor"><span id="_Toc131846624" class="anchor"><span id="_Toc131929628" class="anchor"><span id="_Toc131936951" class="anchor"><span id="_Toc130888402" class="anchor"><span id="_Toc130978735" class="anchor"><span id="_Toc131014411" class="anchor"><span id="_Toc131846627" class="anchor"><span id="_Toc131929631" class="anchor"><span id="_Toc131936954" class="anchor"><span id="_Toc130888405" class="anchor"><span id="_Toc130978738" class="anchor"><span id="_Toc131014414" class="anchor"><span id="_Toc131846630" class="anchor"><span id="_Toc131929634" class="anchor"><span id="_Toc131936957" class="anchor"><span id="_Toc130888411" class="anchor"><span id="_Toc130978744" class="anchor"><span id="_Toc131014420" class="anchor"><span id="_Toc131846636" class="anchor"><span id="_Toc131929640" class="anchor"><span id="_Toc131936963" class="anchor"><span id="_Toc130888413" class="anchor"><span id="_Toc130978746" class="anchor"><span id="_Toc131014422" class="anchor"><span id="_Toc131846638" class="anchor"><span id="_Toc131929642" class="anchor"><span id="_Toc131936965" class="anchor"><span id="_Toc127596900" class="anchor"><span id="_Toc127786521" class="anchor"><span id="_Toc127786837" class="anchor"><span id="_Toc127787153" class="anchor"><span id="_Toc127877827" class="anchor"><span id="_Toc128289897" class="anchor"><span id="_Toc128290290" class="anchor"><span id="_Toc130189895" class="anchor"><span id="_Toc130201111" class="anchor"><span id="_Toc130201427" class="anchor"><span id="_Toc130201748" class="anchor"><span id="_Toc131936966" class="anchor"><span id="_Toc133901300" class="anchor"><span id="_Toc137461174" class="anchor"><span id="_Toc139096689" class="anchor"><span id="_Toc139188612" class="anchor"><span id="_Toc139191475" class="anchor"><span id="_Toc140490527" class="anchor"><span id="_Toc140571429" class="anchor"><span id="_Toc141257702" class="anchor"><span id="_Toc141258029" class="anchor"><span id="_Toc141267557" class="anchor"><span id="_Toc141522575" class="anchor"><span id="_Toc141529663" class="anchor"><span id="_Toc141529980" class="anchor"><span id="_Toc141851589" class="anchor"><span id="_Toc141852523" class="anchor"><span id="_Toc141888067" class="anchor"><span id="_Toc141889907" class="anchor"><span id="_Toc141893576" class="anchor"><span id="_Toc142113429" class="anchor"><span id="_Toc142114457" class="anchor"><span id="_Toc142729674" class="anchor"><span id="_Toc142730958" class="anchor"><span id="_Toc142731331" class="anchor"><span id="_Toc142998698" class="anchor"><span id="_Toc143063790" class="anchor"><span id="_Toc143509900" class="anchor"><span id="_Toc143510347" class="anchor"><span id="_Toc144026379" class="anchor"><span id="_Toc144026710" class="anchor"><span id="_Toc144276353" class="anchor"><span id="_Toc144276697" class="anchor"><span id="_Toc144280285" class="anchor"><span id="_Toc144280631" class="anchor"><span id="_Toc144540846" class="anchor"><span id="_Toc144554749" class="anchor"><span id="_Toc144722350" class="anchor"><span id="_Toc145503813" class="anchor"><span id="_Toc145512255" class="anchor"><span id="_Toc145513278" class="anchor"><span id="_Toc145513662" class="anchor"><span id="_Toc222907448" class="anchor"><span id="_Toc342653153" class="anchor"><span id="_Toc439858237" class="anchor"><span id="_Toc439864248" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>

<span id="_Toc437514723" class="anchor"></span>

<span id="_Toc437514779" class="anchor"></span>

<span id="_Toc437514781" class="anchor"></span>

  -- ------------------------------------------------- -- --
                                                          
                                                          
     <span id="_Toc437514800" class="anchor"></span>      
     <span id="_Toc437514805" class="anchor"></span>      
     <span id="_Toc437514810" class="anchor"></span>      
     <span id="_Toc437514815" class="anchor"></span>      
     <span id="_Toc437514820" class="anchor"></span>      
     <span id="_Toc437514825" class="anchor"></span>      
     <span id="_Toc437514830" class="anchor"></span>      
     <span id="_Toc437514835" class="anchor"></span>      
  -- ------------------------------------------------- -- --

### <span id="_Toc131936967" class="anchor"><span id="_Toc133901301" class="anchor"><span id="_Toc137461175" class="anchor"><span id="_Toc139096690" class="anchor"><span id="_Toc139188613" class="anchor"><span id="_Toc139191476" class="anchor"><span id="_Toc140490528" class="anchor"><span id="_Toc140571430" class="anchor"><span id="_Toc141257703" class="anchor"><span id="_Toc141258030" class="anchor"><span id="_Toc141267558" class="anchor"><span id="_Toc141522576" class="anchor"><span id="_Toc141529664" class="anchor"><span id="_Toc141529981" class="anchor"><span id="_Toc141851590" class="anchor"><span id="_Toc141852524" class="anchor"><span id="_Toc141888068" class="anchor"><span id="_Toc141889908" class="anchor"><span id="_Toc141893577" class="anchor"><span id="_Toc142113430" class="anchor"><span id="_Toc142114458" class="anchor"><span id="_Toc142729675" class="anchor"><span id="_Toc142730959" class="anchor"><span id="_Toc142731332" class="anchor"><span id="_Toc142998699" class="anchor"><span id="_Toc143063791" class="anchor"><span id="_Toc143509901" class="anchor"><span id="_Toc143510348" class="anchor"><span id="_Toc144026380" class="anchor"><span id="_Toc144026711" class="anchor"><span id="_Toc144276354" class="anchor"><span id="_Toc144276698" class="anchor"><span id="_Toc144280286" class="anchor"><span id="_Toc144280632" class="anchor"><span id="_Toc144540847" class="anchor"><span id="_Toc144554750" class="anchor"><span id="_Toc144722351" class="anchor"><span id="_Toc145503814" class="anchor"><span id="_Toc145512256" class="anchor"><span id="_Toc145513279" class="anchor"><span id="_Toc145513663" class="anchor"><span id="_Toc222907449" class="anchor"><span id="_Toc342653154" class="anchor"><span id="_Toc439858238" class="anchor"><span id="_Toc127596901" class="anchor"><span id="_Toc127786522" class="anchor"><span id="_Toc127786838" class="anchor"><span id="_Toc127787154" class="anchor"><span id="_Toc127877828" class="anchor"><span id="_Toc128289898" class="anchor"><span id="_Toc128290291" class="anchor"><span id="_Toc130189896" class="anchor"><span id="_Toc130201112" class="anchor"><span id="_Toc130201428" class="anchor"><span id="_Toc130201749" class="anchor"><span id="_Toc439864249" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>

<span id="_Toc437514841" class="anchor"></span>

<span id="_Toc437514843" class="anchor"></span>

<span id="_Toc437514846" class="anchor"></span>

1.  <span id="_Toc131936968" class="anchor"><span id="_Toc133901302" class="anchor"><span id="_Toc137461176" class="anchor"><span id="_Toc139096691" class="anchor"><span id="_Toc139188614" class="anchor"><span id="_Toc139191477" class="anchor"><span id="_Toc140490529" class="anchor"><span id="_Toc140571431" class="anchor"><span id="_Toc141257704" class="anchor"><span id="_Toc141258031" class="anchor"><span id="_Toc141267559" class="anchor"><span id="_Toc141522577" class="anchor"><span id="_Toc141529665" class="anchor"><span id="_Toc141529982" class="anchor"><span id="_Toc141851591" class="anchor"><span id="_Toc141852525" class="anchor"><span id="_Toc141888069" class="anchor"><span id="_Toc141889909" class="anchor"><span id="_Toc141893578" class="anchor"><span id="_Toc142113431" class="anchor"><span id="_Toc142114459" class="anchor"><span id="_Toc142729676" class="anchor"><span id="_Toc142730960" class="anchor"><span id="_Toc142731333" class="anchor"><span id="_Toc142998700" class="anchor"><span id="_Toc143063792" class="anchor"><span id="_Toc143509902" class="anchor"><span id="_Toc143510349" class="anchor"><span id="_Toc144026381" class="anchor"><span id="_Toc144026712" class="anchor"><span id="_Toc144276355" class="anchor"><span id="_Toc144276699" class="anchor"><span id="_Toc144280287" class="anchor"><span id="_Toc144280633" class="anchor"><span id="_Toc144540848" class="anchor"><span id="_Toc144554751" class="anchor"><span id="_Toc144722352" class="anchor"><span id="_Toc145503815" class="anchor"><span id="_Toc145512257" class="anchor"><span id="_Toc145513280" class="anchor"><span id="_Toc145513664" class="anchor"><span id="_Toc222907450" class="anchor"><span id="_Toc342653155" class="anchor"><span id="_Toc439858239" class="anchor"><span id="_Toc439864250" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>
    ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

    1.  ### <span id="_Toc127596902" class="anchor"><span id="_Toc127786523" class="anchor"><span id="_Toc127786839" class="anchor"><span id="_Toc127787155" class="anchor"><span id="_Toc127877829" class="anchor"><span id="_Toc128289899" class="anchor"><span id="_Toc128290292" class="anchor"><span id="_Toc130189897" class="anchor"><span id="_Toc130201113" class="anchor"><span id="_Toc130201429" class="anchor"><span id="_Toc130201750" class="anchor"><span id="_Ref130791879" class="anchor"><span id="_Toc131936969" class="anchor"><span id="_Toc133901303" class="anchor"><span id="_Toc137461177" class="anchor"><span id="_Toc139096692" class="anchor"><span id="_Toc139188615" class="anchor"><span id="_Toc139191478" class="anchor"><span id="_Toc140490530" class="anchor"><span id="_Toc140571432" class="anchor"><span id="_Toc141257705" class="anchor"><span id="_Toc141258032" class="anchor"><span id="_Toc141267560" class="anchor"><span id="_Toc141522578" class="anchor"><span id="_Toc141529666" class="anchor"><span id="_Toc141529983" class="anchor"><span id="_Toc141851592" class="anchor"><span id="_Toc141852526" class="anchor"><span id="_Toc141888070" class="anchor"><span id="_Toc141889910" class="anchor"><span id="_Toc141893579" class="anchor"><span id="_Toc142113432" class="anchor"><span id="_Toc142114460" class="anchor"><span id="_Toc142729677" class="anchor"><span id="_Toc142730961" class="anchor"><span id="_Toc142731334" class="anchor"><span id="_Toc142998701" class="anchor"><span id="_Toc143063793" class="anchor"><span id="_Toc143509903" class="anchor"><span id="_Toc143510350" class="anchor"><span id="_Toc144026382" class="anchor"><span id="_Toc144026713" class="anchor"><span id="_Toc144276356" class="anchor"><span id="_Toc144276700" class="anchor"><span id="_Toc144280288" class="anchor"><span id="_Toc144280634" class="anchor"><span id="_Toc144540849" class="anchor"><span id="_Toc144554752" class="anchor"><span id="_Toc144722353" class="anchor"><span id="_Toc145503816" class="anchor"><span id="_Toc145512258" class="anchor"><span id="_Toc145513281" class="anchor"><span id="_Toc145513665" class="anchor"><span id="_Toc222907451" class="anchor"><span id="_Toc342653156" class="anchor"><span id="_Toc439858240" class="anchor"><span id="_Toc439864251" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>

##### 

<span id="_Toc437514854" class="anchor"></span>

<span id="_Toc437514864" class="anchor"></span>

##### 

  ------------------------------------------------- -- --
  <span id="_Toc437514868" class="anchor"></span>
  ------------------------------------------------- -- --

##### 

-   -   -   

  -- --
     
     
     
     
     
     
     
  -- --

### <span id="_Toc130978752" class="anchor"><span id="_Toc131014428" class="anchor"><span id="_Toc131846643" class="anchor"><span id="_Toc131929647" class="anchor"><span id="_Toc131936970" class="anchor"><span id="_Toc130978753" class="anchor"><span id="_Toc131014429" class="anchor"><span id="_Toc131846644" class="anchor"><span id="_Toc131929648" class="anchor"><span id="_Toc131936971" class="anchor"><span id="_Toc130978759" class="anchor"><span id="_Toc131014435" class="anchor"><span id="_Toc131846650" class="anchor"><span id="_Toc131929654" class="anchor"><span id="_Toc131936977" class="anchor"><span id="_Toc130978760" class="anchor"><span id="_Toc131014436" class="anchor"><span id="_Toc131846651" class="anchor"><span id="_Toc131929655" class="anchor"><span id="_Toc131936978" class="anchor"><span id="_Toc130978761" class="anchor"><span id="_Toc131014437" class="anchor"><span id="_Toc131846652" class="anchor"><span id="_Toc131929656" class="anchor"><span id="_Toc131936979" class="anchor"><span id="_Toc130978764" class="anchor"><span id="_Toc131014440" class="anchor"><span id="_Toc131846655" class="anchor"><span id="_Toc131929659" class="anchor"><span id="_Toc131936982" class="anchor"><span id="_Toc130978778" class="anchor"><span id="_Toc131014454" class="anchor"><span id="_Toc131846669" class="anchor"><span id="_Toc131929673" class="anchor"><span id="_Toc131936996" class="anchor"><span id="_Toc127596904" class="anchor"><span id="_Toc127786525" class="anchor"><span id="_Toc127786841" class="anchor"><span id="_Toc127787157" class="anchor"><span id="_Toc127877831" class="anchor"><span id="_Toc128289901" class="anchor"><span id="_Toc128290294" class="anchor"><span id="_Toc130189899" class="anchor"><span id="_Toc130201115" class="anchor"><span id="_Toc130201431" class="anchor"><span id="_Toc130201752" class="anchor"><span id="_Ref130796250" class="anchor"><span id="_Ref130880844" class="anchor"><span id="_Toc131937012" class="anchor"><span id="_Toc133901304" class="anchor"><span id="_Toc137461178" class="anchor"><span id="_Toc139096693" class="anchor"><span id="_Toc139188616" class="anchor"><span id="_Toc139191479" class="anchor"><span id="_Toc140490531" class="anchor"><span id="_Toc140571433" class="anchor"><span id="_Toc141257706" class="anchor"><span id="_Toc141258033" class="anchor"><span id="_Toc141267561" class="anchor"><span id="_Toc141522579" class="anchor"><span id="_Toc141529667" class="anchor"><span id="_Toc141529984" class="anchor"><span id="_Toc141851593" class="anchor"><span id="_Toc141852527" class="anchor"><span id="_Toc141888071" class="anchor"><span id="_Toc141889911" class="anchor"><span id="_Toc141893580" class="anchor"><span id="_Toc142113433" class="anchor"><span id="_Toc142114461" class="anchor"><span id="_Toc142729678" class="anchor"><span id="_Toc142730962" class="anchor"><span id="_Toc142731335" class="anchor"><span id="_Toc142998702" class="anchor"><span id="_Toc143063794" class="anchor"><span id="_Toc143509904" class="anchor"><span id="_Toc143510351" class="anchor"><span id="_Toc144026383" class="anchor"><span id="_Toc144026714" class="anchor"><span id="_Toc144276357" class="anchor"><span id="_Toc144276701" class="anchor"><span id="_Toc144280289" class="anchor"><span id="_Toc144280635" class="anchor"><span id="_Toc144540850" class="anchor"><span id="_Toc144554753" class="anchor"><span id="_Toc144722354" class="anchor"><span id="_Toc145503817" class="anchor"><span id="_Toc145512259" class="anchor"><span id="_Toc145513282" class="anchor"><span id="_Toc145513666" class="anchor"><span id="_Toc222907452" class="anchor"><span id="_Toc342653160" class="anchor"><span id="_Toc439858241" class="anchor"><span id="_Toc439864252" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>

##### 

<span id="_Toc437514931" class="anchor"></span>

<span id="_Toc437514941" class="anchor"></span>

##### 

  ------------------------------------------------- -- --
  <span id="_Toc437514945" class="anchor"></span>
  ------------------------------------------------- -- --

##### 

<span id="_Toc437514977" class="anchor"></span>

-   -   -   -   

  ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- -------------------------------------------------
                                                                                                                                                                                                 
                                                                                                                                                                                                 
                                                                                                                                                                                                 
                                                                                                                                                                                                 
  <span id="_Toc437515000" class="anchor"></span>                                                                                                                                                <span id="_Toc437515001" class="anchor"></span>
  <span id="_Toc437515003" class="anchor"></span>                                                                                                                                                <span id="_Toc437515004" class="anchor"></span>
  <span id="_Toc437515006" class="anchor"></span>                                                                                                                                                <span id="_Toc437515007" class="anchor"></span>
  <span id="_Toc437515009" class="anchor"></span>                                                                                                                                                <span id="_Toc437515010" class="anchor"></span>
  <span id="_Toc119138706" class="anchor"><span id="_Toc119143865" class="anchor"><span id="_Toc119138707" class="anchor"><span id="_Toc119143866" class="anchor"></span></span></span></span>   
                                                                                                                                                                                                 
  ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- -------------------------------------------------

1.  <span id="_Toc127596905" class="anchor"><span id="_Toc127786526" class="anchor"><span id="_Toc127786842" class="anchor"><span id="_Toc127787158" class="anchor"><span id="_Toc127877832" class="anchor"><span id="_Toc128289902" class="anchor"><span id="_Toc128290295" class="anchor"><span id="_Toc130189900" class="anchor"><span id="_Toc130201116" class="anchor"><span id="_Toc130201432" class="anchor"><span id="_Toc130201753" class="anchor"><span id="_Toc131937013" class="anchor"><span id="_Toc133901305" class="anchor"><span id="_Toc137461179" class="anchor"><span id="_Toc139096694" class="anchor"><span id="_Toc139188617" class="anchor"><span id="_Toc139191480" class="anchor"><span id="_Toc140490532" class="anchor"><span id="_Toc140571434" class="anchor"><span id="_Toc141257707" class="anchor"><span id="_Toc141258034" class="anchor"><span id="_Toc141267562" class="anchor"><span id="_Toc141522580" class="anchor"><span id="_Toc141529668" class="anchor"><span id="_Toc141529985" class="anchor"><span id="_Toc141851594" class="anchor"><span id="_Toc141852528" class="anchor"><span id="_Toc141888072" class="anchor"><span id="_Toc141889912" class="anchor"><span id="_Toc141893581" class="anchor"><span id="_Toc142113434" class="anchor"><span id="_Toc142114462" class="anchor"><span id="_Toc142729679" class="anchor"><span id="_Toc142730963" class="anchor"><span id="_Toc142731336" class="anchor"><span id="_Toc142998703" class="anchor"><span id="_Toc143063795" class="anchor"><span id="_Toc143509905" class="anchor"><span id="_Toc143510352" class="anchor"><span id="_Toc144026384" class="anchor"><span id="_Toc144026715" class="anchor"><span id="_Toc144276358" class="anchor"><span id="_Toc144276702" class="anchor"><span id="_Toc144280290" class="anchor"><span id="_Toc144280636" class="anchor"><span id="_Toc144540851" class="anchor"><span id="_Toc144554754" class="anchor"><span id="_Toc144722355" class="anchor"><span id="_Toc145503818" class="anchor"><span id="_Toc145512260" class="anchor"><span id="_Toc145513283" class="anchor"><span id="_Toc145513667" class="anchor"><span id="_Toc222907453" class="anchor"><span id="_Toc342653164" class="anchor"><span id="_Toc439864253" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Scheduler
    ==================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================

    1.  <span id="_Toc127596906" class="anchor"><span id="_Toc127786527" class="anchor"><span id="_Toc127786843" class="anchor"><span id="_Toc127787159" class="anchor"><span id="_Toc127877833" class="anchor"><span id="_Toc128289903" class="anchor"><span id="_Toc128290296" class="anchor"><span id="_Toc130189901" class="anchor"><span id="_Toc130201117" class="anchor"><span id="_Toc130201433" class="anchor"><span id="_Toc130201754" class="anchor"><span id="_Toc131937014" class="anchor"><span id="_Toc133901306" class="anchor"><span id="_Toc137461180" class="anchor"><span id="_Toc139096695" class="anchor"><span id="_Toc139188618" class="anchor"><span id="_Toc139191481" class="anchor"><span id="_Toc140490533" class="anchor"><span id="_Toc140571435" class="anchor"><span id="_Toc141257708" class="anchor"><span id="_Toc141258035" class="anchor"><span id="_Toc141267563" class="anchor"><span id="_Toc141522581" class="anchor"><span id="_Toc141529669" class="anchor"><span id="_Toc141529986" class="anchor"><span id="_Toc141851595" class="anchor"><span id="_Toc141852529" class="anchor"><span id="_Toc141888073" class="anchor"><span id="_Toc141889913" class="anchor"><span id="_Toc141893582" class="anchor"><span id="_Toc142113435" class="anchor"><span id="_Toc142114463" class="anchor"><span id="_Toc142729680" class="anchor"><span id="_Toc142730964" class="anchor"><span id="_Toc142731337" class="anchor"><span id="_Toc142998704" class="anchor"><span id="_Toc143063796" class="anchor"><span id="_Toc143509906" class="anchor"><span id="_Toc143510353" class="anchor"><span id="_Toc144026385" class="anchor"><span id="_Toc144026716" class="anchor"><span id="_Toc144276359" class="anchor"><span id="_Toc144276703" class="anchor"><span id="_Toc144280291" class="anchor"><span id="_Toc144280637" class="anchor"><span id="_Toc144540852" class="anchor"><span id="_Toc144554755" class="anchor"><span id="_Toc144722356" class="anchor"><span id="_Toc145503819" class="anchor"><span id="_Toc145512261" class="anchor"><span id="_Toc145513284" class="anchor"><span id="_Toc145513668" class="anchor"><span id="_Toc222907454" class="anchor"><span id="_Toc342653165" class="anchor"><span id="_Toc439864254" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Scheduling Concepts
        ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

The hypervisor schedules virtual processors to run on logical
processors.

The hypervisor scheduler makes scheduling decisions based on these
policy settings set by the root. Because these decisions are made at
discreet times, not continuously, the policies are guaranteed only over
a sufficiently long period of time. This time is purposely undefined but
will typically be on the order of hundredths of a second.

<span id="_Toc127596907" class="anchor"><span id="_Toc127786528" class="anchor"><span id="_Toc127786844" class="anchor"><span id="_Toc127787160" class="anchor"><span id="_Toc127877834" class="anchor"><span id="_Toc128289904" class="anchor"><span id="_Toc128290297" class="anchor"><span id="_Toc130189902" class="anchor"><span id="_Toc130201118" class="anchor"><span id="_Toc130201434" class="anchor"><span id="_Toc130201755" class="anchor"><span id="_Toc131937015" class="anchor"><span id="_Toc133901307" class="anchor"><span id="_Toc137461181" class="anchor"><span id="_Toc139096696" class="anchor"><span id="_Toc139188619" class="anchor"><span id="_Toc139191482" class="anchor"><span id="_Toc140490534" class="anchor"><span id="_Toc140571436" class="anchor"><span id="_Toc141257709" class="anchor"><span id="_Toc141258036" class="anchor"><span id="_Toc141267564" class="anchor"><span id="_Toc141522582" class="anchor"><span id="_Toc141529670" class="anchor"><span id="_Toc141529987" class="anchor"><span id="_Toc141851596" class="anchor"><span id="_Toc141852530" class="anchor"><span id="_Toc141888074" class="anchor"><span id="_Toc141889914" class="anchor"><span id="_Toc141893583" class="anchor"><span id="_Toc142113436" class="anchor"><span id="_Toc142114464" class="anchor"><span id="_Toc142729681" class="anchor"><span id="_Toc142730965" class="anchor"><span id="_Toc142731338" class="anchor"><span id="_Toc142998705" class="anchor"><span id="_Toc143063797" class="anchor"><span id="_Toc143509907" class="anchor"><span id="_Toc143510354" class="anchor"><span id="_Toc144026386" class="anchor"><span id="_Toc144026717" class="anchor"><span id="_Toc144276360" class="anchor"><span id="_Toc144276704" class="anchor"><span id="_Toc144280292" class="anchor"><span id="_Toc144280638" class="anchor"><span id="_Toc144540853" class="anchor"><span id="_Toc144554756" class="anchor"><span id="_Toc144722357" class="anchor"><span id="_Toc145503820" class="anchor"><span id="_Toc145512262" class="anchor"><span id="_Toc145513285" class="anchor"><span id="_Toc145513669" class="anchor"><span id="_Toc222907455" class="anchor"><span id="_Toc342653166" class="anchor"><span id="_Toc439864255" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Scheduling Policy Settings
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

Various schedule policy settings can be set by the root partition
administrator. These include:

-   CPU Reserve

-   CPU Cap

-   CPU Weight

Each of these is described in more detail in the following sections.

### <span id="_Ref112428142" class="anchor"><span id="_Toc127596908" class="anchor"><span id="_Toc127786529" class="anchor"><span id="_Toc127786845" class="anchor"><span id="_Toc127787161" class="anchor"><span id="_Toc127877835" class="anchor"><span id="_Toc128289905" class="anchor"><span id="_Toc128290298" class="anchor"><span id="_Toc130189903" class="anchor"><span id="_Toc130201119" class="anchor"><span id="_Toc130201435" class="anchor"><span id="_Toc130201756" class="anchor"><span id="_Toc131937016" class="anchor"><span id="_Toc133901308" class="anchor"><span id="_Toc137461182" class="anchor"><span id="_Toc139096697" class="anchor"><span id="_Toc139188620" class="anchor"><span id="_Toc139191483" class="anchor"><span id="_Toc140490535" class="anchor"><span id="_Toc140571437" class="anchor"><span id="_Toc141257710" class="anchor"><span id="_Toc141258037" class="anchor"><span id="_Toc141267565" class="anchor"><span id="_Toc141522583" class="anchor"><span id="_Toc141529671" class="anchor"><span id="_Toc141529988" class="anchor"><span id="_Toc141851597" class="anchor"><span id="_Toc141852531" class="anchor"><span id="_Toc141888075" class="anchor"><span id="_Toc141889915" class="anchor"><span id="_Toc141893584" class="anchor"><span id="_Toc142113437" class="anchor"><span id="_Toc142114465" class="anchor"><span id="_Toc142729682" class="anchor"><span id="_Toc142730966" class="anchor"><span id="_Toc142731339" class="anchor"><span id="_Toc142998706" class="anchor"><span id="_Toc143063798" class="anchor"><span id="_Toc143509908" class="anchor"><span id="_Toc143510355" class="anchor"><span id="_Toc144026387" class="anchor"><span id="_Toc144026718" class="anchor"><span id="_Toc144276361" class="anchor"><span id="_Toc144276705" class="anchor"><span id="_Toc144280293" class="anchor"><span id="_Toc144280639" class="anchor"><span id="_Toc144540854" class="anchor"><span id="_Toc144554757" class="anchor"><span id="_Toc144722358" class="anchor"><span id="_Toc145503821" class="anchor"><span id="_Toc145512263" class="anchor"><span id="_Toc145513286" class="anchor"><span id="_Toc145513670" class="anchor"><span id="_Toc222907456" class="anchor"><span id="_Toc342653167" class="anchor"><span id="_Toc439864256" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>CPU Reserve

A CPU reserve can be supplied for each partition. The hypervisor
guarantees that this fraction of CPU time is available to each virtual
processor within the partition as needed. It does not necessarily mean
that the virtual processors *will* consume the entire reserve. If they
are idle or waiting on hypervisor work, other virtual processors may
consume the available processor cycles.

The CPU reserve is specified as a fraction of a logical processor’s
capacity. A reserve value of 0.5 indicates that 50% of a logical
processor is reserved for each virtual processor in the partition. Valid
reserve values range from 0 (no reserve) to 1 (in which case each
virtual processor is guaranteed to get 100% of a logical processor if
required). The reserve value may not be greater than the CPU Cap (see
section 20.2.2).

The reserve value is expressed as an integer ranging from 0x00000000 to
0x00010000. For example, the value 0x0000C000 indicates 0.75, or 75% of
a logical processor. By default, a partition’s reserve is set to
0x00000000, indicating that there is no reserve.

The total reserves for all virtual processors cannot exceed the number
of logical processors in the system. Reserves are not guaranteed if the
number of virtual processors in a partition exceeds the number of
logical processors that are available for scheduling.

If the number of virtual processors in a partition is greater than the
number of logical processors, then reserves are not guaranteed, and the
partition’s reserve may be reset to zero.

### <span id="_Ref112428225" class="anchor"><span id="_Toc127596909" class="anchor"><span id="_Toc127786530" class="anchor"><span id="_Toc127786846" class="anchor"><span id="_Toc127787162" class="anchor"><span id="_Toc127877836" class="anchor"><span id="_Toc128289906" class="anchor"><span id="_Toc128290299" class="anchor"><span id="_Toc130189904" class="anchor"><span id="_Toc130201120" class="anchor"><span id="_Toc130201436" class="anchor"><span id="_Toc130201757" class="anchor"><span id="_Toc131937017" class="anchor"><span id="_Toc133901309" class="anchor"><span id="_Toc137461183" class="anchor"><span id="_Toc139096698" class="anchor"><span id="_Toc139188621" class="anchor"><span id="_Toc139191484" class="anchor"><span id="_Toc140490536" class="anchor"><span id="_Toc140571438" class="anchor"><span id="_Toc141257711" class="anchor"><span id="_Toc141258038" class="anchor"><span id="_Toc141267566" class="anchor"><span id="_Toc141522584" class="anchor"><span id="_Toc141529672" class="anchor"><span id="_Toc141529989" class="anchor"><span id="_Toc141851598" class="anchor"><span id="_Toc141852532" class="anchor"><span id="_Toc141888076" class="anchor"><span id="_Toc141889916" class="anchor"><span id="_Toc141893585" class="anchor"><span id="_Toc142113438" class="anchor"><span id="_Toc142114466" class="anchor"><span id="_Toc142729683" class="anchor"><span id="_Toc142730967" class="anchor"><span id="_Toc142731340" class="anchor"><span id="_Toc142998707" class="anchor"><span id="_Toc143063799" class="anchor"><span id="_Toc143509909" class="anchor"><span id="_Toc143510356" class="anchor"><span id="_Toc144026388" class="anchor"><span id="_Toc144026719" class="anchor"><span id="_Toc144276362" class="anchor"><span id="_Toc144276706" class="anchor"><span id="_Toc144280294" class="anchor"><span id="_Toc144280640" class="anchor"><span id="_Toc144540855" class="anchor"><span id="_Toc144554758" class="anchor"><span id="_Toc144722359" class="anchor"><span id="_Toc145503822" class="anchor"><span id="_Toc145512264" class="anchor"><span id="_Toc145513287" class="anchor"><span id="_Toc145513671" class="anchor"><span id="_Toc222907457" class="anchor"><span id="_Toc342653168" class="anchor"><span id="_Toc439864257" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>CPU Cap

A CPU cap can be specified for each partition. The hypervisor guarantees
that the fraction of CPU time consumed by each virtual processor within
the partition will not exceed this cap.

The CPU cap is specified as a fraction of a logical processor’s
capacity. A cap value of 0.5 indicates that each virtual processor will
be restricted to using 50% of a logical processor. Valid cap values
range from 0 to 1 (in which case the cap has no effect).

The CPU cap value may not be less than the CPU reserve (see section
20.2.1).

The cap value is expressed as an integer ranging from 0x00000000 to
0x00010000. For example, the value 0x0000C000 indicates 0.75, or 75% of
a logical processor.

By default, a partition’s cap is set to 0x00010000, indicating that
there is no cap.

### <span id="_Ref112428297" class="anchor"><span id="_Toc127596910" class="anchor"><span id="_Toc127786531" class="anchor"><span id="_Toc127786847" class="anchor"><span id="_Toc127787163" class="anchor"><span id="_Toc127877837" class="anchor"><span id="_Toc128289907" class="anchor"><span id="_Toc128290300" class="anchor"><span id="_Toc130189905" class="anchor"><span id="_Toc130201121" class="anchor"><span id="_Toc130201437" class="anchor"><span id="_Toc130201758" class="anchor"><span id="_Toc131937018" class="anchor"><span id="_Toc133901310" class="anchor"><span id="_Toc137461184" class="anchor"><span id="_Toc139096699" class="anchor"><span id="_Toc139188622" class="anchor"><span id="_Toc139191485" class="anchor"><span id="_Toc140490537" class="anchor"><span id="_Toc140571439" class="anchor"><span id="_Toc141257712" class="anchor"><span id="_Toc141258039" class="anchor"><span id="_Toc141267567" class="anchor"><span id="_Toc141522585" class="anchor"><span id="_Toc141529673" class="anchor"><span id="_Toc141529990" class="anchor"><span id="_Toc141851599" class="anchor"><span id="_Toc141852533" class="anchor"><span id="_Toc141888077" class="anchor"><span id="_Toc141889917" class="anchor"><span id="_Toc141893586" class="anchor"><span id="_Toc142113439" class="anchor"><span id="_Toc142114467" class="anchor"><span id="_Toc142729684" class="anchor"><span id="_Toc142730968" class="anchor"><span id="_Toc142731341" class="anchor"><span id="_Toc142998708" class="anchor"><span id="_Toc143063800" class="anchor"><span id="_Toc143509910" class="anchor"><span id="_Toc143510357" class="anchor"><span id="_Toc144026389" class="anchor"><span id="_Toc144026720" class="anchor"><span id="_Toc144276363" class="anchor"><span id="_Toc144276707" class="anchor"><span id="_Toc144280295" class="anchor"><span id="_Toc144280641" class="anchor"><span id="_Toc144540856" class="anchor"><span id="_Toc144554759" class="anchor"><span id="_Toc144722360" class="anchor"><span id="_Toc145503823" class="anchor"><span id="_Toc145512265" class="anchor"><span id="_Toc145513288" class="anchor"><span id="_Toc145513672" class="anchor"><span id="_Toc222907458" class="anchor"><span id="_Toc342653169" class="anchor"><span id="_Toc439864258" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>CPU Weight

The CPU weight is a relative weight assigned to each of the virtual
processors of the partition. Unless otherwise constrained by reserves
and caps, the scheduler will attempt to weight the run time of the
virtual processors scheduled on a given logical processor according to
their relative weights. Let’s consider the case where three partitions,
each with one virtual processor are being scheduled on a single logical
processor, their weights are 100, 200 and 700, no reserves or caps are
in effect, and all three of the virtual processors have work to perform
(that is, they are not idle). In this case, the fraction of physical CPU
capacity provided to the three virtual processors would be approximately
10%, 20%, and 70%.

The CPU weight value is expressed as a decimal value from 1 to 10,000
where 100 (the geometric mean) is the typical value.

By default, a partition’s weight is set to 100.

1.  <span id="_Toc182301604" class="anchor"><span id="_Toc182302498" class="anchor"><span id="_Toc182303392" class="anchor"><span id="_Toc182331215" class="anchor"><span id="_Toc182301605" class="anchor"><span id="_Toc182302499" class="anchor"><span id="_Toc182303393" class="anchor"><span id="_Toc182331216" class="anchor"><span id="_Toc182301606" class="anchor"><span id="_Toc182302500" class="anchor"><span id="_Toc182303394" class="anchor"><span id="_Toc182331217" class="anchor"><span id="_Toc182301607" class="anchor"><span id="_Toc182302501" class="anchor"><span id="_Toc182303395" class="anchor"><span id="_Toc182331218" class="anchor"><span id="_Toc182301608" class="anchor"><span id="_Toc182302502" class="anchor"><span id="_Toc182303396" class="anchor"><span id="_Toc182331219" class="anchor"><span id="_Toc182301609" class="anchor"><span id="_Toc182302503" class="anchor"><span id="_Toc182303397" class="anchor"><span id="_Toc182331220" class="anchor"><span id="_Toc182301610" class="anchor"><span id="_Toc182302504" class="anchor"><span id="_Toc182303398" class="anchor"><span id="_Toc182331221" class="anchor"><span id="_Toc182301611" class="anchor"><span id="_Toc182302505" class="anchor"><span id="_Toc182303399" class="anchor"><span id="_Toc182331222" class="anchor"><span id="_Toc182301612" class="anchor"><span id="_Toc182302506" class="anchor"><span id="_Toc182303400" class="anchor"><span id="_Toc182331223" class="anchor"><span id="_Toc182301613" class="anchor"><span id="_Toc182302507" class="anchor"><span id="_Toc182303401" class="anchor"><span id="_Toc182331224" class="anchor"><span id="_Toc182301614" class="anchor"><span id="_Toc182302508" class="anchor"><span id="_Toc182303402" class="anchor"><span id="_Toc182331225" class="anchor"><span id="_Toc127596912" class="anchor"><span id="_Toc127786533" class="anchor"><span id="_Toc127786849" class="anchor"><span id="_Toc127787165" class="anchor"><span id="_Toc127877839" class="anchor"><span id="_Toc128289909" class="anchor"><span id="_Toc128290302" class="anchor"><span id="_Toc130189907" class="anchor"><span id="_Toc130201123" class="anchor"><span id="_Toc130201439" class="anchor"><span id="_Toc130201760" class="anchor"><span id="_Toc131937020" class="anchor"><span id="_Toc133901312" class="anchor"><span id="_Toc137461186" class="anchor"><span id="_Toc139096701" class="anchor"><span id="_Toc139188624" class="anchor"><span id="_Toc139191487" class="anchor"><span id="_Toc140490539" class="anchor"><span id="_Toc140571441" class="anchor"><span id="_Toc141257714" class="anchor"><span id="_Toc141258041" class="anchor"><span id="_Toc141267569" class="anchor"><span id="_Toc141522587" class="anchor"><span id="_Toc141529675" class="anchor"><span id="_Toc141529992" class="anchor"><span id="_Toc141851601" class="anchor"><span id="_Toc141852535" class="anchor"><span id="_Toc141888079" class="anchor"><span id="_Toc141889919" class="anchor"><span id="_Toc141893588" class="anchor"><span id="_Toc142113441" class="anchor"><span id="_Toc142114469" class="anchor"><span id="_Toc142729686" class="anchor"><span id="_Toc142730970" class="anchor"><span id="_Toc142731343" class="anchor"><span id="_Toc142998710" class="anchor"><span id="_Toc143063802" class="anchor"><span id="_Toc143509912" class="anchor"><span id="_Toc143510359" class="anchor"><span id="_Toc144026391" class="anchor"><span id="_Toc144026722" class="anchor"><span id="_Toc144276365" class="anchor"><span id="_Toc144276709" class="anchor"><span id="_Toc144280297" class="anchor"><span id="_Toc144280643" class="anchor"><span id="_Toc144540858" class="anchor"><span id="_Toc144554761" class="anchor"><span id="_Toc144722362" class="anchor"><span id="_Toc145503825" class="anchor"><span id="_Toc145512267" class="anchor"><span id="_Toc145513290" class="anchor"><span id="_Toc145513674" class="anchor"><span id="_Toc222907459" class="anchor"><span id="_Toc342653170" class="anchor"><span id="_Toc439864259" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Other Scheduling Considerations
    ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

    1.  ### <span id="_Ref113363449" class="anchor"><span id="_Toc127596913" class="anchor"><span id="_Toc127786534" class="anchor"><span id="_Toc127786850" class="anchor"><span id="_Toc127787166" class="anchor"><span id="_Toc127877840" class="anchor"><span id="_Toc128289910" class="anchor"><span id="_Toc128290303" class="anchor"><span id="_Toc130189908" class="anchor"><span id="_Toc130201124" class="anchor"><span id="_Toc130201440" class="anchor"><span id="_Toc130201761" class="anchor"><span id="_Toc131937021" class="anchor"><span id="_Toc133901313" class="anchor"><span id="_Toc137461187" class="anchor"><span id="_Toc139096702" class="anchor"><span id="_Toc139188625" class="anchor"><span id="_Toc139191488" class="anchor"><span id="_Toc140490540" class="anchor"><span id="_Toc140571442" class="anchor"><span id="_Toc141257715" class="anchor"><span id="_Toc141258042" class="anchor"><span id="_Toc141267570" class="anchor"><span id="_Toc141522588" class="anchor"><span id="_Toc141529676" class="anchor"><span id="_Toc141529993" class="anchor"><span id="_Toc141851602" class="anchor"><span id="_Toc141852536" class="anchor"><span id="_Toc141888080" class="anchor"><span id="_Toc141889920" class="anchor"><span id="_Toc141893589" class="anchor"><span id="_Toc142113442" class="anchor"><span id="_Toc142114470" class="anchor"><span id="_Toc142729687" class="anchor"><span id="_Toc142730971" class="anchor"><span id="_Toc142731344" class="anchor"><span id="_Toc142998711" class="anchor"><span id="_Toc143063803" class="anchor"><span id="_Toc143509913" class="anchor"><span id="_Toc143510360" class="anchor"><span id="_Toc144026392" class="anchor"><span id="_Toc144026723" class="anchor"><span id="_Toc144276366" class="anchor"><span id="_Toc144276710" class="anchor"><span id="_Toc144280298" class="anchor"><span id="_Toc144280644" class="anchor"><span id="_Toc144540859" class="anchor"><span id="_Toc144554762" class="anchor"><span id="_Toc144722363" class="anchor"><span id="_Toc145503826" class="anchor"><span id="_Toc145512268" class="anchor"><span id="_Toc145513291" class="anchor"><span id="_Toc145513675" class="anchor"><span id="_Toc222907460" class="anchor"><span id="_Toc342653171" class="anchor"><span id="_Toc439864260" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Hyperthreading

Multiple virtual processors can optionally be grouped together and
scheduled onto hyperthreads within a single physical processor core. In
effect, these virtual processors then act like virtual hyperthreads.
When virtual processors are grouped as such, the hypervisor tries to
schedule them concurrently on the same physical processor core. This
scheduling behavior potentially improves performance and reduces
information leakage across partition boundaries.

### <span id="_Toc182301617" class="anchor"><span id="_Toc182302511" class="anchor"><span id="_Toc182303405" class="anchor"><span id="_Toc182331228" class="anchor"><span id="_Toc182301618" class="anchor"><span id="_Toc182302512" class="anchor"><span id="_Toc182303406" class="anchor"><span id="_Toc182331229" class="anchor"><span id="_Toc182301619" class="anchor"><span id="_Toc182302513" class="anchor"><span id="_Toc182303407" class="anchor"><span id="_Toc182331230" class="anchor"><span id="_Toc182301620" class="anchor"><span id="_Toc182302514" class="anchor"><span id="_Toc182303408" class="anchor"><span id="_Toc182331231" class="anchor"><span id="_Toc127596914" class="anchor"><span id="_Toc127786535" class="anchor"><span id="_Toc127786851" class="anchor"><span id="_Toc127787167" class="anchor"><span id="_Toc127877841" class="anchor"><span id="_Toc128289911" class="anchor"><span id="_Toc128290304" class="anchor"><span id="_Toc130189909" class="anchor"><span id="_Toc130201125" class="anchor"><span id="_Toc130201441" class="anchor"><span id="_Toc130201762" class="anchor"><span id="_Toc131937022" class="anchor"><span id="_Toc133901314" class="anchor"><span id="_Toc137461188" class="anchor"><span id="_Toc139096703" class="anchor"><span id="_Toc139188626" class="anchor"><span id="_Toc139191489" class="anchor"><span id="_Toc140490541" class="anchor"><span id="_Toc140571443" class="anchor"><span id="_Toc141257716" class="anchor"><span id="_Toc141258043" class="anchor"><span id="_Toc141267571" class="anchor"><span id="_Toc141522589" class="anchor"><span id="_Toc141529677" class="anchor"><span id="_Toc141529994" class="anchor"><span id="_Toc141851603" class="anchor"><span id="_Toc141852537" class="anchor"><span id="_Toc141888081" class="anchor"><span id="_Toc141889921" class="anchor"><span id="_Toc141893590" class="anchor"><span id="_Toc142113443" class="anchor"><span id="_Toc142114471" class="anchor"><span id="_Toc142729688" class="anchor"><span id="_Toc142730972" class="anchor"><span id="_Toc142731345" class="anchor"><span id="_Toc142998712" class="anchor"><span id="_Toc143063804" class="anchor"><span id="_Toc143509914" class="anchor"><span id="_Toc143510361" class="anchor"><span id="_Toc144026393" class="anchor"><span id="_Toc144026724" class="anchor"><span id="_Toc144276367" class="anchor"><span id="_Toc144276711" class="anchor"><span id="_Toc144280299" class="anchor"><span id="_Toc144280645" class="anchor"><span id="_Toc144540860" class="anchor"><span id="_Toc144554763" class="anchor"><span id="_Toc144722364" class="anchor"><span id="_Toc145503827" class="anchor"><span id="_Toc145512269" class="anchor"><span id="_Toc145513292" class="anchor"><span id="_Toc145513676" class="anchor"><span id="_Toc222907461" class="anchor"><span id="_Toc342653172" class="anchor"><span id="_Toc439864261" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>NUMA and Affinity

When a virtual processor is run-able, the hypervisor’s scheduler assigns
it to a logical processor. The placement is determined based on a
variety of factors including workload, reservations, and NUMA topology.
In general, the scheduler will attempt to keep a virtual processor
scheduled on a logical processor that is topologically closest to the
memory being accessed by the virtual processor, in effect minimizing
memory access times.

The scheduler also attempts to create as much temporal affinity as
possible. That is, it will prefer to run a virtual processor on the same
logical processor each time it is scheduled. If the logical processor is
oversubscribed, the scheduler may move it to another logical processor.

### <span id="_Toc222907462" class="anchor"><span id="_Toc342653173" class="anchor"><span id="_Toc439864262" class="anchor"></span></span></span>Guest Spinlocks

A typical multiprocessor-capable operating system uses locks for
enforcing atomicity of certain operations. When running such an
operating system inside a virtual machine controlled by the hypervisor
these critical sections protected by locks can be extended by intercepts
generated by the critical section code. The critical section code may
also be preempted by the hypervisor scheduler. Although the hypervisor
attempts to prevent such preemptions, they can occur. Consequently,
other lock contenders could end up spinning until the lock holder is
re-scheduled again and therefore significantly extend the spinlock
acquisition time. The hypervisor indicates to the guest OS the number of
times a spinlock acquisition should be attempted before indicating an
excessive spin situation to the hypervisor. This count is returned in
CPUID leaf 0x40000004.

The HvNotifyLongSpinWait hypercall provides an interface for enlightened
guests to improve the statistical fairness property of a lock for
multiprocessor virtual machines. Through this hypercall, a guest
notifies the hypervisor of a long spinlock acquisition. This allows the
hypervisor to make better scheduling decisions.

<span id="_Toc222907463" class="anchor"><span id="_Toc342653174" class="anchor"><span id="_Toc439864263" class="anchor"></span></span></span>Scheduler Data Types
-----------------------------------------------------------------------------------------------------------------------------------------------------------------

The following data types support the scheduler interfaces.

typedef UINT64 HV\_INPUT\_NOTIFY\_LONG\_SPINWAIT ;

typedef HV\_INPUT\_NOTIFY\_LONG\_SPINWAIT,
\*PHV\_INPUT\_NOTIFY\_LONG\_SPINWAIT;

1.  <span id="_Toc222907464" class="anchor"><span id="_Toc342653175" class="anchor"><span id="_Toc439864264" class="anchor"></span></span></span>Scheduler Interfaces
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------

    1.  ### <span id="_Toc222907465" class="anchor"><span id="_Toc342653176" class="anchor"><span id="_Toc439864265" class="anchor"></span></span></span>HvNotifyLongSpinWait

The HvNotifyLongSpinWait hypercall is used by a guest OS to notify the
hypervisor that the calling virtual processor is attempting to acquire a
resource that is potentially held by another virtual processor within
the same partition. This scheduling hint improves the scalability of
partitions with more than one virtual processor.

##### Wrapper Interface

HV\_STATUS

HvNotifyLongSpinWait(

\_in HV\_INPUT\_NOTIFY\_LONG\_SPINWAIT SpinwaitInfo

);

##### Native Interface

  HvNotifyLongSpinWait \[fast\]
  ------------------------------- ------------------------ -------------------
  Input Parameters
  0

##### Description

The HvNotifyLongSpinWait hypercall allows a partition to inform the
Hypervisor of a long spinlock acquire failure. The hypervisor can use
this information to make better scheduling decisions for the notifying
virtual processor and its partition.

Input Parameters

SpinwaitInfo – Specifies the accumulated count the guest was spinning.

Output Parameters

None.

Restrictions

None.

Return Values

There is no error status for this hypercall, only HV\_STATUS\_SUCCESS
will be returned as this is an advisory hypercall.

1.  <span id="_Ref141852707" class="anchor"><span id="_Toc141888082" class="anchor"><span id="_Toc141889922" class="anchor"><span id="_Toc141893591" class="anchor"><span id="_Toc142113444" class="anchor"><span id="_Toc142114472" class="anchor"><span id="_Toc142729689" class="anchor"><span id="_Toc142730973" class="anchor"><span id="_Toc142731346" class="anchor"><span id="_Toc142998713" class="anchor"><span id="_Toc143063805" class="anchor"><span id="_Toc143509915" class="anchor"><span id="_Toc143510362" class="anchor"><span id="_Toc144026394" class="anchor"><span id="_Toc144026725" class="anchor"><span id="_Toc144276368" class="anchor"><span id="_Toc144276712" class="anchor"><span id="_Toc144280300" class="anchor"><span id="_Toc144280646" class="anchor"><span id="_Toc144540861" class="anchor"><span id="_Toc144554764" class="anchor"><span id="_Toc144722365" class="anchor"><span id="_Toc145503828" class="anchor"><span id="_Toc145512270" class="anchor"><span id="_Toc145513293" class="anchor"><span id="_Toc145513677" class="anchor"><span id="_Toc222907466" class="anchor"><span id="_Toc342653180" class="anchor"><span id="_Toc439858255" class="anchor"><span id="_Ref113202446" class="anchor"><span id="_Toc118467516" class="anchor"><span id="_Toc127596915" class="anchor"><span id="_Toc127786536" class="anchor"><span id="_Toc127786852" class="anchor"><span id="_Toc127787168" class="anchor"><span id="_Toc127877842" class="anchor"><span id="_Toc128289912" class="anchor"><span id="_Toc128290305" class="anchor"><span id="_Toc130189910" class="anchor"><span id="_Toc130201126" class="anchor"><span id="_Toc130201442" class="anchor"><span id="_Toc130201763" class="anchor"><span id="_Ref130718787" class="anchor"><span id="_Toc131937023" class="anchor"><span id="_Toc133901315" class="anchor"><span id="_Toc137461189" class="anchor"><span id="_Toc139096704" class="anchor"><span id="_Toc139188627" class="anchor"><span id="_Toc139191490" class="anchor"><span id="_Toc140490542" class="anchor"><span id="_Toc140571444" class="anchor"><span id="_Toc141257717" class="anchor"><span id="_Toc141258044" class="anchor"><span id="_Toc141267572" class="anchor"><span id="_Toc141522590" class="anchor"><span id="_Toc141529678" class="anchor"><span id="_Toc141529995" class="anchor"><span id="_Toc141851604" class="anchor"><span id="_Toc141852538" class="anchor"><span id="_Toc439864266" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>
    ====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================

    1.  <span id="_Toc141851605" class="anchor"><span id="_Toc141852539" class="anchor"><span id="_Toc141888083" class="anchor"><span id="_Toc141889923" class="anchor"><span id="_Toc141893592" class="anchor"><span id="_Toc142113445" class="anchor"><span id="_Toc142114473" class="anchor"><span id="_Toc145513294" class="anchor"><span id="_Toc145513678" class="anchor"><span id="_Toc222907467" class="anchor"><span id="_Toc342653181" class="anchor"><span id="_Toc439858256" class="anchor"><span id="_Toc439864267" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span>
        -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

-   -   -   -   1.  ### <span id="_Toc145513295" class="anchor"><span id="_Toc145513679" class="anchor"><span id="_Toc222907468" class="anchor"><span id="_Toc342653182" class="anchor"><span id="_Toc439858257" class="anchor"><span id="_Toc127596918" class="anchor"><span id="_Toc127786539" class="anchor"><span id="_Toc127786855" class="anchor"><span id="_Toc127787171" class="anchor"><span id="_Toc127877845" class="anchor"><span id="_Toc128289915" class="anchor"><span id="_Toc128290308" class="anchor"><span id="_Toc130189913" class="anchor"><span id="_Toc130201129" class="anchor"><span id="_Toc130201445" class="anchor"><span id="_Toc130201766" class="anchor"><span id="_Toc131937026" class="anchor"><span id="_Toc133901318" class="anchor"><span id="_Toc137461192" class="anchor"><span id="_Toc139096707" class="anchor"><span id="_Toc139188630" class="anchor"><span id="_Toc139191493" class="anchor"><span id="_Toc140490545" class="anchor"><span id="_Toc140571447" class="anchor"><span id="_Toc141851607" class="anchor"><span id="_Toc141852541" class="anchor"><span id="_Toc141888085" class="anchor"><span id="_Toc141889925" class="anchor"><span id="_Toc141893594" class="anchor"><span id="_Toc142113447" class="anchor"><span id="_Toc142114475" class="anchor"><span id="_Toc439864268" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>

    2.  ### <span id="_Toc145513296" class="anchor"><span id="_Toc145513680" class="anchor"><span id="_Toc222907469" class="anchor"><span id="_Toc342653183" class="anchor"><span id="_Toc439858258" class="anchor"><span id="_Toc439864269" class="anchor"></span></span></span></span></span></span>

    3.  ### <span id="_Toc127596917" class="anchor"><span id="_Toc127786538" class="anchor"><span id="_Toc127786854" class="anchor"><span id="_Toc127787170" class="anchor"><span id="_Toc127877844" class="anchor"><span id="_Toc128289914" class="anchor"><span id="_Toc128290307" class="anchor"><span id="_Toc130189912" class="anchor"><span id="_Toc130201128" class="anchor"><span id="_Toc130201444" class="anchor"><span id="_Toc130201765" class="anchor"><span id="_Toc131937025" class="anchor"><span id="_Toc133901317" class="anchor"><span id="_Toc137461191" class="anchor"><span id="_Toc139096706" class="anchor"><span id="_Toc139188629" class="anchor"><span id="_Toc139191492" class="anchor"><span id="_Toc140490544" class="anchor"><span id="_Toc140571446" class="anchor"><span id="_Toc141851606" class="anchor"><span id="_Toc141852540" class="anchor"><span id="_Toc141888084" class="anchor"><span id="_Toc141889924" class="anchor"><span id="_Toc141893593" class="anchor"><span id="_Toc142113446" class="anchor"><span id="_Toc142114474" class="anchor"><span id="_Toc145513297" class="anchor"><span id="_Toc145513681" class="anchor"><span id="_Toc222907470" class="anchor"><span id="_Toc342653184" class="anchor"><span id="_Toc439858259" class="anchor"><span id="_Toc439864270" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>

-   -   -   -   1.  ### <span id="_Toc145513298" class="anchor"><span id="_Toc145513682" class="anchor"><span id="_Toc222907471" class="anchor"><span id="_Toc342653185" class="anchor"><span id="_Toc439858260" class="anchor"><span id="_Toc439864271" class="anchor"></span></span></span></span></span></span>

    2.  ### <span id="_Toc141851608" class="anchor"><span id="_Toc141852542" class="anchor"><span id="_Toc141888086" class="anchor"><span id="_Toc141889926" class="anchor"><span id="_Toc141893595" class="anchor"><span id="_Toc142113448" class="anchor"><span id="_Toc142114476" class="anchor"><span id="_Toc145513299" class="anchor"><span id="_Toc145513683" class="anchor"><span id="_Ref146017345" class="anchor"><span id="_Toc222907472" class="anchor"><span id="_Toc342653186" class="anchor"><span id="_Toc439858261" class="anchor"><span id="_Toc127596919" class="anchor"><span id="_Toc127786540" class="anchor"><span id="_Toc127786856" class="anchor"><span id="_Toc127787172" class="anchor"><span id="_Toc127877846" class="anchor"><span id="_Toc128289916" class="anchor"><span id="_Toc128290309" class="anchor"><span id="_Toc130189914" class="anchor"><span id="_Toc130201130" class="anchor"><span id="_Toc130201446" class="anchor"><span id="_Toc130201767" class="anchor"><span id="_Toc131937027" class="anchor"><span id="_Toc133901319" class="anchor"><span id="_Toc137461193" class="anchor"><span id="_Toc139096708" class="anchor"><span id="_Toc139188631" class="anchor"><span id="_Toc139191494" class="anchor"><span id="_Toc140490546" class="anchor"><span id="_Toc140571448" class="anchor"><span id="_Toc439864272" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>

<span id="_Toc437515062" class="anchor"></span>

<span id="_Toc437515064" class="anchor"></span>

  <span id="_Toc437515066" class="anchor"></span>               
  ------------------------------------------------- -- -- -- -- --
                                                                
                                                                
                                                                
                                                                
                                                                
                                                                
                                                                
                                                                

1.  ### <span id="_Toc342653187" class="anchor"><span id="_Toc141851609" class="anchor"><span id="_Toc141852543" class="anchor"><span id="_Toc141888087" class="anchor"><span id="_Toc141889927" class="anchor"><span id="_Toc141893596" class="anchor"><span id="_Toc142113449" class="anchor"><span id="_Toc142114477" class="anchor"><span id="_Toc145513300" class="anchor"><span id="_Toc145513684" class="anchor"><span id="_Toc222907473" class="anchor"><span id="_Toc342653188" class="anchor"><span id="_Toc439858262" class="anchor"><span id="_Toc439864273" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span>

2.  ### <span id="_Toc145513301" class="anchor"><span id="_Toc145513685" class="anchor"><span id="_Toc222907474" class="anchor"><span id="_Toc342653189" class="anchor"><span id="_Toc439858263" class="anchor"><span id="_Toc439864274" class="anchor"></span></span></span></span></span></span>

-   -   -   -   1.  ### <span id="_Toc127596920" class="anchor"><span id="_Toc127786541" class="anchor"><span id="_Toc127786857" class="anchor"><span id="_Toc127787173" class="anchor"><span id="_Toc127877847" class="anchor"><span id="_Toc128289917" class="anchor"><span id="_Toc128290310" class="anchor"><span id="_Toc130189915" class="anchor"><span id="_Toc130201131" class="anchor"><span id="_Toc130201447" class="anchor"><span id="_Toc130201768" class="anchor"><span id="_Toc131937028" class="anchor"><span id="_Toc133901320" class="anchor"><span id="_Toc137461194" class="anchor"><span id="_Toc139096709" class="anchor"><span id="_Toc139188632" class="anchor"><span id="_Toc139191495" class="anchor"><span id="_Toc140490547" class="anchor"><span id="_Toc140571449" class="anchor"><span id="_Toc141851610" class="anchor"><span id="_Toc141852544" class="anchor"><span id="_Toc141888088" class="anchor"><span id="_Toc141889928" class="anchor"><span id="_Toc141893597" class="anchor"><span id="_Toc142113450" class="anchor"><span id="_Toc142114478" class="anchor"><span id="_Toc145513302" class="anchor"><span id="_Toc145513686" class="anchor"><span id="_Toc222907475" class="anchor"><span id="_Toc342653190" class="anchor"><span id="_Toc439858264" class="anchor"><span id="_Toc439864275" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>

    2.  ### <span id="_Toc145513303" class="anchor"><span id="_Toc145513687" class="anchor"><span id="_Toc222907476" class="anchor"><span id="_Toc342653191" class="anchor"><span id="_Toc439858265" class="anchor"><span id="_Toc127596921" class="anchor"><span id="_Toc127786542" class="anchor"><span id="_Toc127786858" class="anchor"><span id="_Toc127787174" class="anchor"><span id="_Toc127877848" class="anchor"><span id="_Toc128289918" class="anchor"><span id="_Toc128290311" class="anchor"><span id="_Toc130189916" class="anchor"><span id="_Toc130201132" class="anchor"><span id="_Toc130201448" class="anchor"><span id="_Toc130201769" class="anchor"><span id="_Toc131937029" class="anchor"><span id="_Toc133901321" class="anchor"><span id="_Toc137461195" class="anchor"><span id="_Toc139096710" class="anchor"><span id="_Toc139188633" class="anchor"><span id="_Toc139191496" class="anchor"><span id="_Toc140490548" class="anchor"><span id="_Toc140571450" class="anchor"><span id="_Toc141851611" class="anchor"><span id="_Toc141852545" class="anchor"><span id="_Toc141888089" class="anchor"><span id="_Toc141889929" class="anchor"><span id="_Toc141893598" class="anchor"><span id="_Toc142113451" class="anchor"><span id="_Toc142114479" class="anchor"><span id="_Toc439864276" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>

    3.  ### <span id="_Toc145513304" class="anchor"><span id="_Toc145513688" class="anchor"><span id="_Toc222907477" class="anchor"><span id="_Toc342653192" class="anchor"><span id="_Toc439858266" class="anchor"><span id="_Toc439864277" class="anchor"></span></span></span></span></span></span>

-   -   1.  ### <span id="_Ref145838915" class="anchor"><span id="_Toc222907478" class="anchor"><span id="_Toc342653193" class="anchor"><span id="_Toc439858267" class="anchor"><span id="_Toc145513305" class="anchor"><span id="_Toc145513689" class="anchor"><span id="_Toc439864278" class="anchor"></span></span></span></span></span></span></span>

    2.  ### <span id="_Ref146017404" class="anchor"><span id="_Toc222907479" class="anchor"><span id="_Toc342653194" class="anchor"><span id="_Toc439858268" class="anchor"><span id="_Toc439864279" class="anchor"></span></span></span></span></span>

    3.  ### <span id="_Toc222907480" class="anchor"><span id="_Toc342653195" class="anchor"><span id="_Toc439858269" class="anchor"><span id="_Toc439864280" class="anchor"></span></span></span></span>

    4.  ### <span id="_Toc145513306" class="anchor"><span id="_Toc145513690" class="anchor"><span id="_Toc222907481" class="anchor"><span id="_Toc342653196" class="anchor"><span id="_Toc439858270" class="anchor"><span id="_Toc439864281" class="anchor"></span></span></span></span></span></span>

-   -   -   -   -   -   1.  <span id="_Toc141851612" class="anchor"><span id="_Toc141852546" class="anchor"><span id="_Toc141888090" class="anchor"><span id="_Toc141889930" class="anchor"><span id="_Toc141893599" class="anchor"><span id="_Toc142113452" class="anchor"><span id="_Toc142114480" class="anchor"><span id="_Toc145513307" class="anchor"><span id="_Toc145513691" class="anchor"><span id="_Toc222907482" class="anchor"><span id="_Toc342653197" class="anchor"><span id="_Toc439858271" class="anchor"><span id="_Toc439864282" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span>
        -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

        1.  ### <span id="_Toc141851613" class="anchor"><span id="_Toc141852547" class="anchor"><span id="_Toc141888091" class="anchor"><span id="_Toc141889931" class="anchor"><span id="_Toc141893600" class="anchor"><span id="_Toc142113453" class="anchor"><span id="_Toc142114481" class="anchor"><span id="_Toc145513308" class="anchor"><span id="_Toc145513692" class="anchor"><span id="_Toc222907483" class="anchor"><span id="_Toc342653198" class="anchor"><span id="_Toc439858272" class="anchor"><span id="_Toc439864283" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span>

<span id="_Toc437515179" class="anchor"></span>

<span id="_Toc437515187" class="anchor"></span>

<span id="_Toc437515188" class="anchor"></span>

  -- -------------------------------------------------
     <span id="_Toc437515193" class="anchor"></span>
     <span id="_Toc437515196" class="anchor"></span>
     <span id="_Toc437515199" class="anchor"></span>
  -- -------------------------------------------------

### <span id="_Toc127596924" class="anchor"><span id="_Toc127786545" class="anchor"><span id="_Toc127786861" class="anchor"><span id="_Toc127787177" class="anchor"><span id="_Toc127877851" class="anchor"><span id="_Toc128289921" class="anchor"><span id="_Toc128290314" class="anchor"><span id="_Toc130189919" class="anchor"><span id="_Toc130201135" class="anchor"><span id="_Toc130201451" class="anchor"><span id="_Toc130201772" class="anchor"><span id="_Toc131937032" class="anchor"><span id="_Toc133901324" class="anchor"><span id="_Toc137461198" class="anchor"><span id="_Toc139096713" class="anchor"><span id="_Toc139188636" class="anchor"><span id="_Toc139191499" class="anchor"><span id="_Toc140490551" class="anchor"><span id="_Toc140571453" class="anchor"><span id="_Toc141851614" class="anchor"><span id="_Toc141852548" class="anchor"><span id="_Toc141888092" class="anchor"><span id="_Toc141889932" class="anchor"><span id="_Toc141893601" class="anchor"><span id="_Toc142113454" class="anchor"><span id="_Toc142114482" class="anchor"><span id="_Toc145513309" class="anchor"><span id="_Toc145513693" class="anchor"><span id="_Toc222907484" class="anchor"><span id="_Toc342653199" class="anchor"><span id="_Toc439858273" class="anchor"><span id="_Toc439864284" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>

<span id="_Toc437515203" class="anchor"></span>

<span id="_Toc437515207" class="anchor"></span>

<span id="_Toc437515211" class="anchor"></span>

### <span id="_Toc127596925" class="anchor"><span id="_Toc127786546" class="anchor"><span id="_Toc127786862" class="anchor"><span id="_Toc127787178" class="anchor"><span id="_Toc127877852" class="anchor"><span id="_Toc128289922" class="anchor"><span id="_Toc128290315" class="anchor"><span id="_Toc130189920" class="anchor"><span id="_Toc130201136" class="anchor"><span id="_Toc130201452" class="anchor"><span id="_Toc130201773" class="anchor"><span id="_Toc131937033" class="anchor"><span id="_Toc133901325" class="anchor"><span id="_Toc137461199" class="anchor"><span id="_Toc139096714" class="anchor"><span id="_Toc139188637" class="anchor"><span id="_Toc139191500" class="anchor"><span id="_Toc140490552" class="anchor"><span id="_Toc140571454" class="anchor"><span id="_Toc141851615" class="anchor"><span id="_Toc141852549" class="anchor"><span id="_Toc141888093" class="anchor"><span id="_Toc141889933" class="anchor"><span id="_Toc141893602" class="anchor"><span id="_Toc142113455" class="anchor"><span id="_Toc142114483" class="anchor"><span id="_Toc145513310" class="anchor"><span id="_Toc145513694" class="anchor"><span id="_Toc222907485" class="anchor"><span id="_Toc342653200" class="anchor"><span id="_Toc439858274" class="anchor"><span id="_Toc439864285" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>

<span id="_Toc437515214" class="anchor"></span>

<span id="_Toc437515226" class="anchor"></span>

### <span id="_Toc145513311" class="anchor"><span id="_Toc145513695" class="anchor"><span id="_Toc222907486" class="anchor"><span id="_Toc342653201" class="anchor"><span id="_Toc439858275" class="anchor"><span id="_Toc127596926" class="anchor"><span id="_Toc127786547" class="anchor"><span id="_Toc127786863" class="anchor"><span id="_Toc127787179" class="anchor"><span id="_Toc127877853" class="anchor"><span id="_Toc128289923" class="anchor"><span id="_Toc128290316" class="anchor"><span id="_Toc130189921" class="anchor"><span id="_Toc130201137" class="anchor"><span id="_Toc130201453" class="anchor"><span id="_Toc130201774" class="anchor"><span id="_Toc131937034" class="anchor"><span id="_Toc133901326" class="anchor"><span id="_Toc137461200" class="anchor"><span id="_Toc139096715" class="anchor"><span id="_Toc139188638" class="anchor"><span id="_Toc139191501" class="anchor"><span id="_Toc140490553" class="anchor"><span id="_Toc140571455" class="anchor"><span id="_Toc141851616" class="anchor"><span id="_Toc141852550" class="anchor"><span id="_Toc141888094" class="anchor"><span id="_Toc141889934" class="anchor"><span id="_Toc141893603" class="anchor"><span id="_Toc142113456" class="anchor"><span id="_Toc142114484" class="anchor"><span id="_Toc439864286" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>

<span id="_Toc437515230" class="anchor"></span>

<span id="_Toc437515232" class="anchor"></span>

<span id="_Toc437515234" class="anchor"></span>

<span id="_Toc437515235" class="anchor"></span>

### <span id="_Toc145513312" class="anchor"><span id="_Toc145513696" class="anchor"><span id="_Toc222907487" class="anchor"><span id="_Toc342653202" class="anchor"><span id="_Toc439858276" class="anchor"><span id="_Toc439864287" class="anchor"></span></span></span></span></span></span>

<span id="_Toc437515238" class="anchor"></span>

<span id="_Toc437515245" class="anchor"></span>

<span id="_Toc437515252" class="anchor"></span>

<span id="_Toc437515254" class="anchor"></span>

<span id="_Toc437515261" class="anchor"></span>

<span id="_Toc437515263" class="anchor"></span>

<span id="_Toc437515275" class="anchor"></span>

<span id="_Toc437515277" class="anchor"></span>

<span id="_Toc437515279" class="anchor"></span>

<span id="_Toc437515280" class="anchor"></span>

### <span id="_Toc141851617" class="anchor"><span id="_Toc141852551" class="anchor"><span id="_Toc141888095" class="anchor"><span id="_Toc141889935" class="anchor"><span id="_Toc141893604" class="anchor"><span id="_Toc142113457" class="anchor"><span id="_Toc142114485" class="anchor"><span id="_Toc145513313" class="anchor"><span id="_Toc145513697" class="anchor"><span id="_Toc222907488" class="anchor"><span id="_Toc342653203" class="anchor"><span id="_Toc439858277" class="anchor"><span id="_Toc439864288" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span>

<span id="_Toc437515293" class="anchor"></span>

<span id="_Toc437515299" class="anchor"></span>

<span id="_Toc437515305" class="anchor"></span>

<span id="_Toc437515313" class="anchor"></span>

1.  <span id="_Toc141851618" class="anchor"><span id="_Toc141852552" class="anchor"><span id="_Toc141888096" class="anchor"><span id="_Toc141889936" class="anchor"><span id="_Toc141893605" class="anchor"><span id="_Toc142113458" class="anchor"><span id="_Toc142114486" class="anchor"><span id="_Toc145513314" class="anchor"><span id="_Toc145513698" class="anchor"><span id="_Toc222907489" class="anchor"><span id="_Toc342653204" class="anchor"><span id="_Toc439858278" class="anchor"><span id="_Toc439864289" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span>
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

    1.  ### <span id="_Toc141851619" class="anchor"><span id="_Toc141852553" class="anchor"><span id="_Toc141888097" class="anchor"><span id="_Toc141889937" class="anchor"><span id="_Toc141893606" class="anchor"><span id="_Toc142113459" class="anchor"><span id="_Toc142114487" class="anchor"><span id="_Toc145513315" class="anchor"><span id="_Toc145513699" class="anchor"><span id="_Toc222907490" class="anchor"><span id="_Toc342653205" class="anchor"><span id="_Toc439858279" class="anchor"><span id="_Toc439864290" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span>

##### 

<span id="_Toc437515322" class="anchor"></span>

<span id="_Toc437515332" class="anchor"></span>

##### 

  ------------------------------------------------- -- --
  <span id="_Toc437515336" class="anchor"></span>
  ------------------------------------------------- -- --

##### 

-   -   

  ------------------------------------------------- --
                                                    
                                                    
  <span id="_Toc437515381" class="anchor"></span>   
  <span id="_Toc437515384" class="anchor"></span>   
  <span id="_Toc437515387" class="anchor"></span>   
  <span id="_Toc437515390" class="anchor"></span>   
                                                    
                                                    
  ------------------------------------------------- --

### <span id="_Toc145513323" class="anchor"><span id="_Toc145513707" class="anchor"><span id="_Toc222907491" class="anchor"><span id="_Toc342653209" class="anchor"><span id="_Toc439858280" class="anchor"><span id="_Toc127596929" class="anchor"><span id="_Toc127786550" class="anchor"><span id="_Toc127786866" class="anchor"><span id="_Toc127787182" class="anchor"><span id="_Toc127877856" class="anchor"><span id="_Toc128289926" class="anchor"><span id="_Toc128290319" class="anchor"><span id="_Toc130189924" class="anchor"><span id="_Toc130201140" class="anchor"><span id="_Toc130201456" class="anchor"><span id="_Toc130201777" class="anchor"><span id="_Toc131937037" class="anchor"><span id="_Toc133901329" class="anchor"><span id="_Toc137461203" class="anchor"><span id="_Toc139096718" class="anchor"><span id="_Toc139188641" class="anchor"><span id="_Toc139191504" class="anchor"><span id="_Toc140490556" class="anchor"><span id="_Toc140571458" class="anchor"><span id="_Toc141851620" class="anchor"><span id="_Toc141852554" class="anchor"><span id="_Toc141888098" class="anchor"><span id="_Toc141889938" class="anchor"><span id="_Toc141893607" class="anchor"><span id="_Toc142113460" class="anchor"><span id="_Toc142114488" class="anchor"><span id="_Ref142223669" class="anchor"><span id="_Toc145513316" class="anchor"><span id="_Toc145513700" class="anchor"><span id="_Toc439864291" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>

##### 

<span id="_Toc437515403" class="anchor"></span>

<span id="_Toc437515408" class="anchor"></span>

##### 

  ------------------------------------------------- -- --
  <span id="_Toc437515412" class="anchor"></span>
  ------------------------------------------------- -- --

##### 

-   

  ------------------------------------------------- --
                                                    
                                                    
                                                    
  <span id="_Toc437515442" class="anchor"></span>   
  <span id="_Toc437515445" class="anchor"></span>   
  ------------------------------------------------- --

### <span id="_Toc222907492" class="anchor"><span id="_Toc342653213" class="anchor"><span id="_Toc439858281" class="anchor"><span id="_Toc439864292" class="anchor"></span></span></span></span>

##### 

<span id="_Toc437515451" class="anchor"></span>

<span id="_Toc437515458" class="anchor"></span>

##### 

  ------------------------------------------------- -- --
  <span id="_Toc437515462" class="anchor"></span>
  ------------------------------------------------- -- --

##### 

-   

  ------------------------------------------------- --
                                                    
                                                    
  <span id="_Toc437515494" class="anchor"></span>   
  <span id="_Toc437515497" class="anchor"></span>   
                                                    
                                                    
  ------------------------------------------------- --

### <span id="_Toc145513322" class="anchor"><span id="_Toc145513706" class="anchor"><span id="_Toc222907493" class="anchor"><span id="_Toc342653217" class="anchor"><span id="_Toc439858282" class="anchor"><span id="_Toc145513317" class="anchor"><span id="_Toc145513701" class="anchor"><span id="_Toc127596930" class="anchor"><span id="_Toc127786551" class="anchor"><span id="_Toc127786867" class="anchor"><span id="_Toc127787183" class="anchor"><span id="_Toc127877857" class="anchor"><span id="_Toc128289927" class="anchor"><span id="_Toc128290320" class="anchor"><span id="_Toc130189925" class="anchor"><span id="_Toc130201141" class="anchor"><span id="_Toc130201457" class="anchor"><span id="_Toc130201778" class="anchor"><span id="_Toc131937038" class="anchor"><span id="_Toc133901330" class="anchor"><span id="_Toc137461204" class="anchor"><span id="_Toc139096719" class="anchor"><span id="_Toc139188642" class="anchor"><span id="_Toc139191505" class="anchor"><span id="_Toc140490557" class="anchor"><span id="_Toc140571459" class="anchor"><span id="_Toc141851621" class="anchor"><span id="_Toc141852555" class="anchor"><span id="_Toc141888099" class="anchor"><span id="_Toc141889939" class="anchor"><span id="_Toc141893608" class="anchor"><span id="_Toc142113461" class="anchor"><span id="_Toc142114489" class="anchor"><span id="_Toc439864293" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>

##### 

<span id="_Toc437515509" class="anchor"></span>

<span id="_Toc437515515" class="anchor"></span>

##### 

  ------------------------------------------------- -- --
  <span id="_Toc437515519" class="anchor"></span>
  ------------------------------------------------- -- --

##### 

-   

  ------------------------------------------------- --
                                                    
                                                    
  <span id="_Toc437515547" class="anchor"></span>   
                                                    
  <span id="_Toc437515553" class="anchor"></span>   
  ------------------------------------------------- --

### <span id="_Toc342653221" class="anchor"><span id="_Toc222907494" class="anchor"><span id="_Toc342653222" class="anchor"><span id="_Toc439858283" class="anchor"><span id="_Toc439864294" class="anchor"></span></span></span></span></span>

##### 

<span id="_Toc437515559" class="anchor"></span>

<span id="_Toc437515566" class="anchor"></span>

##### 

  ------------------------------------------------- -- --
  <span id="_Toc437515570" class="anchor"></span>
  ------------------------------------------------- -- --

##### 

-   

  ------------------------------------------------- --
                                                    
                                                    
  <span id="_Toc437515603" class="anchor"></span>   
                                                    
  <span id="_Toc437515609" class="anchor"></span>   
                                                    
  ------------------------------------------------- --

### <span id="_Toc145513321" class="anchor"><span id="_Toc145513705" class="anchor"><span id="_Toc222907495" class="anchor"><span id="_Toc342653226" class="anchor"><span id="_Toc439858284" class="anchor"><span id="_Toc127596932" class="anchor"><span id="_Toc127786553" class="anchor"><span id="_Toc127786869" class="anchor"><span id="_Toc127787185" class="anchor"><span id="_Toc127877859" class="anchor"><span id="_Toc128289929" class="anchor"><span id="_Toc128290322" class="anchor"><span id="_Toc130189927" class="anchor"><span id="_Toc130201143" class="anchor"><span id="_Toc130201459" class="anchor"><span id="_Toc130201780" class="anchor"><span id="_Toc131937040" class="anchor"><span id="_Toc133901332" class="anchor"><span id="_Toc137461206" class="anchor"><span id="_Toc139096721" class="anchor"><span id="_Toc139188644" class="anchor"><span id="_Toc139191507" class="anchor"><span id="_Toc140490559" class="anchor"><span id="_Toc140571461" class="anchor"><span id="_Toc141851623" class="anchor"><span id="_Toc141852557" class="anchor"><span id="_Toc141888101" class="anchor"><span id="_Toc141889941" class="anchor"><span id="_Toc141893610" class="anchor"><span id="_Toc142113463" class="anchor"><span id="_Toc142114491" class="anchor"><span id="_Ref142223568" class="anchor"><span id="_Toc145513318" class="anchor"><span id="_Toc145513702" class="anchor"><span id="_Toc439864295" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>

##### 

<span id="_Toc437515618" class="anchor"></span>

<span id="_Toc437515624" class="anchor"></span>

##### 

  ------------------------------------------------- -- --
  <span id="_Toc437515628" class="anchor"></span>
  ------------------------------------------------- -- --

##### 

-   

  -- --
     
     
     
  -- --

### <span id="_Toc342571006" class="anchor"><span id="_Toc342653230" class="anchor"><span id="_Toc342571007" class="anchor"><span id="_Toc342653231" class="anchor"><span id="_Toc222907496" class="anchor"><span id="_Toc342653232" class="anchor"><span id="_Toc439858285" class="anchor"><span id="_Toc439864296" class="anchor"></span></span></span></span></span></span></span></span>

##### 

<span id="_Toc437515662" class="anchor"></span>

<span id="_Toc437515665" class="anchor"></span>

<span id="_Toc437515668" class="anchor"></span>

##### 

  ------------------------------------------------- -- --
  <span id="_Toc437515672" class="anchor"></span>
  ------------------------------------------------- -- --

##### 

-   

  -- --
     
     
     
  -- --

### <span id="_Toc145513319" class="anchor"><span id="_Toc145513703" class="anchor"><span id="_Toc222907497" class="anchor"><span id="_Toc342653236" class="anchor"><span id="_Toc439858286" class="anchor"><span id="_Toc439864297" class="anchor"></span></span></span></span></span></span>

##### 

<span id="_Toc437515709" class="anchor"></span>

<span id="_Toc437515715" class="anchor"></span>

##### 

  ------------------------------------------------- -- --
  <span id="_Toc437515719" class="anchor"></span>
  ------------------------------------------------- -- --

##### 

-   -   

  ------------------------------------------------- -------------------------------------------------
                                                    
                                                    
  <span id="_Toc437515748" class="anchor"></span>   
                                                    
  <span id="_Toc437515754" class="anchor"></span>   <span id="_Toc437515755" class="anchor"></span>
  ------------------------------------------------- -------------------------------------------------

### <span id="_Toc222907498" class="anchor"><span id="_Toc342653240" class="anchor"><span id="_Toc439858287" class="anchor"><span id="_Toc439864298" class="anchor"></span></span></span></span>

##### 

<span id="_Toc437515761" class="anchor"></span>

<span id="_Toc437515767" class="anchor"></span>

##### 

  ------------------------------------------------- -- --
  <span id="_Toc437515771" class="anchor"></span>
  ------------------------------------------------- -- --

##### 

-   

  ------------------------------------------------- --
                                                    
                                                    
  <span id="_Toc437515799" class="anchor"></span>   
  ------------------------------------------------- --

<span id="_Toc437515802" class="anchor"></span>

1.  <span id="_Toc144026395" class="anchor"><span id="_Toc144026726" class="anchor"><span id="_Toc144276369" class="anchor"><span id="_Toc144276713" class="anchor"><span id="_Toc144280301" class="anchor"><span id="_Toc144280647" class="anchor"><span id="_Toc144540884" class="anchor"><span id="_Toc144554787" class="anchor"><span id="_Toc144722388" class="anchor"><span id="_Toc145503851" class="anchor"><span id="_Toc145512271" class="anchor"><span id="_Toc145513324" class="anchor"><span id="_Toc145513708" class="anchor"><span id="_Toc222907500" class="anchor"><span id="_Toc342653244" class="anchor"><span id="_Toc439864299" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Guest Debugging Support
    =======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================

    1.  <span id="_Toc127596916" class="anchor"><span id="_Toc127786537" class="anchor"><span id="_Toc127786853" class="anchor"><span id="_Toc127787169" class="anchor"><span id="_Toc127877843" class="anchor"><span id="_Toc128289913" class="anchor"><span id="_Toc128290306" class="anchor"><span id="_Toc130189911" class="anchor"><span id="_Toc130201127" class="anchor"><span id="_Toc130201443" class="anchor"><span id="_Toc130201764" class="anchor"><span id="_Toc131937024" class="anchor"><span id="_Toc133901316" class="anchor"><span id="_Toc137461190" class="anchor"><span id="_Toc139096705" class="anchor"><span id="_Toc139188628" class="anchor"><span id="_Toc139191491" class="anchor"><span id="_Toc140490543" class="anchor"><span id="_Toc140571445" class="anchor"><span id="_Toc144026396" class="anchor"><span id="_Toc144026727" class="anchor"><span id="_Toc144276370" class="anchor"><span id="_Toc144276714" class="anchor"><span id="_Toc144280302" class="anchor"><span id="_Toc144280648" class="anchor"><span id="_Toc144540885" class="anchor"><span id="_Toc144554788" class="anchor"><span id="_Toc144722389" class="anchor"><span id="_Toc145503852" class="anchor"><span id="_Toc145512272" class="anchor"><span id="_Toc145513325" class="anchor"><span id="_Toc145513709" class="anchor"><span id="_Toc222907501" class="anchor"><span id="_Toc342653245" class="anchor"><span id="_Toc439864300" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Overview
        ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

Many operating systems support inter-machine debugging that uses a
physical connection to support communication between a debugger running
on the *host* system and the component being debugged, running on the
*target* system.. The most common approach is to use a NULL modem cable
to connect a serial port on the host system to a serial port on the
target system. Those ports are then used exclusively for debugging
traffic. An alternative is to use an IEEE 1394 cable to connect the two
systems. This chapter discusses both approaches, highlighting the
differences where applicable.

When more than one guest is debugged simultaneously, each partition’s
traffic must be multiplexed across the common physical connection. The
hypervisor provides a simple set of interfaces to exchange
session-related data across the physical connection. The default port
used for the connection is the serial COM port.

The implementation is almost entirely protocol independent. From the
hypervisor’s perspective, the debugging data exchanged by the two
systems is simply a sequenced stream of opaque data. The exception is an
additional multiplex message that translates into an NT debugger
break-in message for the client. Non-NT debuggers do not need to handle
this message for debugging to continue to work.

Note that because of the volatile nature of the connection, the
hypervisor does not guarantee that any or all of the data will be
delivered. The host and target systems should be aware of this and
implement all appropriate synchronization and recovery mechanisms. Note
that the hypervisor must have guest debugging support enabled. To detect
the availability of the feature, use a hypervisor CPUID leaf. For
details see sectio<span id="d" class="anchor"></span>n<span id="c"
class="anchor"></span> 3.3.

### <span id="_Toc144026397" class="anchor"><span id="_Toc144026728" class="anchor"><span id="_Ref144028142" class="anchor"><span id="_Toc144276371" class="anchor"><span id="_Toc144276715" class="anchor"><span id="_Toc144280303" class="anchor"><span id="_Toc144280649" class="anchor"><span id="_Toc144540886" class="anchor"><span id="_Toc144554789" class="anchor"><span id="_Toc144722390" class="anchor"><span id="_Toc145503853" class="anchor"><span id="_Toc145512273" class="anchor"><span id="_Toc145513326" class="anchor"><span id="_Toc145513710" class="anchor"><span id="_Toc222907502" class="anchor"><span id="_Toc342653246" class="anchor"><span id="_Toc439864301" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Debug Sessions

Each guest that uses the debugging facility manages a single *session*
between itself and the external debugger. A partition must possess the
*Debugging* privilege to use a debug session (see section 5.2.3). This
privilege is granted at partition creation and checked when the
partition is initialized to allow the system to reserve resources for
the incoming and outgoing debugging data streams. Debugging resources
are allocated from the partition’s pool and provide buffers for incoming
and outgoing session data. At a minimum, the outgoing buffer is large
enough to accept the maximum amount of session data that can be posted
by a single hypercall. The debugging privilege also grants access to the
debugging hypercalls, HvPostDebugData, HvRetrieveDebugData and
HvResetDebugSession.

The debug session is assigned a unique *debugging channel identifier*
that identifies the session over the physical connection. The identifier
is an assigned partition property value that is 16 bits wide and must
either be zero or a non-zero value that is unique on the target system.
A debugging channel identifier of zero indicates a channel ID is not
assigned, and the debugging hypercalls return an error. For information
regarding partition properties, see section 5.2.2.

When the partition is saved, any debugging-related data that has been
posted or not yet received is not part of the partition’s save context.
When the partition is subsequently restored, the *Debugging* privilege
must be granted at partition creation to ensure that the necessary
session infrastructure is manifested by partition initialization. The
session appears in a reset state, and the guest is expected to sense the
loss of synchronization recover accordingly.

When the partition is finalized, the process implicitly resets the
debugging session and releases any related resources that were allocated
during partition initialization. Any debugging data in the incoming and
outgoing buffers is discarded.

### <span id="_Toc144026398" class="anchor"><span id="_Toc144026729" class="anchor"><span id="_Toc144276372" class="anchor"><span id="_Toc144276716" class="anchor"><span id="_Toc144280304" class="anchor"><span id="_Toc144280650" class="anchor"><span id="_Toc144540887" class="anchor"><span id="_Toc144554790" class="anchor"><span id="_Toc144722391" class="anchor"><span id="_Toc145503854" class="anchor"><span id="_Toc145512274" class="anchor"><span id="_Toc145513327" class="anchor"><span id="_Toc145513711" class="anchor"><span id="_Toc222907503" class="anchor"><span id="_Toc342653247" class="anchor"><span id="_Toc439864302" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Transmitting Data on a Session

When a guest wishes to transmit data to an external debugger, it does so
by *posting* the data to the session. The hypervisor sends the posted
data to the host system asynchronously (for serial debugging) or
synchronously (for 1394 debugging) to the host system. The hypervisor
buffers the outgoing data using the buffer space that was allocated for
the session when the partition was initialized. If sufficient free space
is not available for all of the data, the hypervisor returns an error
and does not post any data.

### <span id="_Toc144026399" class="anchor"><span id="_Toc144026730" class="anchor"><span id="_Toc144276373" class="anchor"><span id="_Toc144276717" class="anchor"><span id="_Toc144280305" class="anchor"><span id="_Toc144280651" class="anchor"><span id="_Toc144540888" class="anchor"><span id="_Toc144554791" class="anchor"><span id="_Toc144722392" class="anchor"><span id="_Toc145503855" class="anchor"><span id="_Toc145512275" class="anchor"><span id="_Toc145513328" class="anchor"><span id="_Toc145513712" class="anchor"><span id="_Toc222907504" class="anchor"><span id="_Toc342653248" class="anchor"><span id="_Toc439864303" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Retrieving Data from a Session

The hypervisor retrieves any outstanding received data for the session.
The data is buffered using space that was allocated when the partition
was initialized. If sufficient free space is not available when data
arrives on the connection, the excess bytes are discarded.

The guest should request a buffer of the maximum size permitted by the
hypercall. If the buffer has no data, the call returns an error. If the
attempt to retrieve data is successful, more data might still be
available. The caller should process the retrieved data and attempt to
retrieve more. This process should be repeated until the hypercall
returns an error indicating that all pending receive data has been
retrieved.

### <span id="_Toc144026400" class="anchor"><span id="_Toc144026731" class="anchor"><span id="_Toc144276374" class="anchor"><span id="_Toc144276718" class="anchor"><span id="_Toc144280306" class="anchor"><span id="_Toc144280652" class="anchor"><span id="_Toc144540889" class="anchor"><span id="_Toc144554792" class="anchor"><span id="_Toc144722393" class="anchor"><span id="_Toc145503856" class="anchor"><span id="_Toc145512276" class="anchor"><span id="_Toc145513329" class="anchor"><span id="_Toc145513713" class="anchor"><span id="_Toc222907505" class="anchor"><span id="_Toc342653249" class="anchor"><span id="_Toc439864304" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Purging Data from a Session

If a guest detects a loss of synchronization with its remote
counterpart, the guest can reset the session, selectively discarding all
of the pending received or posted transmitted data for the session.

### <span id="_Toc144026401" class="anchor"><span id="_Toc144026732" class="anchor"><span id="_Toc144276375" class="anchor"><span id="_Toc144276719" class="anchor"><span id="_Toc144280307" class="anchor"><span id="_Toc144280653" class="anchor"><span id="_Toc144540890" class="anchor"><span id="_Toc144554793" class="anchor"><span id="_Toc144722394" class="anchor"><span id="_Toc145503857" class="anchor"><span id="_Toc145512277" class="anchor"><span id="_Toc145513330" class="anchor"><span id="_Toc145513714" class="anchor"><span id="_Toc222907506" class="anchor"><span id="_Toc342653250" class="anchor"><span id="_Toc439864305" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Sensing Activity on the Physical Connection

The hypervisor maintains a simple, global count of the number of bytes
received over the debugging connection. The hypervisor increments this
count each time a byte is received. The counter is permitted to wrap. A
changing counter value is a good indication of activity, because it
indicates that the session is active and the connection is intact. (Note
that a changing counter value does not guarantee an active session,
because the hypervisor could misconstrue noise as received data.)

The hypervisor also maintains a local, session-specific copy of the
global counter that is updated from the global counter whenever the
guest attempts to retrieve data from the session. If a guest wishes to
test for incoming activity, it can do so by setting the appropriate
options when it calls the post or retrieve hypercalls. If the options
are set, the hypercall compares the local and global counters before
doing anything else. If the two values match, then no receive activity
has occurred on the physical connection since the local counter was last
updated, and the hypercall returns an error. Guests can use this feature
to detect inactivity and implement a time-out mechanism.

### <span id="_Toc144026402" class="anchor"><span id="_Toc144026733" class="anchor"><span id="_Toc144276376" class="anchor"><span id="_Toc144276720" class="anchor"><span id="_Toc144280308" class="anchor"><span id="_Toc144280654" class="anchor"><span id="_Toc144540891" class="anchor"><span id="_Toc144554794" class="anchor"><span id="_Toc144722395" class="anchor"><span id="_Toc145503858" class="anchor"><span id="_Toc145512278" class="anchor"><span id="_Toc145513331" class="anchor"><span id="_Toc145513715" class="anchor"><span id="_Toc222907507" class="anchor"><span id="_Toc342653251" class="anchor"><span id="_Toc439864306" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Hypercall Loops

During a debugging session, guests often enter tight loops as they
attempt to post or retrieve session data until they are successful. The
hypercalls used for this purpose allow the guest to provide a hint to
the hypervisor that it intends to behave this way. The hypervisor is
aware of the state of the debug session buffers and might elect to use
the hint under either of the following circumstances:

-   An attempt by the guest to retrieve data when the incoming data
    buffer is empty, or

-   An attempt by the guest to post data when the outgoing data buffer
    has insufficient space.

When the hypervisor encounters either circumstance, it can use the hint
and its knowledge of the connection and session state to do one of the
following:

-   Return control to the guest, allowing it to make another attempt.

-   Suspend the virtual processor for the amount of time specified by
    the caller. The suspension could be terminated early if either of
    the following are true:

-   The guest is retrieving debugging data and has received new
    incoming data.

-   The guest is posting debugging data and adequate free outgoing
    buffer space has become available.

    1.  <span id="_Toc127596922" class="anchor"><span id="_Toc127786543" class="anchor"><span id="_Toc127786859" class="anchor"><span id="_Toc127787175" class="anchor"><span id="_Toc127877849" class="anchor"><span id="_Toc128289919" class="anchor"><span id="_Toc128290312" class="anchor"><span id="_Toc130189917" class="anchor"><span id="_Toc130201133" class="anchor"><span id="_Toc130201449" class="anchor"><span id="_Toc130201770" class="anchor"><span id="_Toc131937030" class="anchor"><span id="_Toc133901322" class="anchor"><span id="_Toc137461196" class="anchor"><span id="_Toc139096711" class="anchor"><span id="_Toc139188634" class="anchor"><span id="_Toc139191497" class="anchor"><span id="_Toc140490549" class="anchor"><span id="_Toc140571451" class="anchor"><span id="_Toc144026403" class="anchor"><span id="_Toc144026734" class="anchor"><span id="_Toc144276377" class="anchor"><span id="_Toc144276721" class="anchor"><span id="_Toc144280309" class="anchor"><span id="_Toc144280655" class="anchor"><span id="_Toc144540892" class="anchor"><span id="_Toc144554795" class="anchor"><span id="_Toc144722396" class="anchor"><span id="_Toc145503859" class="anchor"><span id="_Toc145512279" class="anchor"><span id="_Toc145513332" class="anchor"><span id="_Toc145513716" class="anchor"><span id="_Toc222907508" class="anchor"><span id="_Toc342653252" class="anchor"><span id="_Toc439864307" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Debugging Data Types
        ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

The following data types support the debugging facility.

### <span id="_Toc127596923" class="anchor"><span id="_Toc127786544" class="anchor"><span id="_Toc127786860" class="anchor"><span id="_Toc127787176" class="anchor"><span id="_Toc127877850" class="anchor"><span id="_Toc128289920" class="anchor"><span id="_Toc128290313" class="anchor"><span id="_Toc130189918" class="anchor"><span id="_Toc130201134" class="anchor"><span id="_Toc130201450" class="anchor"><span id="_Toc130201771" class="anchor"><span id="_Toc131937031" class="anchor"><span id="_Toc133901323" class="anchor"><span id="_Toc137461197" class="anchor"><span id="_Toc139096712" class="anchor"><span id="_Toc139188635" class="anchor"><span id="_Toc139191498" class="anchor"><span id="_Toc140490550" class="anchor"><span id="_Toc140571452" class="anchor"><span id="_Toc144026404" class="anchor"><span id="_Toc144026735" class="anchor"><span id="_Toc144276378" class="anchor"><span id="_Toc144276722" class="anchor"><span id="_Toc144280310" class="anchor"><span id="_Toc144280656" class="anchor"><span id="_Toc144540893" class="anchor"><span id="_Toc144554796" class="anchor"><span id="_Toc144722397" class="anchor"><span id="_Toc145503860" class="anchor"><span id="_Toc145512280" class="anchor"><span id="_Toc145513333" class="anchor"><span id="_Toc145513717" class="anchor"><span id="_Toc222907509" class="anchor"><span id="_Toc342653253" class="anchor"><span id="_Toc439864308" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Debug Types

The debugging interfaces exchange simple blocks of data between a guest
and an external port. The size of the blocks is not fixed, but cannot
exceed a maximum size. Further limitation to maximum block size is
imposed by the underlying protocol that is being used. The options that
are accepted by the hypercalls and that guests use to implement
debugging are defined as follows:

// Debug channel identifier

typedef UINT16 HV\_DEBUG\_CHANNEL\_IDENTIFIER;

// Maximum size of the payload

\#define HV\_DEBUG\_MAXIMUM\_DATA\_SIZE 4088

// Debug options for all calls

typedef UINT32 HV\_DEBUG\_OPTIONS;

// Options flags for HvPostDebugData

\#define HV\_DEBUG\_POST\_LOOP 0x00000001

// Options flags for HvRetrieveDebugData

\#define HV\_DEBUG\_RETRIEVE\_LOOP 0x00000001

\#define HV\_DEBUG\_RETRIEVE\_TEST\_ACTIVITY 0x00000002

// Options flags for HvResetDebugSession

\#define HV\_DEBUG\_PURGE\_INCOMING\_DATA 0x00000001

\#define HV\_DEBUG\_PURGE\_OUTGOING\_DATA 0x00000002

<span id="_Toc342653254" class="anchor"><span id="_Toc127596927" class="anchor"><span id="_Toc127786548" class="anchor"><span id="_Toc127786864" class="anchor"><span id="_Toc127787180" class="anchor"><span id="_Toc127877854" class="anchor"><span id="_Toc128289924" class="anchor"><span id="_Toc128290317" class="anchor"><span id="_Toc130189922" class="anchor"><span id="_Toc130201138" class="anchor"><span id="_Toc130201454" class="anchor"><span id="_Toc130201775" class="anchor"><span id="_Toc131937035" class="anchor"><span id="_Toc133901327" class="anchor"><span id="_Toc137461201" class="anchor"><span id="_Toc139096716" class="anchor"><span id="_Toc139188639" class="anchor"><span id="_Toc139191502" class="anchor"><span id="_Toc140490554" class="anchor"><span id="_Toc140571456" class="anchor"><span id="_Toc144026405" class="anchor"><span id="_Toc144026736" class="anchor"><span id="_Toc144276379" class="anchor"><span id="_Toc144276723" class="anchor"><span id="_Toc144280311" class="anchor"><span id="_Toc144280657" class="anchor"><span id="_Toc144540894" class="anchor"><span id="_Toc144554797" class="anchor"><span id="_Toc144722398" class="anchor"><span id="_Toc145503861" class="anchor"><span id="_Toc145512281" class="anchor"><span id="_Toc145513334" class="anchor"><span id="_Toc145513718" class="anchor"><span id="_Toc222907510" class="anchor"><span id="_Toc342653255" class="anchor"><span id="_Toc439864309" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Debugging Interfaces
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

The following sections describe the debug facility hypercall interfaces.

### <span id="_Toc127596928" class="anchor"><span id="_Toc127786549" class="anchor"><span id="_Toc127786865" class="anchor"><span id="_Toc127787181" class="anchor"><span id="_Toc127877855" class="anchor"><span id="_Toc128289925" class="anchor"><span id="_Toc128290318" class="anchor"><span id="_Toc130189923" class="anchor"><span id="_Toc130201139" class="anchor"><span id="_Toc130201455" class="anchor"><span id="_Toc130201776" class="anchor"><span id="_Toc131937036" class="anchor"><span id="_Toc133901328" class="anchor"><span id="_Toc137461202" class="anchor"><span id="_Toc139096717" class="anchor"><span id="_Toc139188640" class="anchor"><span id="_Toc139191503" class="anchor"><span id="_Toc140490555" class="anchor"><span id="_Toc140571457" class="anchor"><span id="_Toc144026406" class="anchor"><span id="_Toc144026737" class="anchor"><span id="_Toc144276380" class="anchor"><span id="_Toc144276724" class="anchor"><span id="_Toc144280312" class="anchor"><span id="_Toc144280658" class="anchor"><span id="_Toc144540895" class="anchor"><span id="_Toc144554798" class="anchor"><span id="_Toc144722399" class="anchor"><span id="_Toc145503862" class="anchor"><span id="_Toc145512282" class="anchor"><span id="_Toc145513335" class="anchor"><span id="_Toc145513719" class="anchor"><span id="_Toc222907511" class="anchor"><span id="_Toc342653256" class="anchor"><span id="_Toc439864310" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>HvPostDebugData

The HvPostDebugData hypercall posts a block of data for transmission
over the connection.

##### Wrapper Interface

HV\_STATUS

HvPostDebugData(

\_\_in UINT32 Count,

\_\_in HV\_DEBUG\_OPTIONS Options,

\_\_in\_bcount(HV\_DEBUG\_MAXIMUM\_DATA\_SIZE, Count)

PUINT8 Data,

\_\_out PUINT32 PendingCount

);

##### Native Interface

  HvPostDebugData
  ------------------- --------------------------------------------------- -------------------
  Input Parameters
  0
  8
  Output Parameters
  0

##### Description

Users call the HvPostDebugData hypercall to post a block of data. The
block can be as large as HV\_DEBUG\_MAXIMUM\_DATA\_SIZE bytes in size,
and this size is further restricted by the underlying protocol that is
being used. If the hypervisor’s outgoing data buffer has enough space
for the entire block of data, it is posted for transmission. Otherwise,
HvPostDebugData returns an error and no data is posted. Users can call
HvPostDebugData with *Count* set to zero to determine whether any
pending data is present in the outgoing session buffer.

Input Parameters

*Count* is the number of bytes to be posted. It can range from 0 to
HV\_DEBUG\_MAXIMUM\_DATA\_SIZE. Note that the underlying protocol that
is being used further limits the maximum data size.

*Options* specifies the following hypercall options:

HV\_DEBUG\_POST\_LOOP indicates that the guest will continue to call
HvPostDebugData until it completes successfully.

*Data* is an opaque stream of bytes for the hypervisor to post for
transmission.

Output Parameters

*PendingCount* is the total number of bytes in the outgoing session
buffer that are pending transmission, including any data posted by this
call.

Restrictions

The caller’s partition must possess the *Debugging* privilege.

Return Values

  Status code                         Error condition
  ----------------------------------- -----------------------------------------------------------------------------------------------------
  HV\_STATUS\_FEATURE\_UNAVAILABLE    Guest debugging support is not present or not enabled in the hypervisor.
  HV\_STATUS\_ACCESS\_DENIED          The caller’s partition does not possess the *Debugging* privilege.
  HV\_STATUS\_OPERATION\_DENIED       The partition’s *Debug Channel Identifier* property has not been assigned a unique, non-zero value.
  HV\_STATUS\_INVALID\_PARAMETER      The *Count* parameter specifies more than HV\_DEBUG\_MAXIMUM\_DATA\_SIZE bytes of data.
                                      The area described by *Data* and *Count* crosses a page boundary.
                                      *Options* specified a flag other than HV\_DEBUG\_POST\_LOOP.
  HV\_STATUS\_INSUFFICIENT\_BUFFERS   The outgoing session buffer does not have sufficient space to accept all of *Data.*

### <span id="_Toc342653260" class="anchor"><span id="_Toc144026407" class="anchor"><span id="_Toc144026738" class="anchor"><span id="_Toc144276381" class="anchor"><span id="_Toc144276725" class="anchor"><span id="_Toc144280313" class="anchor"><span id="_Toc144280659" class="anchor"><span id="_Toc144540896" class="anchor"><span id="_Toc144554799" class="anchor"><span id="_Toc144722400" class="anchor"><span id="_Toc145503863" class="anchor"><span id="_Toc145512283" class="anchor"><span id="_Toc145513336" class="anchor"><span id="_Toc145513720" class="anchor"><span id="_Toc222907512" class="anchor"><span id="_Toc342653261" class="anchor"><span id="_Toc439864311" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>HvRetrieveDebugData

The HvRetrieveDebugData hypercall retrieves received data.

##### Wrapper Interface

HV\_STATUS

HvRetrieveDebugData(

\_\_in\_out PUINT32 Count,

\_\_in HV\_DEBUG\_OPTIONS Options,

\_\_in HV\_NONA100\_DURATION Timeout,

\_\_out PUINT32 RetrievedCount,

\_\_out PUINT32 RemainingCount,

\_\_out\_bcount(HV\_DEBUG\_MAXIMUM\_DATA\_SIZE, \*Count)

PUINT8 Data

);

##### Native Interface

  HvRetrieveDebugData
  --------------------- --------------------------------------------------- --------------------------
  Input Parameters
  0
  8
  Output Parameters
  0
  8

##### Description

HvRetrieveDebugData retrieves up to HV\_DEBUG\_MAXIMUM\_DATA\_SIZE bytes
from the session’s received data stream and returns an error if no data
is available. A caller can set *Count* to zero to simply determine
whether any received data is present in the incoming session buffer. If
data is present, HvRetrieveDebugData returns a success code but does not
return any data.

Input Parameters

*Count* specifies the maximum number of bytes to be retrieved. This
value can range from 0 to HV\_DEBUG\_MAXIMUM\_DATA\_SIZE.

*Options* specifies the hypercall options:

HV\_DEBUG\_RETRIEVE\_LOOP indicates that if there is no immediately
available data, the hypervisor should suspend the virtual processor for
the interval specified by *Timeout*.

HV\_DEBUG\_RETRIEVE\_TEST\_ACTIVITY indicates that if no receive
activity (for any session) has occurred on the physical connection since
the last HvRetrieveDebugData hypercall, the hypercall should return an
error. HvRetrieveDebugData performs this test before it does any other
processing.

*Timeout* specifies the maximum time, in 100 nanosecond units, that the
virtual processor will be suspended while waiting for data to arrive.

Output Parameters

*RetrievedCount* contains the number of bytes returned in *Data*.

*RemainingCount* contains the number of bytes in *Data* that are still
pending, after *Count* bytes have been returned.

*Data* contains RetrievedCount bytes data from the beginning of the
session’s received data stream.

Restrictions

The caller’s partition must possess the *Debugging* privilege.

Return Values

  Status code                        Error condition
  ---------------------------------- -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  HV\_STATUS\_FEATURE\_UNAVAILABLE   Guest debugging support is not present or not enabled in the hypervisor.
  HV\_STATUS\_ACCESS\_DENIED         The caller’s partition does not possess the *Debugging* privilege.
  HV\_STATUS\_OPERATION\_DENIED      The partition’s *Debug Channel Identifier* property has not been assigned a unique, non-zero value.
  HV\_STATUS\_INVALID\_PARAMETER     The *Count* parameter specifies more than HV\_DEBUG\_MAXIMUM\_DATA\_SIZE bytes of data.
                                     The area described by *Data* and *Count* crosses a page boundary.
                                     *Options* specified a flag other than HV\_DEBUG\_RETRIEVE\_LOOP or HV\_DEBUG\_RETRIEVE\_TEST\_ACTIVITY.
  HV\_STATUS\_INACTIVE               *Options* specified HV\_DEBUG\_RETRIEVE\_TEST\_ACTIVITY and the hypervisor has not recorded any receive activity on the physical connection since the guest’s last call to HvRetrieveDebugData.
  HV\_STATUS\_NO\_DATA               The incoming session buffer has no pending data.

### <span id="_Toc130721940" class="anchor"><span id="_Toc130888447" class="anchor"><span id="_Toc130978823" class="anchor"><span id="_Toc131014499" class="anchor"><span id="_Toc144026408" class="anchor"><span id="_Toc144026739" class="anchor"><span id="_Toc144276382" class="anchor"><span id="_Toc144276726" class="anchor"><span id="_Toc144280314" class="anchor"><span id="_Toc144280660" class="anchor"><span id="_Toc144540897" class="anchor"><span id="_Toc144554800" class="anchor"><span id="_Toc144722401" class="anchor"><span id="_Toc145503864" class="anchor"><span id="_Toc145512284" class="anchor"><span id="_Toc145513337" class="anchor"><span id="_Toc145513721" class="anchor"><span id="_Toc222907513" class="anchor"><span id="_Toc342653265" class="anchor"><span id="_Toc439864312" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>HvResetDebugSession

The HvResetDebugSession hypercall resets the incoming or outgoing buffer
context.

##### Wrapper Interface

HV\_STATUS

HvResetDebugSession(

HV\_DEBUG\_OPTIONS Options

);

##### Native Interface

  HvResetDebugSession \[fast\]
  ------------------------------ -------------------- -------------------
  Input Parameters
  0

Description\
The HvResetDebugSession hypercall directs the hypervisor to purge all
internal receive or transmit buffers for the session. Any pending data
is lost. Callers use this hypercall to reset the state of the
connection.

Input Parameters

*Options* specifies which session buffers should be purged. Callers can
set either or both of the following flags:

HV\_DEBUG\_PURGE\_INCOMING\_DATA purges the receive buffer.

HV\_DEBUG\_PURGE\_OUTGOING\_DATA purges the transmit buffer.

Output Parameters

None.

Restrictions

The caller’s partition must possess the *Debugging* privilege.

Return Values

  Status code                        Error condition
  ---------------------------------- -----------------------------------------------------------------------------------------------------
  HV\_STATUS\_FEATURE\_UNAVAILABLE   Guest debugging support is not present or not enabled in the hypervisor.
  HV\_STATUS\_ACCESS\_DENIED         The caller’s partition does not possess the *Debugging* privilege.
  HV\_STATUS\_OPERATION\_DENIED      The partition’s *Debug Channel Identifier* property has not been assigned a unique, non-zero value.
  HV\_STATUS\_INVALID\_PARAMETER     The *Options* parameter includes an unsupported flag or includes neither of the supported flags.
  HV\_STATUS\_NO\_DATA               No data was purged from the buffers specified by the *Options* flags.

### HvCollectLivedump

The HvCollectLivedump hypercall collects a live dump for the host
machine.

##### Wrapper Interface

HV\_STATUS

HvCollectLivedump(

HV\_INPUT\_COLLECT\_LIVE\_DUMP Flags

);

##### Native Interface

  HvResetDebugSession
  --------------------- -------------------- -------------------
  Input Parameters
  0

Description\
The HvCollectLivedump hypercall initiates a live dump of the host.

Input Parameters

*Flags* specifies which flags to include when initiating a live dump.

Output Parameters

None.

Restrictions

The caller’s partition must possess the *Debugging* privilege.

Return Values

  Status code                        Error condition
  ---------------------------------- --------------------------------------------------------------------------
  HV\_STATUS\_FEATURE\_UNAVAILABLE   Guest debugging support is not present or not enabled in the hypervisor.

1.  <span id="_Toc141529697" class="anchor"><span id="_Toc141530014" class="anchor"><span id="_Toc141851625" class="anchor"><span id="_Toc141852559" class="anchor"><span id="_Toc141888103" class="anchor"><span id="_Toc141889943" class="anchor"><span id="_Toc141893612" class="anchor"><span id="_Toc142113465" class="anchor"><span id="_Toc142114493" class="anchor"><span id="_Toc142729691" class="anchor"><span id="_Toc142730975" class="anchor"><span id="_Toc142731348" class="anchor"><span id="_Toc142998715" class="anchor"><span id="_Toc143063807" class="anchor"><span id="_Toc143509916" class="anchor"><span id="_Toc143510364" class="anchor"><span id="_Toc144026409" class="anchor"><span id="_Toc144026740" class="anchor"><span id="_Toc144276383" class="anchor"><span id="_Toc144276727" class="anchor"><span id="_Toc144280315" class="anchor"><span id="_Toc144280661" class="anchor"><span id="_Toc144540898" class="anchor"><span id="_Toc144554801" class="anchor"><span id="_Toc144722402" class="anchor"><span id="_Ref144797003" class="anchor"><span id="_Toc145503865" class="anchor"><span id="_Toc145512285" class="anchor"><span id="_Toc145513338" class="anchor"><span id="_Toc145513722" class="anchor"><span id="_Toc222907514" class="anchor"><span id="_Toc342653268" class="anchor"><span id="_Toc439864314" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Statistics
    =========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================

    1.  <span id="_Toc127596934" class="anchor"><span id="_Toc127786555" class="anchor"><span id="_Toc127786871" class="anchor"><span id="_Toc127787187" class="anchor"><span id="_Toc127877861" class="anchor"><span id="_Toc128289931" class="anchor"><span id="_Toc128290324" class="anchor"><span id="_Toc130189929" class="anchor"><span id="_Toc130201145" class="anchor"><span id="_Toc130201461" class="anchor"><span id="_Toc130201782" class="anchor"><span id="_Toc131937042" class="anchor"><span id="_Toc133901334" class="anchor"><span id="_Toc137461208" class="anchor"><span id="_Toc139096723" class="anchor"><span id="_Toc139188646" class="anchor"><span id="_Toc139191509" class="anchor"><span id="_Toc140490561" class="anchor"><span id="_Toc140571463" class="anchor"><span id="_Toc141257736" class="anchor"><span id="_Toc141258063" class="anchor"><span id="_Toc141267591" class="anchor"><span id="_Toc141522609" class="anchor"><span id="_Toc141529698" class="anchor"><span id="_Toc141530015" class="anchor"><span id="_Toc141851626" class="anchor"><span id="_Toc141852560" class="anchor"><span id="_Toc141888104" class="anchor"><span id="_Toc141889944" class="anchor"><span id="_Toc141893613" class="anchor"><span id="_Toc142113466" class="anchor"><span id="_Toc142114494" class="anchor"><span id="_Toc142729692" class="anchor"><span id="_Toc142730976" class="anchor"><span id="_Toc142731349" class="anchor"><span id="_Toc142998716" class="anchor"><span id="_Toc143063808" class="anchor"><span id="_Toc143509917" class="anchor"><span id="_Toc143510365" class="anchor"><span id="_Toc144026410" class="anchor"><span id="_Toc144026741" class="anchor"><span id="_Toc144276384" class="anchor"><span id="_Toc144276728" class="anchor"><span id="_Toc144280316" class="anchor"><span id="_Toc144280662" class="anchor"><span id="_Toc144540899" class="anchor"><span id="_Toc144554802" class="anchor"><span id="_Toc144722403" class="anchor"><span id="_Toc145503866" class="anchor"><span id="_Toc145512286" class="anchor"><span id="_Toc145513339" class="anchor"><span id="_Toc145513723" class="anchor"><span id="_Toc222907515" class="anchor"><span id="_Toc342653269" class="anchor"><span id="_Toc439864315" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Overview
        -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

The hypervisor maintains simple statistics counters for various events.
The list of events is implementation-specific and likely to differ from
one revision to the next. The following definitions help to set the
context for further reading:

A *counter* monitors a specific item of the system.

An *object* is a collection of counters that are related to the same
measurable entity.

A *counter instance* refers to a particular instantiation of an object
that a counter can monitor.

### <span id="_Toc127596935" class="anchor"><span id="_Toc127786556" class="anchor"><span id="_Toc127786872" class="anchor"><span id="_Toc127787188" class="anchor"><span id="_Toc127877862" class="anchor"><span id="_Toc128289932" class="anchor"><span id="_Toc128290325" class="anchor"><span id="_Toc130189930" class="anchor"><span id="_Toc130201146" class="anchor"><span id="_Toc130201462" class="anchor"><span id="_Toc130201783" class="anchor"><span id="_Toc131937043" class="anchor"><span id="_Toc133901335" class="anchor"><span id="_Toc137461209" class="anchor"><span id="_Toc139096724" class="anchor"><span id="_Toc139188647" class="anchor"><span id="_Toc139191510" class="anchor"><span id="_Toc140490562" class="anchor"><span id="_Toc140571464" class="anchor"><span id="_Toc141257737" class="anchor"><span id="_Toc141258064" class="anchor"><span id="_Toc141267592" class="anchor"><span id="_Toc141522610" class="anchor"><span id="_Toc141529699" class="anchor"><span id="_Toc141530016" class="anchor"><span id="_Toc141851627" class="anchor"><span id="_Toc141852561" class="anchor"><span id="_Toc141888105" class="anchor"><span id="_Toc141889945" class="anchor"><span id="_Toc141893614" class="anchor"><span id="_Toc142113467" class="anchor"><span id="_Toc142114495" class="anchor"><span id="_Toc142729693" class="anchor"><span id="_Toc142730977" class="anchor"><span id="_Toc142731350" class="anchor"><span id="_Toc142998717" class="anchor"><span id="_Toc143063809" class="anchor"><span id="_Toc143509918" class="anchor"><span id="_Toc143510366" class="anchor"><span id="_Toc144026411" class="anchor"><span id="_Toc144026742" class="anchor"><span id="_Toc144276385" class="anchor"><span id="_Toc144276729" class="anchor"><span id="_Toc144280317" class="anchor"><span id="_Toc144280663" class="anchor"><span id="_Toc144540900" class="anchor"><span id="_Toc144554803" class="anchor"><span id="_Toc144722404" class="anchor"><span id="_Toc145503867" class="anchor"><span id="_Toc145512287" class="anchor"><span id="_Toc145513340" class="anchor"><span id="_Toc145513724" class="anchor"><span id="_Toc222907516" class="anchor"><span id="_Toc342653270" class="anchor"><span id="_Toc439864316" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Global Versus Local Statistics

Two classes of statistics counters are provided: global and local.
Counters of the local class are local to a specific partition or objects
associated with a partition. Counters of the global class are associated
with the entire hypervisor or objects that are not associated with a
specific partition.

Global statistics classes include:

-   Hypervisor

-   Logical processors

-   Local statistics classes include:Partitions

-   Virtual processors

Additional objects for which counters of global and local classes are
gathered may be added in future hypervisor implementations.

### <span id="_Toc127596936" class="anchor"><span id="_Toc127786557" class="anchor"><span id="_Toc127786873" class="anchor"><span id="_Toc127787189" class="anchor"><span id="_Toc127877863" class="anchor"><span id="_Toc128289933" class="anchor"><span id="_Toc128290326" class="anchor"><span id="_Toc130189931" class="anchor"><span id="_Toc130201147" class="anchor"><span id="_Toc130201463" class="anchor"><span id="_Toc130201784" class="anchor"><span id="_Toc131937044" class="anchor"><span id="_Toc133901336" class="anchor"><span id="_Toc137461210" class="anchor"><span id="_Toc139096725" class="anchor"><span id="_Toc139188648" class="anchor"><span id="_Toc139191511" class="anchor"><span id="_Toc140490563" class="anchor"><span id="_Toc140571465" class="anchor"><span id="_Toc141257738" class="anchor"><span id="_Toc141258065" class="anchor"><span id="_Toc141267593" class="anchor"><span id="_Toc141522611" class="anchor"><span id="_Toc141529700" class="anchor"><span id="_Toc141530017" class="anchor"><span id="_Toc141851628" class="anchor"><span id="_Toc141852562" class="anchor"><span id="_Toc141888106" class="anchor"><span id="_Toc141889946" class="anchor"><span id="_Toc141893615" class="anchor"><span id="_Toc142113468" class="anchor"><span id="_Toc142114496" class="anchor"><span id="_Toc142729694" class="anchor"><span id="_Toc142730978" class="anchor"><span id="_Toc142731351" class="anchor"><span id="_Toc142998718" class="anchor"><span id="_Toc143063810" class="anchor"><span id="_Toc143509919" class="anchor"><span id="_Toc143510367" class="anchor"><span id="_Toc144026412" class="anchor"><span id="_Toc144026743" class="anchor"><span id="_Toc144276386" class="anchor"><span id="_Toc144276730" class="anchor"><span id="_Toc144280318" class="anchor"><span id="_Toc144280664" class="anchor"><span id="_Toc144540901" class="anchor"><span id="_Toc144554804" class="anchor"><span id="_Toc144722405" class="anchor"><span id="_Toc145503868" class="anchor"><span id="_Toc145512288" class="anchor"><span id="_Toc145513341" class="anchor"><span id="_Toc145513725" class="anchor"><span id="_Toc222907517" class="anchor"><span id="_Toc342653271" class="anchor"><span id="_Toc439864317" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Statistics Page Mappings

Memory for statistics counter instances is allocated automatically by
the hypervisor when certain objects are allocated. For example, when a
virtual processor is allocated, space for that virtual processor’s
associated statistics is also allocated.

One page of memory is allocated to store the counter instances for each
object and is called a *stats page*. This allows individual counter
types to be mapped into a partition’s address space for easy retrieval.
This mapping is performed using overlay pages. For a discussion of
overlay pages, see section 8.1.3.

Stats pages mapped into a partition’s GPA space are write protected.
Attempts to write to these pages will result in a \#MC fault. The
hypervisor writes to these pages by using writeback cacheability. For
correct behavior, guests are recommended to map these pages with
writeback caching as well.

The lifetime of a stats page is the same as the lifetime for its
corresponding object. If that object is deleted and its stats page is
still mapped within a partition’s GPA space, that stats page mapping is
removed. As with any overlay page, removal of a stats page mapping
reveals whatever is “beneath" the overlay page.

### <span id="_Toc141889947" class="anchor"><span id="_Toc141893616" class="anchor"><span id="_Toc142113469" class="anchor"><span id="_Toc142114497" class="anchor"><span id="_Toc142729695" class="anchor"><span id="_Toc142730979" class="anchor"><span id="_Toc142731352" class="anchor"><span id="_Toc142998719" class="anchor"><span id="_Toc143063811" class="anchor"><span id="_Toc143509920" class="anchor"><span id="_Toc143510368" class="anchor"><span id="_Toc144026413" class="anchor"><span id="_Toc144026744" class="anchor"><span id="_Toc144276387" class="anchor"><span id="_Toc144276731" class="anchor"><span id="_Toc144280319" class="anchor"><span id="_Toc144280665" class="anchor"><span id="_Toc144540902" class="anchor"><span id="_Toc144554805" class="anchor"><span id="_Toc144722406" class="anchor"><span id="_Toc145503869" class="anchor"><span id="_Toc145512289" class="anchor"><span id="_Toc145513342" class="anchor"><span id="_Toc145513726" class="anchor"><span id="_Toc222907518" class="anchor"><span id="_Toc342653272" class="anchor"><span id="_Toc439864318" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Format of Statistics Pages

Statistics pages consist of a sequence of tightly-packed *statistics*
*groups*, each prefixed by a header:

typedef UINT16 HV\_STATISTICS\_GROUP\_TYPE;

typedef union

{

UINT32 VersionMajorMinor;

struct

{

UINT32 VersionMinor;

UINT32 VersionMajor;

} Version;

} HV\_STATISTICS\_GROUP\_VERSION;

typedef UINT16 HV\_STATISTICS\_GROUP\_LENGTH;

// Actual header format

typedef struct

{

HV\_STATISTICS\_GROUP\_TYPE Type;

HV\_STATISTICS\_GROUP\_VERSION Version;

HV\_STATISTICS\_GROUP\_LENGTH Length;

} HV\_STATISTICS\_GROUP\_HEADER;

Each statistics group has an associated identifier (TYPE) and version
number present within its header. The group identifier is unique within
the statistics object. The version number is composed of a major and
minor number. The length field indicates how many bytes constitute the
group. It does not include the size of the group header and is aligned
to an 8-byte boundary. Adding the length to the base address of the
group’s data will lead to the next group header.

The last group of data within the page is followed by a header
indicating the end of the list, with both the version number and length
set to zero. Using this format allows the hypervisor to support a
variety of both architectural and implementation-specific counters. See
Appendix J: Statistics Counter Definitions for details of the various
statistics group formats.

### <span id="_Toc144540903" class="anchor"><span id="_Toc144554806" class="anchor"><span id="_Toc144722407" class="anchor"><span id="_Toc145503870" class="anchor"><span id="_Toc145512290" class="anchor"><span id="_Toc145513343" class="anchor"><span id="_Toc145513727" class="anchor"><span id="_Toc222907519" class="anchor"><span id="_Toc342653273" class="anchor"><span id="_Toc439864319" class="anchor"></span></span></span></span></span></span></span></span></span></span>Statistics Group Compatibility

As new versions of the hypervisor are released and counters are added to
the end of a group, the minor number will be incremented. This will
allow existing code to be compatible with future hypervisors. A check to
ensure that the group’s major version number matches and that the minor
version number is greater-than-or-equal to the compile-time value will
suffice.

Should the format of the group ever change, the major number should be
incremented. Note that groups containing architectural counters should
not change major version numbers from release to release. A particular
counter will always be present at its assigned location but may no
longer be maintained. In such cases the counter will always read as
zero.

// Standard header types that have zero version and length

\#define HV\_STATISTICS\_TYPE\_END\_OF\_LIST 0

\#define HV\_STATISTICS\_TYPE\_END\_OF\_PAGE 1

// Definitions for the hypervisor counters statistics page

\#define HV\_STATISTICS\_TYPE\_HCA\_ID 2

\#define HV\_STATISTICS\_TYPE\_HCA\_VERSION ((1 &lt;&lt; 16) | 0) //
V1.0

// Definitions for the logical processor counters statistics page

\#define HV\_STATISTICS\_TYPE\_LPA\_ID 2

\#define HV\_STATISTICS\_TYPE\_LPA\_VERSION ((1 &lt;&lt; 16) | 0) //
V1.0

\#define HV\_STATISTICS\_TYPE\_LPV\_ID 3

\#define HV\_STATISTICS\_TYPE\_LPV\_VERSION ((1 &lt;&lt; 16) | 0) //
V1.0

// Definitions for the partition counters statistics page

\#define HV\_STATISTICS\_TYPE\_PA\_ID 2

\#define HV\_STATISTICS\_TYPE\_PA\_VERSION ((1 &lt;&lt; 16) | 0) // V1.0

// Definitions for the virtual processor statistics page

\#define HV\_STATISTICS\_TYPE\_VPA\_ID 2

\#define HV\_STATISTICS\_TYPE\_VPA\_VERSION ((1 &lt;&lt; 16) | 0) //
V1.0

\#define HV\_STATISTICS\_TYPE\_VPV\_ID 3

\#define HV\_STATISTICS\_TYPE\_VPV\_VERSION ((1 &lt;&lt; 16) | 0) //
V1.0

1.  <span id="_Toc127596937" class="anchor"><span id="_Toc127786558" class="anchor"><span id="_Toc127786874" class="anchor"><span id="_Toc127787190" class="anchor"><span id="_Toc127877864" class="anchor"><span id="_Toc128289934" class="anchor"><span id="_Toc128290327" class="anchor"><span id="_Toc130189932" class="anchor"><span id="_Toc130201148" class="anchor"><span id="_Toc130201464" class="anchor"><span id="_Toc130201785" class="anchor"><span id="_Toc131937045" class="anchor"><span id="_Toc133901337" class="anchor"><span id="_Toc137461211" class="anchor"><span id="_Toc139096726" class="anchor"><span id="_Toc139188649" class="anchor"><span id="_Toc139191512" class="anchor"><span id="_Toc140490564" class="anchor"><span id="_Toc140571466" class="anchor"><span id="_Toc141257739" class="anchor"><span id="_Toc141258066" class="anchor"><span id="_Toc141267594" class="anchor"><span id="_Toc141522612" class="anchor"><span id="_Toc141529701" class="anchor"><span id="_Toc141530018" class="anchor"><span id="_Toc141851629" class="anchor"><span id="_Toc141852563" class="anchor"><span id="_Toc141888107" class="anchor"><span id="_Toc141889948" class="anchor"><span id="_Toc141893617" class="anchor"><span id="_Toc142113470" class="anchor"><span id="_Toc142114498" class="anchor"><span id="_Toc142729696" class="anchor"><span id="_Toc142730980" class="anchor"><span id="_Toc142731353" class="anchor"><span id="_Toc142998720" class="anchor"><span id="_Toc143063812" class="anchor"><span id="_Toc143509921" class="anchor"><span id="_Toc143510369" class="anchor"><span id="_Toc144026414" class="anchor"><span id="_Toc144026745" class="anchor"><span id="_Toc144276388" class="anchor"><span id="_Toc144276732" class="anchor"><span id="_Toc144280320" class="anchor"><span id="_Toc144280666" class="anchor"><span id="_Toc144540904" class="anchor"><span id="_Toc144554807" class="anchor"><span id="_Toc144722408" class="anchor"><span id="_Toc145503871" class="anchor"><span id="_Toc145512291" class="anchor"><span id="_Toc145513344" class="anchor"><span id="_Toc145513728" class="anchor"><span id="_Toc222907520" class="anchor"><span id="_Toc342653274" class="anchor"><span id="_Toc439864320" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Statistics Data Types
    --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

    1.  ### <span id="_Toc127596938" class="anchor"><span id="_Toc127786559" class="anchor"><span id="_Toc127786875" class="anchor"><span id="_Toc127787191" class="anchor"><span id="_Toc127877865" class="anchor"><span id="_Toc128289935" class="anchor"><span id="_Toc128290328" class="anchor"><span id="_Toc130189933" class="anchor"><span id="_Toc130201149" class="anchor"><span id="_Toc130201465" class="anchor"><span id="_Toc130201786" class="anchor"><span id="_Toc131937046" class="anchor"><span id="_Toc133901338" class="anchor"><span id="_Toc137461212" class="anchor"><span id="_Toc139096727" class="anchor"><span id="_Toc139188650" class="anchor"><span id="_Toc139191513" class="anchor"><span id="_Toc140490565" class="anchor"><span id="_Toc140571467" class="anchor"><span id="_Toc141257740" class="anchor"><span id="_Toc141258067" class="anchor"><span id="_Toc141267595" class="anchor"><span id="_Toc141522613" class="anchor"><span id="_Toc141529702" class="anchor"><span id="_Toc141530019" class="anchor"><span id="_Toc141851630" class="anchor"><span id="_Toc141852564" class="anchor"><span id="_Toc141888108" class="anchor"><span id="_Toc141889949" class="anchor"><span id="_Toc141893618" class="anchor"><span id="_Toc142113471" class="anchor"><span id="_Toc142114499" class="anchor"><span id="_Toc142729697" class="anchor"><span id="_Toc142730981" class="anchor"><span id="_Toc142731354" class="anchor"><span id="_Toc142998721" class="anchor"><span id="_Toc143063813" class="anchor"><span id="_Toc143509922" class="anchor"><span id="_Toc143510370" class="anchor"><span id="_Toc144026415" class="anchor"><span id="_Toc144026746" class="anchor"><span id="_Toc144276389" class="anchor"><span id="_Toc144276733" class="anchor"><span id="_Toc144280321" class="anchor"><span id="_Toc144280667" class="anchor"><span id="_Toc144540905" class="anchor"><span id="_Toc144554808" class="anchor"><span id="_Toc144722409" class="anchor"><span id="_Toc145503872" class="anchor"><span id="_Toc145512292" class="anchor"><span id="_Toc145513345" class="anchor"><span id="_Toc145513729" class="anchor"><span id="_Toc222907521" class="anchor"><span id="_Toc342653275" class="anchor"><span id="_Toc439864321" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Specifying Statistics Objects

When a caller wishes to access the statistics for an object, it must
specify the object type and identify the object instance with the
mapping request. The object type is specified using the following
enumeration:

typedef enum

{

// Global stats objects

HvStatsObjectHypervisor = 0x00000001,

HvStatsObjectLogicalProcessor = 0x00000002,

// Local stats objects

HvStatsObjectPartition = 0x00010001,

HvStatsObjectVp = 0x00010002

} HV\_STATS\_OBJECT\_TYPE;

The specific statistics object instance is identified using a 16-byte
data structure, defined as follows:

typedef union

{

// HvStatsObjectHypervisor

struct

{

UINT64 ReservedZ1\[2\];

} Hypervisor;

// HvStatsObjectLogicalProcessor

struct

{

HV\_LOGICAL\_PROCESSOR\_INDEX LogicalProcessorIndex;

UINT32 ReservedZ2;

UINT64 ReservedZ3;

} LogicalProcessor;

// HvStatsObjectPartition

struct

{

HV\_PARTITION\_ID PartitionId;

UINT64 ReservedZ4;

} Partition;

// HvStatsObjectVp

struct

{

HV\_PARTITION\_ID PartitionId;

HV\_VP\_INDEX VpIndex;

UINT32 ReservedZ5;

} Vp;

} HV\_STATS\_OBJECT\_IDENTITY;

The flags associated with requests for certain statistics objects are
defined as follows:

// Flags used for specifying the stats object when making

// mapping/unmapping stats page hypercalls

typedef UINT16 HV\_STATS\_OBJECT\_FLAG;

\#define HvStatsObjectSelfStats 0x0001

1.  <span id="_Toc144276393" class="anchor"><span id="_Toc144276737" class="anchor"><span id="_Toc144280325" class="anchor"><span id="_Toc144280671" class="anchor"><span id="_Toc144540909" class="anchor"><span id="_Toc144554812" class="anchor"><span id="_Toc144276396" class="anchor"><span id="_Toc144276740" class="anchor"><span id="_Toc144280328" class="anchor"><span id="_Toc144280674" class="anchor"><span id="_Toc144540912" class="anchor"><span id="_Toc144554815" class="anchor"><span id="_Toc144276402" class="anchor"><span id="_Toc144276746" class="anchor"><span id="_Toc144280334" class="anchor"><span id="_Toc144280680" class="anchor"><span id="_Toc144540918" class="anchor"><span id="_Toc144554821" class="anchor"><span id="_Toc127596940" class="anchor"><span id="_Toc127786561" class="anchor"><span id="_Toc127786877" class="anchor"><span id="_Toc127787193" class="anchor"><span id="_Toc127877867" class="anchor"><span id="_Toc128289937" class="anchor"><span id="_Toc128290330" class="anchor"><span id="_Toc130189935" class="anchor"><span id="_Toc130201151" class="anchor"><span id="_Toc130201467" class="anchor"><span id="_Toc130201788" class="anchor"><span id="_Toc131937048" class="anchor"><span id="_Toc133901340" class="anchor"><span id="_Toc137461214" class="anchor"><span id="_Toc139096729" class="anchor"><span id="_Toc139188652" class="anchor"><span id="_Toc139191515" class="anchor"><span id="_Toc140490567" class="anchor"><span id="_Toc140571469" class="anchor"><span id="_Toc141257742" class="anchor"><span id="_Toc141258069" class="anchor"><span id="_Toc141267597" class="anchor"><span id="_Toc141522615" class="anchor"><span id="_Toc141529704" class="anchor"><span id="_Toc141530021" class="anchor"><span id="_Toc141851632" class="anchor"><span id="_Toc141852566" class="anchor"><span id="_Toc141888110" class="anchor"><span id="_Toc141889951" class="anchor"><span id="_Toc141893620" class="anchor"><span id="_Toc142113473" class="anchor"><span id="_Toc142114501" class="anchor"><span id="_Toc142729699" class="anchor"><span id="_Toc142730983" class="anchor"><span id="_Toc142731356" class="anchor"><span id="_Toc142998723" class="anchor"><span id="_Toc143063815" class="anchor"><span id="_Toc143509924" class="anchor"><span id="_Toc143510372" class="anchor"><span id="_Toc144026417" class="anchor"><span id="_Toc144026748" class="anchor"><span id="_Toc144276403" class="anchor"><span id="_Toc144276747" class="anchor"><span id="_Toc144280335" class="anchor"><span id="_Toc144280681" class="anchor"><span id="_Toc144540919" class="anchor"><span id="_Toc144554822" class="anchor"><span id="_Toc144722410" class="anchor"><span id="_Toc145503873" class="anchor"><span id="_Toc145512293" class="anchor"><span id="_Toc145513346" class="anchor"><span id="_Toc145513730" class="anchor"><span id="_Toc222907522" class="anchor"><span id="_Toc342653276" class="anchor"><span id="_Toc439864322" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Statistics Interfaces
    --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

    1.  ### <span id="_Toc127596941" class="anchor"><span id="_Toc127786562" class="anchor"><span id="_Toc127786878" class="anchor"><span id="_Toc127787194" class="anchor"><span id="_Toc127877868" class="anchor"><span id="_Toc128289938" class="anchor"><span id="_Toc128290331" class="anchor"><span id="_Toc130189936" class="anchor"><span id="_Toc130201152" class="anchor"><span id="_Toc130201468" class="anchor"><span id="_Toc130201789" class="anchor"><span id="_Toc131937049" class="anchor"><span id="_Toc133901341" class="anchor"><span id="_Toc137461215" class="anchor"><span id="_Toc139096730" class="anchor"><span id="_Toc139188653" class="anchor"><span id="_Toc139191516" class="anchor"><span id="_Toc140490568" class="anchor"><span id="_Toc140571470" class="anchor"><span id="_Toc141257743" class="anchor"><span id="_Toc141258070" class="anchor"><span id="_Toc141267598" class="anchor"><span id="_Toc141522616" class="anchor"><span id="_Toc141529705" class="anchor"><span id="_Toc141530022" class="anchor"><span id="_Toc141851633" class="anchor"><span id="_Toc141852567" class="anchor"><span id="_Toc141888111" class="anchor"><span id="_Toc141889952" class="anchor"><span id="_Toc141893621" class="anchor"><span id="_Toc142113474" class="anchor"><span id="_Toc142114502" class="anchor"><span id="_Toc142729700" class="anchor"><span id="_Toc142730984" class="anchor"><span id="_Toc142731357" class="anchor"><span id="_Toc142998724" class="anchor"><span id="_Toc143063816" class="anchor"><span id="_Toc143509925" class="anchor"><span id="_Toc143510373" class="anchor"><span id="_Toc144026418" class="anchor"><span id="_Toc144026749" class="anchor"><span id="_Toc144276404" class="anchor"><span id="_Toc144276748" class="anchor"><span id="_Toc144280336" class="anchor"><span id="_Toc144280682" class="anchor"><span id="_Toc144540920" class="anchor"><span id="_Toc144554823" class="anchor"><span id="_Toc144722411" class="anchor"><span id="_Toc145503874" class="anchor"><span id="_Toc145512294" class="anchor"><span id="_Toc145513347" class="anchor"><span id="_Toc145513731" class="anchor"><span id="_Toc222907523" class="anchor"><span id="_Toc342653277" class="anchor"><span id="_Toc439864323" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>HvMapStatsPage

The HvMapStatsPage hypercall maps the specified stats page into the
caller’s GPA space.

##### Wrapper Interface

HV\_STATUS

HV\_INPUT\_MAP\_STATS\_PAGE (

\_\_in HV\_STATS\_OBJECT\_TYPE StatsType,

\_\_in HV\_STATS\_OBJECT\_IDENTITY ObjectIdentity,

\_\_in HV\_GPA\_PAGE\_NUMBER TargetGpaPage

\_\_out HV\_GPA\_PAGE\_NUMBER MatLocation

);

##### Native Interface

  HvMapStatsPage
  ------------------- --------------------------- -------------------
  Input Parameters
  0
  8
  16
  24
  Output Parameters
  0

##### Description

Stats pages for global statistics can be mapped only into the GPA space
of the root partition.

If the specified GPA page is beyond the bounds of the partition’s valid
GPA space, then the call may indicate success, but the stats page will
not be accessible. In addition, the partition must have the
*AccessStats* privilege.

Input Parameters

*StatsType* specifies the statistics object type.

*ObjectIdentity* specifies the statistics object’s identity by using a
union. The specific fields within this union differ depending on the
statistics type, as specified in the first parameter. Reserved fields
within this parameter must be set to zero.

When *StatsType* is HvStatsObjectHypervisor, *ObjectIdentity* is
formatted as follows:

  8    RsvdZ (16 bytes)
  ---- ------------------
  16   

When *StatsType* is HvStatsObjectLogicalProcessor, *ObjectIdentity* is
formatted as follows:

  8    LogicalProcessorIndex (4 bytes)   RsvdZ (4 bytes)
  ---- --------------------------------- -----------------
  16   RsvdZ (8 bytes)

When *StatsType* is HvStatsObjectPartition, *ObjectIdentity* is
formatted as follows:

  8    PartitionId (8 bytes)
  ---- ----------------------- --------------------------- -----------------
  16   RsvdZ (8 bytes)

When *StatsType* is HvStatsObjectVp, *ObjectIdentity* is formatted as
follows:

  8    PartitionId (8 bytes)
  ---- ----------------------- --------------------------- -----------------
  16   VpIndex (4 bytes)

*TargetGpaPage* specifies the location within the caller’s GPA space
where the stats page should appear.

Output Parameters

*MapLocation* the location into which the statistics were mapped.

Restrictions

The caller must possess the *AccessStats* privilege.

For global stats types, the caller must be the root partition.

For local stats types, the caller must be the parent of the partition
specified by *PartitionId*.

The partition specified by *PartitionId* must be in the “active" state.

Return Values

  ----------------------------------------------------------------------------------------------------------------------------------------------------------------
  Status code                             Error condition
  --------------------------------------- ------------------------------------------------------------------------------------------------------------------------
  HV\_STATUS\_ACCESS\_DENIED              For global stats types, the caller is not the root partition.
                                          
                                          For local stats types, the caller is not the parent of the specified partition.

                                          The caller’s partition privilege flag AccessStats is cleared.

  HV\_STATUS\_INVALID\_PARTITION\_ID      The specified partition ID is invalid (used only for partition and VP stats).

  HV\_STATUS\_INVALID\_VP\_INDEX          The specified VP index does not reference a virtual processor within the specified partition (used only for VP stats).

  HV\_STATUS\_OPERATION\_DENIED           The stats page has already been mapped within the caller’s GPA space. It must be unmapped before it is mapped again.

  HV\_STATUS\_INVALID\_PARAMETER          The specified logical processor index is invalid (used only for logical processor stats).

                                          Reserved fields within the *ObjectIdentity* parameter are not set to zero.

  HV\_STATUS\_INSUFFICIENT\_MEMORY        The number of pages in the memory pool of the caller is insufficient to perform the operation.

  HV\_STATUS\_INVALID\_PARTITION\_STATE   The specified partition is not in the “active" state.
  ----------------------------------------------------------------------------------------------------------------------------------------------------------------

### <span id="_Toc127596942" class="anchor"><span id="_Toc127786563" class="anchor"><span id="_Toc127786879" class="anchor"><span id="_Toc127787195" class="anchor"><span id="_Toc127877869" class="anchor"><span id="_Toc128289939" class="anchor"><span id="_Toc128290332" class="anchor"><span id="_Toc130189937" class="anchor"><span id="_Toc130201153" class="anchor"><span id="_Toc130201469" class="anchor"><span id="_Toc130201790" class="anchor"><span id="_Toc131937050" class="anchor"><span id="_Toc133901342" class="anchor"><span id="_Toc137461216" class="anchor"><span id="_Toc139096731" class="anchor"><span id="_Toc139188654" class="anchor"><span id="_Toc139191517" class="anchor"><span id="_Toc140490569" class="anchor"><span id="_Toc140571471" class="anchor"><span id="_Toc141257744" class="anchor"><span id="_Toc141258071" class="anchor"><span id="_Toc141267599" class="anchor"><span id="_Toc141522617" class="anchor"><span id="_Toc141529706" class="anchor"><span id="_Toc141530023" class="anchor"><span id="_Toc141851634" class="anchor"><span id="_Toc141852568" class="anchor"><span id="_Toc141888112" class="anchor"><span id="_Toc141889953" class="anchor"><span id="_Toc141893622" class="anchor"><span id="_Toc142113475" class="anchor"><span id="_Toc142114503" class="anchor"><span id="_Toc142729701" class="anchor"><span id="_Toc142730985" class="anchor"><span id="_Toc142731358" class="anchor"><span id="_Toc142998725" class="anchor"><span id="_Toc143063817" class="anchor"><span id="_Toc143509926" class="anchor"><span id="_Toc143510374" class="anchor"><span id="_Toc144026419" class="anchor"><span id="_Toc144026750" class="anchor"><span id="_Toc144276405" class="anchor"><span id="_Toc144276749" class="anchor"><span id="_Toc144280337" class="anchor"><span id="_Toc144280683" class="anchor"><span id="_Toc144540921" class="anchor"><span id="_Toc144554824" class="anchor"><span id="_Toc144722412" class="anchor"><span id="_Toc145503875" class="anchor"><span id="_Toc145512295" class="anchor"><span id="_Toc145513348" class="anchor"><span id="_Toc145513732" class="anchor"><span id="_Toc222907524" class="anchor"><span id="_Toc342653281" class="anchor"><span id="_Toc439864324" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>HvUnmapStatsPage

The HvUnmapStatsPage hypercall unmaps the specified stats page from the
caller’s GPA space.

##### Wrapper Interface

HV\_STATUS

HvUnmapStatsPage(

\_\_in HV\_STATS\_OBJECT\_TYPE StatsType,

\_\_in HV\_STATS\_OBJECT\_IDENTITY ObjectIdentity

);

##### Native Interface

  HvUnmapStatsPage
  ------------------ --------------------------- -------------------
  Input Parameters
  0
  8
  16

##### Description

Only the root partition may unmap global stats pages. Local stats pages
may only be unmapped by the partition or its parent. In addition, the
partition must have the *AccessStats* privilege.

Input Parameters

*StatsType* specifies the statistics object type.

*ObjectIdentity* specifies the statistics object’s identity by using a
union. The specific fields within this union differ depending on the
statistics type, as specified in the first parameter. Reserved fields
within this parameter must be set to zero.

When *StatsType* is HvStatsObjectHypervisor, *ObjectIdentity* is
formatted as follows:

  8    RsvdZ (16 bytes)
  ---- ------------------
  16   

When *StatsType* is HvStatsObjectLogicalProcessor, *ObjectIdentity* is
formatted as follows:

  8    LogicalProcessorIndex (4 bytes)   RsvdZ (4 bytes)
  ---- --------------------------------- -----------------
  16   RsvdZ (8 bytes)

When *StatsType* is HvStatsObjectPartition, *ObjectIdentity* is
formatted as follows:

  8    PartitionId (8 bytes)
  ---- ----------------------- --------------------------- -----------------
  16   RsvdZ (8 bytes)

When *StatsType* is HvStatsObjectVp, *ObjectIdentity* is formatted as
follows:

  8    PartitionId (8 bytes)
  ---- ----------------------- --------------------------- -----------------
  16   VpIndex (4 bytes)

Output Parameters

None.

Restrictions

-   The caller must possess the *AccessStats* privilege.

-   For global stats types, the caller must be the root partition.

-   For local stats types, the caller must be the parent of the
    partition specified by *PartitionId.* The partition specified by
    *PartitionId* must be in the “active" state.

Return Values

  ----------------------------------------------------------------------------------------------------------------------------------------------------------------
  Status code                             Error condition
  --------------------------------------- ------------------------------------------------------------------------------------------------------------------------
  HV\_STATUS\_ACCESS\_DENIED              For global stats types, the caller is not the root partition.
                                          
                                          For local stats types, the caller is not the parent of the specified partition.

                                          The caller’s partition privilege flag AccessStats is cleared.

  HV\_STATUS\_INVALID\_PARTITION\_ID      The specified partition ID is invalid (used only for partition and VP stats).

  HV\_STATUS\_INVALID\_VP\_INDEX          The specified VP index does not reference a virtual processor within the specified partition (used only for VP stats).

  HV\_STATUS\_INVALID\_PARAMETER          The specified logical processor index is invalid (used only for logical processor stats).

                                          Reserved fields within the *ObjectIdentity* parameter are not set to zero.

  HV\_STATUS\_INVALID\_PARTITION\_STATE   The specified partition is not in the “active" state.

  HV\_STATUS\_OPERATION\_DENIED           The specified page is not initialized or mapped.
  ----------------------------------------------------------------------------------------------------------------------------------------------------------------

### <span id="_Toc222907525" class="anchor"><span id="_Toc342653285" class="anchor"><span id="_Toc439864325" class="anchor"></span></span></span>Statistics Page Mapping MSRs

A guest wishing to access its own local statistics pages must use the
following model-specific registers (MSRs).

  MSR address   Register name                                    Function
  ------------- ------------------------------------------------ --------------------------------------------------------------------------
  0x400000E0    HV\_X64\_MSR\_STATS\_PARTITION\_RETAIL\_PAGE     Map the guest’s local partition-related retail statistics page
  0x400000E1    HV\_X64\_MSR\_STATS\_PARTITION\_INTERNAL\_PAGE   Map the guest’s local partition-related internal statistics page
  0x400000E2    HV\_X64\_MSR\_STATS\_VP\_RETAIL\_PAGE            Map the guest’s local virtual processor-related retail statistics page
  0x400000E3    HV\_X64\_MSR\_STATS\_VP\_INTERNAL\_PAGE          Map the guest’s local virtual processor-related internal statistics page

Each of the above MSRs has the following format:

  63:12                          11:1    0
  ------------------------------ ------- --------
  Statistics Page Base Address   RsvdP   Enable

  ----------------------------------------------------------------------------------
  Bits    Description                                                   Attributes
  ------- ------------------------------------------------------------- ------------
  63:12   Base address (in GPA space) of statistics page to be mapped   Read/write
                                                                        
          (low 12 bits assumed to be zero)                              

  11:1    RsvdP (value should be preserved)                             Read/write

  0       Statistics page enable                                        Read/write
  ----------------------------------------------------------------------------------

At virtual processor creation time and upon processor reset, the value
of each of the statistics page registers is 0x0000000000000000. Thus,
the pages are disabled by default. The guest must enable the chosen page
by setting bit 0. If the specified base address is beyond the end of the
partition’s GPA space, the statistics page will not be accessible to the
guest. When modifying the registers, guests should preserve the value of
the reserved bits (1 through 11) for future compatibility.

Restrictions

The caller must possess the *AccessStatsReg* privilege.

1.  <span id="_Toc127596943" class="anchor"><span id="_Toc127786564" class="anchor"><span id="_Toc127786880" class="anchor"><span id="_Toc127787196" class="anchor"><span id="_Toc127877870" class="anchor"><span id="_Toc128289940" class="anchor"><span id="_Toc128290333" class="anchor"><span id="_Toc130189938" class="anchor"><span id="_Toc130201154" class="anchor"><span id="_Toc130201470" class="anchor"><span id="_Toc130201791" class="anchor"><span id="_Ref130722217" class="anchor"><span id="_Toc131937051" class="anchor"><span id="_Toc133901343" class="anchor"><span id="_Toc137461217" class="anchor"><span id="_Toc139096732" class="anchor"><span id="_Toc139188655" class="anchor"><span id="_Toc139191518" class="anchor"><span id="_Toc140490570" class="anchor"><span id="_Toc140571472" class="anchor"><span id="_Toc141257745" class="anchor"><span id="_Toc141258072" class="anchor"><span id="_Toc141267600" class="anchor"><span id="_Toc141522618" class="anchor"><span id="_Toc141529707" class="anchor"><span id="_Toc141530024" class="anchor"><span id="_Toc141851635" class="anchor"><span id="_Toc141852569" class="anchor"><span id="_Toc141888113" class="anchor"><span id="_Toc141889954" class="anchor"><span id="_Toc141893623" class="anchor"><span id="_Toc142113476" class="anchor"><span id="_Toc142114504" class="anchor"><span id="_Toc142729702" class="anchor"><span id="_Toc142730986" class="anchor"><span id="_Toc142731359" class="anchor"><span id="_Toc142998726" class="anchor"><span id="_Toc143063818" class="anchor"><span id="_Toc143509927" class="anchor"><span id="_Toc143510375" class="anchor"><span id="_Toc144026420" class="anchor"><span id="_Toc144026751" class="anchor"><span id="_Toc144276406" class="anchor"><span id="_Toc144276750" class="anchor"><span id="_Toc144280338" class="anchor"><span id="_Toc144280684" class="anchor"><span id="_Toc144540922" class="anchor"><span id="_Toc144554825" class="anchor"><span id="_Toc144722413" class="anchor"><span id="_Toc145503876" class="anchor"><span id="_Toc145512296" class="anchor"><span id="_Toc145513349" class="anchor"><span id="_Toc145513733" class="anchor"><span id="_Toc222907526" class="anchor"><span id="_Toc342653286" class="anchor"><span id="_Toc439864326" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Booting
    ===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================

    1.  <span id="_Toc127596944" class="anchor"><span id="_Toc127786565" class="anchor"><span id="_Toc127786881" class="anchor"><span id="_Toc127787197" class="anchor"><span id="_Toc127877871" class="anchor"><span id="_Toc128289941" class="anchor"><span id="_Toc128290334" class="anchor"><span id="_Toc130189939" class="anchor"><span id="_Toc130201155" class="anchor"><span id="_Toc130201471" class="anchor"><span id="_Toc130201792" class="anchor"><span id="_Toc131937052" class="anchor"><span id="_Toc133901344" class="anchor"><span id="_Toc137461218" class="anchor"><span id="_Toc139096733" class="anchor"><span id="_Toc139188656" class="anchor"><span id="_Toc139191519" class="anchor"><span id="_Toc140490571" class="anchor"><span id="_Toc140571473" class="anchor"><span id="_Toc141257746" class="anchor"><span id="_Toc141258073" class="anchor"><span id="_Toc141267601" class="anchor"><span id="_Toc141522619" class="anchor"><span id="_Toc141529708" class="anchor"><span id="_Toc141530025" class="anchor"><span id="_Toc141851636" class="anchor"><span id="_Toc141852570" class="anchor"><span id="_Toc141888114" class="anchor"><span id="_Toc141889955" class="anchor"><span id="_Toc141893624" class="anchor"><span id="_Toc142113477" class="anchor"><span id="_Toc142114505" class="anchor"><span id="_Toc142729703" class="anchor"><span id="_Toc142730987" class="anchor"><span id="_Toc142731360" class="anchor"><span id="_Toc142998727" class="anchor"><span id="_Toc143063819" class="anchor"><span id="_Toc143509928" class="anchor"><span id="_Toc143510376" class="anchor"><span id="_Toc144026421" class="anchor"><span id="_Toc144026752" class="anchor"><span id="_Toc144276407" class="anchor"><span id="_Toc144276751" class="anchor"><span id="_Toc144280339" class="anchor"><span id="_Toc144280685" class="anchor"><span id="_Toc144540923" class="anchor"><span id="_Toc144554826" class="anchor"><span id="_Toc144722414" class="anchor"><span id="_Toc145503877" class="anchor"><span id="_Toc145512297" class="anchor"><span id="_Toc145513350" class="anchor"><span id="_Toc145513734" class="anchor"><span id="_Toc222907527" class="anchor"><span id="_Toc342653287" class="anchor"><span id="_Toc439864327" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Overview
        -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

The mechanism by which the hypervisor is loaded and launched is not
architecturally defined. Typically, it will involve a *boot agent*
running within ROM-based or flash-based firmware, an on-disk boot
loader, or a device driver. This agent is responsible for loading the
hypervisor code image, laying it out in memory, gathering various
boot-time parameters, and invoking the hypervisor’s entry point in the
environment specified by the hypervisor image. Some boot agent
implementations may leverage specialized security hardware to perform a
*measured* or *verified launch*.

<span id="_Toc127596945" class="anchor"><span id="_Toc127786566" class="anchor"><span id="_Toc127786882" class="anchor"><span id="_Toc127787198" class="anchor"><span id="_Toc127877872" class="anchor"><span id="_Toc128289942" class="anchor"><span id="_Toc128290335" class="anchor"><span id="_Toc130189940" class="anchor"><span id="_Toc130201156" class="anchor"><span id="_Toc130201472" class="anchor"><span id="_Toc130201793" class="anchor"><span id="_Toc131937053" class="anchor"><span id="_Toc133901345" class="anchor"><span id="_Toc137461219" class="anchor"><span id="_Toc139096734" class="anchor"><span id="_Toc139188657" class="anchor"><span id="_Toc139191520" class="anchor"><span id="_Toc140490572" class="anchor"><span id="_Toc140571474" class="anchor"><span id="_Toc141257747" class="anchor"><span id="_Toc141258074" class="anchor"><span id="_Toc141267602" class="anchor"><span id="_Toc141522620" class="anchor"><span id="_Toc141529709" class="anchor"><span id="_Toc141530026" class="anchor"><span id="_Toc141851637" class="anchor"><span id="_Toc141852571" class="anchor"><span id="_Toc141888115" class="anchor"><span id="_Toc141889956" class="anchor"><span id="_Toc141893625" class="anchor"><span id="_Toc142113478" class="anchor"><span id="_Toc142114506" class="anchor"><span id="_Toc142729704" class="anchor"><span id="_Toc142730988" class="anchor"><span id="_Toc142731361" class="anchor"><span id="_Toc142998728" class="anchor"><span id="_Toc143063820" class="anchor"><span id="_Toc143509929" class="anchor"><span id="_Toc143510377" class="anchor"><span id="_Toc144026422" class="anchor"><span id="_Toc144026753" class="anchor"><span id="_Toc144276408" class="anchor"><span id="_Toc144276752" class="anchor"><span id="_Toc144280340" class="anchor"><span id="_Toc144280686" class="anchor"><span id="_Toc144540924" class="anchor"><span id="_Toc144554827" class="anchor"><span id="_Toc144722415" class="anchor"><span id="_Toc145503878" class="anchor"><span id="_Toc145512298" class="anchor"><span id="_Toc145513351" class="anchor"><span id="_Toc145513735" class="anchor"><span id="_Toc222907528" class="anchor"><span id="_Toc342653288" class="anchor"><span id="_Toc439864328" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Pre-boot Requirements
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

The hypervisor or its boot agent must validate that the following
requirements are true before or during a successful hypervisor launch:

-   All physical processors support the minimum feature set required by
    the hypervisor.

-   All physical processors have the same number of cores and
    hyperthreads per core.

-   The physical processors support virtualization extensions (for
    example, Intels® VT or AMD–V™).

-   The physical processors are running in monitor mode; that is, the
    hypervisor is not attempting to be launched on top of an existing
    hypervisor or VMM.

For a detailed list of the hypervisor pre-boot requirements, see
Appendix E: Boot-time CPUID Feature Requirements.

<span id="_Toc127596946" class="anchor"><span id="_Toc127786567" class="anchor"><span id="_Toc127786883" class="anchor"><span id="_Toc127787199" class="anchor"><span id="_Toc127877873" class="anchor"><span id="_Toc128289943" class="anchor"><span id="_Toc128290336" class="anchor"><span id="_Toc130189941" class="anchor"><span id="_Toc130201157" class="anchor"><span id="_Toc130201473" class="anchor"><span id="_Toc130201794" class="anchor"><span id="_Toc131937054" class="anchor"><span id="_Toc133901346" class="anchor"><span id="_Toc137461220" class="anchor"><span id="_Toc139096735" class="anchor"><span id="_Toc139188658" class="anchor"><span id="_Toc139191521" class="anchor"><span id="_Toc140490573" class="anchor"><span id="_Toc140571475" class="anchor"><span id="_Toc141257748" class="anchor"><span id="_Toc141258075" class="anchor"><span id="_Toc141267603" class="anchor"><span id="_Toc141522621" class="anchor"><span id="_Toc141529710" class="anchor"><span id="_Toc141530027" class="anchor"><span id="_Toc141851638" class="anchor"><span id="_Toc141852572" class="anchor"><span id="_Toc141888116" class="anchor"><span id="_Toc141889957" class="anchor"><span id="_Toc141893626" class="anchor"><span id="_Toc142113479" class="anchor"><span id="_Toc142114507" class="anchor"><span id="_Toc142729705" class="anchor"><span id="_Toc142730989" class="anchor"><span id="_Toc142731362" class="anchor"><span id="_Toc142998729" class="anchor"><span id="_Toc143063821" class="anchor"><span id="_Toc143509930" class="anchor"><span id="_Toc143510378" class="anchor"><span id="_Toc144026423" class="anchor"><span id="_Toc144026754" class="anchor"><span id="_Toc144276409" class="anchor"><span id="_Toc144276753" class="anchor"><span id="_Toc144280341" class="anchor"><span id="_Toc144280687" class="anchor"><span id="_Toc144540925" class="anchor"><span id="_Toc144554828" class="anchor"><span id="_Toc144722416" class="anchor"><span id="_Toc145503879" class="anchor"><span id="_Toc145512299" class="anchor"><span id="_Toc145513352" class="anchor"><span id="_Toc145513736" class="anchor"><span id="_Toc222907529" class="anchor"><span id="_Toc342653289" class="anchor"><span id="_Toc439864329" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Post-boot Conditions
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

Immediately after a successful hypervisor launch, control is returned to
the boot agent or another component of guest code designated by the boot
agent. In any case, this code will be running in a newly-created
partition referred to as the *root partition.* At this time, the
following conditions are guaranteed to exist:

-   The hypervisor knows about all present and potential physical nodes.
    Each of these nodes has been assigned a unique index.

-   The hypervisor knows about the memory access ratios between
    physical nodes.

-   An SPA range has been created for every populated RAM range in
    the machine.

-   All RAM SPA pages are mapped into the root partition’s GPA space
    with an identity map. All pages that are in use by the hypervisor
    are mapped with no access rights. All other pages are mapped as
    readable, writable, and executable.

-   The hypervisor knows about all existing and potential logical
    processors in the system. Each has been given a unique logical
    processor index. (Potential here refers to logical processors that
    can be hot-plugged at some point in the future.)

-   A single partition exists (the root partition). It is in the
    active state.

-   The root partition’s memory pool may or may not be populated with
    some memory. Code within the root partition can use the hypercall
    HvGetMemoryBalance to determine how many pages are in the pool.

-   One virtual processor is created in the root partition for each
    existing and potential logical processor in the system.

-   None of the root partition’s virtual processors are suspended.

-   All virtual processors corresponding to potential logical processors
    are assumed to be in the “offline" power state. All other virtual
    processors are assumed to be in the “C0" power state.

-   After a successful hypervisor boot, the root partition’s virtual
    processors are left in the same initialization state as their
    corresponding logical processors before the boot. For example, if a
    processor was already initialized and executing code, it will
    continue to execute code after hypervisor boot. If a processor was
    in the “wait for SIPI" state, it will effectively remain in this
    state after hypervisor boot.

-   The initial register state of a root partition’s virtual processor
    is not architecturally specified. Typically, it will be derived from
    the register state of the boot agent before the hypervisor
    was launched.

-   The root partition runs with default scheduling policy parameters
    (no reserve, an infinite cap, and a weight of 100).

-   The hypercall MSRs are visible to the root partition, but the
    hypercall interface has not yet been established within the
    root partition.

-   The SynIC is not yet enabled within the root partition. No synthetic
    timers are enabled.

-   The local APIC is enabled and located in the root partition’s GPA
    space according to the IA32\_APIC\_BASE MSR of the first logical
    processor (the boot processor).

-   If available (see section 3.4), the APIC MSRs are visible within the
    root partition.

    1.  <span id="_Toc127596947" class="anchor"><span id="_Toc127786568" class="anchor"><span id="_Toc127786884" class="anchor"><span id="_Toc127787200" class="anchor"><span id="_Toc127877874" class="anchor"><span id="_Toc128289944" class="anchor"><span id="_Toc128290337" class="anchor"><span id="_Toc130189942" class="anchor"><span id="_Toc130201158" class="anchor"><span id="_Toc130201474" class="anchor"><span id="_Toc130201795" class="anchor"><span id="_Toc131937055" class="anchor"><span id="_Toc133901347" class="anchor"><span id="_Toc137461221" class="anchor"><span id="_Toc139096736" class="anchor"><span id="_Toc139188659" class="anchor"><span id="_Toc139191522" class="anchor"><span id="_Toc140490574" class="anchor"><span id="_Toc140571476" class="anchor"><span id="_Toc141257749" class="anchor"><span id="_Toc141258076" class="anchor"><span id="_Toc141267604" class="anchor"><span id="_Toc141522622" class="anchor"><span id="_Toc141529711" class="anchor"><span id="_Toc141530028" class="anchor"><span id="_Toc141851639" class="anchor"><span id="_Toc141852573" class="anchor"><span id="_Toc141888117" class="anchor"><span id="_Toc141889958" class="anchor"><span id="_Toc141893627" class="anchor"><span id="_Toc142113480" class="anchor"><span id="_Toc142114508" class="anchor"><span id="_Toc142729706" class="anchor"><span id="_Toc142730990" class="anchor"><span id="_Toc142731363" class="anchor"><span id="_Toc142998730" class="anchor"><span id="_Toc143063822" class="anchor"><span id="_Toc143509931" class="anchor"><span id="_Toc143510379" class="anchor"><span id="_Toc144026424" class="anchor"><span id="_Toc144026755" class="anchor"><span id="_Toc144276410" class="anchor"><span id="_Toc144276754" class="anchor"><span id="_Toc144280342" class="anchor"><span id="_Toc144280688" class="anchor"><span id="_Toc144540926" class="anchor"><span id="_Toc144554829" class="anchor"><span id="_Toc144722417" class="anchor"><span id="_Toc145503880" class="anchor"><span id="_Toc145512300" class="anchor"><span id="_Toc145513353" class="anchor"><span id="_Toc145513737" class="anchor"><span id="_Ref145840572" class="anchor"><span id="_Ref145840614" class="anchor"><span id="_Toc222907530" class="anchor"><span id="_Toc342653290" class="anchor"><span id="_Toc439864330" class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Root Partition
        -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

The root partition is special in a number of ways. It is “born" with
certain properties, capabilities, and privileges that non-root
partitions do not possess. These include the following:

The root partition has no parent partition. Any operations that can be
performed only by a parent partition on its children cannot be performed
on the root. This includes the following operations:

-   Changes to partition state (HvInitializePartition,
    HvFinalizePartition and HvDeletePartition)

-   Modification of partition properties (HvGetPartitionProperty
    and HvSetPartitionProperty)

-   Changes to GPA mappings (HvMapGpaPages may only change access rights
    to an existing mapping; HvUnmapGpaPages is not allowed)

-   Access to VA or GPA space (HvTranslateVirtualAddress, HvReadGpa,
    or HvWriteGpa)

-   Installation of intercepts (HvInstallIntercept)

-   Virtual processor creation and deletion (HvCreateVp and HvDeleteVp)

-   Access to virtual processor register state (HvGetVpRegisters
    and HvSetVpRegisters)

-   Virtualization of legacy interrupts (HvAssertVirtualInterrupt
    and HvClearVirtualInterrupt)

1.  <span id="_Toc342653291" class="anchor"><span id="_Toc439858320" class="anchor"><span id="_Toc222907531" class="anchor"><span id="_Toc439864331" class="anchor"></span></span></span></span>
    ============================================================================================================================================================================================

    1.  <span id="_Toc342653292" class="anchor"><span id="_Toc439858321" class="anchor"><span id="_Toc439864332" class="anchor"></span></span></span>
        ---------------------------------------------------------------------------------------------------------------------------------------------

        1.  ### <span id="_Toc342653293" class="anchor"><span id="_Toc439858322" class="anchor"><span id="_Toc439864333" class="anchor"></span></span></span>

        2.  ### <span id="_Toc342571045" class="anchor"><span id="_Toc439858323" class="anchor"><span id="_Toc342653294" class="anchor"><span id="_Toc439864334" class="anchor"></span></span></span></span>

        3.  ### <span id="_Toc439858324" class="anchor"><span id="_Toc439864335" class="anchor"></span></span>

        4.  ### <span id="_Toc342653295" class="anchor"><span id="_Toc439858325" class="anchor"><span id="_Toc439864336" class="anchor"></span></span></span>

        5.  ### <span id="_Toc342653296" class="anchor"><span id="_Toc439858326" class="anchor"><span id="_Toc439864337" class="anchor"></span></span></span>

        6.  ### <span id="_Toc439858327" class="anchor"><span id="_Toc439864338" class="anchor"></span></span>

        7.  ### <span id="_Toc439858328" class="anchor"><span id="_Toc439864339" class="anchor"></span></span>

        8.  ### <span id="_Toc439858329" class="anchor"><span id="_Toc439864340" class="anchor"></span></span>

        9.  ### <span id="_Toc439858330" class="anchor"><span id="_Toc439864341" class="anchor"></span></span>

        10. ### <span id="_Toc342653297" class="anchor"><span id="_Toc342653298" class="anchor"><span id="_Toc439858331" class="anchor"><span id="_Toc439864342" class="anchor"></span></span></span></span>

    2.  <span id="_Toc342653299" class="anchor"><span id="_Toc342653300" class="anchor"><span id="_Toc342653301" class="anchor"><span id="_Toc439858332" class="anchor"><span id="_Toc439864343" class="anchor"></span></span></span></span></span>
        -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

        1.  ### <span id="_Toc342653302" class="anchor"><span id="_Toc439858333" class="anchor"><span id="_Toc439864344" class="anchor"></span></span></span>

##### 

##### 

  -- -- --
  -- -- --

##### 

  -- --
     
     
     
     
     
     
     
     
     
  -- --

### <span id="_Toc342571052" class="anchor"><span id="_Toc342653306" class="anchor"><span id="_Toc342653307" class="anchor"><span id="_Toc439858334" class="anchor"><span id="_Toc439864345" class="anchor"></span></span></span></span></span>

##### 

##### 

  -- -- --
  -- -- --

##### 

-   

  -- --
     
     
  -- --

<span id="_Toc342653311" class="anchor"><span id="_Ref182321688" class="anchor"><span id="_Toc221334068" class="anchor"><span id="_Toc222907537" class="anchor"><span id="_Toc342653314" class="anchor"><span id="_Toc439864346" class="anchor"></span></span></span></span></span></span>Appendix A: Interface Guidelines
==========================================================================================================================================================================================================================================================================================================================

<span id="_Toc127596948" class="anchor"><span id="_Toc128290338"
class="anchor"><span id="_Toc130201475" class="anchor"><span
id="_Toc131937056" class="anchor"><span id="_Toc133901348"
class="anchor"><span id="_Toc137461222" class="anchor"><span
id="_Toc139096737" class="anchor"><span id="_Toc139188660"
class="anchor"><span id="_Toc139191523" class="anchor"><span
id="_Toc140571477" class="anchor"><span id="_Toc141257751"
class="anchor"><span id="_Toc141267605" class="anchor"><span
id="_Toc141522623" class="anchor"><span id="_Toc141530029"
class="anchor"><span id="_Toc141852574" class="anchor"><span
id="_Toc141888118" class="anchor"><span id="_Toc141889959"
class="anchor"><span id="_Toc141893628" class="anchor"><span
id="_Toc142113481" class="anchor"><span id="_Toc142114509"
class="anchor"><span id="_Toc142729707" class="anchor"><span
id="_Toc142730991" class="anchor"><span id="_Toc142731364"
class="anchor"><span id="_Toc142998731" class="anchor"><span
id="_Toc143063823" class="anchor"><span id="_Toc143509932"
class="anchor"><span id="_Toc143510380" class="anchor"><span
id="_Toc144026425" class="anchor"><span id="_Toc144026756"
class="anchor"><span id="_Toc144276411" class="anchor"><span
id="_Toc144276755" class="anchor"><span id="_Toc144280343"
class="anchor"><span id="_Toc144280689" class="anchor"><span
id="_Toc144540927" class="anchor"><span id="_Toc144554830"
class="anchor"><span id="_Toc144722418" class="anchor"><span
id="_Toc145503881" class="anchor"><span id="_Toc145512301"
class="anchor"><span id="_Toc145513354" class="anchor"><span
id="_Toc145513738" class="anchor"><span id="_Toc221334063"
class="anchor"><span id="_Toc222907532"
class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>In
the interest of providing a consistent interface for the hypervisor, the
following guidelines should be honored for all interfaces:

-   Names of calls, types, structures, and constants should be clearly
    marked as being associated with the hypervisor. In general, this is
    done by prepending “Hv" or “HV".

-   Names of calls, types, structures, and constants should be clear and
    not overly generic (for example, “HvSetFlag" is probably
    too generic).

-   All hypervisor types (including enumerations) must have
    explicitly-defined sizes and values.

-   Names of types and constants that are platform-specific should
    include such an indication (for example, by prepending
    with “HV\_X64").

-   In general, abbreviations should be avoided. However, if
    abbreviations are used, they should be used consistently throughout
    the interface. The following is a list of approved abbreviations:

-   CPU (central processing unit)

-   ID (identifier)

-   INFO (information)

-   FP (floating point)

-   GPA (guest physical address)

-   HV (hypervisor)

-   MAX (maximum)

-   MIN (minimum)

-   MSR (model-specific register)

-   RAM (random access memory)

-   SINT (synthetic interrupt source)

-   SPA (system physical address)

-   STATS (statistics)

-   SYNIC (synthetic interrupt controller)

-   VP (virtual processor)

-   In most cases, partition IDs and VP indices should not be implicit;
    that is, the interface should allow the caller to specify these
    values rather than assuming the caller wants to operate on the
    current partition or VP. There are several specific cases where this
    guideline is ignored.

-   No hypercalls should include a GPA address input parameter that
    points to additional input or output parameters. In other words, all
    parameters should be passed by value, not by reference.

-   In most cases, page numbers are preferable to addresses. This is
    especially true when the interface in question operates on memory
    with page-level granularity.

-   The verb “Set" should be used only for calls that set a
    specific value. Generally, such calls should have an accompanying
    “Get" call.

-   The name of rep hypercalls should indicate that they operate on
    multiple parameters (for example, HvSetVpRegisters instead
    of HvSetVpRegister).

-   Rep hypercalls should be used only in cases where there is a clear
    performance need. In other cases, simple hypercalls are preferred.

<span id="_Toc110172899" class="anchor"><span id="_Toc111176474" class="anchor"><span id="_Toc118467520" class="anchor"><span id="_Toc141257752" class="anchor"><span id="_Toc221334064" class="anchor"><span id="_Toc222907533" class="anchor"><span id="_Toc342653312" class="anchor"><span id="_Toc439864347" class="anchor"></span></span></span></span></span></span></span></span>Appendix B: Hypercall Code Reference
============================================================================================================================================================================================================================================================================================================================================================================================================================

<span id="_Toc127596949" class="anchor"><span id="_Toc128290339"
class="anchor"><span id="_Toc130201476" class="anchor"><span
id="_Toc131937057" class="anchor"><span id="_Toc133901349"
class="anchor"><span id="_Toc137461223" class="anchor"><span
id="_Toc139096738" class="anchor"><span id="_Toc139188661"
class="anchor"><span id="_Toc139191524" class="anchor"><span
id="_Toc140571478" class="anchor"><span id="_Toc141257753"
class="anchor"><span id="_Toc141267606" class="anchor"><span
id="_Toc141522624" class="anchor"><span id="_Toc141530030"
class="anchor"><span id="_Toc141852575" class="anchor"><span
id="_Toc141888119" class="anchor"><span id="_Toc141889960"
class="anchor"><span id="_Toc141893629" class="anchor"><span
id="_Toc142113482" class="anchor"><span id="_Toc142114510"
class="anchor"><span id="_Toc142729708" class="anchor"><span
id="_Toc142730992" class="anchor"><span id="_Toc142731365"
class="anchor"><span id="_Toc142998732" class="anchor"><span
id="_Toc143063824" class="anchor"><span id="_Toc143509933"
class="anchor"><span id="_Toc143510381" class="anchor"><span
id="_Toc144026426" class="anchor"><span id="_Toc144026757"
class="anchor"><span id="_Toc144276412" class="anchor"><span
id="_Toc144276756" class="anchor"><span id="_Toc144280344"
class="anchor"><span id="_Toc144280690" class="anchor"><span
id="_Toc144540928" class="anchor"><span id="_Toc144554831"
class="anchor"><span id="_Toc144722419" class="anchor"><span
id="_Toc145503882" class="anchor"><span id="_Toc145512302"
class="anchor"><span id="_Toc145513355" class="anchor"><span
id="_Toc145513739" class="anchor"><span id="_Toc222907534"
class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>The
following is a table of all hypercalls by call code.

  ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  Call Code            Rep Call   Fast   Hypercall                            Caller                                                      Partition Privilege Required (if any)
                                                                                                                                          
                                  Call                                                                                                    
  -------------------- ---------- ------ ------------------------------------ ----------------------------------------------------------- -----------------------------------------
  0x0001                                 HvSwitchVirtualAddressSpace          Any                                                         UseHypercallForAddressSpaceSwitch

  0x0002                                 HvFlushVirtualAddressSpace           Any                                                         UseHypercallFor\[Local\]\[Remote\]Flush

  0x0003                                 HvFlushVirtualAddressList            Any                                                         UseHypercallFor\[Local\]\[Remote\]Flush

  0x0004                                 HvGetLogicalProcessorRunTime         Any                                                         CpuManagement

  0x0005\                                Reserved for future use              --                                                          
  thru\                                                                                                                                   
  0x0007                                                                                                                                  

  0x0008                                 HvNotifyLongSpinWait                 Any                                                         UseHypercallForLongSpinWait

  0x00090                                HvCallParkedVirtualProcessors        Any                                                         CpuManagement

  0x000b                                 HvCallSendSyntheticClusterIpi                                                                    

  0x000c                                 Reserved                                                                                         

  0x000d                                 Reserved                                                                                         

  0x000e                                 Reserved                                                                                         

  0x000f                                 Reserved                                                                                         

  0x0010                                 Reserved                                                                                         

  0x0011                                 Reserved                                                                                         

  0x0012                                 Reserved                                                                                         

  0x0013                                 Reserved                                                                                         

  0x0014                                 Reserved                                                                                         

  0x0015                                 Reserved                                                                                         

  0x0016                                 Reserved for future use              --                                                          
                                                                                                                                          
  thru                                                                                                                                    
                                                                                                                                          
  0x003F                                                                                                                                  

  0x0040                                 HvCreatePartition                    Any                                                         CreatePartitions

  0x0041                                 HvInitializePartition                Parent                                                      

  0x0042                                 HvFinalizePartition                  Parent                                                      

  0x0043                                 HvDeletePartition                    Parent                                                      

  0x0044                                 HvGetPartitionProperty               Parent / Root                                               

  0x0045                                 HvSetPartitionProperty               Parent / Root                                               

  0x0046                                 HvGetPartitionId                     Any                                                         AccessPartitionId

  0x0047                                 HvGetNextChildPartition              Parent                                                      

  0x0048                                 HvDepositMemory                      Parent / Root                                               AccessMemoryPool

  0x0049                                 HvWithdrawMemory                     Parent / Root                                               AccessMemoryPool

  0x004A                                 HvGetMemoryBalance                   Parent / Root                                               AccessMemoryPool

  0x004B                                 HvMapGpaPages                        Parent / Root                                               

  0x004C                                 HvUnmapGpaPages                      Parent                                                      

  0x004D                                 HvInstallIntercept                   Parent                                                      

  0x004E                                 HvCreateVp                           Parent                                                      

  0x004F                                 HvDeleteVp                           Parent                                                      

  0x0050                                 HvGetVpRegisters                     Parent / Root                                               

  0x0051                                 HvSetVpRegisters                     Parent                                                      

  0x0052                                 HvTranslateVirtualAddress            Parent                                                      

  0x0053                                 HvReadGpa                            Parent                                                      

  0x0054                                 HvWriteGpa                           Parent                                                      

  0x0055                                 HvAssertVirtualInterrupt             Parent                                                      

  0x0056                                 HvClearVirtualInterrupt              Parent                                                      

  0x0057                                 HvCreatePort                         Parent / Root                                               CreatePort

  0x0058                                 HvDeletePort                         Parent / Root                                               

  0x0059                                 HvConnectPort                        Parent / Root                                               ConnectPort

  0x005A                                 HvGetPortProperty                    Parent / Root                                               

  0x005B                                 HvDisconnectPort                     Parent / Root                                               

  0x005C                                 HvPostMessage                        Any                                                         PostMessages

  0x005D                                 HvSignalEvent                        Any                                                         SignalEvents

  0x005E                                 HvSavePartitionState                 Parent                                                      

  0x005F                                 HvRestorePartitionState              Parent                                                      CreatePartitions

  0x0060                                 HvInitializeEventLogBufferGroup      Root                                                        

  0x0061                                 HvFinalizeEventLogBufferGroup        Root                                                        

  0x0062                                 HvCreateEventLogBuffer               Root                                                        

  0x0063                                 HvDeleteEventLogBuffer               Root                                                        

  0x0064                                 HvMapEventLogBuffer                  Root                                                        

  0x0065                                 HvUnmapEventLogBuffer                Root                                                        

  0x0066                                 HvSetEventLogGroupSources            Root                                                        

  0x0067                                 HvReleaseEventLogBuffer              Root                                                        

  0x0068                                 HvFlushEventLogBuffer                Root                                                        

  0x0069                                 HvPostDebugData                      Any                                                         Debugging

  0x006A                                 HvRetrieveDebugData                  Any                                                         Debugging

  0x006B                                 HvResetDebugSession                  Any                                                         Debugging

  0x006C                                 HvMapStatsPage                       Parent<span id="_Ref191729132" class="anchor"></span>[^4]   AccessStats

  0x006D                                 HvUnmapStatsPage                     Parent4                                                     AccessStats

  0x006E                                 HvCallMapSparseGpaPages              Parent / Root                                               

  0x006F                                 HvCallSetSystemProperty              Root                                                        ConfigureProfiler

  0x0070                                 HvCallSetPortProperty                Parent / Root                                               CreatePort

  0x0071 thru 0x0075                     Reserved                                                                                         

  0x0076                                 HvCallAddLogicalProcessor            Root                                                        CpuManagement

  0x0077                                 HvCallRemoveLogicalProcessor         Root                                                        CpuManagement

  0x0078                                 HvCallQueryNumaDistance              Root                                                        CpuManagement

  0x0079                                 HvCallSetLogicalProcessorProperty    Root                                                        CpuManagement

  0x007A                                 HvCallGetLogicalProcessorProperty    Root                                                        CpuManagement

  0x007B                                 HvCallGetSystemProperty              Any                                                         CpuManagement

  0x007C                                 HvCallMapDeviceInterrupt             Root                                                        CpuManagement

  0x007D                                 HvCallUnmapDeviceInterrupt           Root                                                        CpuManagement

  0x007E                                 HvCallCreateDeviceDomain             Root                                                        CpuManagement

  0x007F                                 HvCallDeleteDeviceDomain             Root                                                        CpuManagement

  0x0080                                 HvCallMapDevicePages                 Root                                                        CpuManagement

  0x0081                                 HvCallUnmapDevicePages               Root                                                        CpuManagement

  0x0082                                 HvCallAttachDevice                   Root                                                        CpuManagement

  0x0083                                 HvCallDetachDevice                   Root                                                        CpuManagement

  0x0084                                 HvCallNotifyStandbyTransition        Root                                                        CpuManagement

  0x0085                                 HvCallPrepareForSleep                Root                                                        CpuManagement

  0x0086                                 HvCallPrepareForHibernate            Root                                                        CpuManagement

  0x0087                                 HvCallNotifyPartitionEvent           Root                                                        CpuManagement

  0x0088                                 HvCallGetLogicalProcessorRegisters   Root                                                        CpuManagement

  0x0089                                 HvCallSetLogicalProcessorRegisters   Root                                                        CpuManagement

  0x008A                                 HvCallQueryAssociatedLpsforMca       Root                                                        CpuManagement

  0x008B                                 HvCallNotifyRingEmpty                Root                                                        CpuManagement

  0x008C                                 HvCallInjectSyntheticMachineCheck    Root                                                        CpuManagement

  0x008D                                 HvCallScrubPartition                 Root                                                        

  0x008E                                 HvCallCollectLivedump                Root                                                        Debugging

  0x008F                                 HvCallDisableHypervisor              Root                                                        

  0x0090                                 HvCallModifySparseGpaPages           Root                                                        

  0x0091                                 HvCallRegisterInterceptResult        Root                                                        

  0x0092                                 HvCallUnregisterInterceptResult      Root                                                        

  0x0094                                 HvCallAssertVirtualInterrupt                                                                     

  0x0095                                 HvCallCreatePort                                                                                 

  0x0096                                 HvCallConnectPort                                                                                

  0x0097                                 HvCallGetSpaPageList                                                                             

  0x0099                                 HvCallStartVirtualProcessor                                                                      

  0x009A                                 HvCallGetVpIndexFromApicId                                                                       

  0x009B                                 HvCallGetPowerProperty                                                                           

  0x009C                                 HvCallSetPowerProperty                                                                           

  0x009D                                 HvCallCreatePasidSpace                                                                           

  0x009E                                 HvCallDeletePasidSpace                                                                           

  0x009F                                 HvCallSetPasidAddressSpace                                                                       

  0x00A0                                 HvCallFlushPasidAddressSpace                                                                     

  0x00A1                                 HvCallFlushPasidAddressList                                                                      

  0x00A2                                 HvCallAttachPasidSpace                                                                           

  0x00A3                                 HvCallDetachPasidSpace                                                                           

  0x00A4                                 HvCallEnablePasid                                                                                

  0x00A5                                 HvCallDisablePasid                                                                               

  0x00A6                                 HvCallAcknowledgeDevicePageRequest                                                               

  0x00A7                                 HvCallCreateDevicePrQueue                                                                        

  0x00A8                                 HvCallDeleteDevicePrQueue                                                                        

  0x00A9                                 HvCallSetDevicePrqProperty                                                                       

  0x00AA                                 HvCallGetPhysicalDeviceProperty                                                                  

  0x00AB                                 HvCallSetPhysicalDeviceProperty                                                                  
  ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

<span id="_Toc110172900" class="anchor"><span id="_Toc111176475" class="anchor"><span id="_Toc118467521" class="anchor"><span id="_Toc141257754" class="anchor"><span id="_Toc221334066" class="anchor"><span id="_Toc222907535" class="anchor"><span id="_Toc342653313" class="anchor"><span id="_Toc439864348" class="anchor"></span></span></span></span></span></span></span></span>Appendix C: Hypercall Status Code Reference
===================================================================================================================================================================================================================================================================================================================================================================================================================================

<span id="_Toc127596950" class="anchor"><span id="_Toc128290340"
class="anchor"><span id="_Toc130201477" class="anchor"><span
id="_Toc131937058" class="anchor"><span id="_Toc133901350"
class="anchor"><span id="_Toc137461224" class="anchor"><span
id="_Toc139096739" class="anchor"><span id="_Toc139188662"
class="anchor"><span id="_Toc139191525" class="anchor"><span
id="_Toc140571479" class="anchor"><span id="_Toc141257755"
class="anchor"><span id="_Toc141267607" class="anchor"><span
id="_Toc141522625" class="anchor"><span id="_Toc141530031"
class="anchor"><span id="_Toc141852576" class="anchor"><span
id="_Toc141888120" class="anchor"><span id="_Toc141889961"
class="anchor"><span id="_Toc141893630" class="anchor"><span
id="_Toc142113483" class="anchor"><span id="_Toc142114511"
class="anchor"><span id="_Toc142729709" class="anchor"><span
id="_Toc142730993" class="anchor"><span id="_Toc142731366"
class="anchor"><span id="_Toc142998733" class="anchor"><span
id="_Toc143063825" class="anchor"><span id="_Toc143509934"
class="anchor"><span id="_Toc143510382" class="anchor"><span
id="_Toc144026427" class="anchor"><span id="_Toc144026758"
class="anchor"><span id="_Toc144276413" class="anchor"><span
id="_Toc144276757" class="anchor"><span id="_Toc144280345"
class="anchor"><span id="_Toc144280691" class="anchor"><span
id="_Toc144540929" class="anchor"><span id="_Toc144554832"
class="anchor"><span id="_Toc144722420" class="anchor"><span
id="_Toc145503883" class="anchor"><span id="_Toc145512303"
class="anchor"><span id="_Toc145513356" class="anchor"><span
id="_Toc145513740" class="anchor"><span id="_Toc222907536"
class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>The
following is a table of all hypercall return codes.

  ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  Status Code   Status Name                                                              Meaning
  ------------- ------------------------------------------------------------------------ ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  0x0000        HV\_STATUS\_SUCCESS                                                      The operation succeeded.

  0x0001                                                                                 Reserved.<span id="_Ref157935944" class="anchor"></span>[^5]

  0x0002        HV\_STATUS\_INVALID\_HYPERCALL\_CODE                                     The hypervisor does not support the operation because the specified hypercall code is not supported.

  0x0003        HV\_STATUS\_INVALID\_HYPERCALL\_INPUT                                    The rep count was incorrect (for example, a non-zero rep count was passed to a non-rep call or a zero rep count was passed to a rep call) or a reserved bit in the specified hypercall input value was non-zero.

  0x0004        HV\_STATUS\_INVALID\_ALIGNMENT                                           The specified input and/or output GPA pointers were not aligned to 8 bytes or the specified input and/or output parameters lists spanned a page boundary.

  0x0005        HV\_STATUS\_INVALID\_PARAMETER                                           One or more input parameters were invalid.^i^

  0x0006        HV\_STATUS\_ACCESS\_DENIED                                               The caller did not possess sufficient access rights to perform the requested operation.^i^

  0x0007        HV\_STATUS\_INVALID\_PARTITION\_STATE                                    The specified partition’s state was not appropriate for the requested operation.

  0x0008        HV\_STATUS\_OPERATION\_DENIED                                            The operation could not be performed. (The actual cause depends on the operation.)

  0x0009        HV\_STATUS\_UNKNOWN\_PROPERTY                                            The specified partition property ID is not a recognized property.

  0x000A        HV\_STATUS\_PROPERTY\_VALUE\_OUT\_OF\_RANGE                              The specified value of a partition property is out of range or violates an invariant.

  0x000B        HV\_STATUS\_INSUFFICIENT\_MEMORY                                         Insufficient memory exists for the call to succeed.

  0x000C        HV\_STATUS\_PARTITION\_TOO\_DEEP                                         The maximum partition depth has been exceeded for the partition hierarchy.

  0x000D        HV\_STATUS\_INVALID\_PARTITION\_ID                                       The specified partition ID is invalid.

  0x000E        HV\_STATUS\_INVALID\_VP\_INDEX                                           The specified VP index is invalid.

  0x000F                                                                                 Reserved

  0x0010                                                                                 Reserved

  0x0011        HV\_STATUS\_INVALID\_PORT\_ID                                            The specified port ID is not unique or does not exist.

  0x0012        HV\_STATUS\_INVALID\_CONNECTION\_ID                                      The specified connection ID is not unique or does not exist.

  0x0033        HV\_STATUS\_INSUFFICIENT\_BUFFERS                                        The target port does not have sufficient buffers for the caller to post a message.

  0x0014        HV\_STATUS\_NOT\_ACKNOWLEDGED                                            An external interrupt has not previously been asserted and acknowledged by the virtual processor prior to clearing it.

  0x0015        HV\_STATUS\_INVALID\_VP\_STATE                                           A virtual processor is not in the correct state for the performance of the indicated operation.

  0x0016        HV\_STATUS\_ACKNOWLEDGED                                                 An external interrupt cannot be asserted because a previously-asserted external interrupt was acknowledged by the virtual processor and has not yet been cleared.

  0x0017        HV\_STATUS\_INVALID\_SAVE\_RESTORE\_STATE                                The initial call to HvSavePartitionState or HvRestorePartitionState specifying HV\_SAVE\_RESTORE\_STATE\_START was not made at the beginning of the save/restore process.

  0x0018        HV\_STATUS\_INVALID\_SYNIC\_STATE                                        The operation could not be performed because a required feature of the SynIC was disabled.

  0x0019        HV\_STATUS\_OBJECT\_IN\_USE                                              The operation could not be performed because the object or value was either already in use or being used for a purpose that would not permit it.

  0x001A        HV\_STATUS\_INVALID\_PROXIMITY\_DOMAIN\_INFO                             The *Flags* field included an invalid mask value in the proximity domain information.

                                                                                         The *Id* field contained an invalid ACPI node ID in the proximity domain information.

  0x001B        HV\_STATUS\_NO\_DATA                                                     An attempt to retrieve data failed because none was available.

  0x001C        HV\_STATUS\_INACTIVE                                                     The physical connection being used for debugging has not recorded any receive activity since the last operation.

  0x001D        HV\_STATUS\_NO\_RESOURCES                                                A resource is unavailable for allocation. This may indicate that there is a resource shortage or that an implementation limitation may have been reached.

  0x001E        HV\_STATUS\_FEATURE\_UNAVAILABLE                                         A hypervisor feature is not available to the caller.

  0x001F        HV\_STATUS\_PARTIAL\_PACKET                                              The debug packet returned is only a partial packet due to an I/O error.

  0x0020        HV\_STATUS\_PROCESSOR\_FEATURE\_SSE3\_NOT\_SUPPORTED                     The supplied restore state requires an unsupported processor feature (SSE3).

  0x0021        HV\_STATUS\_PROCESSOR\_FEATURE\_LAHFSAHF\_NOT\_SUPPORTED                 The supplied restore state requires an unsupported processor feature (LAHFSAHF ).

  0x0022        HV\_STATUS\_PROCESSOR\_FEATURE\_SSSE3\_NOT\_SUPPORTED                    The supplied restore state requires an unsupported processor feature (SSSE3).

  0x0023        HV\_STATUS\_PROCESSOR\_FEATURE\_SSE4\_1\_NOT\_SUPPORTED                  The supplied restore state requires an unsupported processor feature (SSE4.1).

  0x0024        HV\_STATUS\_PROCESSOR\_FEATURE\_SSE4\_2\_NOT\_SUPPORTED                  The supplied restore state requires an unsupported processor feature SSE4.2 is not supported.

  0x0025        HV\_STATUS\_PROCESSOR\_FEATURE\_SSE4A\_NOT\_SUPPORTED                    The supplied restore state requires an unsupported processor feature SSE4a is not supported.

  0x0026        HV\_STATUS\_PROCESSOR\_FEATURE\_XOP\_NOT\_SUPPORTED                      The supplied restore state requires an unsupported processor feature XOP is not supported.

  0x0027        HV\_STATUS\_PROCESSOR\_FEATURE\_POPCNT\_NOT\_SUPPORTED                   The supplied restore state requires an unsupported processor feature POPCNT is not supported.

  0x0028        HV\_STATUS\_PROCESSOR\_FEATURE\_CMPXCHG16B\_NOT\_SUPPORTED               The supplied restore state requires an unsupported processor feature CMPXCHG16B is not supported.

  0x0029        HV\_STATUS\_PROCESSOR\_FEATURE\_ALTMOVCR8\_NOT\_SUPPORTED                The supplied restore state requires an unsupported processor feature ALTMOVCR8 is not supported.

  0x002A        HV\_STATUS\_PROCESSOR\_FEATURE\_LZCNT\_NOT\_SUPPORTED                    The supplied restore state requires an unsupported processor feature LZCNT is not supported.

  0x002B        HV\_STATUS\_PROCESSOR\_FEATURE\_MISALIGNED\_SSE\_NOT\_SUPPORTED          The supplied restore state requires an unsupported processor feature MISALIGNED SSE3 is not supported.

  0x002C        HV\_STATUS\_PROCESSOR\_FEATURE\_MMX\_EXT\_NOT\_SUPPORTED                 The supplied restore state requires an unsupported processor feature MMX EXT is not supported.

  0x002D        HV\_STATUS\_PROCESSOR\_FEATURE\_3DNOW\_NOT\_SUPPORTED                    The supplied restore state requires an unsupported processor feature 3DNow is not supported.

  0x002E        HV\_STATUS\_PROCESSOR\_FEATURE\_EXTENDED\_3DNOW\_NOT\_SUPPORTED          The supplied restore state requires an unsupported processor feature Extended 3DNow is not supported.

  0x002F        HV\_STATUS\_PROCESSOR\_FEATURE\_PAGE\_1GB\_NOT\_SUPPORTED                The supplied restore state requires an unsupported processor feature PAHGE 1GB is not supported.

  0x0030        HV\_STATUS\_PROCESSOR\_CACHE\_LINE\_FLUSH\_SIZE\_INCOMPATIBLE            The processor’s cache line flush size is not supported.

  0x0031        HV\_STATUS\_PROCESSOR\_FEATURE\_XSAVE\_NOT\_SUPPORTED                    The supplied restore state requires an unsupported processor feature XSAVE is not supported.

  0x0032        HV\_STATUS\_PROCESSOR\_FEATURE\_XSAVEOPT\_NOT\_SUPPORTED                 The supplied restore state requires an unsupported processor feature XSAVEOPT is not supported.

  0x0033        HV\_STATUS\_INSUFFICIENT\_BUFFER                                         The specified buffer was too small to contain all of the requested data.

  0x0034        HV\_STATUS\_PROCESSOR\_FEATURE\_XSAVE\_AVX\_NOT\_SUPPORTED               The supplied restore state requires an unsupported processor feature AVX is not supported.

  0x0035        HV\_STATUS\_PROCESSOR\_FEATURE\_XSAVE\_ FEATURE\_NOT\_SUPPORTED          The supplied restore state requires an unsupported XSAVE processor feature.

  0x0036        HV\_STATUS\_PROCESSOR\_XSAVE\_SAVE\_AREA\_INCOMPATIBLE                   The processor’s XSAVE area is not supported.

  0x0037        HV\_STATUS\_INCOMPATIBLE\_PROCESSOR                                      The processor architecture is not supported.

  0x0038        HV\_STATUS\_INSUFFICIENT\_DEVICE\_DOMAINS                                The maximum number of domains supported by the platform I/O remapping hardware is currently in use.

  0x0039        HV\_STATUS\_PROCESSOR\_FEATURE\_AES\_NOT\_SUPPORTED                      The supplied restore state requires an unsupported processor feature (AES).

  0x003A        HV\_STATUS\_PROCESSOR\_FEATURE\_PCLMULQDQ\_NOT\_SUPPORTED                The supplied restore state requires an unsupported processor feature (PCLMULQDQ).

  0x003B        HV\_STATUS\_PROCESSOR\_FEATURE\_INCOMPATIBLE\_XSAVE\_FEATURES            The supplied restore state enables incompatible XSAVE features.
                                                                                         
                                                                                         (Enabling AVX without XSAVE/enabling XSAVEOPT without XSAVE)

  0x003C        HV\_STATUS\_CPUID\_FEATURE\_VALIDATION\_ERROR                            Generic logical processor CPUID feature set validation error.

  0x003D        HV\_STATUS\_CPUID\_XSAVE\_FEATURE\_VALIDATION\_ERROR                     CPUID XSAVE feature validation error.

  0x003E        HV\_STATUS\_PROCESSOR\_STARTUP\_TIMEOUT                                  Processor startup timed out.

  0x003F        HV\_STATUS\_SMX\_ENABLED                                                 SMX enabled by the BIOS.

  0x0040        HV\_STATUS\_PROCESSOR\_FEATURE\_PCID\_NOT\_SUPPORTED                     The supplied restore state requires an unsupported processor
                                                                                         
                                                                                         processor feature (PCID).

  0x0041        HV\_STATUS\_INVALID\_LP\_INDEX                                           The hypervisor could not perform the operation because the specified LP index is invalid.

  0x0042        HV\_STATUS\_FEATURE\_FMA4\_NOT\_SUPPORTED                                The supplied restore state requires an unsupported processor feature (FMA4).

  0x0043        HV\_STATUS\_FEATURE\_F16C\_NOT\_SUPPORTED                                The supplied restore state requires an unsupported processor feature (F16C).

  0x0044        HV\_STATUS\_PROCESSOR\_FEATURE\_RDRAND\_NOT\_SUPPORTED                   The supplied restore state requires an unsupported processor feature (RDRAND).

  0x0045        HV\_STATUS\_PROCESSOR\_FEATURE\_RDWRFSGS\_NOT\_SUPPORTED                 The supplied restore state requires an unsupported processor feature (Read/Write FS/GS).

  0x0046        HV\_STATUS\_PROCESSOR\_FEATURE\_SMEP\_NOT\_SUPPORTED                     The supplied restore state requires an unsupported processor feature (SMEP).

  0x0047        HV\_STATUS\_PROCESSOR\_FEATURE\_ENHANCED\_FAST\_STRING\_NOT\_SUPPORTED   The supplied restore state requires an unsupported processor feature (Enhanced Fast String).

  0x0048        HV\_STATUS\_PROCESSOR\_FEATURE\_MOVBE\_NOT\_SUPPORTED                    The supplied restore state requires an unsupported processor feature (MovBe Instruction).

  0x0049        HV\_STATUS\_PROCESSOR\_FEATURE\_BMI1\_NOT\_SUPPORTED                     The supplied restore state requires an unsupported processor feature (Bmi1).

  0x004A        HV\_STATUS\_PROCESSOR\_FEATURE\_BMI2\_NOT\_SUPPORTED                     The supplied restore state requires an unsupported processor feature (Bmi2).

  0x004B        HV\_STATUS\_PROCESSOR\_FEATURE\_HLE\_NOT\_SUPPORTED                      The supplied restore state requires an unsupported processor feature (Hle).

  0x004C        HV\_STATUS\_PROCESSOR\_FEATURE\_RTM\_NOT\_SUPPORTED                      The supplied restore state requires an unsupported processor feature (Rtm).

  0x004D        HV\_STATUS\_PROCESSOR\_FEATURE\_XSAVE\_FMA\_NOT\_SUPPORTED               The supplied restore state requires an unsupported processor feature (Fma).

  0x004E        HV\_STATUS\_PROCESSOR\_FEATURE\_XSAVE\_AVX2\_NOT\_SUPPORTED              The supplied restore state requires an unsupported processor feature (Avx2)

  0x004F        HV\_STATUS\_PROCESSOR\_FEATURE\_NPIEP1\_NOT\_SUPPORTED                   The supplied restore state requires an unsupported processor feature (NPIEP1).

  0x0050        HV\_STATUS\_INVALID\_REGISTER\_VALUE                                     The supplied register value is invalid.

  0x0052        HV\_STATUS\_PROCESSOR\_FEATURE\_RDSEED\_NOT\_SUPPORTED                   The supplied restore state requires an unsupported processor feature (RdSeed).

  0x0053        HV\_STATUS\_PROCESSOR\_FEATURE\_ADX\_NOT\_SUPPORTED                      The supplied restore state requires an unsupported processor feature (Adx).

  0x0054        HV\_STATUS\_PROCESSOR\_FEATURE\_SMAP\_NOT\_SUPPORTED                     The supplied restore state requires an unsupported processor feature (SMAP).

  0x0055        HV\_STATUS\_NX\_NOT\_DETECTED                                            NX not detected on the machine.

  0x0056        HV\_STATUS\_PROCESSOR\_FEATURE\_INTEL\_PREFETCH\_NOT\_SUPPORTED          The supplied restore state requires an unsupported processor feature (Intel Prefetch)

  0x0057        HV\_STATUS\_INVALID\_DEVICE\_ID                                          The supplied device ID is invalid.

  0x0058        HV\_STATUS\_INVALID\_DEVICE\_STATE                                       The operation is not allowed in the current device state.

  0x0059        HV\_STATUS\_PENDING\_PAGE\_REQUESTS                                      The device had pending page requests which were discarded.

  0x0060        HV\_STATUS\_PAGE\_REQUEST\_INVALID                                       The supplied page request specifies a memory access that the guest does not have permissions to perform.

  0X2007        HV\_STATUS\_HYPERCALL\_INTERCEPT                                         The requested access to the hypercall generated an intercept.
  ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

Appendix D: Architectural CPUID<span id="_Ref182330427" class="anchor"><span id="_Toc141257756" class="anchor"><span id="_Ref142907327" class="anchor"><span id="_Ref147656202" class="anchor"></span></span></span></span>
===========================================================================================================================================================================================================================

<span id="_Toc222907538" class="anchor"></span>The table below contains
a list of architected CPUID leaves and how they are virtualized by the
hypervisor. *Pass through* means that the hardware value is used and
passed through to the guest. That value will be the same on all logical
processors in the system.

  --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  **Index and\              **Name**                                                                                                           **Start bit**   **End bit**   **Virtualized Value**                                                                      **Virtualized Value**
  Register**                                                                                                                                                                                                                                                            
                                                                                                                                                                             **Root\                                                                                    **Non-Root\
                                                                                                                                                                             **                                                                                         **
  ------------------------- ------------------------------------------------------------------------------------------------------------------ --------------- ------------- ------------------------------------------------------------------------------------------ ----------------------------------------------------------------------------------------------------------------------------------------------
  0x00000000                Vendor ID                                                                                                                                                                                                                                   

  EAX                       Maximum valid standard CPUID index                                                                                 0               31            Minimum of the hardware value on the current logical processor and 0x00000006              Minimum of the hardware value across all logical processors and 0x00000006

  EBX                       Processor vendor string                                                                                            0               31            Pass through                                                                               Pass through

  ECX                       Processor vendor string                                                                                            0               31            Pass through                                                                               Pass through

  EDX                       Processor vendor string                                                                                            0               31            Pass through                                                                               Pass through

  0x00000001                 Feature Information                                                                                                                                                                                                                         

  EAX                       Stepping                                                                                                           0               3             Pass through                                                                               Pass through minimum stepping across all logical processors

                            Base Model                                                                                                         4               7             Pass through                                                                               Pass through

                            Base Family                                                                                                        8               11            Pass through                                                                               Pass through

                            Processor Type                                                                                                     12              13            Pass through                                                                               Pass through

                            RsvdZ                                                                                                              14              15            Cleared                                                                                    Cleared

                            Extended Model                                                                                                     16              19            Pass through                                                                               Pass through

                            Extended Family                                                                                                    20              27            Pass through                                                                               Pass through

                            RsvdZ                                                                                                              28              31            Cleared                                                                                    Cleared

  EBX                       Miscellaneous Information                                                                                                                                                                                                                   

                            Brand Identifier                                                                                                   0               7             Pass through                                                                               Pass through value received from processor 0

                            CL Flush size                                                                                                      8               15            Pass through                                                                               Pass through

                            Maximum LPs in a physical package                                                                                  16              23            Pass through                                                                               If HT is disabled, set to number of cores. If HT enabled, Pass through.

                            Initial APIC ID                                                                                                    24              31            Pass through                                                                               Return value of the HvX64RegisterInitialApicId

  ECX                       Feature Flags / Identifiers                                                                                                                                                                                                                 

                            SSE3                                                                                                               0               0             Pass through                                                                               Set if set on all, otherwise 0

                            PCLMULDQ                                                                                                           1               1             Pass through                                                                               Pass through

                            DTES64                                                                                                             2               2             Cleared                                                                                    Cleared

                            MONITOR                                                                                                            3               3             Cleared                                                                                    Cleared

                            DS-CPL                                                                                                             4               4             Cleared                                                                                    Cleared

                            VMX                                                                                                                5               5             Cleared                                                                                    Cleared

                            SMX                                                                                                                6               6             Cleared                                                                                    Cleared

                            EIST                                                                                                               7               7             Pass through                                                                               Cleared

                            TM2                                                                                                                8               8             Pass through                                                                               Cleared

                            SSSE3                                                                                                              9               9             Pass through                                                                               Set if set on all, otherwise 0

                            CNXT-ID                                                                                                            10              10            Pass through                                                                               Cleared

                            RsvdZ                                                                                                              11              11            Cleared                                                                                    Cleared

                            FMA                                                                                                                12              12            Pass through                                                                               Pass through

                            CMPXCHG16B                                                                                                         13              13            Pass through                                                                               Set if set on all, otherwise 0

                            xTPR                                                                                                               14              14            Pass through                                                                               Cleared

                            PDCM                                                                                                               15              15            Cleared                                                                                    Cleared

                            RsvdZ                                                                                                              16              16            Cleared                                                                                    Cleared

                            PCID                                                                                                               17              17            Pass through                                                                               Pass through

                            DCA                                                                                                                18              18            Cleared                                                                                    Cleared

                            SSE4.1                                                                                                             19              19            Pass through                                                                               Set if set on all, otherwise 0

                            SSE4.2                                                                                                             20              20            Pass through                                                                               Set if set on all, otherwise 0

                            x2APIC                                                                                                             21              21            Pass through                                                                               Cleared

                            RsvdZ                                                                                                              22              22            Cleared                                                                                    Cleared

                            POPCNT                                                                                                             23              23            Pass through                                                                               Set if set on all, otherwise 0

                            TSC-DEADLINE                                                                                                       24              24            Cleared                                                                                    Cleared

                            AES                                                                                                                25              25            Pass through                                                                               Pass through

                            XSAVE                                                                                                              26              26            Set if enabled                                                                             Set if enabled

                            OSXSAVE                                                                                                            27              27            Pass through                                                                               Pass through

                            AVX                                                                                                                28              28            Set if enabled                                                                             Set if enabled

                            F16C                                                                                                               29              29            Pass through                                                                               Pass through

                            RDRAND                                                                                                             30              30            Pass through                                                                               Pass through

                            Hypervisor Present                                                                                                 31              31            Set                                                                                        Set

  EDX                       Feature Information                                                                                                                                                                                                                         

                            FPU                                                                                                                0               0             Set                                                                                        Set

                            VME                                                                                                                1               1             Set                                                                                        Set

                            DE                                                                                                                 2               2             Set                                                                                        Set

                            PSE                                                                                                                3               3             Set                                                                                        Set

                            TSC                                                                                                                4               4             Set                                                                                        Set

                            MSR                                                                                                                5               5             Set                                                                                        Set

                            PAE                                                                                                                6               6             Set                                                                                        Set

                            MCE                                                                                                                7               7             Set                                                                                        Set

                            CMPXCHG8B                                                                                                          8               8             Set                                                                                        Set

                            APIC                                                                                                               9               9             Set                                                                                        Set

                            RsvdZ                                                                                                              10              10            Cleared                                                                                    Cleared

                            SEP                                                                                                                11              11            Set                                                                                        Set

                            MTRR                                                                                                               12              12            Set                                                                                        Set

                            PGE                                                                                                                13              13            Set                                                                                        Set

                            MCA                                                                                                                14              14            Set                                                                                        Set

                            CMOV                                                                                                               15              15            Set                                                                                        Set

                            PAT                                                                                                                16              16            Set                                                                                        Set

                            PSE-36                                                                                                             17              17            Set                                                                                        Set

                            PSN                                                                                                                18              18            Cleared                                                                                    Cleared

                            CLFSH                                                                                                              19              19            Set                                                                                        Set

                            RsvdZ                                                                                                              20              20            Cleared                                                                                    Cleared

                            DS                                                                                                                 21              21            Cleared                                                                                    Cleared

                            ACPI                                                                                                               22              22            Pass through                                                                               Cleared

                            MMX                                                                                                                23              23            Set                                                                                        Set

                            FXSR                                                                                                               24              24            Set                                                                                        Set

                            SSE                                                                                                                25              25            Set                                                                                        Set

                            SSE2                                                                                                               26              26            Set                                                                                        Set

                            SS                                                                                                                 27              27            Pass through                                                                               Set if set on all, otherwise 0

                            HTT                                                                                                                28              28            Pass through                                                                               Cleared

                            TM                                                                                                                 29              29            Pass through                                                                               Cleared

                            RsvdZ                                                                                                              30              30            Cleared                                                                                    Cleared

                            PBE                                                                                                                31              31            Pass through                                                                               Cleared

  0x00000002                 Cache Descriptors                                                                                                                                                                                                                           

  EAX                       Cache and TLB descriptors                                                                                          0               31            Pass through on Intel                                                                      Pass through value from processor 0 on Intel
                                                                                                                                                                                                                                                                        
                                                                                                                                                                             Cleared on AMD                                                                             Cleared on AMD

  EBX                       Cache and TLB descriptors                                                                                          0               31            Pass through on Intel                                                                      Pass through value from processor 0 on Intel
                                                                                                                                                                                                                                                                        
                                                                                                                                                                             Cleared on AMD                                                                             Cleared on AMD

  ECX                       Cache and TLB descriptors                                                                                          0               31            Pass through on Intel                                                                      Pass through value from processor 0 on Intel
                                                                                                                                                                                                                                                                        
                                                                                                                                                                             Cleared on AMD                                                                             Cleared on AMD

  EDX                       Cache and TLB descriptors                                                                                          0               31            Pass through on Intel                                                                      Pass through value from processor 0 on Intel
                                                                                                                                                                                                                                                                        
                                                                                                                                                                             Cleared on AMD                                                                             Cleared on AMD

  0x00000003                 Processor Serial Number                                                                                                                                                                                                                     

  EAX                       Processor serial number                                                                                            0               31            Cleared                                                                                    Cleared

  EBX                       Processor serial number                                                                                            0               31            Cleared                                                                                    Cleared

  ECX                       Processor serial number                                                                                            0               31            Cleared                                                                                    Cleared

  EDX                       Processor serial number                                                                                            0               31            Cleared                                                                                    Cleared

  0x00000004                Deterministic Cache Parameters                                                                                                                    

  EAX                       Cache type                                                                                                         0               4             Pass through                                                                               Pass through value from processor 0

                            Cache level                                                                                                        5               7             Pass through                                                                               Pass through value from processor 0

                            Self-initializing cache level                                                                                      8               8             Pass through                                                                               Pass through value from processor 0

                            Fully Associative                                                                                                  9               9             Pass through                                                                               Pass through value from processor 0

                            Write back invalidate / invalidate                                                                                 10              10            Pass through                                                                               Pass through value from processor 0

                            Cache inclusiveness                                                                                                11              11            Pass through                                                                               Pass through value from processor 0

                            RsvdZ                                                                                                              12              13            Cleared                                                                                    Cleared

                            Maximum threads in cache                                                                                           14              25            Pass through                                                                               If HT disabled, scale the value down by the number of threads / core. If HT is enabled, set to the number of logical processors per package.

                            Max cores per package                                                                                              26              31            Pass through                                                                               If HT enabled, scale up this value by number of threads per core. If HT is disabled, Pass through the value from processor 0.

  EBX                       Coherency line size                                                                                                0               11            Pass through                                                                               Pass through value from processor 0

                            Physical line partitions                                                                                           12              21            Pass through                                                                               Pass through value from processor 0

                            Ways of associativity                                                                                              22              31            Pass through                                                                               Pass through value from processor 0

  ECX                       Number of sets                                                                                                     0               31            Pass through                                                                               Pass through value from processor 0

  EDX                       RsvdZ                                                                                                              0               31            Cleared                                                                                    Cleared

  0x00000005                MONITOR / MWAIT                                                                                                                                                                                                                              

  EAX                                                                                                                                          0               15            Cleared                                                                                    Cleared

                            RsvdZ                                                                                                              16              31            Cleared                                                                                    Cleared

  EBX                       MonLineSizeMax                                                                                                     0               15            Cleared                                                                                    Cleared

                            RsvdZ                                                                                                              16              31            Cleared                                                                                    Cleared

  ECX                       EMX                                                                                                                0               0             Cleared                                                                                    Cleared

                            IBE                                                                                                                1               1             Cleared                                                                                    Cleared

                            RsvdZ                                                                                                              2               31            Cleared                                                                                    Cleared

  EDX                       C0SubstatesUsingMwait                                                                                              0               3             Cleared                                                                                    Cleared

                            C1SubstatesUsingMwait                                                                                              4               7             Cleared                                                                                    Cleared

                            C2SubstatesUsingMwait                                                                                              8               11            Cleared                                                                                    Cleared

                            C3SubstatesUsingMwait                                                                                              12              15            Cleared                                                                                    Cleared

                            C4SubstatesUsingMwait                                                                                              16              19            Cleared                                                                                    Cleared

                            RsvdZ                                                                                                              20              31            Cleared                                                                                    Cleared

  0x00000006                Power management feature enumeration function                                                                                                                                                                                                

  EAX                       Digital Temperature Sensor Supported.                                                                              0               0             Pass through for the partition possessing the CpuManagement privilege, otherwise Cleared   Pass through for the partition possessing the CpuManagement privilege, otherwise Cleared

                            Dynamic Acceleration Enabled                                                                                       1               1             Pass through for the partition possessing the CpuManagement privilege, otherwise Cleared   Pass through for the partition possessing the CpuManagement privilege, otherwise Cleared

                            Constant Rate Timer                                                                                                2               2             Pass through for the partition possessing the CpuManagement privilege, otherwise Cleared   Pass through for the partition possessing the CpuManagement privilege, otherwise Cleared

                            RsvdZ                                                                                                              3               31            Pass through for the partition possessing the CpuManagement privilege, otherwise Cleared   Pass through for the partition possessing the CpuManagement privilege, otherwise Cleared

  EBX                       Thermal Threshold Count                                                                                            0               3             Pass through for the partition possessing the CpuManagement privilege, otherwise Cleared   Pass through for the partition possessing the CpuManagement privilege, otherwise Cleared

                            RsvdZ                                                                                                              4               31            Pass through for the partition possessing the CpuManagement privilege, otherwise Cleared   Pass through for the partition possessing the CpuManagement privilege, otherwise Cleared

  ECX                       Hardware Coordination Feeback                                                                                      0               0             Pass through for the partition possessing the CpuManagement privilege, otherwise Cleared   Pass through for the partition possessing the CpuManagement privilege, otherwise Cleared

                            RsvdZ                                                                                                              1               31            Pass through for the partition possessing the CpuManagement privilege, otherwise Cleared   Pass through for the partition possessing the CpuManagement privilege, otherwise Cleared

  EDX                       RsvdZ                                                                                                              0               31            Pass through for the partition possessing the CpuManagement privilege, otherwise Cleared   Pass through for the partition possessing the CpuManagement privilege, otherwise Cleared

  0x00000007                 Extended Feature Flags                                                                                                                                                                                                                      

  EAX                       RsvdZ                                                                                                              0               31            Cleared                                                                                    Cleared

  EBX                       FSGSBASE                                                                                                           0               0             Pass Through                                                                               Pass Through

                            RsvdZ                                                                                                              1               6             Cleared                                                                                    Cleared

                            SMEP                                                                                                               7               7             Pass Through                                                                               Pass Through

                            RsvdZ                                                                                                              8               8             Cleared                                                                                    Cleared

                            Enhanced REP MOVSB/STOSB                                                                                           9               9             Pass Through                                                                               Pass Through

                            RsvdZ                                                                                                              10              31            Cleared                                                                                    Cleared

  ECX                       RsvdZ                                                                                                              0               31            Cleared                                                                                    Cleared

  EDX                       RsvdZ                                                                                                              0               31            Cleared                                                                                    Cleared

  0x00000008                Reserved                                                                                                                                                                                                                                     

  EAX                       RsvdZ                                                                                                              0               31            Cleared                                                                                    Cleared

  EBX                       RsvdZ                                                                                                              0               31            Cleared                                                                                    Cleared

  ECX                       RsvdZ                                                                                                              0               31            Cleared                                                                                    Cleared

  EDX                       RsvdZ                                                                                                              0               31            Cleared                                                                                    Cleared

  0x00000009                                                                                                                                                                                                                                                             

  EAX                       RsvdZ                                                                                                              0               31            Cleared                                                                                    Cleared

  EBX                       RsvdZ                                                                                                              0               31            Cleared                                                                                    Cleared

  ECX                       RsvdZ                                                                                                              0               31            Cleared                                                                                    Cleared

  EDX                       RsvdZ                                                                                                              0               31            Cleared                                                                                    Cleared

  0x0000000A                Architectural Performance Monitor                                                                                                                 

  EAX                       Architectural Perfmon                                                                                              0               31            Cleared                                                                                    Cleared

  EBX                       Architectural Perfmon                                                                                              0               31            Cleared                                                                                    Cleared

  ECX                       Architectural Perfmon                                                                                              0               31            Cleared                                                                                    Cleared

  EDX                       Architectural Perfmon                                                                                              0               31            Cleared                                                                                    Cleared

  0x40000000                Hypervisor CPUID leaf range and vendor ID signature                                                                                                                                                                                          

  EAX                       The maximum input value for hypervisor CPUID information                                                           0               31            At least 0x40000005                                                                        At least 0x40000005

  EBX                       Hypervisor Vendor ID Signature                                                                                     0               31            0x7263694D—“Micr"                                                                          0x7263694D—“Micr"

  ECX                       Hypervisor Vendor ID Signature                                                                                     0               31            0x666F736F—“osof"                                                                          0x666F736F—“osof"

  EDX                       Hypervisor Vendor ID Signature                                                                                     0               31            0x76482074—“t Hv"                                                                          0x76482074—“t Hv"

  0x40000001                Hypervisor vendor-neutral interface identification                                                                                                                                                                                           

  EAX                       Hypervisor Interface Signature                                                                                     0               31            0x31237648—“Hv\#1"                                                                         0x31237648—“Hv\#1"

  EBX                       RsvdZ                                                                                                              0               31            Cleared                                                                                    Cleared

  ECX                       RsvdZ                                                                                                              0               31            Cleared                                                                                    Cleared

  EDX                       RsvdZ                                                                                                              0               31            Cleared                                                                                    Cleared

  0x40000002                Operating system identity                                                                                                                                                                                                                    

  EAX                       Build Number                                                                                                       0               31                                                                                                       

  EBX                       Minor Version                                                                                                      0               15                                                                                                       

                            Major Version                                                                                                      16              31                                                                                                       

  ECX                       Service Pack                                                                                                       0               31                                                                                                       

  EDX                       Service Number                                                                                                     0               23                                                                                                       

                            Service Branch                                                                                                     24              31                                                                                                       

  0x40000003                                                                                                                                                                                                                                                             

  EAX                       Feature identification - partition privileges                                                                                                                                                                                               

                            VP Runtime available                                                                                               0               0                                                                                                        

                            Partition Reference Counter available                                                                              1               1                                                                                                        

                            Basic SynIC MSRs available                                                                                         2               2                                                                                                        

                            Synthetic Timer MSRs available                                                                                     3               3                                                                                                        

                            APIC access MSRs available                                                                                         4               4                                                                                                        

                            Hypercall MSRs available                                                                                           5               5                                                                                                        

                            Access virtual processor index MSR available                                                                       6               6                                                                                                        

                            Virtual System Reset MSR available                                                                                 7               7                                                                                                        

                            Access statistics pages MSRs available                                                                             8               8                                                                                                        

                            AccessPartitionReferenceTsc                                                                                        9               9                                                                                                        

                            AccessGuestIdleMsrs                                                                                                10              10                                                                                                       

                            AccessFrequencyMsrs                                                                                                11              11                                                                                                       

                            AccessDebugMsrs                                                                                                    12              12                                                                                                       

                            RsvdZ                                                                                                              13              31            Cleared                                                                                    Cleared

  EBX                       Feature identification - partition creation flags                                                                                                                                                                                           

                            CreatePartitions                                                                                                   0               0                                                                                                        

                            AccessPartitionId                                                                                                  1               1                                                                                                        

                            AccessMemoryPool                                                                                                   2               2                                                                                                        

                            AdjustMessageBuffers                                                                                               3               3                                                                                                        

                            PostMessages                                                                                                       4               4                                                                                                        

                            SignalEvents                                                                                                       5               5                                                                                                        

                            CreatePort                                                                                                         6               6                                                                                                        

                            ConnectPort                                                                                                        7               7                                                                                                        

                            AccessStats                                                                                                        8               8                                                                                                        

                            RsvdZ                                                                                                              9               10                                                                                                       

                            Debugging                                                                                                          11              11                                                                                                       

                            CpuManagement                                                                                                      12              12                                                                                                       

                            ConfigureProfiler                                                                                                  13              13                                                                                                       

                            RsvdP                                                                                                              14              14                                                                                                       

                            RsvdZ                                                                                                              15              31            Cleared                                                                                    Cleared

  ECX                       Feature identification - power management                                                                                                                                                                                                   

                            Maximum processor power state. 0 is C0, 1 is C1, 2 is C2, 3 is C3.                                                 0               3                                                                                                        

                            HPET needed for C3                                                                                                 4               4                                                                                                        

                            RsvdZ                                                                                                              5               31            Cleared                                                                                    Cleared

  EDX                       Feature identification - miscellaneous                                                                                                                                                                                                      

                            The MWAIT instruction is available                                                                                 0               0                                                                                                        

                            Guest debugging support is available                                                                               1               1             Cleared                                                                                    Set

                            Performance monitor support is available                                                                           2               2             Cleared                                                                                    Cleared

                            CpuDynamicPartitioningAvailable                                                                                    3               3             Cleared                                                                                    Cleared

                            XmmRegistersForFastHypercallAvailable                                                                              4               4             Set                                                                                        Set

                            GuestIdleAvailable                                                                                                 5               5             Cleared                                                                                    Set

                            HypervisorSleepStateSupportAvailable                                                                               6               6             Set                                                                                        Cleared

                            NumaDistanceQueryAvailable                                                                                         7               7             Set                                                                                        Cleared

                            FrequencyMsrsAvailable                                                                                             8               8             Set                                                                                        Cleared

                            SyntheticMachineCheckAvailable                                                                                     9               9             Cleared                                                                                    Set

                            GuestCrashMsrsAvailable                                                                                            10              10            Cleared                                                                                    Set

                            DebugMsrsAvailable                                                                                                 11              11            Cleared                                                                                    Set

                            Npiep1Available                                                                                                    12              12                                                                                                       

                            DisableHypervisorAvailable                                                                                         13              13                                                                                                       

                            ExtendedGvaRangesForFlishVirtualAddressListAvailable                                                               14              14                                                                                                       

                            FastHypercallOutputAvailable                                                                                       15              15                                                                                                       

                            Reserved                                                                                                           16              16                                                                                                       

                            SintPollingModeAvailable                                                                                           17              17                                                                                                       

                            RsvdZ                                                                                                              17              31            Cleared                                                                                    Cleared

  0x40000004                                                                                                                                                                                                                                                             

  EAX                       Implementation recommendations                                                                                                                                                                                                              

                            Recommend using hypercall for address space switches rather than MOV to CR3 instruction                            0               0             Set                                                                                        Set

                            Recommend using hypercall for local TLB flushes rather than INVLPG or MOV to CR3 instructions                      1               1             Set                                                                                        Set

                            Recommend using hypercall for remote TLB flushes rather than inter-processor interrupts                            2               2             Set                                                                                        Set

                            Recommend using MSRs for accessing APIC registers EOI, ICR and TPR rather than their memory-mapped counterparts.   3               3             Set                                                                                        Set

                            Recommend using the hypervisor-provided MSR to initiate a system RESET.                                            4               4             Set                                                                                        Set

                            Recommend using relaxed timing for this partition.                                                                 5               5             Set                                                                                        Set

                            UseDmaRemapping                                                                                                    6               6                                                                                                        

                            UseInteruptRemapping                                                                                               7               7                                                                                                        

                            UseX2ApicMsrs                                                                                                      8               8                                                                                                        

                            DeprecateAutoEoi                                                                                                   9               9                                                                                                        

                            RsvdZ                                                                                                              10              31            Cleared                                                                                    Cleared

  EBX                       Recommended number of attempts to retry a spinlock failure before notifying the hypervisor about the failures.\    0               31                                                                                                       
                            0xFFFFFFFF indicates never to retry.                                                                                                                                                                                                        

  ECX                       RsvdZ                                                                                                              0               31            Cleared                                                                                    Cleared

  EDX                       RsvdZ                                                                                                              0               31            Cleared                                                                                    Cleared

  0x40000005                Implementation limits                                                                                                                                                                                                                        

  EAX                       The maximum number of virtual processors supported.                                                                0               31            64                                                                                         64

  EBX                       The maximum number of logical processors supported.                                                                0               31            512                                                                                        512

  ECX                       The maximum number of interrupt mappings supported                                                                 0               31                                                                                                       

  EDX                       RsvdZ                                                                                                              0               31            Cleared                                                                                    Cleared

  0x40000006                Implementation hardware features                                                                                                                                                                                                            

  EAX                       Support for APIC overlay assist is detected and in use.                                                            0               0                                                                                                        

                            Support for MSR bitmaps is detected and in use.                                                                    1               1                                                                                                        

                            Support for architectural performance counters is detected and in use.                                             2               2                                                                                                        

                            Second Level Address Translation is detected and in use.                                                           3               3                                                                                                        

                            DMA Remapping is detected and in use.                                                                              4               4                                                                                                        

                            Interrupt Remapping is detected and in use.                                                                        5               5                                                                                                        

                            Memory patrol scrubber present                                                                                     6               6                                                                                                        

                            RsvdZ for future Intel-specific features.                                                                          7               31                                                                                                       

  EBX                       RsvdZ                                                                                                              0               31            Cleared                                                                                    Cleared

  ECX                       RsvdZ                                                                                                              0               31            Cleared                                                                                    Cleared

  EDX                       RsvdZ for future AMD-specific features                                                                             0               31            Cleared                                                                                    Cleared

  0x40000007 - 0x4000007F                                                                                                                                                                                                                                                

  EAX - EDX                 Reserved for future hypervisor use                                                                                                                                                                                                          

  0x40000080 - 0x400000FF                                                                                                                                                                                                                                                

  EAX - EDX                 Reserved for use of intercept handlers in the parent partition                                                                                                                                                                              

  0x80000000                                                                                                                                                                                                                                                             

  EAX                       Highest Extended CPUID Leaf                                                                                        0               31            Minimum of the hardware value on current logical processor and 0x8000001A                  Minimum of the hardware value across all logical processors in the system and 0x8000001A

  EBX                       Processor vendor string                                                                                            0               31            Pass through                                                                               Pass through value from processor 0

  ECX                       Processor vendor string                                                                                            0               31            Pass through                                                                               Pass through value from processor 0

  EDX                       Processor vendor string                                                                                            0               31            Pass through                                                                               Pass through value from processor 0

  0x80000001                                                                                                                                                                                                                                                             

  EAX                       Stepping                                                                                                           0               3             Pass through                                                                               Minimum across all logical processors

                            Base Model                                                                                                         4               7             Pass through                                                                               Pass through value from processor 0

                            Base Family                                                                                                        8               11            Pass through                                                                               Pass through value from processor 0

                            Processor Type                                                                                                     12              13            Pass through                                                                               Pass through value from processor 0

                            RsvdZ                                                                                                              14              15            Cleared                                                                                    Cleared

                            Extended Model                                                                                                     16              19            Pass through                                                                               Pass through

                            Extended Family                                                                                                    20              27            Pass through                                                                               Pass through

                            RsvdZ                                                                                                              28              31            Cleared                                                                                    Cleared

  EBX                       Brand ID                                                                                                           0               15            Pass through                                                                               Pass through

                            RsvdZ                                                                                                              16              27            Cleared                                                                                    Cleared

                            Package Type                                                                                                       28              31            Pass through                                                                               Pass through

  ECX                       Extended feature flag / feature identifiers                                                                                                                                                                                                 

                            LahfSahf                                                                                                           0               0             Pass through                                                                               Set if set on all, otherwise 0

                            CmpLegacy                                                                                                          1               1             Pass through                                                                               Set if set on all, otherwise 0

                            SVM                                                                                                                2               2             Cleared                                                                                    Cleared

                            ExtApicSpace                                                                                                       3               3             Cleared                                                                                    Cleared

                            AltMovCr8                                                                                                          4               4             Pass through                                                                               Set if set on all, otherwise 0

                            ABM                                                                                                                5               5             Pass through                                                                               Set if set on all, otherwise 0

                            SSE4A                                                                                                              6               6             Pass through                                                                               Set if set on all, otherwise 0

                            MisAlignSse                                                                                                        7               7             Pass through                                                                               Set if set on all, otherwise 0

                            3DNowPrefetch                                                                                                      8               8             Pass through                                                                               Set if set on all, otherwise 0

                            OSVW                                                                                                               9               9             Pass through                                                                               Set if set on all, otherwise 0

                            RsvdZ                                                                                                              10              10            Cleared                                                                                    Cleared

                            SSE5                                                                                                               11              11            Pass through                                                                               Set if set on all, otherwise 0

                            SKINIT                                                                                                             12              12            Cleared                                                                                    Cleared

                            WDT                                                                                                                13              13            Pass through                                                                               Cleared

                            RsvdZ                                                                                                              14              31            Cleared                                                                                    Cleared

  EDX                       Extended feature flags                                                                                                                                                                                                                      

                            FPU                                                                                                                0               0             Set                                                                                        Set

                            VME                                                                                                                1               1             Pass through                                                                               Set if set on all, otherwise 0

                            DE                                                                                                                 2               2             Set                                                                                        Set

                            PSE                                                                                                                3               3             Set                                                                                        Set

                            TSC                                                                                                                4               4             Set                                                                                        Set

                            MSR                                                                                                                5               5             Set                                                                                        Set

                            PAE                                                                                                                6               6             Set                                                                                        Set

                            MCE                                                                                                                7               7             Set                                                                                        Set

                            CMPXCHG8B                                                                                                          8               8             Set                                                                                        Set

                            APIC                                                                                                               9               9             Set                                                                                        Set

                            RsvdZ                                                                                                              10              10            Cleared                                                                                    Cleared

                            SysCallSysRet                                                                                                      11              11            Set                                                                                        Set

                            MTRR                                                                                                               12              12            Set                                                                                        Set

                            PGE                                                                                                                13              13            Set                                                                                        Set

                            MCA                                                                                                                14              14            Set                                                                                        Set

                            CMOV                                                                                                               15              15            Set                                                                                        Set

                            PAT                                                                                                                16              16            Set                                                                                        Set

                            PSE36                                                                                                              17              17            Pass through                                                                               Set if set on all, otherwise 0

                            RsvdZ                                                                                                              18              18            Cleared                                                                                    Cleared

                            RsvdZ                                                                                                              19              19            Cleared                                                                                    Cleared

                            Execute disabled / No execute                                                                                      20              20            Set                                                                                        Set

                            RsvdZ                                                                                                              21              21            Cleared                                                                                    Cleared

                            MmxExt                                                                                                             22              22            Pass through                                                                               Set if set on all, otherwise 0

                            MMX                                                                                                                23              23            Set                                                                                        Set

                            FXSR                                                                                                               24              24            Set                                                                                        Set

                            FFXSR                                                                                                              25              25            Pass through                                                                               Set if set on all, otherwise 0

                            Page1GB                                                                                                            26              26            Cleared                                                                                    Cleared

                            RDTSCP                                                                                                             27              27            Pass through                                                                               Cleared

                            RsvdZ                                                                                                              28              28            Cleared                                                                                    Cleared

                            LM                                                                                                                 29              29            Set                                                                                        Set

                            3DNowExt                                                                                                           30              30            Pass through                                                                               Set if set on all, otherwise 0

                            3DNow                                                                                                              31              31            Pass through                                                                               Set if set on all, otherwise 0

  0x80000002                Processor name string identifier                                                                                                                                                                                                             

  EAX                       Processor Brand String                                                                                             0               31            Pass through                                                                               Pass through value from processor 0

  EBX                       Processor Brand String                                                                                             0               31            Pass through                                                                               Pass through value from processor 0

  ECX                       Processor Brand String                                                                                             0               31            Pass through                                                                               Pass through value from processor 0

  EDX                       Processor Brand String                                                                                             0               31            Pass through                                                                               Pass through value from processor 0

  0x80000003                Processor name string identifier                                                                                                                                                                                                             

  EAX                       Processor Brand String                                                                                             0               31            Pass through                                                                               Pass through value from processor 0

  EBX                       Processor Brand String                                                                                             0               31            Pass through                                                                               Pass through value from processor 0

  ECX                       Processor Brand String                                                                                             0               31            Pass through                                                                               Pass through value from processor 0

  EDX                       Processor Brand String                                                                                             0               31            Pass through                                                                               Pass through value from processor 0

  0x80000004                Processor name string identifier                                                                                                                                                                                                             

  EAX                       Processor Brand String                                                                                             0               31            Pass through                                                                               Pass through value from processor 0

  EBX                       Processor Brand String                                                                                             0               31            Pass through                                                                               Pass through value from processor 0

  ECX                       Processor Brand String                                                                                             0               31            Pass through                                                                               Pass through value from processor 0

  EDX                       Processor Brand String                                                                                             0               31            Pass through                                                                               Pass through value from processor 0

  0x80000005                L1 Cache and TLB identifiers (all registers)                                                                                                                                                                                                 

  EAX                       L1ITlb2and4MSize                                                                                                   0               7             Pass through                                                                               Pass through

                            L1ITlb2and4MAssoc                                                                                                  8               15            Pass through                                                                               Pass through

                            L1DTlb2and4MSize                                                                                                   16              23            Pass through                                                                               Pass through

                            L1DTlb2and4MAssoc                                                                                                  24              31            Pass through                                                                               Pass through

  EBX                       L1ITlb4KSize                                                                                                       0               7             Pass through                                                                               Pass through

                            L1ITlb4KAssoc                                                                                                      8               15            Pass through                                                                               Pass through

                            L1DTlb4KSize                                                                                                       16              23            Pass through                                                                               Pass through

                            L1DTlb4KAssoc                                                                                                      24              31            Pass through                                                                               Pass through

  ECX                       L1DcLineSize                                                                                                       0               7             Pass through                                                                               Pass through

                            L1DcLinesPerTag                                                                                                    8               15            Pass through                                                                               Pass through

                            L1DcAssoc                                                                                                          16              23            Pass through                                                                               Pass through

                            L1DcSize                                                                                                           24              31            Pass through                                                                               Pass through

  EDX                       L1IcLineSize                                                                                                       0               7             Pass through                                                                               Pass through

                            L1IcLinesPerTag                                                                                                    8               15            Pass through                                                                               Pass through

                            L1IcAssoc                                                                                                          16              23            Pass through                                                                               Pass through

                            L1IcSize                                                                                                           24              31            Pass through                                                                               Pass through

  0x80000006                L2 Cache and L2 TLB identifiers                                                                                                                                                                                                              

  EAX                       L2ITlb2and4MSize                                                                                                   0               11            Pass through                                                                               Pass through

                            L2ITlb2and4MAssoc                                                                                                  12              15            Pass through                                                                               Pass through

                            L2DTlb2and4MSize                                                                                                   16              27            Pass through                                                                               Pass through

                            L2DTlb2and4MAssoc                                                                                                  28              31            Pass through                                                                               Pass through

  EBX                       L2ITlb4KSize                                                                                                       0               11            Pass through                                                                               Pass through

                            L2ITlb4KAssoc                                                                                                      12              15            Pass through                                                                               Pass through

                            L2DTlb4KSize                                                                                                       16              27            Pass through                                                                               Pass through

                            L2DTlb4KAssoc                                                                                                      28              31            Pass through                                                                               Pass through

  ECX                       L2 Line Size                                                                                                       0               7             Pass through                                                                               Pass through

                            L2 Lines per tag                                                                                                   8               11            Pass through                                                                               Pass through

                            L2 Associativity                                                                                                   12              15            Pass through                                                                               Pass through

                            L2 cache size in kilobytes                                                                                         16              31            Pass through                                                                               Pass through

  EDX                       L3LineSize                                                                                                         0               7             Pass through                                                                               Pass through

                            L3LinesPerTag                                                                                                      8               11            Pass through                                                                               Pass through

                            L3Assoc                                                                                                            12              15            Pass through                                                                               Pass through

                            RsvdZ                                                                                                              16              17            Pass through                                                                               Pass through

                            L3Size                                                                                                             18              31            Pass through                                                                               Pass through

  0x80000007                Advanced Power Management Information                                                                                                                                                                                                        

  EAX                       RsvdZ                                                                                                              0               31            Cleared                                                                                    Cleared

  EBX                       RsvdZ                                                                                                              0               31            Cleared                                                                                    Cleared

  ECX                       RsvdZ                                                                                                              0               31            Cleared                                                                                    Cleared

  EDX                       TS                                                                                                                 0               0             Pass through                                                                               Cleared

                            FID                                                                                                                1               1             Pass through                                                                               Cleared

                            VID                                                                                                                2               2             Pass through                                                                               Cleared

                            TTP                                                                                                                3               3             Pass through                                                                               Cleared

                            TM                                                                                                                 4               4             Pass through                                                                               Cleared

                            STC                                                                                                                5               5             Pass through                                                                               Cleared

                            100MhzSteps                                                                                                        6               6             Pass through                                                                               Cleared

                            HwPState                                                                                                           7               7             Pass through                                                                               Cleared

                            TscInvariant                                                                                                       8               8             Pass through                                                                               Cleared

                            RsvdZ                                                                                                              9               31            Cleared                                                                                    Cleared

  0x80000008                                                                                                                                                                                                                                                             

  EAX                       PhysAddrSize                                                                                                       0               7             Pass through                                                                               The size of the physical GPA space that is supported

                            LinAddrSize                                                                                                        8               15            Pass through                                                                               The size of the virtual GPA space that is supported

                            RsvdZ                                                                                                              16              31            Cleared                                                                                    Cleared

  EBX                       RsvdZ                                                                                                              0               31            Cleared                                                                                    Cleared

  ECX                       NC                                                                                                                 0               7             Pass through                                                                               Pass through

                            RsvdZ                                                                                                              8               11            Cleared                                                                                    Cleared

                            ApicIdCoreIdSize                                                                                                   12              15            Pass through                                                                               Pass through

                            RsvdZ                                                                                                              16              31            Cleared                                                                                    Cleared

  EDX                       RsvdZ                                                                                                              0               31            Cleared                                                                                    Cleared

  0x80000009                                                                                                                                                                                                                                                             

  EAX                       RsvdZ                                                                                                              0               31            Cleared                                                                                    Cleared

  EBX                       RsvdZ                                                                                                              0               31            Cleared                                                                                    Cleared

  ECX                       RsvdZ                                                                                                              0               31            Cleared                                                                                    Cleared

  EDX                       RsvdZ                                                                                                              0               31            Cleared                                                                                    Cleared

  0x8000000A                SVM revision and feature identification                                                                                                                                                                                                      

  EAX                       SvmRev                                                                                                             0               7             Cleared                                                                                    Cleared

                            RsvdZ                                                                                                              8               31            Cleared                                                                                    Cleared

  EBX                       NASID                                                                                                              0               31            Cleared                                                                                    Cleared

  ECX                       RsvdZ                                                                                                              0               31            Cleared                                                                                    Cleared

  EDX                       NP                                                                                                                 0               0             Cleared                                                                                    Cleared

                            LBRVirt                                                                                                            1               1             Cleared                                                                                    Cleared

                            SVML                                                                                                               2               2             Cleared                                                                                    Cleared

                            NRIPS                                                                                                              3               3             Cleared                                                                                    Cleared

                            RsvdZ                                                                                                              4               31            Cleared                                                                                    Cleared

  0x8000000B                                                                                                                                                                                                                                                             

  EAX                       RsvdZ                                                                                                              0               31            Cleared                                                                                    Cleared

  EBX                       RsvdZ                                                                                                              0               31            Cleared                                                                                    Cleared

  ECX                       RsvdZ                                                                                                              0               31            Cleared                                                                                    Cleared

  EDX                       RsvdZ                                                                                                              0               31            Cleared                                                                                    Cleared

  0x8000000C                                                                                                                                                                                                                                                             

  EAX                       RsvdZ                                                                                                              0               31            Cleared                                                                                    Cleared

  EBX                       RsvdZ                                                                                                              0               31            Cleared                                                                                    Cleared

  ECX                       RsvdZ                                                                                                              0               31            Cleared                                                                                    Cleared

  EDX                       RsvdZ                                                                                                              0               31            Cleared                                                                                    Cleared

  0x8000000D                                                                                                                                                                                                                                                             

  EAX                       RsvdZ                                                                                                              0               31            Cleared                                                                                    Cleared

  EBX                       RsvdZ                                                                                                              0               31            Cleared                                                                                    Cleared

  ECX                       RsvdZ                                                                                                              0               31            Cleared                                                                                    Cleared

  EDX                       RsvdZ                                                                                                              0               31            Cleared                                                                                    Cleared

  0x8000000E                                                                                                                                                                                                                                                             

  EAX                       RsvdZ                                                                                                              0               31            Cleared                                                                                    Cleared

  EBX                       RsvdZ                                                                                                              0               31            Cleared                                                                                    Cleared

  ECX                       RsvdZ                                                                                                              0               31            Cleared                                                                                    Cleared

  EDX                       RsvdZ                                                                                                              0               31            Cleared                                                                                    Cleared

  0x8000000F                                                                                                                                                                                                                                                             

  EAX                       RsvdZ                                                                                                              0               31            Cleared                                                                                    Cleared

  EBX                       RsvdZ                                                                                                              0               31            Cleared                                                                                    Cleared

  ECX                       RsvdZ                                                                                                              0               31            Cleared                                                                                    Cleared

  EDX                       RsvdZ                                                                                                              0               31            Cleared                                                                                    Cleared

  0x80000010                                                                                                                                                                                                                                                             

  EAX                       RsvdZ                                                                                                              0               31            Cleared                                                                                    Cleared

  EBX                       RsvdZ                                                                                                              0               31            Cleared                                                                                    Cleared

  ECX                       RsvdZ                                                                                                              0               31            Cleared                                                                                    Cleared

  EDX                       RsvdZ                                                                                                              0               31            Cleared                                                                                    Cleared

  0x80000011                                                                                                                                                                                                                                                             

  EAX                       RsvdZ                                                                                                              0               31            Cleared                                                                                    Cleared

  EBX                       RsvdZ                                                                                                              0               31            Cleared                                                                                    Cleared

  ECX                       RsvdZ                                                                                                              0               31            Cleared                                                                                    Cleared

  EDX                       RsvdZ                                                                                                              0               31            Cleared                                                                                    Cleared

  0x80000012                                                                                                                                                                                                                                                             

  EAX                       RsvdZ                                                                                                              0               31            Cleared                                                                                    Cleared

  EBX                       RsvdZ                                                                                                              0               31            Cleared                                                                                    Cleared

  ECX                       RsvdZ                                                                                                              0               31            Cleared                                                                                    Cleared

  EDX                       RsvdZ                                                                                                              0               31            Cleared                                                                                    Cleared

  0x80000013                                                                                                                                                                                                                                                             

  EAX                       RsvdZ                                                                                                              0               31            Cleared                                                                                    Cleared

  EBX                       RsvdZ                                                                                                              0               31            Cleared                                                                                    Cleared

  ECX                       RsvdZ                                                                                                              0               31            Cleared                                                                                    Cleared

  EDX                       RsvdZ                                                                                                              0               31            Cleared                                                                                    Cleared

  0x80000014                                                                                                                                                                                                                                                             

  EAX                       RsvdZ                                                                                                              0               31            Cleared                                                                                    Cleared

  EBX                       RsvdZ                                                                                                              0               31            Cleared                                                                                    Cleared

  ECX                       RsvdZ                                                                                                              0               31            Cleared                                                                                    Cleared

  EDX                       RsvdZ                                                                                                              0               31            Cleared                                                                                    Cleared

  0x80000015                                                                                                                                                                                                                                                             

  EAX                       RsvdZ                                                                                                              0               31            Cleared                                                                                    Cleared

  EBX                       RsvdZ                                                                                                              0               31            Cleared                                                                                    Cleared

  ECX                       RsvdZ                                                                                                              0               31            Cleared                                                                                    Cleared

  EDX                       RsvdZ                                                                                                              0               31            Cleared                                                                                    Cleared

  0x80000016                                                                                                                                                                                                                                                             

  EAX                       RsvdZ                                                                                                              0               31            Cleared                                                                                    Cleared

  EBX                       RsvdZ                                                                                                              0               31            Cleared                                                                                    Cleared

  ECX                       RsvdZ                                                                                                              0               31            Cleared                                                                                    Cleared

  EDX                       RsvdZ                                                                                                              0               31            Cleared                                                                                    Cleared

  0x80000017                                                                                                                                                                                                                                                             

  EAX                       RsvdZ                                                                                                              0               31            Cleared                                                                                    Cleared

  EBX                       RsvdZ                                                                                                              0               31            Cleared                                                                                    Cleared

  ECX                       RsvdZ                                                                                                              0               31            Cleared                                                                                    Cleared

  EDX                       RsvdZ                                                                                                              0               31            Cleared                                                                                    Cleared

  0x80000018                                                                                                                                                                                                                                                             

  EAX                       RsvdZ                                                                                                              0               31            Cleared                                                                                    Cleared

  EBX                       RsvdZ                                                                                                              0               31            Cleared                                                                                    Cleared

  ECX                       RsvdZ                                                                                                              0               31            Cleared                                                                                    Cleared

  EDX                       RsvdZ                                                                                                              0               31            Cleared                                                                                    Cleared

  0x80000019                                                                                                                                                                                                                                                             

  EAX                       L1ITlb1GSize                                                                                                       0               11            Cleared                                                                                    Cleared

                            L1ITlb1GAssoc                                                                                                      12              15            Cleared                                                                                    Cleared

                            L1DTlb1GSize                                                                                                       16              27            Cleared                                                                                    Cleared

                            L1DTlb1GAssoc                                                                                                      28              31            Cleared                                                                                    Cleared

  EBX                       L2ITlb1GSize                                                                                                       0               11            Cleared                                                                                    Cleared

                            L2ITlb1GAssoc                                                                                                      12              15            Cleared                                                                                    Cleared

                            L2DTlb1GSize                                                                                                       16              27            Cleared                                                                                    Cleared

                            L2DTlb1GAssoc                                                                                                      28              31            Cleared                                                                                    Cleared

  ECX                       RsvdZ                                                                                                              0               31            Cleared                                                                                    Cleared

  EDX                       RsvdZ                                                                                                              0               31            Cleared                                                                                    Cleared

  0x8000001A                                                                                                                                                                                                                                                             

  EAX                       FP128                                                                                                              0               0             Pass through                                                                               Set if set on all, otherwise 0

                            MOVU                                                                                                               1               1             Pass through                                                                               Set if set on all, otherwise 0

                            RsvdZ                                                                                                              2               31            Cleared                                                                                    Cleared

  EBX                       RsvdZ                                                                                                              0               31            Cleared                                                                                    Cleared

  ECX                       RsvdZ                                                                                                              0               31            Cleared                                                                                    Cleared

  EDX                       RsvdZ                                                                                                              0               31            Cleared                                                                                    Cleared
  --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

<span id="_Ref192575130" class="anchor"><span id="_Toc221334070" class="anchor"><span id="_Toc222907539" class="anchor"><span id="_Toc342653315" class="anchor"><span id="_Toc439864350" class="anchor"></span></span></span></span></span>Appendix E: Boot-time CPUID Feature Requirements
===========================================================================================================================================================================================================================================================================================

<span id="_Toc222907540" class="anchor"></span>The table below contains
a list of CPUID values required for the hypervisor to boot.

  ------------------------------------------------------------------------------------------------------------------------------------------------------------------
  Index and\   Name                                           Start bit   End\   Virtualized feature set definition between processors in the same system
  Register                                                                bit    
  ------------ ---------------------------------------------- ----------- ------ -----------------------------------------------------------------------------------
  0x00000000                                                                     

  EAX          Maximum valid standard CPUID index             0           31     Hardware-specific
                                                                                 
                                                                                 If the underlying hardware is AMD-based, the value must be at least 0x00000001.
                                                                                 
                                                                                 If the underlying hardware is Intel-based, the value must be at least 0x00000004.

  EBX          Processor vendor string                        0           31     Must match

  ECX          Processor vendor string                        0           31     Must match

  EDX          Processor vendor string                        0           31     Must match

  0x00000001                                                                      

  EAX          Stepping                                       0           3      --

               Base Model                                     4           7      Must match

               Base Family                                    8           11     Must match

               Processor Type                                 12          13     Must match

               RsvdZ                                          14          15     --

               Extended Model                                 16          19     Must match

               Extended Family                                20          27     Must match

               RsvdZ                                          28          31     --

  EBX          Miscellaneous Information                                         

               Brand Identifier                               0           7      --

               CL Flush size                                  8           15     Must match

               Maximum LPs in a physical package              16          23     Must match

               Initial APIC ID                                24          31     --

  ECX          Feature Flags / Identifiers                                       

               SSE3                                           0           0      --

               RsvdZ                                          1           2      --

               MONITOR                                        3           3      --

               DS-CPL                                         4           4      --

               VMX                                            5           5      Must be set everywhere on Intel,
                                                                                 
                                                                                 Ignore on AMD

               RsvdZ                                          6           6      --

               EST                                            7           7      --

               TM2                                            8           8      --

               SSSE3                                          9           9      --

               CNXTID                                         10          10     --

               RsvdZ                                          11          12     --

               CMPXCHG16B                                     13          13     --

               xTPR                                           14          14     --

               RsvdZ                                          15          22     --

               Population Count                               23          23     --

                                                                          25     

               XSAVE                                          26          26     Must match

               OSXSAVE                                        27          27     Must match

               RsvdZ                                          28          30     --

               Hypervisor Present                             31          31     Must be cleared everywhere

  EDX          Feature Information                                               

               FPU                                            0           0      Must be set everywhere

               VME                                            1           1      Must be set everywhere

               DE                                             2           2      Must be set everywhere

               PSE                                            3           3      Must be set everywhere

               TSC                                            4           4      Must be set everywhere

               MSR                                            5           5      Must be set everywhere

               PAE                                            6           6      Must be set everywhere

               MCE                                            7           7      Must be set everywhere

               CMPXCHG8B                                      8           8      Must be set everywhere

               APIC                                           9           9      Must be set everywhere

               RsvdZ                                          10          10     --

               SEP                                            11          11     Must be set everywhere

               MTRR                                           12          12     Must be set everywhere

               PGE                                            13          13     Must be set everywhere

               MCA                                            14          14     Must be set everywhere

               CMOV                                           15          15     Must be set everywhere

               PAT                                            16          16     Must be set everywhere

               PSE-36                                         17          17     Must be set everywhere

               PSN                                            18          18     --

               CLFSH                                          19          19     Must be set everywhere

               RsvdZ                                          20          20     --

               DS                                             21          21     --

               ACPI                                           22          22     --

               MMX                                            23          23     Must be set everywhere

               FXSR                                           24          24     Must be set everywhere

               SSE                                            25          25     Must be set everywhere

               SSE2                                           26          26     Must be set everywhere

               SS                                             27          27     --

               HTT                                            28          28     --

               TM                                             29          29     --

               RsvdZ                                          30          30     --

               PBE                                            31          31     --

  0x80000000                                                                      

  EAX          Highest Extended CPUID Leaf                    0           31     Hardware specific.
                                                                                 
                                                                                 If the underlying hardware is AMD-based, the value must be at least 0x80000008.
                                                                                 
                                                                                 If the underlying hardware is Intel based, the value must be at least 0x80000001

  EBX          Processor vendor string                        0           31     --

  ECX          Processor vendor string                        0           31     --

  EDX          Processor vendor string                        0           31     --

  0x80000001                                                                      

  EAX          Stepping                                       0           3      --

               Base Model                                     4           7      Must match

               Base Family                                    8           11     Must match

               Processor Type                                 12          13     Must match

               RsvdZ                                          14          15     --

               Extended Model                                 16          19     Must match

               Extended Family                                20          27     Must match

               RsvdZ                                          28          31     --

  EBX          Brand ID                                       0           15     Must match

               RsvdZ                                          16          27     --

               Package Type                                   28          31     Must match

  ECX          Extended feature flag / feature identifiers                       

               LahfSahf                                       0           0      --

               CmpLegacy                                      1           1      --

               SVM                                            2           2      Must be set everywhere on AMD,
                                                                                 
                                                                                 Ignore on Intel

               ExtApicSpace                                   3           3      --

               AltMovCr8                                      4           4      --

               ABM                                            5           5      --

               SSE4A                                          6           6      --

               MisAlignSse                                    7           7      --

               3DNowPrefetch                                  8           8      --

               OSVW                                           9           9      --

               RsvdZ                                          10          10     --

               SSE5                                           11          11     --

               SKINIT                                         12          12     --

               WDT                                            13          13     --

               RsvdZ                                          14          31     --

  EDX          Extended feature flags                                            

               FPU                                            0           0      Must be set everywhere

               VME                                            1           1      Must be set everywhere

               DE                                             2           2      Must be set everywhere

               PSE                                            3           3      Must be set everywhere

               TSC                                            4           4      Must be set everywhere

               MSR                                            5           5      Must be set everywhere

               PAE                                            6           6      Must be set everywhere

               MCE                                            7           7      Must be set everywhere

               CMPXCHG8B                                      8           8      Must be set everywhere

               APIC                                           9           9      Must be set everywhere

               RsvdZ                                          10          10     --

               SysCallSysRet                                  11          11     Must be set everywhere

               MTRR                                           12          12     Must be set everywhere

               PGE                                            13          13     Must be set everywhere

               MCA                                            14          14     Must be set everywhere

               CMOV                                           15          15     Must be set everywhere

               PAT                                            16          16     Must be set everywhere

               PSE36                                          17          17     Must be set everywhere

               RsvdZ                                          18          19     --

               Execute disabled / No execute                  20          20     Must be set everywhere

               RsvdZ                                          21          21     --

               MmxExt                                         22          22     --

               MMX                                            23          23     Must be set everywhere

               FXSR                                           24          24     Must be set everywhere

               FFXSR                                          25          25     --

               Page1GB                                        26          26     --

               RDTSCP                                         27          27     --

               RsvdZ                                          28          28     --

               LM                                             29          29     Must be set everywhere

               3DNowExt                                       30          30     --

               3DNow                                          31          31     --

  0x80000005   L1 Cache and TLB identifiers (all registers)                       

  EAX          L1ITlb2and4MSize                               0           7      Must match on AMD,
                                                                                 
                                                                                 Ignore on Intel

               L1ITlb2and4MAssoc                              8           15     Must match on AMD,
                                                                                 
                                                                                 Ignore on Intel

               L1DTlb2and4MSize                               16          23     Must match on AMD,
                                                                                 
                                                                                 Ignore on Intel

               L1DTlb2and4MAssoc                              24          31     Must match on AMD,
                                                                                 
                                                                                 Ignore on Intel

  EBX          L1ITlb4KSize                                   0           7      Must match on AMD,
                                                                                 
                                                                                 Ignore on Intel

               L1ITlb4KAssoc                                  8           15     Must match on AMD,
                                                                                 
                                                                                 Ignore on Intel

               L1DTlb4KSize                                   16          23     Must match on AMD,
                                                                                 
                                                                                 Ignore on Intel

               L1DTlb4KAssoc                                  24          31     Must match on AMD,
                                                                                 
                                                                                 Ignore on Intel

  ECX          L1DcLineSize                                   0           7      Must match on AMD,
                                                                                 
                                                                                 Ignore on Intel

               L1DcLinesPerTag                                8           15     Must match on AMD,
                                                                                 
                                                                                 Ignore on Intel

               L1DcAssoc                                      16          23     Must match on AMD,
                                                                                 
                                                                                 Ignore on Intel

               L1DcSize                                       24          31     Must match on AMD,
                                                                                 
                                                                                 Ignore on Intel

  EDX          L1IcLineSize                                   0           7      Must match on AMD,
                                                                                 
                                                                                 Ignore on Intel

               L1IcLinesPerTag                                8           15     Must match on AMD,
                                                                                 
                                                                                 Ignore on Intel

               L1IcAssoc                                      16          23     Must match on AMD,
                                                                                 
                                                                                 Ignore on Intel

               L1IcSize                                       24          31     Must match on AMD,
                                                                                 
                                                                                 Ignore on Intel

  0x80000006   L2 Cache and L2 TLB identifiers                                    

  EAX          L2ITlb2and4MSize                               0           11     Must match on AMD,
                                                                                 
                                                                                 Ignore on Intel

               L2ITlb2and4MAssoc                              12          15     Must match on AMD,
                                                                                 
                                                                                 Ignore on Intel

               L2DTlb2and4MSize                               16          27     Must match on AMD,
                                                                                 
                                                                                 Ignore on Intel

               L2DTlb2and4MAssoc                              28          31     Must match on AMD,
                                                                                 
                                                                                 Ignore on Intel

  EBX          L2ITlb4KSize                                   0           11     Must match on AMD,
                                                                                 
                                                                                 Ignore on Intel

               L2ITlb4KAssoc                                  12          15     Must match on AMD,
                                                                                 
                                                                                 Ignore on Intel

               L2DTlb4KSize                                   16          27     Must match on AMD,
                                                                                 
                                                                                 Ignore on Intel

               L2DTlb4KAssoc                                  28          31     Must match on AMD,
                                                                                 
                                                                                 Ignore on Intel

  ECX          L2 Line Size                                   0           7      Must match

               L2 Lines per tag                               8           11     Must match

               L2 Associativity                               12          15     Must match

               L2 cache size in kilobytes                     16          31     Must match

  EDX          L3LineSize                                     0           7      Must match on AMD,
                                                                                 
                                                                                 Ignore on Intel

               L3LinesPerTag                                  8           11     Must match on AMD,
                                                                                 
                                                                                 Ignore on Intel

               L3Assoc                                        12          15     Must match on AMD,
                                                                                 
                                                                                 Ignore on Intel

               RsvdZ                                          16          17     Must match on AMD,
                                                                                 
                                                                                 Ignore on Intel

               L3Size                                         18          31     Must match on AMD,
                                                                                 
                                                                                 Ignore on Intel

  0x80000008                                                                      

  EAX          PhysAddrSize                                   0           7      Must be less than or equal to 48

               LinAddrSize                                    8           15     --

               RsvdZ                                          16          31     --

  EBX          RsvdZ                                          0           31     --

  ECX          NC                                             0           7      Must match on AMD,
                                                                                 
                                                                                 Ignore on Intel

               RsvdZ                                          8           11     --

               ApicIdCoreIdSize                               12          15     Must match on AMD,
                                                                                 
                                                                                 Ignore on Intel

               RsvdZ                                          16          31     --

  EDX          RsvdZ                                          0           31     --

  0x8000000A   SVM revision and feature identification                            

  EAX          SvmRev                                         0           7      Must match on AMD,
                                                                                 
                                                                                 Ignore on Intel

               RsvdZ                                          8           31     --

  EBX          NASID                                          0           31     Must match on AMD,
                                                                                 
                                                                                 Ignore on Intel

  ECX          RsvdZ                                          0           31     --

  EDX          NP                                             0           0      --

               LBRVirt                                        1           1      --

               SVML                                           2           2      --

               NRIPS                                          3           3      --

               RsvdZ                                          4           31     --
  ------------------------------------------------------------------------------------------------------------------------------------------------------------------

<span id="_Toc342571062" class="anchor"><span id="_Toc342653316" class="anchor"><span id="_Toc342571063" class="anchor"><span id="_Toc342653317" class="anchor"><span id="_Toc342571064" class="anchor"><span id="_Toc342653318" class="anchor"><span id="_Toc221334072" class="anchor"><span id="_Ref221338020" class="anchor"><span id="_Toc222907541" class="anchor"><span id="_Toc342653319" class="anchor"><span id="_Toc439864351" class="anchor"></span></span></span></span></span></span></span></span></span></span></span>Appendix F: Architectural MSRs
===================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================

<span id="_Toc222907542" class="anchor"></span>The table below contains
a list of architectural MSRs and how they are handled by the hypervisor.
The default behavior for MSRs not listed here is pass through to
hardware for root, and \#GP for non-root.

  MSR Number   MSR Name                         Root           Non-Root
  ------------ -------------------------------- -------------- ------------
  0x010        X64\_MSR\_TIME\_STAMP\_COUNTER   Virtual TSC    Virtualize
  0x01B        X64\_MSR\_APIC\_BASE             Virtualize     Virtualize
  0x0FE        X64\_MSR\_MTRRCAP                Pass through   Virtualize
  0x174        X64\_MSR\_SYSENTER\_CS           Virtualize     Virtualize
  0x175        X64\_MSR\_SYSENTER\_ESP          Virtualize     Virtualize
  0x176        X64\_MSR\_SYSENTER\_EIP          Virtualize     Virtualize
  0x179        X64\_MSR\_MCG\_CAP               Pass through   0
  0x17A        X64\_MSR\_MCG\_STATUS            Virtualize     Virtualize
  0x1D9        X64\_MSR\_DEBUG\_CTL             Virtualize     Virtualize
  0x200        X64\_MSR\_MTRR\_PHYSBASE0        Pass through   Virtualize
  0x201        X64\_MSR\_MTRR\_PHYSMASK0        Pass through   Virtualize
  0x202        X64\_MSR\_MTRR\_PHYSBASE1        Pass through   Virtualize
  0x203        X64\_MSR\_MTRR\_PHYSMASK1        Pass through   Virtualize
  0x204        X64\_MSR\_MTRR\_PHYSBASE2        Pass through   Virtualize
  0x205        X64\_MSR\_MTRR\_PHYSMASK2        Pass through   Virtualize
  0x206        X64\_MSR\_MTRR\_PHYSBASE3        Pass through   Virtualize
  0x207        X64\_MSR\_MTRR\_PHYSMASK3        Pass through   Virtualize
  0x208        X64\_MSR\_MTRR\_PHYSBASE4        Pass through   Virtualize
  0x209        X64\_MSR\_MTRR\_PHYSMASK4        Pass through   Virtualize
  0x20A        X64\_MSR\_MTRR\_PHYSBASE5        Pass through   Virtualize
  0x20B        X64\_MSR\_MTRR\_PHYSMASK5        Pass through   Virtualize
  0x20C        X64\_MSR\_MTRR\_PHYSBASE6        Pass through   Virtualize
  0x20D        X64\_MSR\_MTRR\_PHYSMASK6        Pass through   Virtualize
  0x20E        X64\_MSR\_MTRR\_PHYSBASE7        Pass through   Virtualize
  0x20F        X64\_MSR\_MTRR\_PHYSMASK7        Pass through   Virtualize
  0x250        X64\_MSRMTRR\_FIX64K\_00000      Pass through   Virtualize
  0x258        X64\_MSR\_MTRR\_FIX16K\_80000    Pass through   Virtualize
  0x259        X64\_MSR\_MTRR\_FIX16K\_A0000    Pass through   Virtualize
  0x268        X64\_MSR\_MTRR\_FIX4K\_C0000     Pass through   Virtualize
  0x269        X64\_MSR\_MTRR\_FIX4K\_C8000     Pass through   Virtualize
  0x26A        X64\_MSR\_MTRR\_FIX4K\_D0000     Pass through   Virtualize
  0x26B        X64\_MSR\_MTRR\_FIX4K\_D8000     Pass through   Virtualize
  0x26C        X64\_MSR\_MTRR\_FIX4K\_E0000     Pass through   Virtualize
  0x26D        X64\_MSR\_MTRR\_FIX4K\_E8000     Pass through   Virtualize
  0x26E        X64\_MSR\_MTRR\_FIX4K\_F0000     Pass through   Virtualize
  0x26F        X64\_MSR\_MTRR\_FIX4K\_F8000     Pass through   Virtualize
  0x277        X64\_MSR\_CR\_PAT                Virtualize     Virtualize
  0x2FF        X64\_MSR\_MTRR\_DEF\_TYPE        Pass through   Virtualize
  0xC0000080   X64\_MSR\_EFER                   Virtualize     Virtualize
  0xC0000081   X64\_MSR\_STAR                   Virtualize     Virtualize
  0xC0000082   X64\_MSR\_LSTAR                  Virtualize     Virtualize
  0xC0000083   X64\_MSR\_CSTAR                  Virtualize     Virtualize
  0xC0000084   X64\_MSR\_SFMASK                 Virtualize     Virtualize
  0xC0000100   X64\_MSR\_FS\_BASE               Virtualize     Virtualize
  0xC0000101   X64\_MSR\_GS\_BASE               Virtualize     Virtualize
  0xC0000102   X64\_MSR\_KERNEL\_GS\_BASE       Virtualize     Virtualize

<span id="_Toc342571066" class="anchor"><span id="_Toc342653320" class="anchor"><span id="_Toc221334074" class="anchor"><span id="_Toc222907543" class="anchor"><span id="_Toc342653321" class="anchor"><span id="_Toc439864352" class="anchor"></span></span></span></span></span></span>Appendix G: Vendor-Specific MSRs
==========================================================================================================================================================================================================================================================================================================================

<span id="_Toc222907545" class="anchor"></span>**G.1 AMD-specific MSRs**

The table below contains a list of AMD-specific MSRs and how they are
handled by the hypervisor.

The default behavior for MSRs not listed here is Pass through to
hardware for root, and \#GP for non-root.

  ----------------------------------------------------------------------
  **MSR Number**   **MSR Name**        **Root**       **Non-Root**
  ---------------- ------------------- -------------- ------------------
  0xC0010010       AMD\_MSR\_SYSCFG    Pass through   Reads return 0.\
                                                      Writes ignored.

  0xC001001F       AMD\_MSR\_NB\_CFG   Pass through   Reads return 0.\
                                                      Writes ignored.
  ----------------------------------------------------------------------

<span id="_Toc222907546" class="anchor"></span>**G.2 Intel-specific
MSRs**

The table below contains a list of Intel-specific MSRs and how they are
handled by the hypervisor.

The default behavior for MSRs not listed here is Pass through to
hardware for root, and \#GP for non-root.

  ---------------------------------------------------------------------------------------------------------------------------------------------------
  **MSR Number**   **MSR Name**                          **Root**       **Non-Root**
  ---------------- ------------------------------------- -------------- -----------------------------------------------------------------------------
  0x006            INTEL\_MSR\_MONITOR\_FILTER\_SIZE     \#GP           \#GP

  0x017            INTEL\_MSR\_PLATFORM\_ID              Pass through   Reads return 0.
                                                                        
                                                                        Writes ignored.

  0x03A            INTEL\_MSR\_FEATURE\_CONTROL          \#GP           \#GP

  0x079            INTEL\_MSR\_BIOS\_UPDT\_TRIG          Virtualize     Reads return 0.
                                                                        
                                                                        Writes ignored.

  0x08B            INTEL\_MSR\_BIOS\_SIGN\_ID            Pass through   Reads return 8FFFFFFF indicating the best possible patch is already loaded.
                                                                        
                                                                        Writes ignored.

  0x1A0            INTEL\_MSR\_MISC\_ENABLE              Pass through   Reads Pass through,\
                                                                        Writes ignored

  0x38D            INTEL\_MSR\_PERF\_CAPABILITIES        \#GP           \#GP

  0x38E            INTEL\_MSR\_PER\_GLOBAL\_STATUS       \#GP           \#GP

  0x38F            INTEL\_MSR\_PERF\_GLOBAL\_CTRL        \#GP           \#GP

  0x390            INTEL\_MSR\_PERF\_GLOBAL\_OVF\_CTRL   \#GP           \#GP

  0x3F1            INTEL\_MSR\_PEBS\_ENABLE              \#GP           \#GP

  0x480 – 0x48A    INTEL\_MSR\_VMX\_CAPSx                \#GP           \#GP

  0x600            INTEL\_MSR\_DS\_AREA                  \#GP           \#GP
  ---------------------------------------------------------------------------------------------------------------------------------------------------

<span id="_Toc222907547" class="anchor"><span id="_Toc342653322" class="anchor"><span id="_Toc439864353" class="anchor"></span></span></span>Appendix H: Hypervisor Synthetic MSRs
==================================================================================================================================================================================

<span id="_Toc127596951" class="anchor"><span id="_Toc128290341"
class="anchor"><span id="_Toc130201478" class="anchor"><span
id="_Toc131937059" class="anchor"><span id="_Toc133901351"
class="anchor"><span id="_Toc137461225" class="anchor"><span
id="_Toc139096740" class="anchor"><span id="_Toc139188663"
class="anchor"><span id="_Toc139191526" class="anchor"><span
id="_Toc140571480" class="anchor"><span id="_Toc141257757"
class="anchor"><span id="_Toc141267608" class="anchor"><span
id="_Toc141522626" class="anchor"><span id="_Toc141530032"
class="anchor"><span id="_Toc141852577" class="anchor"><span
id="_Toc141888121" class="anchor"><span id="_Toc141889962"
class="anchor"><span id="_Toc141893631" class="anchor"><span
id="_Toc142113484" class="anchor"><span id="_Toc142114512"
class="anchor"><span id="_Toc142729710" class="anchor"><span
id="_Toc142730994" class="anchor"><span id="_Toc142731367"
class="anchor"><span id="_Toc142998734" class="anchor"><span
id="_Toc143063826" class="anchor"><span id="_Toc143509935"
class="anchor"><span id="_Toc143510383" class="anchor"><span
id="_Toc144026428" class="anchor"><span id="_Toc144026759"
class="anchor"><span id="_Toc144276414" class="anchor"><span
id="_Toc144276758" class="anchor"><span id="_Toc144280346"
class="anchor"><span id="_Toc144280692" class="anchor"><span
id="_Toc144540930" class="anchor"><span id="_Toc144554833"
class="anchor"><span id="_Toc144722421" class="anchor"><span
id="_Toc145503884" class="anchor"><span id="_Toc145512304"
class="anchor"><span id="_Toc145513357" class="anchor"><span
id="_Toc145513741" class="anchor"><span id="_Toc221334079"
class="anchor"><span id="_Toc222907548"
class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>The
following is a table of new MSR values defined by the hypervisor.

  **MSR Number**   **MSR Name**                                     **Privilege Required (if any)**   **Access**   **Description**
  ---------------- ------------------------------------------------ --------------------------------- ------------ ------------------------------------------------------------------------------------------------------------------------------
  0x40000000       HV\_X64\_MSR\_GUEST\_OS\_ID                      AccessHypercallMsrs               R/W          Used to identify the guest OS running in the partition. See section 3.6.
  0x40000001       HV\_X64\_MSR\_HYPERCALL                          AccessHypercallMsrs               R/W          Used to enable the hypercall interface. See section 4.12.
  0x40000002       HV\_X64\_MSR\_VP\_INDEX                          AccessVpIndex                     R            Specifies the virtual processor’s index. See section 10.2.1.
  0x40000003       HV\_X64\_MSR\_RESET                              AccessSystemResetMsr              R/W          Used to perform a hypervisor-controlled reboot operation. See section 1.
  0x40000010       HV\_X64\_MSR\_VP\_RUNTIME                        AccessVpRuntimeMsr                R            Specifies the virtual processor’s run time in 100ns units. See section 10.3.1.
  0x40000020       HV\_X64\_MSR\_TIME\_REF\_COUNT                   AccessPartitionReferenceCounter   R            Partition-wide reference counter. See section 18.2.
  0x40000021       HV\_X64\_MSR\_REFERENCE\_TSC                     AccessPartitionReferenceCounter   R            Partition-wide reference time stamp counter. See section 18.4
  0x40000022       HV\_X64\_MSR\_TSC\_FREQUENCY                     AccessFrequencyRegs               R            <span id="a" class="anchor"></span>Specifies the frequency, in Hz, of the TSC, as reported by the hypervisor. See section 1.
  0x40000023       HV\_X64\_MSR\_APIC\_FREQUENCY                    AccessFrequencyRegs               R            Specifies the frequency, in Hz, of the local APIC, as reported by the hypervisor. See section 1.
  0x40000070       HV\_X64\_MSR\_EOI                                AccessApicMsrs                    W            Fast access to the APIC EOI register. See section 16.2.3.
  0x40000071       HV\_X64\_MSR\_ICR                                AccessApicMsrs                    R/W          Fast access to the APIC ICR high and ICR low registers. See section 16.2.3.
  0x40000072       HV\_X64\_MSR\_TPR                                AccessApicMsrs                    R/W          Fast access to the APIC TPR register (use CR8 in 64-bit mode). See section 16.2.3.
  0x40000073       HV\_X64\_MSR\_VP\_ASSIST\_PAGE                   AccessApicMsrs                    R/W          Enables lazy EOI processing. See section 16.3.4.
  0x40000080       HV\_X64\_MSR\_SCONTROL                           AccessSynicRegs                   R/W          Used to control specific behaviors of the synthetic interrupt controller. See section 17.6.1.
  0x40000081       HV\_X64\_MSR\_SVERSION                           AccessSynicRegs                   R            Specifies the SynIC version. See section 0.
  0x40000082       HV\_X64\_MSR\_SIEFP                              AccessSynicRegs                   R/W          Controls the base address of the synthetic interrupt event flag page. See section 17.6.2.
  0x40000083       HV\_X64\_MSR\_SIMP                               AccessSynicRegs                   R/W          Controls the base address of the synthetic interrupt parameter page. See section 17.6.3.
  0x40000084       HV\_X64\_MSR\_EOM                                AccessSynicRegs                   W            Indicates the end of message in the SynIC. See section 17.6.5.
  0x40000090       HV\_X64\_MSR\_SINT0                              AccessSynicRegs                   R/W          Configures synthetic interrupt source 0. See section 17.6.4.
  0x40000091       HV\_X64\_MSR\_SINT1                              AccessSynicRegs                   R/W          Configures synthetic interrupt source 1. See section 17.6.4.
  0x40000092       HV\_X64\_MSR\_SINT2                              AccessSynicRegs                   R/W          Configures synthetic interrupt source 2. See section 17.6.4.
  0x40000093       HV\_X64\_MSR\_SINT3                              AccessSynicRegs                   R/W          Configures synthetic interrupt source 3. See section 17.6.4.
  0x40000094       HV\_X64\_MSR\_SINT4                              AccessSynicRegs                   R/W          Configures synthetic interrupt source 4. See section 17.6.4.
  0x40000095       HV\_X64\_MSR\_SINT5                              AccessSynicRegs                   R/W          Configures synthetic interrupt source 5. See section 17.6.4.
  0x40000096       HV\_X64\_MSR\_SINT6                              AccessSynicRegs                   R/W          Configures synthetic interrupt source 6. See section 17.6.4.
  0x40000097       HV\_X64\_MSR\_SINT7                              AccessSynicRegs                   R/W          Configures synthetic interrupt source 7. See section 17.6.4.
  0x40000098       HV\_X64\_MSR\_SINT8                              AccessSynicRegs                   R/W          Configures synthetic interrupt source 8. See section 17.6.4.
  0x40000099       HV\_X64\_MSR\_SINT9                              AccessSynicRegs                   R/W          Configures synthetic interrupt source 9. See section 17.6.4.
  0x4000009A       HV\_X64\_MSR\_SINT10                             AccessSynicRegs                   R/W          Configures synthetic interrupt source 10. See section 17.6.4.
  0x4000009B       HV\_X64\_MSR\_SINT11                             AccessSynicRegs                   R/W          Configures synthetic interrupt source 11. See section 17.6.4.
  0x4000009C       HV\_X64\_MSR\_SINT12                             AccessSynicRegs                   R/W          Configures synthetic interrupt source 12. See section 17.6.4.
  0x4000009D       HV\_X64\_MSR\_SINT13                             AccessSynicRegs                   R/W          Configures synthetic interrupt source 13. See section 17.6.4.
  0x4000009E       HV\_X64\_MSR\_SINT14                             AccessSynicRegs                   R/W          Configures synthetic interrupt source 14. See section 17.6.4.
  0x4000009F       HV\_X64\_MSR\_SINT15                             AccessSynicRegs                   R/W          Configures synthetic interrupt source 15. See section 17.6.4.
  0x400000B0       HV\_X64\_MSR\_STIMER0\_CONFIG                    AccessSyntheticTimerRegs          R/W          Configuration register for synthetic timer 0. See section 18.3.1.
  0x400000B1       HV\_X64\_MSR\_STIMER0\_COUNT                     AccessSyntheticTimerRegs          R/W          Expiration time or period for synthetic timer 0. See section 18.3.2.
  0x400000B2       HV\_X64\_MSR\_STIMER1\_CONFIG                    AccessSyntheticTimerRegs          R/W          Configuration register for synthetic timer 1. See section 18.3.1.
  0x400000B3       HV\_X64\_MSR\_STIMER1\_COUNT                     AccessSyntheticTimerRegs          R/W          Expiration time or period for synthetic timer 1. See section 18.3.2.
  0x400000B4       HV\_X64\_MSR\_STIMER2\_CONFIG                    AccessSyntheticTimerRegs          R/W          Configuration register for synthetic timer 2. See section 18.3.1.
  0x400000B5       HV\_X64\_MSR\_STIMER2\_COUNT                     AccessSyntheticTimerRegs          R/W          Expiration time or period for synthetic timer 2. See section 18.3.2.
  0x400000B6       HV\_X64\_MSR\_STIMER3\_CONFIG                    AccessSyntheticTimerRegs          R/W          Configuration register for synthetic timer 3. See section 18.3.1.
  0x400000B7       HV\_X64\_MSR\_STIMER3\_COUNT                     AccessSyntheticTimerRegs          R/W          Expiration time or period for synthetic timer 3. See section 18.3.2.
  0x400000C1       HV\_X64\_MSR\_POWER\_STATE\_TRIGGER\_C1          CpuManagement                     R            Trigger the transition to power state C1
  0x400000C2       HV\_X64\_MSR\_POWER\_STATE\_TRIGGER\_C2          CpuManagement                     R            Trigger the transition to power state C2
  0x400000C3       HV\_X64\_MSR\_POWER\_STATE\_TRIGGER\_C3          CpuManagement                     R            Trigger the transition to power state C3
  0x400000D1       HV\_X64\_MSR\_POWER\_STATE\_CONFIG\_C1           CpuManagement                     R/W          Configure the recipe for power state transitions to C1
  0x400000D2       HV\_X64\_MSR\_POWER\_STATE\_CONFIG\_C2           CpuManagement                     R/W          Configure the recipe for power state transitions to C2
  0x400000D3       HV\_X64\_MSR\_POWER\_STATE\_CONFIG\_C3           CpuManagement                     R/W          Configure the recipe for power state transitions to C3
  0x400000E0       HV\_X64\_MSR\_STATS\_PARTITION\_RETAIL\_PAGE     AccessStatsReg                    R/W          Map the guest’s retail partition statistics page
  0x400000E1       HV\_X64\_MSR\_STATS\_PARTITION\_INTERNAL\_PAGE   AccessStatsReg                    R/W          Map the guest’s internal partition statistics page
  0x400000E2       HV\_X64\_MSR\_STATS\_VP\_RETAIL\_PAGE            AccessStatsReg                    R/W          Map the guest’s retail VP statistics page
  0x400000E3       HV\_X64\_MSR\_STATS\_VP\_INTERNAL\_PAGE          AccessStatsReg                    R/W          Map the guest’s internal VP statistics page
  0x400000F0       HV\_X64\_MSR\_GUEST\_IDLE                        AccessGuestIdleReg                R            Trigger the guest’s transition to the idle power state
  0x400000F1       HV\_X64\_MSR\_SYNTH\_DEBUG\_CONTROL                                                             
  0x400000F2       HV\_X64\_MSR\_SYNTH\_DEBUG\_STATUS                                                              
  0x400000F3       HV\_X64\_MSR\_SYNTH\_DEBUG\_SEND\_BUFFER                                                        
  0x400000F4       HV\_X64\_MSR\_SYNTH\_DEBUG\_RECEIVE\_BUFFER                                                     
  0x400000F5       HV\_X64\_MSR\_SYNTH\_DEBUG\_PENDING\_BUFFER                                                     
  0x40000100       HV\_X64\_MSR\_CRASH\_P0                                                                         
  0x40000101       HV\_X64\_MSR\_CRASH\_P1                                                                         
  0x40000102       HV\_X64\_MSR\_CRASH\_P2                                                                         
  0x40000103       HV\_X64\_MSR\_CRASH\_P3                                                                         
  0x40000104       HV\_X64\_MSR\_CRASH\_P4                                                                         
  0x40000105       HV\_X64\_MSR\_CRASH\_CTL                                                                        

<span id="_Ref141888937" class="anchor"><span id="_Toc221334080" class="anchor"><span id="_Toc222907549" class="anchor"><span id="_Toc342653323" class="anchor"><span id="_Toc439864354" class="anchor"></span></span></span></span></span>Appendix I: Event Log Entries
========================================================================================================================================================================================================================================================================

Note: In the table below, rows with bold entries in the “Event Name"
column and 8-byte entries in the “Event Number" column represent event
groups, not individual events. Not all groups have events defined, but
the groups are included for completeness.

  --------------------------------------------------------------------------------------------------------------------------------
  Event Name                                  Event Number         Event Description              Parameters
  ------------------------------------------- -------------------- ------------------------------ --------------------------------
  Boot Manager                                0x0000010000000000   

  Dispatch Manager                            0x0000000000000200   

  Hypercall                                   0x0000000000000400   

  HV\_TR\_HC\_HYPERCALL                       0x1A                 Hypercall                      Guest RIP,
                                                                                                  
                                                                                                  Input Value

  Intercept Manager                           0x0000000000000800   

  HV\_TR\_IM\_GUEST\_EXCEPTION                0x20                 Guest exception                Guest RIP,
                                                                                                  
                                                                                                  Type

  HV\_TR\_IM\_MSR\_READ                       0x21                 MSR Read                       Guest RIP,
                                                                                                  
                                                                                                  Index,
                                                                                                  
                                                                                                  Value (0 if unsuccessful)

  HV\_TR\_IM\_MSR\_WRITE                      0x22                 MSR Write                      Guest RIP,
                                                                                                  
                                                                                                  Index,
                                                                                                  
                                                                                                  Value

  HV\_TR\_IM\_ CR\_READ                       0x23                 Control Register Read          Guest RIP,
                                                                                                  
                                                                                                  Index,
                                                                                                  
                                                                                                  Value (0 if unsuccessful)

  HV\_TR\_IM\_CR\_WRITE                       0x24                 Control Register Write         Guest RIP,
                                                                                                  
                                                                                                  Index,
                                                                                                  
                                                                                                  Value

  HV\_TR\_IM\_HLT\_INSTRUCTION                0x25                 Hlt Instruction                Guest RIP

  HV\_TR\_IM\_MWAIT\_INSTRUCTION              0x26                 MWAIT Instruction              Guest RIP,
                                                                                                  
                                                                                                  MWAIT Extension,
                                                                                                  
                                                                                                  MWAIT Hint

  HV\_TR\_IM\_CPUID\_INSTRUCTION              0x27                 CPUID Instruction              Guest RIP,
                                                                                                  
                                                                                                  EAX Input,
                                                                                                  
                                                                                                  ECX Input

  HV\_TR\_IM\_IO\_PORT\_READ                  0x28                 IO Port Read                   Guest RIP,
                                                                                                  
                                                                                                  Port,
                                                                                                  
                                                                                                  Value (0 if unsuccessful)

  HV\_TR\_IM\_IO\_PORT\_WRITE                 0x29                 IO Port Write                  Guest RIP,
                                                                                                  
                                                                                                  Port,
                                                                                                  
                                                                                                  Value

  HV\_TR\_IM\_EXTERNAL\_INTERRUPT             0x2A                 External interrupt             Vector

  HV\_TR\_IM\_ INTERRUPT\_PENDING             0x2B                 Virtual Interrupt Pending      Guest RIP

  HV\_TR\_IM\_GUEST\_SHUTDOWN                 0x2C                 Guest Shutdown                 Guest RIP

  HV\_TR\_IM\_EMULATED\_INSTRUCTION           0x2D                 Emulated Instruction           Guest RIP

  HV\_TR\_IM\_NMI\_INTERRUPT                  0x2E                 Non-Maskable Interrupt         Guest RIP

  HV\_TR\_IM\_INVLPG\_INSTRUCTION             0x2F                 INVLPG Instruction             Guest RIP,
                                                                                                  
                                                                                                  Guest VA

  HV\_TR\_IM\_IRET\_INSTRUCTION               0x30                 IRET Instruction               Guest RIP

  HV\_TR\_IM\_TASK\_SWITCH                    0x31                 Task Switch                    Guest RIP

  HV\_TR\_IM\_INVD\_INSTRUCTION               0x32                 INVD Instruction               Guest RIP

  HV\_TR\_IM\_ DR\_ACCESS                     0x33                 Debug Register Access          Guest RIP

  HV\_TR\_IM\_FERR\_FREEZE                    0x34                 FERR Freeze                    Guest RIP

  HV\_TR\_IM\_REAL\_MODE\_INTERRUPT           0x35                 Emulated Real-Mode Interrupt   Guest RIP

  HV\_TR\_IM\_MEMORY\_INTERCEPT               0x36                 Memory Intercept               Guest RIP,
                                                                                                  
                                                                                                  GPA Intercept Type

  HV\_TR\_IM\_REFLECTED EXCEPTION             0x37                 Reflected Guest Exception      Guest RIP,
                                                                                                  
                                                                                                  Exception Type

  Instruction Completion                      0x0000000000001000   

  Object Manager                              0x0000000000002000   

  Partition Manager                           0x0000000000004000   

  HV\_TR\_IM\_APIC\_EOI                       0x38                                                

  HV\_TR\_IM\_APIC\_WRITE                     0x39                                                

  HV\_TR\_IM\_APIC\_ACCESS                    0x3A                                                

  HV\_TR\_IM\_NESTED\_PAGE\_FAULT             0x3B                                                

  HV\_TR\_IM\_PAUSE\_LOOP\_EXIT               0x3C                                                

  HV\_TR\_OB\_CREATE\_PARTITION               0x40                                                

  HV\_TR\_OB\_DELETE\_PARTITION               0x41                                                

  HV\_TR\_OB\_RESTORE\_PARTITION              0x42                                                

  HV\_TR\_OB\_RUNDOWN\_PARTITION              0x43                                                

  HV\_TR\_OB\_INIT\_PARTITION                 0x44                                                

  HV\_TR\_OB\_SCRUB\_PARTITION                0x45                                                

  HV\_TR\_PT\_REFERENCE\_TIME                 0x46                 Partition Reference Time       TscOffset, ReferenceTimeOffset

  Virtual Processor Manager                   0x0000000000008000   

  HV\_TR\_VP\_CREATE\_VP                      0x4B                 Create Virtual Processor       Partition ID,
                                                                                                  
                                                                                                  Thread ID,
                                                                                                  
                                                                                                  Hv Status

  HV\_TR\_VP\_DELETE\_VP                      0x4C                 Delete Virtual Processor       Partition ID,
                                                                                                  
                                                                                                  Thread ID,
                                                                                                  
                                                                                                  Hv Status

  Synthetic Interrupt Controller              0x0000000000010000   

  Synthetic Timers                            0x0000000000020000   

  Address Manager – Guest Virtual Addresses   0x0000000000040000   

  HV\_TR\_SYNIC\_DUMP\_INT\_MAPPING           0x50                 

  HV\_TR\_SYNIC\_CREATE\_INT\_MAPPING         0x51                 

  HV\_TR\_SYNIC\_FREE\_INT\_MAPPING           0x52                 

  HV\_TR\_SYNIC\_THROTTLE                     0x53                 

  HV\_TR\_SYNIC\_UNTHROTTLE                   0x54                 

  HV\_TR\_SYNIC\_LPSET\_INT\_MAPPING          0x55                 

  HV\_TR\_AM\_GVA\_GROW\_VIRTUAL\_TLB         0x70                 Grow Virtual TLB               Old Count,
                                                                                                  
                                                                                                  New Count

  HV\_TR\_AM\_GVA\_SHRINK\_VIRTUAL\_TLB       0x71                 Shrink Virtual TLB             Old Count,
                                                                                                  
                                                                                                  New Count,
                                                                                                  
                                                                                                  Free Count

  HV\_TR\_AM\_GVA\_FLUSH\_VIRTUAL\_TLB        0x72                 FlushVirtual TLB               Partition ID

  Address Manager                             0x0000000000080000   

  Virtual Abstraction Layer                   0x0000000000100000   

  Virtualization Manager                      0x0000000000200000   

  Scheduler                                   0x0000000000400000   

  HV\_TR\_SCH\_CONTEXT\_SWITCH                0xB0                 Context Switch                 Partition ID,
                                                                                                  
                                                                                                  Thread ID,
                                                                                                  
                                                                                                  TSC Offset (perf only)

  Threads                                     0x0000000000800000   

  Timers                                      0x0000000001000000   

  Kernel                                      0x0000000002000000   

  Memory Manager                              0x0000000004000000   

  Profiler                                    0x0000000008000000   

  HV\_TR\_SCH\_THREAD\_RUNNABLE\_LOCAL        0xB1                 

  HV\_TR\_SCH\_THREAD\_RUNNABLE\_DEFER        0xB2                 

  HV\_TR\_SCH\_EXPRESS                        0xB3                 

  HV\_TR\_SCH\_EXPRESS\_FAIL                  0xB4                 

  HV\_TR\_SCH\_APPLY\_CAP                     0xB5                 

  HV\_TR\_SCH\_SET\_CAP\_TIMER                0xB6                 

  HV\_TR\_SCH\_COMPUTE\_TIMESLICE             0xB7                 

  HV\_TR\_KE\_LIVEDUMP                        0xD2                 

  HV\_TR\_KE\_PPM\_SUMMARY\_INFO              0xD3                 

  HV\_TR\_KE\_PPM\_CSTATE\_INFO               0xD4                 

  HV\_TR\_KE\_PPM\_PSTATE\_INFO               0xD5                 

  HV\_TR\_KE\_PPM\_TSTATE\_INFO               0xD6                 

  HV\_TR\_KE\_PPM\_RUNDOWN\_SUMMARY\_INFO     0xD7                 

  HV\_TR\_KE\_PPM\_RUNDOWN\_CSTATE\_INFO      0xD8                 

  HV\_TR\_KE\_PPM\_RUNDOWN\_PSTATE\_INFO      0xD9                 

  HV\_TR\_KE\_PPM\_RUNDOWN\_TSTATE\_INFO      0xDA                 

  HV\_TR\_KE\_LIVEDUMP                        0xDB                 

  HV\_TR\_SCH\_PROFILER\_SAMPLE               0xF0                 Context Switch

  HV\_TR\_PROFILER\_HV\_MODULE                0Xf1                 
  --------------------------------------------------------------------------------------------------------------------------------

<span id="_Ref141889063" class="anchor"><span id="_Toc221334082" class="anchor"><span id="_Toc222907551" class="anchor"><span id="_Toc342653324" class="anchor"><span id="_Toc439864355" class="anchor"></span></span></span></span></span>Appendix J: Statistics Counter Definitions
=====================================================================================================================================================================================================================================================================================

<span id="_Toc142730996" class="anchor"><span id="_Toc142731369"
class="anchor"><span id="_Toc142998736" class="anchor"><span
id="_Toc143063828" class="anchor"><span id="_Toc143509937"
class="anchor"><span id="_Toc143510385" class="anchor"><span
id="_Toc144026430" class="anchor"><span id="_Toc144026761"
class="anchor"><span id="_Toc144276416" class="anchor"><span
id="_Toc144276760" class="anchor"><span id="_Toc144280348"
class="anchor"><span id="_Toc144280694" class="anchor"><span
id="_Toc144540932" class="anchor"><span id="_Toc144554835"
class="anchor"><span id="_Toc144722423" class="anchor"><span
id="_Toc145503886" class="anchor"><span id="_Toc145512306"
class="anchor"><span id="_Toc145513359" class="anchor"><span
id="_Toc145513743" class="anchor"><span id="_Toc222907552"
class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>The
hypervisor exposes statistics counters to guests, upon request, using
overlay pages in the partition’s GPA space. Each page is a packed
collection of statistics groups. Each group is prefixed by a header that
contains the group’s identification, the format version and the size of
the group in bytes (not including the header). The array of values
within the group (after the header) may be accessed using a zero-based
index into the array. Index zero references the group’s header. Each
64-bit value is of a particular type.

This appendix describes each supported statistics page and the groups
that it may contain. Statistics Counters are discussed in detail in
chapter 22.

<span id="_Toc141893634" class="anchor"><span id="_Toc142113487"
class="anchor"><span id="_Toc142114515" class="anchor"><span
id="_Toc145503888" class="anchor"><span id="_Toc145512308"
class="anchor"><span id="_Toc145513361" class="anchor"><span
id="_Toc145513745" class="anchor"><span id="_Toc222907553"
class="anchor"><span id="_Toc145503889" class="anchor"><span
id="_Toc145512309" class="anchor"><span id="_Toc145513362"
class="anchor"><span id="_Toc145513746"
class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span>**J.1
Hypervisor Counters\
\
**Hypervisor Counters describe hypervisor-wide states and items. There
is only one Hypervisor Counter Object in the system consisting of only
architectural values. As counters of a global class they can only be
accessed by the root partition.

<span id="_Toc145503890" class="anchor"><span id="_Toc145512310"
class="anchor"><span id="_Toc145513363" class="anchor"><span
id="_Toc145513747" class="anchor"><span id="_Toc222907554"
class="anchor"><span id="_Toc145503891" class="anchor"><span
id="_Toc145512311" class="anchor"><span id="_Toc145513364"
class="anchor"><span id="_Toc145513748"
class="anchor"></span></span></span></span></span></span></span></span></span>**J.1.1
Architected Hypervisor Counters Group**

**Group identifier:** HV\_STATISTICS\_TYPE\_HCA\_ID**\
Group version:** HV\_STATISTICS\_TYPE\_HCA\_VERSION

  ------------------------------------------------------------------------------------------------------------------------------------------------------
  Architected Hypervisor Counters

  (accessible from the root partition only)
  ------------------------------------------- ------------------------- -------- -----------------------------------------------------------------------
  Index

  1

  2

  3

  4

  5
  ------------------------------------------------------------------------------------------------------------------------------------------------------

<span id="_Toc141893635" class="anchor"><span id="_Toc142113488"
class="anchor"><span id="_Toc142114516" class="anchor"><span
id="_Toc145503893" class="anchor"><span id="_Toc145512313"
class="anchor"><span id="_Toc145513366" class="anchor"><span
id="_Toc145513750" class="anchor"><span id="_Toc222907555"
class="anchor"><span id="_Toc145503892" class="anchor"><span
id="_Toc145512312" class="anchor"><span id="_Toc145513365"
class="anchor"><span id="_Toc145513749"
class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span>**J.2
Logical Processor Counters**

Counters for Logical Processor Objects provide information about logical
processor-related states and items. The number of Logical Processor
Objects matches the number of logical processors in the system and
consists of both architectural and release-specific values. As counters
of a global class they can be only accessed by the root partition.

<span id="_Toc145512314" class="anchor"><span id="_Toc145513367"
class="anchor"><span id="_Toc145513751" class="anchor"><span
id="_Toc222907556" class="anchor"><span id="_Toc145512315"
class="anchor"><span id="_Toc145513368" class="anchor"><span
id="_Toc145513752"
class="anchor"></span></span></span></span></span></span></span>**J.2.1
Architected Logical Processor Counters Group**

**Group identifier:** HV\_STATISTICS\_TYPE\_LPA\_ID**\
Group version:** HV\_STATISTICS\_TYPE\_LPA\_VERSION

  --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  Architected Logical Processor Counters

  (accessible from the root partition only)
  ------------------------------------------- ------------------------------------- -------- -------------------------------------------------------------------------------------------------------------------------------------
  Index

  1

  2

  3

  4

  5

  6

  7

  8

  9

  10

  11

  12

  13

  14

  15

  16

  17

  18
  --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

<span id="_Toc141893636" class="anchor"><span id="_Toc142113489"
class="anchor"><span id="_Toc142114517" class="anchor"><span
id="_Toc145503896" class="anchor"><span id="_Toc145512318"
class="anchor"><span id="_Toc145513371" class="anchor"><span
id="_Toc145513755" class="anchor"><span id="_Toc222907557"
class="anchor"><span id="_Toc145503897" class="anchor"><span
id="_Toc145512319" class="anchor"><span id="_Toc145513372"
class="anchor"><span id="_Toc145513756"
class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span>**J.3
Partition Counters**

Counters for Partition Objects provide information about states and
items for a particular partition. The number of Partition Objects
matches the number of partitions present in the system consisting of
only architectural values. As counters of a local class they can be
accessed by a partition and its parent. In Version 1, the root partition
is the parent partition.

<span id="_Toc145512320" class="anchor"><span id="_Toc145513373"
class="anchor"><span id="_Toc145513757" class="anchor"><span
id="_Toc222907558" class="anchor"><span id="_Toc145512321"
class="anchor"><span id="_Toc145513374" class="anchor"><span
id="_Toc145513758"
class="anchor"></span></span></span></span></span></span></span>**J.3.1
Architected Partition Counters Group**

**Group identifier:** HV\_STATISTICS\_TYPE\_PA\_ID**\
Group version:** HV\_STATISTICS\_TYPE\_PA\_VERSION

  -----------------------------------------------------------------------------------------------------------------------------------------
  Architected Partition Counters

  (accessible from a partition and its parent)
  ---------------------------------------------- -------------------- -------- ------------------------------------------------------------
  Index

  1

  -----------------------------------------------------------------------------------------------------------------------------------------

<span id="_Toc222907559" class="anchor"></span>**J.3.2 Release-specific
Partition Counters Group**

**Group identifier:** HV\_STATISTICS\_TYPE\_PV\_ID\
**Group version:** HV\_STATISTICS\_TYPE\_PV\_VERSION

  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  Release-specific Partition Counters

  (accessible from a partition and its parent)
  ---------------------------------------------- ------------------------------- -------- ------------------------------------------------------------------------------------------
  Index

  1

  2

  3

  4

  5

  6

  7
  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

<span id="_Toc141893637" class="anchor"><span id="_Toc142113490"
class="anchor"><span id="_Toc142114518" class="anchor"><span
id="_Toc145503899" class="anchor"><span id="_Toc145512322"
class="anchor"><span id="_Toc145513375" class="anchor"><span
id="_Toc145513759" class="anchor"><span id="_Toc222907560"
class="anchor"><span id="_Toc145503900" class="anchor"><span
id="_Toc145512323" class="anchor"><span id="_Toc145513376"
class="anchor"><span id="_Toc145513760"
class="anchor"></span></span></span></span></span></span></span></span></span></span></span></span>**J.4
Virtual Processor Counters**

Counters for Virtual Processor Objects provide information about states
and items for a particular virtual processor. The number of Virtual
Processor Objects matches the number of virtual processors present in a
given partition and consists of both architectural and release-specific
values. As counters of a local class they can be accessed by the
partition and its parent. In Version 1, the root partition is the parent
partition.

<span id="_Toc145512324" class="anchor"><span id="_Toc145513377"
class="anchor"><span id="_Toc145513761" class="anchor"><span
id="_Toc222907561" class="anchor"><span id="_Toc145512325"
class="anchor"><span id="_Toc145513378" class="anchor"><span
id="_Toc145513762"
class="anchor"></span></span></span></span></span></span></span>**J.4.1
Architected Virtual Processor Counters Group**

**Group identifier:** HV\_STATISTICS\_TYPE\_VPA\_ID**\
Group version:** HV\_STATISTICS\_TYPE\_VPA\_VERSION

  ------------------------------------------------------------------------------------------------------------------------------------------------------------------
  Architected Virtual Processor Counters

  (accessible from a partition and its parent)
  ---------------------------------------------- --------------------- -------- ------------------------------------------------------------------------------------
  Index

  1

  2
  ------------------------------------------------------------------------------------------------------------------------------------------------------------------

<span id="_Toc145512326" class="anchor"><span id="_Toc145513379"
class="anchor"><span id="_Toc145513763" class="anchor"><span
id="_Toc222907562" class="anchor"><span id="_Toc145512327"
class="anchor"><span id="_Toc145513380" class="anchor"><span
id="_Toc145513764"
class="anchor"></span></span></span></span></span></span></span>**J.4.2
Release-specific Virtual Processor Counters Group**

**Group Identifier:** HV\_STATISTICS\_TYPE\_VPV\_ID**\
Group version:** HV\_STATISTICS\_TYPE\_VPV\_VERSION

  ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  Release-specific Virtual Processor Counters

  (accessible from a partition and its parent)
  ---------------------------------------------- ---------------------------------- -------- -----------------------------------------------------------------------------------------------------------------------
  Index

  1

  2

  3

  4

  5

  6

  7

  8

  9

  10

  11

  12

  13

  14

  15

  16

  17

  18

  19

  20

  21

  22

  23

  24

  25

  26

  27

  28

  29

  30

  31

  32

  33

  34

  35

  36

  37

  38

  39

  40

  41

  42

  43

  44

  45

  46

  47

  48

  49

  50

  51

  52

  53

  54

  55

  56

  57

  58

  59
  ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

[^1]: Some implementations may restrict this partition privilege to the
    root partition.

[^2]: This feature set is a subset of all processor features as exposed
    by CPUID. Other features are either hidden from non-root guests or
    are required to be enabled for Hyper-V to launch.

[^3]: Mda is also known as MessageDestinationAddress.

[^4]: Only the root partition may map global statistics pages.

[^5]: Status code is currently referenced by a released version of
    Microsoft Windows ®
